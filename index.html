<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.2/font/bootstrap-icons.css">

    <title>CELO <> OP op-geth forkdiff</title>

    <link rel="icon" type="image/x-icon" href="">

    <style>
        .line-stat {
            width: 14rem;
            float: right;
        }
        .line-stat div {
            width: 50%;
        }
        .text-add-ignored {
            color: #93ad93;
            font-style: italic;
        }
        .text-delete-ignored {
            color: #c47777;
            font-style: italic;
        }
        .toplevelstat {
            margin-left: 0 !important;
            width: 15rem;
        }
    </style>

    
<style>
    .term-container {
        background: #171717;
        border-radius: 5px;
        color: white;
        word-break: break-word;
        overflow-wrap: break-word;
        font-family: "SFMono-Regular", Monaco, Menlo, Consolas, "Liberation Mono", Courier, monospace;
        font-size: 12px;
        line-height: 20px;
        padding: 14px 18px;
        white-space: pre-wrap;
    }

    .term-container img { max-width: 100%; }

    .term a { color: inherit; text-decoration: underline; text-decoration-style: dashed; }
    .term a:hover { color: #2882F9 }

    @keyframes blink-animation {
        to {
            visibility: hidden;
        }
    }

    .term-fg1 { } /* don't bold beccause it looks weird */
    .term-fg2 { color: #838887; } /* faint (decreased intensity) - same as gray really */
    .term-fg3 { font-style: italic; } /* italic */
    .term-fg4 { text-decoration: underline; } /* underline */
    .term-fg5 { animation: blink-animation 1s steps(3, start) infinite; } /* blink */
    .term-fg9 { text-decoration: line-through; } /* crossed-out */

    .term-fg30 { color: #666666; } /* black (but we can't use black, so a diff color) */
    .term-fg31 { color: #ff7070; } /* red */
    .term-fg32 { color: #b0f986; } /* green */
    .term-fg33 { color: #c6c502; } /* yellow */
    .term-fg34 { color: #8db7e0; } /* blue */
    .term-fg35 { color: #f271fb; } /* magenta */
    .term-fg36 { color: #6bf7ff; } /* cyan */

    /* high intense colors */
    .term-fgi1 { color: #5ef765; }
    .term-fgi90 { color: #838887; } /* grey */
    .term-fgi91 { color: #ff3333; } /* red */
    .term-fgi92 { color: #00FF00; } /* green */
    .term-fgi93 { color: #fffc67; } /* yellow */
    .term-fgi94 { color: #6871ff; } /* blue */
    .term-fgi95 { color: #ff76ff; } /* magenta */
    .term-fgi96 { color: #60fcff; } /* cyan */

    /* background colors */
    .term-bg40 { background: #676767; } /* grey */
    .term-bg41 { background: #ff4343; } /* red */
    .term-bg42 { background: #99ff5f; } /* green */

    /* custom foreground/background combos for readability */
    .term-fg31.term-bg40 { color: #F8A39F; }

    /* xterm colors */
    .term-fgx16 { color: #000000; }
    .term-fgx17 { color: #00005f; }
    .term-fgx18 { color: #000087; }
    .term-fgx19 { color: #0000af; }
    .term-fgx20 { color: #0000d7; }
    .term-fgx21 { color: #0000ff; }
    .term-fgx22 { color: #005f00; }
    .term-fgx23 { color: #005f5f; }
    .term-fgx24 { color: #005f87; }
    .term-fgx25 { color: #005faf; }
    .term-fgx26 { color: #005fd7; }
    .term-fgx27 { color: #005fff; }
    .term-fgx28 { color: #008700; }
    .term-fgx29 { color: #00875f; }
    .term-fgx30 { color: #008787; }
    .term-fgx31 { color: #0087af; }
    .term-fgx32 { color: #0087d7; }
    .term-fgx33 { color: #0087ff; }
    .term-fgx34 { color: #00af00; }
    .term-fgx35 { color: #00af5f; }
    .term-fgx36 { color: #00af87; }
    .term-fgx37 { color: #00afaf; }
    .term-fgx38 { color: #00afd7; }
    .term-fgx39 { color: #00afff; }
    .term-fgx40 { color: #00d700; }
    .term-fgx41 { color: #00d75f; }
    .term-fgx42 { color: #00d787; }
    .term-fgx43 { color: #00d7af; }
    .term-fgx44 { color: #00d7d7; }
    .term-fgx45 { color: #00d7ff; }
    .term-fgx46 { color: #00ff00; }
    .term-fgx47 { color: #00ff5f; }
    .term-fgx48 { color: #00ff87; }
    .term-fgx49 { color: #00ffaf; }
    .term-fgx50 { color: #00ffd7; }
    .term-fgx51 { color: #00ffff; }
    .term-fgx52 { color: #5f0000; }
    .term-fgx53 { color: #5f005f; }
    .term-fgx54 { color: #5f0087; }
    .term-fgx55 { color: #5f00af; }
    .term-fgx56 { color: #5f00d7; }
    .term-fgx57 { color: #5f00ff; }
    .term-fgx58 { color: #5f5f00; }
    .term-fgx59 { color: #5f5f5f; }
    .term-fgx60 { color: #5f5f87; }
    .term-fgx61 { color: #5f5faf; }
    .term-fgx62 { color: #5f5fd7; }
    .term-fgx63 { color: #5f5fff; }
    .term-fgx64 { color: #5f8700; }
    .term-fgx65 { color: #5f875f; }
    .term-fgx66 { color: #5f8787; }
    .term-fgx67 { color: #5f87af; }
    .term-fgx68 { color: #5f87d7; }
    .term-fgx69 { color: #5f87ff; }
    .term-fgx70 { color: #5faf00; }
    .term-fgx71 { color: #5faf5f; }
    .term-fgx72 { color: #5faf87; }
    .term-fgx73 { color: #5fafaf; }
    .term-fgx74 { color: #5fafd7; }
    .term-fgx75 { color: #5fafff; }
    .term-fgx76 { color: #5fd700; }
    .term-fgx77 { color: #5fd75f; }
    .term-fgx78 { color: #5fd787; }
    .term-fgx79 { color: #5fd7af; }
    .term-fgx80 { color: #5fd7d7; }
    .term-fgx81 { color: #5fd7ff; }
    .term-fgx82 { color: #5fff00; }
    .term-fgx83 { color: #5fff5f; }
    .term-fgx84 { color: #5fff87; }
    .term-fgx85 { color: #5fffaf; }
    .term-fgx86 { color: #5fffd7; }
    .term-fgx87 { color: #5fffff; }
    .term-fgx88 { color: #870000; }
    .term-fgx89 { color: #87005f; }
    .term-fgx90 { color: #870087; }
    .term-fgx91 { color: #8700af; }
    .term-fgx92 { color: #8700d7; }
    .term-fgx93 { color: #8700ff; }
    .term-fgx94 { color: #875f00; }
    .term-fgx95 { color: #875f5f; }
    .term-fgx96 { color: #875f87; }
    .term-fgx97 { color: #875faf; }
    .term-fgx98 { color: #875fd7; }
    .term-fgx99 { color: #875fff; }
    .term-fgx100 { color: #878700; }
    .term-fgx101 { color: #87875f; }
    .term-fgx102 { color: #878787; }
    .term-fgx103 { color: #8787af; }
    .term-fgx104 { color: #8787d7; }
    .term-fgx105 { color: #8787ff; }
    .term-fgx106 { color: #87af00; }
    .term-fgx107 { color: #87af5f; }
    .term-fgx108 { color: #87af87; }
    .term-fgx109 { color: #87afaf; }
    .term-fgx110 { color: #87afd7; }
    .term-fgx111 { color: #87afff; }
    .term-fgx112 { color: #87d700; }
    .term-fgx113 { color: #87d75f; }
    .term-fgx114 { color: #87d787; }
    .term-fgx115 { color: #87d7af; }
    .term-fgx116 { color: #87d7d7; }
    .term-fgx117 { color: #87d7ff; }
    .term-fgx118 { color: #87ff00; }
    .term-fgx119 { color: #87ff5f; }
    .term-fgx120 { color: #87ff87; }
    .term-fgx121 { color: #87ffaf; }
    .term-fgx122 { color: #87ffd7; }
    .term-fgx123 { color: #87ffff; }
    .term-fgx124 { color: #af0000; }
    .term-fgx125 { color: #af005f; }
    .term-fgx126 { color: #af0087; }
    .term-fgx127 { color: #af00af; }
    .term-fgx128 { color: #af00d7; }
    .term-fgx129 { color: #af00ff; }
    .term-fgx130 { color: #af5f00; }
    .term-fgx131 { color: #af5f5f; }
    .term-fgx132 { color: #af5f87; }
    .term-fgx133 { color: #af5faf; }
    .term-fgx134 { color: #af5fd7; }
    .term-fgx135 { color: #af5fff; }
    .term-fgx136 { color: #af8700; }
    .term-fgx137 { color: #af875f; }
    .term-fgx138 { color: #af8787; }
    .term-fgx139 { color: #af87af; }
    .term-fgx140 { color: #af87d7; }
    .term-fgx141 { color: #af87ff; }
    .term-fgx142 { color: #afaf00; }
    .term-fgx143 { color: #afaf5f; }
    .term-fgx144 { color: #afaf87; }
    .term-fgx145 { color: #afafaf; }
    .term-fgx146 { color: #afafd7; }
    .term-fgx147 { color: #afafff; }
    .term-fgx148 { color: #afd700; }
    .term-fgx149 { color: #afd75f; }
    .term-fgx150 { color: #afd787; }
    .term-fgx151 { color: #afd7af; }
    .term-fgx152 { color: #afd7d7; }
    .term-fgx153 { color: #afd7ff; }
    .term-fgx154 { color: #afff00; }
    .term-fgx155 { color: #afff5f; }
    .term-fgx156 { color: #afff87; }
    .term-fgx157 { color: #afffaf; }
    .term-fgx158 { color: #afffd7; }
    .term-fgx159 { color: #afffff; }
    .term-fgx160 { color: #d70000; }
    .term-fgx161 { color: #d7005f; }
    .term-fgx162 { color: #d70087; }
    .term-fgx163 { color: #d700af; }
    .term-fgx164 { color: #d700d7; }
    .term-fgx165 { color: #d700ff; }
    .term-fgx166 { color: #d75f00; }
    .term-fgx167 { color: #d75f5f; }
    .term-fgx168 { color: #d75f87; }
    .term-fgx169 { color: #d75faf; }
    .term-fgx170 { color: #d75fd7; }
    .term-fgx171 { color: #d75fff; }
    .term-fgx172 { color: #d78700; }
    .term-fgx173 { color: #d7875f; }
    .term-fgx174 { color: #d78787; }
    .term-fgx175 { color: #d787af; }
    .term-fgx176 { color: #d787d7; }
    .term-fgx177 { color: #d787ff; }
    .term-fgx178 { color: #d7af00; }
    .term-fgx179 { color: #d7af5f; }
    .term-fgx180 { color: #d7af87; }
    .term-fgx181 { color: #d7afaf; }
    .term-fgx182 { color: #d7afd7; }
    .term-fgx183 { color: #d7afff; }
    .term-fgx184 { color: #d7d700; }
    .term-fgx185 { color: #d7d75f; }
    .term-fgx186 { color: #d7d787; }
    .term-fgx187 { color: #d7d7af; }
    .term-fgx188 { color: #d7d7d7; }
    .term-fgx189 { color: #d7d7ff; }
    .term-fgx190 { color: #d7ff00; }
    .term-fgx191 { color: #d7ff5f; }
    .term-fgx192 { color: #d7ff87; }
    .term-fgx193 { color: #d7ffaf; }
    .term-fgx194 { color: #d7ffd7; }
    .term-fgx195 { color: #d7ffff; }
    .term-fgx196 { color: #ff0000; }
    .term-fgx197 { color: #ff005f; }
    .term-fgx198 { color: #ff0087; }
    .term-fgx199 { color: #ff00af; }
    .term-fgx200 { color: #ff00d7; }
    .term-fgx201 { color: #ff00ff; }
    .term-fgx202 { color: #ff5f00; }
    .term-fgx203 { color: #ff5f5f; }
    .term-fgx204 { color: #ff5f87; }
    .term-fgx205 { color: #ff5faf; }
    .term-fgx206 { color: #ff5fd7; }
    .term-fgx207 { color: #ff5fff; }
    .term-fgx208 { color: #ff8700; }
    .term-fgx209 { color: #ff875f; }
    .term-fgx210 { color: #ff8787; }
    .term-fgx211 { color: #ff87af; }
    .term-fgx212 { color: #ff87d7; }
    .term-fgx213 { color: #ff87ff; }
    .term-fgx214 { color: #ffaf00; }
    .term-fgx215 { color: #ffaf5f; }
    .term-fgx216 { color: #ffaf87; }
    .term-fgx217 { color: #ffafaf; }
    .term-fgx218 { color: #ffafd7; }
    .term-fgx219 { color: #ffafff; }
    .term-fgx220 { color: #ffd700; }
    .term-fgx221 { color: #ffd75f; }
    .term-fgx222 { color: #ffd787; }
    .term-fgx223 { color: #ffd7af; }
    .term-fgx224 { color: #ffd7d7; }
    .term-fgx225 { color: #ffd7ff; }
    .term-fgx226 { color: #ffff00; }
    .term-fgx227 { color: #ffff5f; }
    .term-fgx228 { color: #ffff87; }
    .term-fgx229 { color: #ffffaf; }
    .term-fgx230 { color: #ffffd7; }
    .term-fgx231 { color: #ffffff; }
    .term-fgx232 { color: #080808; }
    .term-fgx233 { color: #121212; }
    .term-fgx234 { color: #1c1c1c; }
    .term-fgx235 { color: #262626; }
    .term-fgx236 { color: #303030; }
    .term-fgx237 { color: #3a3a3a; }
    .term-fgx238 { color: #444444; }
    .term-fgx239 { color: #4e4e4e; }
    .term-fgx240 { color: #585858; }
    .term-fgx241 { color: #626262; }
    .term-fgx242 { color: #6c6c6c; }
    .term-fgx243 { color: #767676; }
    .term-fgx244 { color: #808080; }
    .term-fgx245 { color: #8a8a8a; }
    .term-fgx246 { color: #949494; }
    .term-fgx247 { color: #9e9e9e; }
    .term-fgx248 { color: #a8a8a8; }
    .term-fgx249 { color: #b2b2b2; }
    .term-fgx250 { color: #bcbcbc; }
    .term-fgx251 { color: #c6c6c6; }
    .term-fgx252 { color: #d0d0d0; }
    .term-fgx253 { color: #dadada; }
    .term-fgx254 { color: #e4e4e4; }
    .term-fgx255 { color: #eeeeee; }
</style>

</head>
<body>
    <div class="col-xl-10 col-xxl-8 mx-auto px-3 py-1 py-md-3">
        <main class="container-fluid">
            <div class="row">
                <div>
                    <div class="float-end">
                        <div class="form-check form-switch">
                            <i class="bi bi-brightness-low" id="dark-mode-icon"></i>
                            <input class="form-check-input" type="checkbox" role="switch" id="dark-mode-toggle" data-bs-toggle="tooltip"
                                   data-bs-placement="bottom" data-bs-title="Toggle Dark Mode"/>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row">
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"role="button" aria-expanded="true" aria-controls="id-a927905c881dced955d47506">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h1>Celo's op-geth</h1></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                    <span class="text-end">diff:</span>
                
                
                    <span class="text-end">ignored:</span>
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 toplevelstat">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+11398</span></div>
                    <div class="text-start"><span class="text-danger">-600</span></div>
                
                
                    <div class="text-end"><span class="text-add-ignored">+364</span></div>
                    <div class="text-start"><span class="text-delete-ignored">-545</span></div>
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse show border-1 ps-3 my-3" id="id-a927905c881dced955d47506">
        <div><p>This is an overview of the changes in <a href="https://github.com/celo-org/op-geth">Celo&rsquo;s <code>op-geth</code> implementation</a>,
a fork of <a href="https://github.com/ethereum-optimism/op-geth">Optimism&rsquo;s <code>op-geth</code></a>.</p>

<p>For differences between the base <code>op-geth</code> and <code>go-ethereum</code>, check out Optimism&rsquo;s
<a href="https://op-geth.optimism.io/">fork-diff overview of changes</a>.</p>
</div>
        <div>
            
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-8caf144abd49112b4e56e9e9"role="button" aria-expanded="false" aria-controls="id-8caf144abd49112b4e56e9e9">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>Celo-specific features</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+7235</span></div>
                    <div class="text-start"><span class="text-danger">-298</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-8caf144abd49112b4e56e9e9">
        <div></div>
        <div>
            
            
        </div>
        <div>
            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-6f46fa9147ed9905192c1efd"role="button" aria-expanded="false" aria-controls="id-6f46fa9147ed9905192c1efd">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h3>Celo token duality</h3></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+311</span></div>
                    <div class="text-start"><span class="text-danger">-42</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-6f46fa9147ed9905192c1efd">
        <div><p>The Celo token is both the native token and ERC-20 compatible.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9a26b71f373b0783cf5b91a3" role="button"
                       aria-expanded="false" aria-controls="id-9a26b71f373b0783cf5b91a3">
                        <code>core/vm/celo_contracts.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/celo_contracts.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+107</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9a26b71f373b0783cf5b91a3"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;celo_contracts.go CELO&#47;core&#47;vm&#47;celo_contracts.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..b0983145dc76d1c69ef04749d6bb0d97d3d75087</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;celo_contracts.go</span>
<span class="term-fg36">@@ -0,0 +1,107 @@</span>
<span class="term-fg32">+package vm</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&#47;addresses&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type CeloPrecompiledContract interface {</span>
<span class="term-fg32">+	RequiredGas(input []byte) uint64                              &#47;&#47; RequiredGas calculates the contract gas use</span>
<span class="term-fg32">+	Run(input []byte, ctx *celoPrecompileContext) ([]byte, error) &#47;&#47; Run runs the precompiled contract</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type wrap struct {</span>
<span class="term-fg32">+	PrecompiledContract</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (pw *wrap) Run(input []byte, ctx *celoPrecompileContext) ([]byte, error) {</span>
<span class="term-fg32">+	return pw.PrecompiledContract.Run(input)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type celoPrecompileContext struct {</span>
<span class="term-fg32">+	*BlockContext</span>
<span class="term-fg32">+	*params.Rules</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	caller common.Address</span>
<span class="term-fg32">+	evm    *EVM</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func NewContext(caller common.Address, evm *EVM) *celoPrecompileContext {</span>
<span class="term-fg32">+	return &amp;celoPrecompileContext{</span>
<span class="term-fg32">+		BlockContext: &amp;evm.Context,</span>
<span class="term-fg32">+		Rules:        &amp;evm.chainRules,</span>
<span class="term-fg32">+		caller:       caller,</span>
<span class="term-fg32">+		evm:          evm,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func celoPrecompileAddress(index byte) common.Address {</span>
<span class="term-fg32">+	celoPrecompiledContractsAddressOffset := byte(0xff)</span>
<span class="term-fg32">+	return common.BytesToAddress(append([]byte{0}, (celoPrecompiledContractsAddressOffset - index)))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (ctx *celoPrecompileContext) IsCallerCeloToken() (bool, error) {</span>
<span class="term-fg32">+	tokenAddress := addresses.CeloTokenAddress</span>
<span class="term-fg32">+	if ctx.evm.ChainConfig().ChainID != nil &amp;&amp; ctx.evm.ChainConfig().ChainID.Uint64() == addresses.AlfajoresChainID {</span>
<span class="term-fg32">+		tokenAddress = addresses.CeloTokenAlfajoresAddress</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return tokenAddress == ctx.caller, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Native transfer contract to make CELO ERC20 compatible.</span>
<span class="term-fg32">+type transfer struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *transfer) RequiredGas(input []byte) uint64 {</span>
<span class="term-fg32">+	return params.CallValueTransferGas</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *transfer) Run(input []byte, ctx *celoPrecompileContext) ([]byte, error) {</span>
<span class="term-fg32">+	if isCeloToken, err := ctx.IsCallerCeloToken(); err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	} else if !isCeloToken {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;unable to call transfer from unpermissioned address&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; input is comprised of 3 arguments:</span>
<span class="term-fg32">+	&#47;&#47;   from:  32 bytes representing the address of the sender</span>
<span class="term-fg32">+	&#47;&#47;   to:    32 bytes representing the address of the recipient</span>
<span class="term-fg32">+	&#47;&#47;   value: 32 bytes, a 256 bit integer representing the amount of CELO to transfer</span>
<span class="term-fg32">+	&#47;&#47; 3 arguments x 32 bytes each = 96 bytes total input</span>
<span class="term-fg32">+	if len(input) != 96 {</span>
<span class="term-fg32">+		return nil, ErrInputLength</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; The from parameter should always be set to the caller of the</span>
<span class="term-fg32">+	&#47;&#47; function calling the precompile (tx.sender in Solidity). Reasons why</span>
<span class="term-fg32">+	&#47;&#47; we have to pass that into the precompile from outside:</span>
<span class="term-fg32">+	&#47;&#47; * We can&#39;t use ctx.caller because that is always the CELO token</span>
<span class="term-fg32">+	&#47;&#47; * We can&#39;t use ctx.evm.Origin because that would limit usage to EOA accounts</span>
<span class="term-fg32">+	&#47;&#47; * The real value we could use is the caller&#39;s caller, which is not readily available</span>
<span class="term-fg32">+	from := common.BytesToAddress(input[0:32])</span>
<span class="term-fg32">+	to := common.BytesToAddress(input[32:64])</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var parsed bool</span>
<span class="term-fg32">+	value, parsed := math.ParseBig256(hexutil.Encode(input[64:96]))</span>
<span class="term-fg32">+	if !parsed {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;Error parsing transfer: unable to parse value from &quot; + hexutil.Encode(input[64:96]))</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	valueU256, overflow := uint256.FromBig(value)</span>
<span class="term-fg32">+	if overflow {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;Error parsing transfer: value overflow&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Fail if we&#39;re trying to transfer more than the available balance</span>
<span class="term-fg32">+	if !ctx.CanTransfer(ctx.evm.StateDB, from, valueU256) {</span>
<span class="term-fg32">+		return nil, ErrInsufficientBalance</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	ctx.Transfer(ctx.evm.StateDB, from, to, valueU256)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return nil, nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b1c131c5ea71a5db78b7e417" role="button"
                       aria-expanded="false" aria-controls="id-b1c131c5ea71a5db78b7e417">
                        <code>core/vm/celo_contracts_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/celo_contracts_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+120</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b1c131c5ea71a5db78b7e417"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;celo_contracts_test.go CELO&#47;core&#47;vm&#47;celo_contracts_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9a0e5a49e41a4cdd1c3f266799f0a267851141fe</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;celo_contracts_test.go</span>
<span class="term-fg36">@@ -0,0 +1,120 @@</span>
<span class="term-fg32">+package vm</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&#47;addresses&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+	&quot;golang.org&#47;x&#47;crypto&#47;sha3&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func makeTestHeaderHash(number *big.Int) common.Hash {</span>
<span class="term-fg32">+	preimage := append([]byte(&quot;fakeheader&quot;), common.LeftPadBytes(number.Bytes()[:], 32)...)</span>
<span class="term-fg32">+	return common.Hash(sha3.Sum256(preimage))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func makeTestHeader(number *big.Int) *types.Header {</span>
<span class="term-fg32">+	return &amp;types.Header{</span>
<span class="term-fg32">+		ParentHash: makeTestHeaderHash(new(big.Int).Sub(number, common.Big1)),</span>
<span class="term-fg32">+		Number:     number,</span>
<span class="term-fg32">+		GasUsed:    params.DefaultGasLimit &#47; 2,</span>
<span class="term-fg32">+		Time:       number.Uint64() * 5,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var testHeader = makeTestHeader(big.NewInt(10000))</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var vmBlockCtx = BlockContext{</span>
<span class="term-fg32">+	CanTransfer: func(db StateDB, addr common.Address, amount *uint256.Int) bool {</span>
<span class="term-fg32">+		&#47;&#47; Assume all addresses but the zero address can transfer for testing</span>
<span class="term-fg32">+		if addr == common.ZeroAddress {</span>
<span class="term-fg32">+			return false</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			return true</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+	Transfer: func(db StateDB, a1, a2 common.Address, i *uint256.Int) {</span>
<span class="term-fg32">+		panic(&quot;transfer: not implemented&quot;)</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+	GetHash: func(u uint64) common.Hash {</span>
<span class="term-fg32">+		panic(&quot;getHash: not implemented&quot;)</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+	Coinbase:    common.Address{},</span>
<span class="term-fg32">+	BlockNumber: new(big.Int).Set(testHeader.Number),</span>
<span class="term-fg32">+	Time:        testHeader.Time,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var vmTxCtx = TxContext{</span>
<span class="term-fg32">+	GasPrice: common.Big1,</span>
<span class="term-fg32">+	Origin:   common.HexToAddress(&quot;a11ce&quot;),</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Create a global mock EVM for use in the following tests.</span>
<span class="term-fg32">+var mockEVM = &amp;EVM{</span>
<span class="term-fg32">+	chainConfig: params.TestChainConfig,</span>
<span class="term-fg32">+	Context:     vmBlockCtx,</span>
<span class="term-fg32">+	TxContext:   vmTxCtx,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var mockPrecompileContext = NewContext(common.HexToAddress(&quot;1337&quot;), mockEVM)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestPrecompileTransfer(t *testing.T) {</span>
<span class="term-fg32">+	type args struct {</span>
<span class="term-fg32">+		input []byte</span>
<span class="term-fg32">+		ctx   *celoPrecompileContext</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		name        string</span>
<span class="term-fg32">+		args        args</span>
<span class="term-fg32">+		wantErr     bool</span>
<span class="term-fg32">+		expectedErr string</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Test transfer with invalid caller&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				input: []byte(&quot;&quot;),</span>
<span class="term-fg32">+				ctx:   mockPrecompileContext,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantErr:     true,</span>
<span class="term-fg32">+			expectedErr: &quot;unable to call transfer from unpermissioned address&quot;,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Test transfer with short input&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				input: []byte(&quot;0000&quot;),</span>
<span class="term-fg32">+				ctx:   NewContext(addresses.CeloTokenAddress, mockEVM),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantErr:     true,</span>
<span class="term-fg32">+			expectedErr: &quot;invalid input length&quot;,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Test transferring from zero address (was used for minting on Celo L1)&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				&#47;&#47; input consists of (from, to, value), each 32 bytes. In this case (0x0, 0x1, 2).</span>
<span class="term-fg32">+				input: []byte{</span>
<span class="term-fg32">+					0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,</span>
<span class="term-fg32">+					0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,</span>
<span class="term-fg32">+					0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2,</span>
<span class="term-fg32">+				},</span>
<span class="term-fg32">+				ctx: NewContext(addresses.CeloTokenAddress, mockEVM),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantErr:     true,</span>
<span class="term-fg32">+			expectedErr: &quot;insufficient balance for transfer&quot;,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for _, tt := range tests {</span>
<span class="term-fg32">+		t.Run(tt.name, func(t *testing.T) {</span>
<span class="term-fg32">+			c := &amp;transfer{}</span>
<span class="term-fg32">+			_, err := c.Run(tt.args.input, tt.args.ctx)</span>
<span class="term-fg32">+			if tt.wantErr {</span>
<span class="term-fg32">+				if err == nil {</span>
<span class="term-fg32">+					t.Errorf(&quot;transfer.Run() expected error = %v&quot;, tt.expectedErr)</span>
<span class="term-fg32">+				} else if err.Error() != tt.expectedErr {</span>
<span class="term-fg32">+					t.Errorf(&quot;transfer.Run() error = %v, expected %v&quot;, err, tt.wantErr)</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c0718cab57eebcc44e51e82c" role="button"
                       aria-expanded="false" aria-controls="id-c0718cab57eebcc44e51e82c">
                        <code>core/vm/contracts.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/vm/contracts.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/contracts.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+30</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c0718cab57eebcc44e51e82c"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;contracts.go CELO&#47;core&#47;vm&#47;contracts.go</span>
<span class="term-fg1">index cd819f9e7b6848011cd8ab427b646a81031c14c5..c1e8c1bfcdda6d879b37684ac8b8f52c5c49318f 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;vm&#47;contracts.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;contracts.go</span>
<span class="term-fg36">@@ -124,6 +124,12 @@</span> 	common.BytesToAddress([]byte{0x0a}):       &amp;kzgPointEvaluation{},
 	common.BytesToAddress([]byte{0x01, 0x00}): &amp;p256Verify{},
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; PrecompiledCeloContractsCel2 contains a set of pre-compiled contracts used</span>
<span class="term-fg32">+&#47;&#47; in the Cel2 release which require the extra celoPrecompileContext.</span>
<span class="term-fg32">+var PrecompiledCeloContractsCel2 = map[common.Address]CeloPrecompiledContract{</span>
<span class="term-fg32">+	celoPrecompileAddress(2): &amp;transfer{},</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; PrecompiledContractsBLS contains the set of pre-compiled Ethereum
 &#47;&#47; contracts specified in EIP-2537. These are exported for testing purposes.
 var PrecompiledContractsBLS = map[common.Address]PrecompiledContract{
<span class="term-fg36">@@ -139,6 +145,7 @@</span> 	common.BytesToAddress([]byte{18}): &amp;bls12381MapG2{},
 }
&nbsp;
 var (
<span class="term-fg32">+	PrecompiledAddressesCel2      []common.Address</span>
 	PrecompiledAddressesFjord     []common.Address
 	PrecompiledAddressesCancun    []common.Address
 	PrecompiledAddressesBerlin    []common.Address
<span class="term-fg36">@@ -168,8 +175,9 @@</span> 		PrecompiledAddressesFjord = append(PrecompiledAddressesFjord, k)
 	}
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; ActivePrecompiles returns the precompiles enabled with the current configuration.</span>
<span class="term-fg31">-func ActivePrecompiles(rules params.Rules) []common.Address {</span>
<span class="term-fg32">+&#47;&#47; OptimismPrecompiles returns the original Optimism precompiles enabled with</span>
<span class="term-fg32">+&#47;&#47; the current configuration.</span>
<span class="term-fg32">+func OptimismPrecompiles(rules params.Rules) []common.Address {</span>
 	switch {
 	case rules.IsOptimismFjord:
 		return PrecompiledAddressesFjord
<span class="term-fg36">@@ -186,18 +194,36 @@</span> 		return PrecompiledAddressesHomestead
 	}
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; ActivePrecompiles returns the precompiles enabled with the current configuration.</span>
<span class="term-fg32">+func ActivePrecompiles(rules params.Rules) []common.Address {</span>
<span class="term-fg32">+	addresses := OptimismPrecompiles(rules)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if !rules.IsCel2 {</span>
<span class="term-fg32">+		return addresses</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	PrecompiledAddressesCel2 = PrecompiledAddressesCel2[:0]</span>
<span class="term-fg32">+	PrecompiledAddressesCel2 = append(PrecompiledAddressesCel2, addresses...)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for k := range PrecompiledCeloContractsCel2 {</span>
<span class="term-fg32">+		PrecompiledAddressesCel2 = append(PrecompiledAddressesCel2, k)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return PrecompiledAddressesCel2</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; RunPrecompiledContract runs and evaluates the output of a precompiled contract.
 &#47;&#47; It returns
 &#47;&#47; - the returned bytes,
 &#47;&#47; - the _remaining_ gas,
 &#47;&#47; - any error that occurred
<span class="term-fg31">-func RunPrecompiledContract(p PrecompiledContract, input []byte, suppliedGas uint64) (ret []byte, remainingGas uint64, err error) {</span>
<span class="term-fg32">+func RunPrecompiledContract(p CeloPrecompiledContract, input []byte, suppliedGas uint64, ctx *celoPrecompileContext) (ret []byte, remainingGas uint64, err error) {</span>
 	gasCost := p.RequiredGas(input)
 	if suppliedGas &lt; gasCost {
 		return nil, 0, ErrOutOfGas
 	}
 	suppliedGas -= gasCost
<span class="term-fg31">-	output, err := p.Run(input)</span>
<span class="term-fg32">+	output, err := p.Run(input, ctx)</span>
 	return output, suppliedGas, err
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a4804dd6e713be977422c94b" role="button"
                       aria-expanded="false" aria-controls="id-a4804dd6e713be977422c94b">
                        <code>core/vm/contracts_fuzz_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/vm/contracts_fuzz_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/contracts_fuzz_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a4804dd6e713be977422c94b"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;contracts_fuzz_test.go CELO&#47;core&#47;vm&#47;contracts_fuzz_test.go</span>
<span class="term-fg1">index 87c1fff7cc81d919b21585b33194494961d9be24..8bba7b73e2fad026a172e2671f00a6ff23c7a9d1 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;vm&#47;contracts_fuzz_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;contracts_fuzz_test.go</span>
<span class="term-fg36">@@ -36,7 +36,7 @@</span> 		if gas &gt; 10_000_000 {
 			return
 		}
 		inWant := string(input)
<span class="term-fg31">-		RunPrecompiledContract(p, input, gas)</span>
<span class="term-fg32">+		RunPrecompiledContract(p, input, gas, mockPrecompileContext)</span>
 		if inHave := string(input); inWant != inHave {
 			t.Errorf(&quot;Precompiled %v modified input data&quot;, a)
 		}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1a6aef7afff1841d465a8941" role="button"
                       aria-expanded="false" aria-controls="id-1a6aef7afff1841d465a8941">
                        <code>core/vm/contracts_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/vm/contracts_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/contracts_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+26</span></div>
                            <div class="text-start"><span class="text-danger">-26</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1a6aef7afff1841d465a8941"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;contracts_test.go CELO&#47;core&#47;vm&#47;contracts_test.go</span>
<span class="term-fg1">index 38781545e1fdbc5df0998024a3c7573bb40c2c5a..9e63b1ab14fc210314c283e2745137adc29194aa 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;vm&#47;contracts_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;contracts_test.go</span>
<span class="term-fg36">@@ -45,30 +45,30 @@</span> }
&nbsp;
 &#47;&#47; allPrecompiles does not map to the actual set of precompiles, as it also contains
 &#47;&#47; repriced versions of precompiles at certain slots
<span class="term-fg31">-var allPrecompiles = map[common.Address]PrecompiledContract{</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{1}):    &amp;ecrecover{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{2}):    &amp;sha256hash{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{3}):    &amp;ripemd160hash{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{4}):    &amp;dataCopy{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{5}):    &amp;bigModExp{eip2565: false},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0xf5}): &amp;bigModExp{eip2565: true},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{6}):    &amp;bn256AddIstanbul{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{7}):    &amp;bn256ScalarMulIstanbul{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{8}):    &amp;bn256PairingIstanbul{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{9}):    &amp;blake2F{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0a}): &amp;kzgPointEvaluation{},</span>
<span class="term-fg32">+var allPrecompiles = map[common.Address]CeloPrecompiledContract{</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{1}):    &amp;wrap{&amp;ecrecover{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{2}):    &amp;wrap{&amp;sha256hash{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{3}):    &amp;wrap{&amp;ripemd160hash{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{4}):    &amp;wrap{&amp;dataCopy{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{5}):    &amp;wrap{&amp;bigModExp{eip2565: false}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0xf5}): &amp;wrap{&amp;bigModExp{eip2565: true}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{6}):    &amp;wrap{&amp;bn256AddIstanbul{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{7}):    &amp;wrap{&amp;bn256ScalarMulIstanbul{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{8}):    &amp;wrap{&amp;bn256PairingIstanbul{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{9}):    &amp;wrap{&amp;blake2F{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0a}): &amp;wrap{&amp;kzgPointEvaluation{}},</span>
&nbsp;
<span class="term-fg31">-	common.BytesToAddress([]byte{0x01, 0x00}): &amp;p256Verify{},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x01, 0x00}): &amp;wrap{&amp;p256Verify{}},</span>
&nbsp;
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x0a}): &amp;bls12381G1Add{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x0b}): &amp;bls12381G1Mul{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x0c}): &amp;bls12381G1MultiExp{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x0d}): &amp;bls12381G2Add{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x0e}): &amp;bls12381G2Mul{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x0f}): &amp;bls12381G2MultiExp{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x10}): &amp;bls12381Pairing{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x11}): &amp;bls12381MapG1{},</span>
<span class="term-fg31">-	common.BytesToAddress([]byte{0x0f, 0x12}): &amp;bls12381MapG2{},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x0a}): &amp;wrap{&amp;bls12381G1Add{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x0b}): &amp;wrap{&amp;bls12381G1Mul{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x0c}): &amp;wrap{&amp;bls12381G1MultiExp{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x0d}): &amp;wrap{&amp;bls12381G2Add{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x0e}): &amp;wrap{&amp;bls12381G2Mul{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x0f}): &amp;wrap{&amp;bls12381G2MultiExp{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x10}): &amp;wrap{&amp;bls12381Pairing{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x11}): &amp;wrap{&amp;bls12381MapG1{}},</span>
<span class="term-fg32">+	common.BytesToAddress([]byte{0x0f, 0x12}): &amp;wrap{&amp;bls12381MapG2{}},</span>
 }
&nbsp;
 &#47;&#47; EIP-152 test vectors
<span class="term-fg36">@@ -100,7 +100,7 @@</span> 	p := allPrecompiles[common.HexToAddress(addr)]
 	in := common.Hex2Bytes(test.Input)
 	gas := p.RequiredGas(in)
 	t.Run(fmt.Sprintf(&quot;%s-Gas=%d&quot;, test.Name, gas), func(t *testing.T) {
<span class="term-fg31">-		if res, _, err := RunPrecompiledContract(p, in, gas); err != nil {</span>
<span class="term-fg32">+		if res, _, err := RunPrecompiledContract(p, in, gas, mockPrecompileContext); err != nil {</span>
 			t.Error(err)
 		} else if common.Bytes2Hex(res) != test.Expected {
 			t.Errorf(&quot;Expected %v, got %v&quot;, test.Expected, common.Bytes2Hex(res))
<span class="term-fg36">@@ -122,7 +122,7 @@</span> 	in := common.Hex2Bytes(test.Input)
 	gas := p.RequiredGas(in) - 1
&nbsp;
 	t.Run(fmt.Sprintf(&quot;%s-Gas=%d&quot;, test.Name, gas), func(t *testing.T) {
<span class="term-fg31">-		_, _, err := RunPrecompiledContract(p, in, gas)</span>
<span class="term-fg32">+		_, _, err := RunPrecompiledContract(p, in, gas, mockPrecompileContext)</span>
 		if err.Error() != &quot;out of gas&quot; {
 			t.Errorf(&quot;Expected error [out of gas], got [%v]&quot;, err)
 		}
<span class="term-fg36">@@ -139,7 +139,7 @@</span> 	p := allPrecompiles[common.HexToAddress(addr)]
 	in := common.Hex2Bytes(test.Input)
 	gas := p.RequiredGas(in)
 	t.Run(test.Name, func(t *testing.T) {
<span class="term-fg31">-		_, _, err := RunPrecompiledContract(p, in, gas)</span>
<span class="term-fg32">+		_, _, err := RunPrecompiledContract(p, in, gas, mockPrecompileContext)</span>
 		if err.Error() != test.ExpectedError {
 			t.Errorf(&quot;Expected error [%v], got [%v]&quot;, test.ExpectedError, err)
 		}
<span class="term-fg36">@@ -171,7 +171,7 @@</span> 		start := time.Now()
 		bench.ResetTimer()
 		for i := 0; i &lt; bench.N; i++ {
 			copy(data, in)
<span class="term-fg31">-			res, _, err = RunPrecompiledContract(p, data, reqGas)</span>
<span class="term-fg32">+			res, _, err = RunPrecompiledContract(p, data, reqGas, mockPrecompileContext)</span>
 		}
 		bench.StopTimer()
 		elapsed := uint64(time.Since(start))</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-732300417964594f4451f70e" role="button"
                       aria-expanded="false" aria-controls="id-732300417964594f4451f70e">
                        <code>core/vm/evm.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/vm/evm.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/evm.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+27</span></div>
                            <div class="text-start"><span class="text-danger">-11</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-732300417964594f4451f70e"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;evm.go CELO&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg1">index c1b0ff0d0fac6e4442e752a6033587a9293ae537..1c00927cbf4afd121ae63b856a0403429e269ab4 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;evm.go</span>
<span class="term-fg36">@@ -38,7 +38,7 @@</span> 	&#47;&#47; and is used by the BLOCKHASH EVM op code.
 	GetHashFunc func(uint64) common.Hash
 )
&nbsp;
<span class="term-fg31">-func (evm *EVM) precompile(addr common.Address) (PrecompiledContract, bool) {</span>
<span class="term-fg32">+func (evm *EVM) precompile(addr common.Address) (CeloPrecompiledContract, bool) {</span>
 	var precompiles map[common.Address]PrecompiledContract
 	switch {
 	case evm.chainRules.IsOptimismFjord:
<span class="term-fg36">@@ -55,14 +55,27 @@</span> 	default:
 		precompiles = PrecompiledContractsHomestead
 	}
 	p, ok := precompiles[addr]
<span class="term-fg31">-	&#47;&#47; Restrict overrides to known precompiles</span>
<span class="term-fg31">-	if ok &amp;&amp; evm.chainConfig.IsOptimism() &amp;&amp; evm.Config.OptimismPrecompileOverrides != nil {</span>
<span class="term-fg31">-		override, ok := evm.Config.OptimismPrecompileOverrides(evm.chainRules, p, addr)</span>
<span class="term-fg31">-		if ok {</span>
<span class="term-fg31">-			return override, ok</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var cp CeloPrecompiledContract</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		var celoPrecompiles map[common.Address]CeloPrecompiledContract</span>
<span class="term-fg32">+		switch {</span>
<span class="term-fg32">+		case evm.chainRules.IsCel2:</span>
<span class="term-fg32">+			celoPrecompiles = PrecompiledCeloContractsCel2</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		cp, ok = celoPrecompiles[addr]</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		&#47;&#47; Restrict overrides to known precompiles</span>
<span class="term-fg32">+		if ok &amp;&amp; evm.chainConfig.IsOptimism() &amp;&amp; evm.Config.OptimismPrecompileOverrides != nil {</span>
<span class="term-fg32">+			override, ok := evm.Config.OptimismPrecompileOverrides(evm.chainRules, p, addr)</span>
<span class="term-fg32">+			if ok {</span>
<span class="term-fg32">+				cp = &amp;wrap{override}</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			cp = &amp;wrap{p}</span>
 		}
 	}
<span class="term-fg31">-	return p, ok</span>
<span class="term-fg32">+	return cp, ok</span>
 }
&nbsp;
 &#47;&#47; BlockContext provides the EVM with auxiliary information. Once provided
<span class="term-fg36">@@ -87,6 +100,9 @@</span> 	Difficulty  *big.Int       &#47;&#47; Provides information for DIFFICULTY
 	BaseFee     *big.Int       &#47;&#47; Provides information for BASEFEE (0 if vm runs with NoBaseFee flag and 0 gas price)
 	BlobBaseFee *big.Int       &#47;&#47; Provides information for BLOBBASEFEE (0 if vm runs with NoBaseFee flag and 0 blob gas price)
 	Random      *common.Hash   &#47;&#47; Provides information for PREVRANDAO
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific information</span>
<span class="term-fg32">+	FeeCurrencyContext common.FeeCurrencyContext</span>
 }
&nbsp;
 &#47;&#47; TxContext provides the EVM with information about a transaction.
<span class="term-fg36">@@ -236,7 +252,7 @@</span> 		}
 	}
&nbsp;
 	if isPrecompile {
<span class="term-fg31">-		ret, gas, err = RunPrecompiledContract(p, input, gas)</span>
<span class="term-fg32">+		ret, gas, err = RunPrecompiledContract(p, input, gas, NewContext(caller.Address(), evm))</span>
 	} else {
 		&#47;&#47; Initialise a new contract and set the code that is to be used by the EVM.
 		&#47;&#47; The contract is a scoped environment for this execution context only.
<span class="term-fg36">@@ -299,7 +315,7 @@</span> 	}
&nbsp;
 	&#47;&#47; It is allowed to call precompiles, even via delegatecall
 	if p, isPrecompile := evm.precompile(addr); isPrecompile {
<span class="term-fg31">-		ret, gas, err = RunPrecompiledContract(p, input, gas)</span>
<span class="term-fg32">+		ret, gas, err = RunPrecompiledContract(p, input, gas, NewContext(caller.Address(), evm))</span>
 	} else {
 		addrCopy := addr
 		&#47;&#47; Initialise a new contract and set the code that is to be used by the EVM.
<span class="term-fg36">@@ -344,7 +360,7 @@</span> 	}
&nbsp;
 	&#47;&#47; It is allowed to call precompiles, even via delegatecall
 	if p, isPrecompile := evm.precompile(addr); isPrecompile {
<span class="term-fg31">-		ret, gas, err = RunPrecompiledContract(p, input, gas)</span>
<span class="term-fg32">+		ret, gas, err = RunPrecompiledContract(p, input, gas, NewContext(caller.Address(), evm))</span>
 	} else {
 		addrCopy := addr
 		&#47;&#47; Initialise a new contract and make initialise the delegate values
<span class="term-fg36">@@ -393,7 +409,7 @@</span> 		}(gas)
 	}
&nbsp;
 	if p, isPrecompile := evm.precompile(addr); isPrecompile {
<span class="term-fg31">-		ret, gas, err = RunPrecompiledContract(p, input, gas)</span>
<span class="term-fg32">+		ret, gas, err = RunPrecompiledContract(p, input, gas, NewContext(caller.Address(), evm))</span>
 	} else {
 		&#47;&#47; At this point, we use a copy of address. If we don&#39;t, the go compiler will
 		&#47;&#47; leak the &#39;contract&#39; to the outer scope, and make allocation for &#39;contract&#39;</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-5979e7cef3b779d8bc017ca1"role="button" aria-expanded="false" aria-controls="id-5979e7cef3b779d8bc017ca1">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h3>Celo fee currencies</h3></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+1859</span></div>
                    <div class="text-start"><span class="text-danger">-231</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-5979e7cef3b779d8bc017ca1">
        <div><p>Fee currencies allow to pay transaction fees with ERC20 tokens.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-2671464266c890b7d81a2b79" role="button"
                       aria-expanded="false" aria-controls="id-2671464266c890b7d81a2b79">
                        <code>contracts/fee_currencies.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/fee_currencies.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+247</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2671464266c890b7d81a2b79"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;fee_currencies.go CELO&#47;contracts&#47;fee_currencies.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..90dce268e092ae22e384c86bb0b5a219acbbd004</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;fee_currencies.go</span>
<span class="term-fg36">@@ -0,0 +1,247 @@</span>
<span class="term-fg32">+package contracts</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;errors&quot;</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;math&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&#47;bind&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&#47;addresses&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&#47;celo&#47;abigen&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;vm&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var feeCurrencyABI *abi.ABI</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func init() {</span>
<span class="term-fg32">+	var err error</span>
<span class="term-fg32">+	feeCurrencyABI, err = abigen.FeeCurrencyMetaData.GetAbi()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		panic(err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Returns nil if debit is possible, used in tx pool validation</span>
<span class="term-fg32">+func TryDebitFees(tx *types.Transaction, from common.Address, backend *CeloBackend, feeContext common.FeeCurrencyContext) error {</span>
<span class="term-fg32">+	amount := new(big.Int).SetUint64(tx.Gas())</span>
<span class="term-fg32">+	amount.Mul(amount, tx.GasFeeCap())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	snapshot := backend.State.Snapshot()</span>
<span class="term-fg32">+	evm := backend.NewEVM(&amp;feeContext)</span>
<span class="term-fg32">+	_, err := DebitFees(evm, tx.FeeCurrency(), from, amount)</span>
<span class="term-fg32">+	backend.State.RevertToSnapshot(snapshot)</span>
<span class="term-fg32">+	return err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Debits transaction fees from the transaction sender and stores them in the temporary address</span>
<span class="term-fg32">+func DebitFees(evm *vm.EVM, feeCurrency *common.Address, address common.Address, amount *big.Int) (uint64, error) {</span>
<span class="term-fg32">+	if amount.Cmp(big.NewInt(0)) == 0 {</span>
<span class="term-fg32">+		return 0, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	maxIntrinsicGasCost, ok := common.MaxAllowedIntrinsicGasCost(evm.Context.FeeCurrencyContext.IntrinsicGasCosts, feeCurrency)</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		return 0, exchange.ErrUnregisteredFeeCurrency</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	leftoverGas, err := evm.CallWithABI(</span>
<span class="term-fg32">+		feeCurrencyABI, &quot;debitGasFees&quot;, *feeCurrency, maxIntrinsicGasCost,</span>
<span class="term-fg32">+		&#47;&#47; debitGasFees(address from, uint256 value) parameters</span>
<span class="term-fg32">+		address, amount,</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	if errors.Is(err, vm.ErrOutOfGas) {</span>
<span class="term-fg32">+		&#47;&#47; This basically is a configuration &#47; contract error, since</span>
<span class="term-fg32">+		&#47;&#47; the contract itself used way more gas than was expected (including grace limit)</span>
<span class="term-fg32">+		return 0, fmt.Errorf(&quot;surpassed maximum allowed intrinsic gas for fee currency: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	gasUsed := maxIntrinsicGasCost - leftoverGas</span>
<span class="term-fg32">+	log.Trace(&quot;DebitFees called&quot;, &quot;feeCurrency&quot;, *feeCurrency, &quot;gasUsed&quot;, gasUsed)</span>
<span class="term-fg32">+	return gasUsed, err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Credits fees to the respective parties</span>
<span class="term-fg32">+&#47;&#47; - the base fee goes to the fee handler</span>
<span class="term-fg32">+&#47;&#47; - the transaction tip goes to the miner</span>
<span class="term-fg32">+&#47;&#47; - the l1 data fee goes the the data fee receiver, is the node runs in rollup mode</span>
<span class="term-fg32">+&#47;&#47; - remaining funds are refunded to the transaction sender</span>
<span class="term-fg32">+func CreditFees(</span>
<span class="term-fg32">+	evm *vm.EVM,</span>
<span class="term-fg32">+	feeCurrency *common.Address,</span>
<span class="term-fg32">+	txSender, tipReceiver, baseFeeReceiver, l1DataFeeReceiver common.Address,</span>
<span class="term-fg32">+	refund, feeTip, baseFee, l1DataFee *big.Int,</span>
<span class="term-fg32">+	gasUsedDebit uint64,</span>
<span class="term-fg32">+) error {</span>
<span class="term-fg32">+	&#47;&#47; Our old `creditGasFees` function does not accept an l1DataFee and</span>
<span class="term-fg32">+	&#47;&#47; the fee currencies do not implement the new interface yet. Since tip</span>
<span class="term-fg32">+	&#47;&#47; and data fee both go to the sequencer, we can work around that for</span>
<span class="term-fg32">+	&#47;&#47; now by addint the l1DataFee to the tip.</span>
<span class="term-fg32">+	if l1DataFee != nil {</span>
<span class="term-fg32">+		feeTip = new(big.Int).Add(feeTip, l1DataFee)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Not all fee currencies can handle a receiver being the zero address.</span>
<span class="term-fg32">+	&#47;&#47; In that case send the fee to the base fee recipient, which we know is non-zero.</span>
<span class="term-fg32">+	if tipReceiver.Cmp(common.ZeroAddress) == 0 {</span>
<span class="term-fg32">+		tipReceiver = baseFeeReceiver</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	maxAllowedGasForDebitAndCredit, ok := common.MaxAllowedIntrinsicGasCost(evm.Context.FeeCurrencyContext.IntrinsicGasCosts, feeCurrency)</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		return exchange.ErrUnregisteredFeeCurrency</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	maxAllowedGasForCredit := maxAllowedGasForDebitAndCredit - gasUsedDebit</span>
<span class="term-fg32">+	leftoverGas, err := evm.CallWithABI(</span>
<span class="term-fg32">+		feeCurrencyABI, &quot;creditGasFees&quot;, *feeCurrency, maxAllowedGasForCredit,</span>
<span class="term-fg32">+		&#47;&#47; function creditGasFees(</span>
<span class="term-fg32">+		&#47;&#47; 	address from,</span>
<span class="term-fg32">+		&#47;&#47; 	address feeRecipient,</span>
<span class="term-fg32">+		&#47;&#47; 	address, &#47;&#47; gatewayFeeRecipient, unused</span>
<span class="term-fg32">+		&#47;&#47; 	address communityFund,</span>
<span class="term-fg32">+		&#47;&#47; 	uint256 refund,</span>
<span class="term-fg32">+		&#47;&#47; 	uint256 tipTxFee,</span>
<span class="term-fg32">+		&#47;&#47; 	uint256, &#47;&#47; gatewayFee, unused</span>
<span class="term-fg32">+		&#47;&#47; 	uint256 baseTxFee</span>
<span class="term-fg32">+		&#47;&#47; )</span>
<span class="term-fg32">+		txSender, tipReceiver, common.ZeroAddress, baseFeeReceiver, refund, feeTip, common.Big0, baseFee,</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	if errors.Is(err, vm.ErrOutOfGas) {</span>
<span class="term-fg32">+		&#47;&#47; This is a configuration &#47; contract error, since</span>
<span class="term-fg32">+		&#47;&#47; the contract itself used way more gas than was expected (including grace limit)</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;surpassed maximum allowed intrinsic gas for fee currency: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	gasUsed := maxAllowedGasForCredit - leftoverGas</span>
<span class="term-fg32">+	log.Trace(&quot;CreditFees called&quot;, &quot;feeCurrency&quot;, *feeCurrency, &quot;gasUsed&quot;, gasUsed)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	intrinsicGas, ok := common.CurrencyIntrinsicGasCost(evm.Context.FeeCurrencyContext.IntrinsicGasCosts, feeCurrency)</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		&#47;&#47; this will never happen</span>
<span class="term-fg32">+		return exchange.ErrUnregisteredFeeCurrency</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	gasUsedForDebitAndCredit := gasUsedDebit + gasUsed</span>
<span class="term-fg32">+	if gasUsedForDebitAndCredit &gt; intrinsicGas {</span>
<span class="term-fg32">+		log.Info(&quot;Gas usage for debit+credit exceeds intrinsic gas!&quot;, &quot;gasUsed&quot;, gasUsedForDebitAndCredit, &quot;intrinsicGas&quot;, intrinsicGas, &quot;feeCurrency&quot;, feeCurrency)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func GetRegisteredCurrencies(caller *abigen.FeeCurrencyDirectoryCaller) ([]common.Address, error) {</span>
<span class="term-fg32">+	currencies, err := caller.GetCurrencies(&amp;bind.CallOpts{})</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return currencies, fmt.Errorf(&quot;Failed to get registered tokens: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return currencies, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetExchangeRates returns the exchange rates for the provided gas currencies</span>
<span class="term-fg32">+func GetExchangeRates(caller bind.ContractCaller) (common.ExchangeRates, error) {</span>
<span class="term-fg32">+	exchangeRates := map[common.Address]*big.Rat{}</span>
<span class="term-fg32">+	directory, err := abigen.NewFeeCurrencyDirectoryCaller(addresses.FeeCurrencyDirectoryAddress, caller)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return exchangeRates, fmt.Errorf(&quot;Failed to access FeeCurrencyDirectory: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	currencies, err := GetRegisteredCurrencies(directory)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return common.ExchangeRates{}, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return getExchangeRatesForTokens(directory, currencies)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetFeeCurrencyContext returns the fee currency block context for all registered gas currencies from CELO</span>
<span class="term-fg32">+func GetFeeCurrencyContext(caller bind.ContractCaller) (common.FeeCurrencyContext, error) {</span>
<span class="term-fg32">+	var feeContext common.FeeCurrencyContext</span>
<span class="term-fg32">+	directory, err := abigen.NewFeeCurrencyDirectoryCaller(addresses.FeeCurrencyDirectoryAddress, caller)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return feeContext, fmt.Errorf(&quot;Failed to access FeeCurrencyDirectory: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	currencies, err := GetRegisteredCurrencies(directory)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return feeContext, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	rates, err := getExchangeRatesForTokens(directory, currencies)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return feeContext, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	intrinsicGas, err := getIntrinsicGasForTokens(directory, currencies)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return feeContext, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return common.FeeCurrencyContext{</span>
<span class="term-fg32">+		ExchangeRates:     rates,</span>
<span class="term-fg32">+		IntrinsicGasCosts: intrinsicGas,</span>
<span class="term-fg32">+	}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetBalanceERC20 returns an account&#39;s balance on a given ERC20 currency</span>
<span class="term-fg32">+func GetBalanceERC20(caller bind.ContractCaller, accountOwner common.Address, contractAddress common.Address) (result *big.Int, err error) {</span>
<span class="term-fg32">+	token, err := abigen.NewFeeCurrencyCaller(contractAddress, caller)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;failed to access FeeCurrency: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	balance, err := token.BalanceOf(&amp;bind.CallOpts{}, accountOwner)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return balance, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetFeeBalance returns the account&#39;s balance from the specified feeCurrency</span>
<span class="term-fg32">+&#47;&#47; (if feeCurrency is nil or ZeroAddress, native currency balance is returned).</span>
<span class="term-fg32">+func GetFeeBalance(backend *CeloBackend, account common.Address, feeCurrency *common.Address) *big.Int {</span>
<span class="term-fg32">+	if feeCurrency == nil || *feeCurrency == common.ZeroAddress {</span>
<span class="term-fg32">+		return backend.State.GetBalance(account).ToBig()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	balance, err := GetBalanceERC20(backend, account, *feeCurrency)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		log.Error(&quot;Error while trying to get ERC20 balance:&quot;, &quot;cause&quot;, err, &quot;contract&quot;, feeCurrency.Hex(), &quot;account&quot;, account.Hex())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return balance</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; getIntrinsicGasForTokens returns the intrinsic gas costs for the provided gas currencies from CELO</span>
<span class="term-fg32">+func getIntrinsicGasForTokens(caller *abigen.FeeCurrencyDirectoryCaller, tokens []common.Address) (common.IntrinsicGasCosts, error) {</span>
<span class="term-fg32">+	gasCosts := common.IntrinsicGasCosts{}</span>
<span class="term-fg32">+	for _, tokenAddress := range tokens {</span>
<span class="term-fg32">+		config, err := caller.GetCurrencyConfig(&amp;bind.CallOpts{}, tokenAddress)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			log.Error(&quot;Failed to get intrinsic gas cost for gas currency!&quot;, &quot;err&quot;, err, &quot;tokenAddress&quot;, tokenAddress.Hex())</span>
<span class="term-fg32">+			continue</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if !config.IntrinsicGas.IsUint64() {</span>
<span class="term-fg32">+			log.Error(&quot;Intrinsic gas cost exceeds MaxUint64 limit, capping at MaxUint64&quot;, &quot;err&quot;, err, &quot;tokenAddress&quot;, tokenAddress.Hex())</span>
<span class="term-fg32">+			gasCosts[tokenAddress] = math.MaxUint64</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			gasCosts[tokenAddress] = config.IntrinsicGas.Uint64()</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return gasCosts, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; getExchangeRatesForTokens returns the exchange rates for the provided gas currencies from CELO</span>
<span class="term-fg32">+func getExchangeRatesForTokens(caller *abigen.FeeCurrencyDirectoryCaller, tokens []common.Address) (common.ExchangeRates, error) {</span>
<span class="term-fg32">+	exchangeRates := common.ExchangeRates{}</span>
<span class="term-fg32">+	for _, tokenAddress := range tokens {</span>
<span class="term-fg32">+		rate, err := caller.GetExchangeRate(&amp;bind.CallOpts{}, tokenAddress)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			log.Error(&quot;Failed to get medianRate for gas currency!&quot;, &quot;err&quot;, err, &quot;tokenAddress&quot;, tokenAddress.Hex())</span>
<span class="term-fg32">+			continue</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if rate.Numerator.Sign() &lt;= 0 || rate.Denominator.Sign() &lt;= 0 {</span>
<span class="term-fg32">+			log.Error(&quot;Bad exchange rate for fee currency&quot;, &quot;tokenAddress&quot;, tokenAddress.Hex(), &quot;numerator&quot;, rate.Numerator, &quot;denominator&quot;, rate.Denominator)</span>
<span class="term-fg32">+			continue</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		exchangeRates[tokenAddress] = new(big.Rat).SetFrac(rate.Numerator, rate.Denominator)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return exchangeRates, nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4d82d36f487377916eca21a2" role="button"
                       aria-expanded="false" aria-controls="id-4d82d36f487377916eca21a2">
                        <code>core/blockchain_celo_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/blockchain_celo_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+146</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4d82d36f487377916eca21a2"><span class="term-fg1">diff --git op-geth&#47;core&#47;blockchain_celo_test.go CELO&#47;core&#47;blockchain_celo_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ec5c8eadacc471c13e8bf5b44cea212744307070</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;blockchain_celo_test.go</span>
<span class="term-fg36">@@ -0,0 +1,146 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2014 The go-ethereum Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the go-ethereum library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The go-ethereum library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the go-ethereum library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package core</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;ethash&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&#47;addresses&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;rawdb&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;vm&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;assert&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TestNativeTransferWithFeeCurrency tests the following:</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47;  1. A transaction whose gasFeeCap is greater than the baseFee is valid.</span>
<span class="term-fg32">+&#47;&#47;  2. Gas accounting for celo fee currency transactions is correct.</span>
<span class="term-fg32">+&#47;&#47;  3. Only the transaction&#39;s tip will be received by the coinbase.</span>
<span class="term-fg32">+&#47;&#47;  4. The transaction sender pays for both the tip and baseFee.</span>
<span class="term-fg32">+&#47;&#47;  5. The base fee goes to the fee handler.</span>
<span class="term-fg32">+func TestNativeTransferWithFeeCurrency(t *testing.T) {</span>
<span class="term-fg32">+	testNativeTransferWithFeeCurrency(t, rawdb.HashScheme, DevFeeCurrencyAddr2)</span>
<span class="term-fg32">+	testNativeTransferWithFeeCurrency(t, rawdb.PathScheme, DevFeeCurrencyAddr2)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Test that the gas price is checked against the base fee in the same currency.</span>
<span class="term-fg32">+&#47;&#47; The tx has a GasFeeCap that matches the blocks base fee, so it would succeed</span>
<span class="term-fg32">+&#47;&#47; when compared without currency conversion, but it must fail if the check is</span>
<span class="term-fg32">+&#47;&#47; correct.</span>
<span class="term-fg32">+func TestNativeTransferWithFeeCurrencyAndTooLowGasPrice(t *testing.T) {</span>
<span class="term-fg32">+	assert.PanicsWithError(t, &quot;max fee per gas less than block base fee: address 0x71562b71999873DB5b286dF957af199Ec94617F7, maxFeePerGas: 875000000, baseFee: 1750000000&quot;,</span>
<span class="term-fg32">+		func() { testNativeTransferWithFeeCurrency(t, rawdb.HashScheme, DevFeeCurrencyAddr) },</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func testNativeTransferWithFeeCurrency(t *testing.T, scheme string, feeCurrencyAddr common.Address) {</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		aa     = common.HexToAddress(&quot;0x000000000000000000000000000000000000aaaa&quot;)</span>
<span class="term-fg32">+		engine = ethash.NewFaker()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; A sender who makes transactions, has some funds</span>
<span class="term-fg32">+		key1, _ = crypto.HexToECDSA(&quot;b71c71a67e1177ad4e901695e1b4b9ee17ae16c6668d313eac2f96dbcda3f291&quot;)</span>
<span class="term-fg32">+		addr1   = crypto.PubkeyToAddress(key1.PublicKey)</span>
<span class="term-fg32">+		config  = *params.AllEthashProtocolChanges</span>
<span class="term-fg32">+		funds   = DevBalance</span>
<span class="term-fg32">+		gspec   = &amp;Genesis{</span>
<span class="term-fg32">+			Config: &amp;config,</span>
<span class="term-fg32">+			Alloc:  celoGenesisAccounts(addr1),</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	gspec.Config.Cel2Time = uint64ptr(0)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	signer := types.LatestSigner(gspec.Config)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	_, blocks, _ := GenerateChainWithGenesis(gspec, engine, 1, func(i int, b *BlockGen) {</span>
<span class="term-fg32">+		b.SetCoinbase(common.Address{1})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		txdata := &amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+			ChainID:     gspec.Config.ChainID,</span>
<span class="term-fg32">+			Nonce:       0,</span>
<span class="term-fg32">+			To:          &amp;aa,</span>
<span class="term-fg32">+			Gas:         100000,</span>
<span class="term-fg32">+			GasFeeCap:   b.header.BaseFee,</span>
<span class="term-fg32">+			GasTipCap:   big.NewInt(2),</span>
<span class="term-fg32">+			Data:        []byte{},</span>
<span class="term-fg32">+			FeeCurrency: &amp;feeCurrencyAddr,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		tx := types.NewTx(txdata)</span>
<span class="term-fg32">+		tx, _ = types.SignTx(tx, signer, key1)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		b.AddTx(tx)</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+	chain, err := NewBlockChain(rawdb.NewMemoryDatabase(), DefaultCacheConfigWithScheme(scheme), gspec, nil, engine, vm.Config{}, nil, nil)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;failed to create tester chain: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	defer chain.Stop()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if n, err := chain.InsertChain(blocks); err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;block %d: failed to insert into chain: %v&quot;, n, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	block := chain.GetBlockByNumber(1)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; 1+2: Ensure correct gas amount is deducted</span>
<span class="term-fg32">+	expectedGas := uint64(71000)</span>
<span class="term-fg32">+	if block.GasUsed() != expectedGas {</span>
<span class="term-fg32">+		t.Fatalf(&quot;incorrect amount of gas spent: expected %d, got %d&quot;, expectedGas, block.GasUsed())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	state, _ := chain.State()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	backend := contracts.CeloBackend{</span>
<span class="term-fg32">+		ChainConfig: chain.chainConfig,</span>
<span class="term-fg32">+		State:       state,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	exchangeRates, err := contracts.GetExchangeRates(&amp;backend)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatal(&quot;could not get exchange rates&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	baseFeeInFeeCurrency, _ := exchange.ConvertCeloToCurrency(exchangeRates, &amp;feeCurrencyAddr, block.BaseFee())</span>
<span class="term-fg32">+	actual, _ := contracts.GetBalanceERC20(&amp;backend, block.Coinbase(), feeCurrencyAddr)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; 3: Ensure that miner received only the tx&#39;s tip.</span>
<span class="term-fg32">+	expected := new(big.Int).SetUint64(block.GasUsed() * block.Transactions()[0].GasTipCap().Uint64())</span>
<span class="term-fg32">+	if actual.Cmp(expected) != 0 {</span>
<span class="term-fg32">+		t.Fatalf(&quot;miner balance incorrect: expected %d, got %d&quot;, expected, actual)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; 4: Ensure the tx sender paid for the gasUsed * (tip + block baseFee).</span>
<span class="term-fg32">+	actual, _ = contracts.GetBalanceERC20(&amp;backend, addr1, feeCurrencyAddr)</span>
<span class="term-fg32">+	actual = new(big.Int).Sub(funds, actual)</span>
<span class="term-fg32">+	expected = new(big.Int).SetUint64(block.GasUsed() * (block.Transactions()[0].GasTipCap().Uint64() + baseFeeInFeeCurrency.Uint64()))</span>
<span class="term-fg32">+	if actual.Cmp(expected) != 0 {</span>
<span class="term-fg32">+		t.Fatalf(&quot;sender balance incorrect: expected %d, got %d&quot;, expected, actual)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; 5: Check that base fee has been moved to the fee handler.</span>
<span class="term-fg32">+	actual, _ = contracts.GetBalanceERC20(&amp;backend, addresses.FeeHandlerAddress, feeCurrencyAddr)</span>
<span class="term-fg32">+	expected = new(big.Int).SetUint64(block.GasUsed() * baseFeeInFeeCurrency.Uint64())</span>
<span class="term-fg32">+	if actual.Cmp(expected) != 0 {</span>
<span class="term-fg32">+		t.Fatalf(&quot;fee handler balance incorrect: expected %d, got %d&quot;, expected, actual)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c9055184445cd7fcb8f1f7ed" role="button"
                       aria-expanded="false" aria-controls="id-c9055184445cd7fcb8f1f7ed">
                        <code>core/celo_evm.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/celo_evm.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c9055184445cd7fcb8f1f7ed"><span class="term-fg1">diff --git op-geth&#47;core&#47;celo_evm.go CELO&#47;core&#47;celo_evm.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..402fc6baf3fd81cdc307b03c13cf6eab283d57b7</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;celo_evm.go</span>
<span class="term-fg36">@@ -0,0 +1,24 @@</span>
<span class="term-fg32">+package core</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;vm&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func setCeloFieldsInBlockContext(blockContext *vm.BlockContext, header *types.Header, config *params.ChainConfig, statedb vm.StateDB) {</span>
<span class="term-fg32">+	if !config.IsCel2(header.Time) {</span>
<span class="term-fg32">+		return</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	caller := &amp;contracts.CeloBackend{ChainConfig: config, State: statedb}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Add fee currency context</span>
<span class="term-fg32">+	var err error</span>
<span class="term-fg32">+	blockContext.FeeCurrencyContext, err = contracts.GetFeeCurrencyContext(caller)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		log.Error(&quot;Error fetching exchange rates!&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d847e150739e9888d6b7e51e" role="button"
                       aria-expanded="false" aria-controls="id-d847e150739e9888d6b7e51e">
                        <code>core/evm.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/evm.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/evm.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d847e150739e9888d6b7e51e"><span class="term-fg1">diff --git op-geth&#47;core&#47;evm.go CELO&#47;core&#47;evm.go</span>
<span class="term-fg1">index d1e826d2a343a656650c26648e19cfe292998000..917b6fee5f4e0e4c1e40ef3ae78346242648bb2c 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;evm.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;evm.go</span>
<span class="term-fg36">@@ -39,7 +39,7 @@</span> 	GetHeader(common.Hash, uint64) *types.Header
 }
&nbsp;
 &#47;&#47; NewEVMBlockContext creates a new context for use in the EVM.
<span class="term-fg31">-func NewEVMBlockContext(header *types.Header, chain ChainContext, author *common.Address, config *params.ChainConfig, statedb types.StateGetter) vm.BlockContext {</span>
<span class="term-fg32">+func NewEVMBlockContext(header *types.Header, chain ChainContext, author *common.Address, config *params.ChainConfig, statedb vm.StateDB) vm.BlockContext {</span>
 	var (
 		beneficiary common.Address
 		baseFee     *big.Int
<span class="term-fg36">@@ -62,7 +62,7 @@</span> 	}
 	if header.Difficulty.Cmp(common.Big0) == 0 {
 		random = &amp;header.MixDigest
 	}
<span class="term-fg31">-	return vm.BlockContext{</span>
<span class="term-fg32">+	blockContext := vm.BlockContext{</span>
 		CanTransfer: CanTransfer,
 		Transfer:    Transfer,
 		GetHash:     GetHashFn(header, chain),
<span class="term-fg36">@@ -76,6 +76,10 @@</span> 		GasLimit:    header.GasLimit,
 		Random:      random,
 		L1CostFunc:  types.NewL1CostFunc(config, statedb),
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	setCeloFieldsInBlockContext(&amp;blockContext, header, config, statedb)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return blockContext</span>
 }
&nbsp;
 &#47;&#47; NewEVMTxContext creates a new transaction context for a single transaction.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fdf934aef2f7d790f478a0c4" role="button"
                       aria-expanded="false" aria-controls="id-fdf934aef2f7d790f478a0c4">
                        <code>core/state_processor.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/state_processor.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/state_processor.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+15</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fdf934aef2f7d790f478a0c4"><span class="term-fg1">diff --git op-geth&#47;core&#47;state_processor.go CELO&#47;core&#47;state_processor.go</span>
<span class="term-fg1">index e11041a87c50a614c1c30c1c3f9a427a845af64e..0eed561e7dd0c608b7727ffa3db9c41a94d792d7 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;state_processor.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;state_processor.go</span>
<span class="term-fg36">@@ -22,6 +22,7 @@</span> 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;misc&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
<span class="term-fg36">@@ -82,7 +83,7 @@</span> 		ProcessBeaconBlockRoot(*beaconRoot, vmenv, statedb)
 	}
 	&#47;&#47; Iterate over and process the individual transactions
 	for i, tx := range block.Transactions() {
<span class="term-fg31">-		msg, err := TransactionToMessage(tx, signer, header.BaseFee)</span>
<span class="term-fg32">+		msg, err := TransactionToMessage(tx, signer, header.BaseFee, context.FeeCurrencyContext.ExchangeRates)</span>
 		if err != nil {
 			return nil, nil, 0, fmt.Errorf(&quot;could not apply tx %d [%v]: %w&quot;, i, tx.Hash().Hex(), err)
 		}
<span class="term-fg36">@@ -152,6 +153,16 @@</span> 			receipt.DepositReceiptVersion = new(uint64)
 			*receipt.DepositReceiptVersion = types.CanyonDepositReceiptVersion
 		}
 	}
<span class="term-fg32">+	if tx.Type() == types.CeloDynamicFeeTxV2Type {</span>
<span class="term-fg32">+		alternativeBaseFee := evm.Context.BaseFee</span>
<span class="term-fg32">+		if msg.FeeCurrency != nil {</span>
<span class="term-fg32">+			alternativeBaseFee, err = exchange.ConvertCeloToCurrency(evm.Context.FeeCurrencyContext.ExchangeRates, msg.FeeCurrency, evm.Context.BaseFee)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, err</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		receipt.BaseFee = new(big.Int).Set(alternativeBaseFee)</span>
<span class="term-fg32">+	}</span>
 	if tx.Type() == types.BlobTxType {
 		receipt.BlobGasUsed = uint64(len(tx.BlobHashes()) * params.BlobTxBlobGasPerBlob)
 		receipt.BlobGasPrice = evm.Context.BlobBaseFee
<span class="term-fg36">@@ -176,12 +187,12 @@</span> &#47;&#47; and uses the input parameters for its environment. It returns the receipt
 &#47;&#47; for the transaction, gas used and an error if the transaction failed,
 &#47;&#47; indicating the block was invalid.
 func ApplyTransaction(config *params.ChainConfig, bc ChainContext, author *common.Address, gp *GasPool, statedb *state.StateDB, header *types.Header, tx *types.Transaction, usedGas *uint64, cfg vm.Config) (*types.Receipt, error) {
<span class="term-fg31">-	msg, err := TransactionToMessage(tx, types.MakeSigner(config, header.Number, header.Time), header.BaseFee)</span>
<span class="term-fg32">+	&#47;&#47; Create a new context to be used in the EVM environment</span>
<span class="term-fg32">+	blockContext := NewEVMBlockContext(header, bc, author, config, statedb)</span>
<span class="term-fg32">+	msg, err := TransactionToMessage(tx, types.MakeSigner(config, header.Number, header.Time), header.BaseFee, blockContext.FeeCurrencyContext.ExchangeRates)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg31">-	&#47;&#47; Create a new context to be used in the EVM environment</span>
<span class="term-fg31">-	blockContext := NewEVMBlockContext(header, bc, author, config, statedb)</span>
 	txContext := NewEVMTxContext(msg)
 	vmenv := vm.NewEVM(blockContext, txContext, statedb, config, cfg)
 	return applyTransaction(msg, config, gp, statedb, header.Number, header.Hash(), tx, usedGas, vmenv)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1587b374c816d5a59984f499" role="button"
                       aria-expanded="false" aria-controls="id-1587b374c816d5a59984f499">
                        <code>core/state_transition.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/state_transition.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/state_transition.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+265</span></div>
                            <div class="text-start"><span class="text-danger">-56</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1587b374c816d5a59984f499"><span class="term-fg1">diff --git op-geth&#47;core&#47;state_transition.go CELO&#47;core&#47;state_transition.go</span>
<span class="term-fg1">index a86e4c6d582d5a38fbd5a8473f0401a81e712b5c..afe3c34f5c1c86b12b3643a7b3caa750acb5a873 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;state_transition.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;state_transition.go</span>
<span class="term-fg36">@@ -22,10 +22,14 @@</span> 	&quot;math&quot;
 	&quot;math&#47;big&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
 	cmath &quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&#47;addresses&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;vm&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&#47;kzg4844&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;holiman&#47;uint256&quot;
 )
<span class="term-fg36">@@ -67,7 +71,7 @@</span> 	return common.CopyBytes(result.ReturnData)
 }
&nbsp;
 &#47;&#47; IntrinsicGas computes the &#39;intrinsic gas&#39; for a message with the given data.
<span class="term-fg31">-func IntrinsicGas(data []byte, accessList types.AccessList, isContractCreation bool, isHomestead, isEIP2028, isEIP3860 bool) (uint64, error) {</span>
<span class="term-fg32">+func IntrinsicGas(data []byte, accessList types.AccessList, isContractCreation bool, isHomestead, isEIP2028, isEIP3860 bool, feeCurrency *common.Address, feeIntrinsicGas common.IntrinsicGasCosts) (uint64, error) {</span>
 	&#47;&#47; Set the starting gas for the raw transaction
 	var gas uint64
 	if isContractCreation &amp;&amp; isHomestead {
<span class="term-fg36">@@ -109,6 +113,32 @@</span> 			}
 			gas += lenWords * params.InitCodeWordGas
 		}
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; This gas is used for charging user for one `transfer` call to deduct their fee in</span>
<span class="term-fg32">+	&#47;&#47; non-native currency and (up to) three `transfer` calls for fee payouts.</span>
<span class="term-fg32">+	&#47;&#47; The three transfers cover the following cases:</span>
<span class="term-fg32">+	&#47;&#47; - Base fee transfer to the fee handler</span>
<span class="term-fg32">+	&#47;&#47; - Tip fee transfer to the block proposer</span>
<span class="term-fg32">+	&#47;&#47; - Refund of leftover fees to the transaction sender</span>
<span class="term-fg32">+	&#47;&#47;</span>
<span class="term-fg32">+	&#47;&#47; A user might or might not have a gas refund at the end and even if they do the gas refund might</span>
<span class="term-fg32">+	&#47;&#47; be smaller than maxGasForDebitAndCreditTransactions. We still decide to deduct and do the refund</span>
<span class="term-fg32">+	&#47;&#47; since it makes the mining fee more consistent with respect to the gas fee. Otherwise, we would</span>
<span class="term-fg32">+	&#47;&#47; have to expect the user to estimate the mining fee right or else end up losing</span>
<span class="term-fg32">+	&#47;&#47; `min(gas sent - gas charged, maxGasForDebitAndCreditTransactions)` extra.</span>
<span class="term-fg32">+	&#47;&#47; In this case, however, the user always ends up paying `maxGasForDebitAndCreditTransactions`</span>
<span class="term-fg32">+	&#47;&#47; keeping it consistent.</span>
<span class="term-fg32">+	if feeCurrency != nil {</span>
<span class="term-fg32">+		intrinsicGasForFeeCurrency, ok := common.CurrencyIntrinsicGasCost(feeIntrinsicGas, feeCurrency)</span>
<span class="term-fg32">+		if !ok {</span>
<span class="term-fg32">+			return 0, exchange.ErrUnregisteredFeeCurrency</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if (math.MaxUint64 - gas) &lt; intrinsicGasForFeeCurrency {</span>
<span class="term-fg32">+			return 0, ErrGasUintOverflow</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		gas += intrinsicGasForFeeCurrency</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	if accessList != nil {
 		gas += uint64(len(accessList)) * params.TxAccessListAddressGas
 		gas += uint64(accessList.StorageKeys()) * params.TxAccessListStorageKeyGas
<span class="term-fg36">@@ -150,10 +180,18 @@</span> 	IsSystemTx     bool                 &#47;&#47; IsSystemTx indicates the message, if also a deposit, does not emit gas usage.
 	IsDepositTx    bool                 &#47;&#47; IsDepositTx indicates the message is force-included and can persist a mint.
 	Mint           *big.Int             &#47;&#47; Mint is the amount to mint before EVM processing, or nil if there is no minting.
 	RollupCostData types.RollupCostData &#47;&#47; RollupCostData caches data to compute the fee we charge for data availability
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo additions</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; FeeCurrency specifies the currency for gas fees.</span>
<span class="term-fg32">+	&#47;&#47; `nil` corresponds to CELO (native currency).</span>
<span class="term-fg32">+	&#47;&#47; All other values should correspond to ERC20 contract addresses.</span>
<span class="term-fg32">+	FeeCurrency         *common.Address</span>
<span class="term-fg32">+	MaxFeeInFeeCurrency *big.Int &#47;&#47; MaxFeeInFeeCurrency is the maximum fee that can be charged in the fee currency.</span>
 }
&nbsp;
 &#47;&#47; TransactionToMessage converts a transaction into a Message.
<span class="term-fg31">-func TransactionToMessage(tx *types.Transaction, s types.Signer, baseFee *big.Int) (*Message, error) {</span>
<span class="term-fg32">+func TransactionToMessage(tx *types.Transaction, s types.Signer, baseFee *big.Int, exchangeRates map[common.Address]*big.Rat) (*Message, error) {</span>
 	msg := &amp;Message{
 		Nonce:          tx.Nonce(),
 		GasLimit:       tx.Gas(),
<span class="term-fg36">@@ -172,9 +210,19 @@</span>
 		SkipAccountChecks: false,
 		BlobHashes:        tx.BlobHashes(),
 		BlobGasFeeCap:     tx.BlobGasFeeCap(),
<span class="term-fg32">+</span>
<span class="term-fg32">+		FeeCurrency:         tx.FeeCurrency(),</span>
<span class="term-fg32">+		MaxFeeInFeeCurrency: nil, &#47;&#47; Will only be set once CIP-66 is implemented</span>
 	}
 	&#47;&#47; If baseFee provided, set gasPrice to effectiveGasPrice.
 	if baseFee != nil {
<span class="term-fg32">+		if tx.Type() == types.CeloDynamicFeeTxV2Type {</span>
<span class="term-fg32">+			var err error</span>
<span class="term-fg32">+			baseFee, err = exchange.ConvertCeloToCurrency(exchangeRates, msg.FeeCurrency, baseFee)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, err</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
 		msg.GasPrice = cmath.BigMin(msg.GasPrice.Add(msg.GasTipCap, baseFee), msg.GasFeeCap)
 	}
 	var err error
<span class="term-fg36">@@ -182,6 +230,13 @@</span> 	msg.From, err = types.Sender(s, tx)
 	return msg, err
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; IsFeeCurrencyDenominated returns whether the gas-price related</span>
<span class="term-fg32">+&#47;&#47; fields are denominated in a given fee currency or in the native token.</span>
<span class="term-fg32">+&#47;&#47; This effectively is only true for CIP-64 transactions.</span>
<span class="term-fg32">+func (msg *Message) IsFeeCurrencyDenominated() bool {</span>
<span class="term-fg32">+	return msg.FeeCurrency != nil &amp;&amp; msg.MaxFeeInFeeCurrency == nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; ApplyMessage computes the new state by applying the given message
 &#47;&#47; against the old state within the environment.
 &#47;&#47;
<span class="term-fg36">@@ -190,6 +245,7 @@</span> &#47;&#47; the gas used (which includes gas refunds) and an error if it failed. An error always
 &#47;&#47; indicates a core error meaning that the message would always fail for that particular
 &#47;&#47; state and would never be accepted within a block.
 func ApplyMessage(evm *vm.EVM, msg *Message, gp *GasPool) (*ExecutionResult, error) {
<span class="term-fg32">+	log.Trace(&quot;Applying state transition message&quot;, &quot;from&quot;, msg.From, &quot;nonce&quot;, msg.Nonce, &quot;to&quot;, msg.To, &quot;gasPrice&quot;, msg.GasPrice, &quot;feeCurrency&quot;, msg.FeeCurrency, &quot;gas&quot;, msg.GasLimit, &quot;value&quot;, msg.Value, &quot;data&quot;, msg.Data)</span>
 	return NewStateTransition(evm, msg, gp).TransitionDb()
 }
&nbsp;
<span class="term-fg36">@@ -222,6 +278,8 @@</span> 	gasRemaining uint64
 	initialGas   uint64
 	state        vm.StateDB
 	evm          *vm.EVM
<span class="term-fg32">+</span>
<span class="term-fg32">+	feeCurrencyGasUsed uint64</span>
 }
&nbsp;
 &#47;&#47; NewStateTransition initialises and returns a new state transition object.
<span class="term-fg36">@@ -277,8 +335,9 @@</span> 	balanceCheckU256, overflow := uint256.FromBig(balanceCheck)
 	if overflow {
 		return fmt.Errorf(&quot;%w: address %v required balance exceeds 256 bits&quot;, ErrInsufficientFunds, st.msg.From.Hex())
 	}
<span class="term-fg31">-	if have, want := st.state.GetBalance(st.msg.From), balanceCheckU256; have.Cmp(want) &lt; 0 {</span>
<span class="term-fg31">-		return fmt.Errorf(&quot;%w: address %v have %v want %v&quot;, ErrInsufficientFunds, st.msg.From.Hex(), have, want)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err := st.canPayFee(balanceCheckU256); err != nil {</span>
<span class="term-fg32">+		return err</span>
 	}
 	if err := st.gp.SubGas(st.msg.GasLimit); err != nil {
 		return err
<span class="term-fg36">@@ -286,9 +345,50 @@</span> 	}
 	st.gasRemaining += st.msg.GasLimit
&nbsp;
 	st.initialGas = st.msg.GasLimit
<span class="term-fg31">-	mgvalU256, _ := uint256.FromBig(mgval)</span>
<span class="term-fg31">-	st.state.SubBalance(st.msg.From, mgvalU256)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return st.subFees(mgval)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; canPayFee checks whether accountOwner&#39;s balance can cover transaction fee.</span>
<span class="term-fg32">+func (st *StateTransition) canPayFee(checkAmount *uint256.Int) error {</span>
<span class="term-fg32">+	if st.msg.FeeCurrency == nil {</span>
<span class="term-fg32">+		balance := st.state.GetBalance(st.msg.From)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		if balance.Cmp(checkAmount) &lt; 0 {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;%w: address %v have %v want %v&quot;, ErrInsufficientFunds, st.msg.From.Hex(), balance, checkAmount)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		backend := &amp;contracts.CeloBackend{</span>
<span class="term-fg32">+			ChainConfig: st.evm.ChainConfig(),</span>
<span class="term-fg32">+			State:       st.state,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		balance, err := contracts.GetBalanceERC20(backend, st.msg.From, *st.msg.FeeCurrency)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; Token amount can&#39;t be bigger than 256 bit</span>
<span class="term-fg32">+		balanceU256, _ := uint256.FromBig(balance)</span>
<span class="term-fg32">+		if balanceU256.Cmp(checkAmount) &lt; 0 {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;%w: address %v have %v want %v, fee currency: %v&quot;, ErrInsufficientFunds, st.msg.From.Hex(), balance, checkAmount, st.msg.FeeCurrency.Hex())</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
 	return nil
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (st *StateTransition) subFees(effectiveFee *big.Int) (err error) {</span>
<span class="term-fg32">+	log.Trace(&quot;Debiting fee&quot;, &quot;from&quot;, st.msg.From, &quot;amount&quot;, effectiveFee, &quot;feeCurrency&quot;, st.msg.FeeCurrency)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; native currency</span>
<span class="term-fg32">+	if st.msg.FeeCurrency == nil {</span>
<span class="term-fg32">+		effectiveFeeU256, _ := uint256.FromBig(effectiveFee)</span>
<span class="term-fg32">+		st.state.SubBalance(st.msg.From, effectiveFeeU256)</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		gasUsedDebit, err := contracts.DebitFees(st.evm, st.msg.FeeCurrency, st.msg.From, effectiveFee)</span>
<span class="term-fg32">+		st.feeCurrencyGasUsed += gasUsedDebit</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
 }
&nbsp;
 func (st *StateTransition) preCheck() error {
<span class="term-fg36">@@ -329,6 +429,19 @@</span> 			return fmt.Errorf(&quot;%w: address %v, codehash: %s&quot;, ErrSenderNoEOA,
 				msg.From.Hex(), codeHash)
 		}
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Verify that fee currency is registered</span>
<span class="term-fg32">+	if msg.FeeCurrency != nil {</span>
<span class="term-fg32">+		if !st.evm.ChainConfig().IsCel2(st.evm.Context.Time) {</span>
<span class="term-fg32">+			return ErrCel2NotEnabled</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			if !common.IsCurrencyAllowed(st.evm.Context.FeeCurrencyContext.ExchangeRates, msg.FeeCurrency) {</span>
<span class="term-fg32">+				log.Trace(&quot;fee currency not allowed&quot;, &quot;fee currency address&quot;, msg.FeeCurrency)</span>
<span class="term-fg32">+				return exchange.ErrUnregisteredFeeCurrency</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Make sure that transaction gasFeeCap is greater than the baseFee (post london)
 	if st.evm.ChainConfig().IsLondon(st.evm.Context.BlockNumber) {
 		&#47;&#47; Skip the checks if gas fields are zero and baseFee was explicitly disabled (eth_call)
<span class="term-fg36">@@ -346,14 +459,20 @@</span> 			if msg.GasFeeCap.Cmp(msg.GasTipCap) &lt; 0 {
 				return fmt.Errorf(&quot;%w: address %v, maxPriorityFeePerGas: %s, maxFeePerGas: %s&quot;, ErrTipAboveFeeCap,
 					msg.From.Hex(), msg.GasTipCap, msg.GasFeeCap)
 			}
<span class="term-fg32">+</span>
 			&#47;&#47; This will panic if baseFee is nil, but basefee presence is verified
 			&#47;&#47; as part of header validation.
<span class="term-fg31">-			if msg.GasFeeCap.Cmp(st.evm.Context.BaseFee) &lt; 0 {</span>
<span class="term-fg32">+			baseFeeInFeeCurrency, err := exchange.ConvertCeloToCurrency(st.evm.Context.FeeCurrencyContext.ExchangeRates, msg.FeeCurrency, st.evm.Context.BaseFee)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return fmt.Errorf(&quot;preCheck: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if msg.GasFeeCap.Cmp(baseFeeInFeeCurrency) &lt; 0 {</span>
 				return fmt.Errorf(&quot;%w: address %v, maxFeePerGas: %s, baseFee: %s&quot;, ErrFeeCapTooLow,
<span class="term-fg31">-					msg.From.Hex(), msg.GasFeeCap, st.evm.Context.BaseFee)</span>
<span class="term-fg32">+					msg.From.Hex(), msg.GasFeeCap, baseFeeInFeeCurrency)</span>
 			}
 		}
 	}
<span class="term-fg32">+</span>
 	&#47;&#47; Check the blob version validity
 	if msg.BlobHashes != nil {
 		&#47;&#47; The to field of a blob tx type is mandatory, and a `BlobTx` transaction internally
<span class="term-fg36">@@ -445,6 +564,18 @@</span> 	&#47;&#47; 4. the purchased gas is enough to cover intrinsic usage
 	&#47;&#47; 5. there is no overflow when calculating intrinsic gas
 	&#47;&#47; 6. caller has enough balance to cover asset transfer for **topmost** call
&nbsp;
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		msg              = st.msg</span>
<span class="term-fg32">+		sender           = vm.AccountRef(msg.From)</span>
<span class="term-fg32">+		rules            = st.evm.ChainConfig().Rules(st.evm.Context.BlockNumber, st.evm.Context.Random != nil, st.evm.Context.Time)</span>
<span class="term-fg32">+		contractCreation = msg.To == nil</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Execute the preparatory steps for state transition which includes:</span>
<span class="term-fg32">+	&#47;&#47; - prepare accessList(post-berlin)</span>
<span class="term-fg32">+	&#47;&#47; - reset transient storage(eip 1153)</span>
<span class="term-fg32">+	st.state.Prepare(rules, msg.From, st.evm.Context.Coinbase, msg.To, vm.ActivePrecompiles(rules), msg.AccessList)</span>
<span class="term-fg32">+</span>
 	&#47;&#47; Check clauses 1-3, buy gas if everything is correct
 	if err := st.preCheck(); err != nil {
 		return nil, err
<span class="term-fg36">@@ -461,15 +592,17 @@</span> 			}
 		}()
 	}
&nbsp;
<span class="term-fg31">-	var (</span>
<span class="term-fg31">-		msg              = st.msg</span>
<span class="term-fg31">-		sender           = vm.AccountRef(msg.From)</span>
<span class="term-fg31">-		rules            = st.evm.ChainConfig().Rules(st.evm.Context.BlockNumber, st.evm.Context.Random != nil, st.evm.Context.Time)</span>
<span class="term-fg31">-		contractCreation = msg.To == nil</span>
<span class="term-fg32">+	&#47;&#47; Check clauses 4-5, subtract intrinsic gas if everything is correct</span>
<span class="term-fg32">+	gas, err := IntrinsicGas(</span>
<span class="term-fg32">+		msg.Data,</span>
<span class="term-fg32">+		msg.AccessList,</span>
<span class="term-fg32">+		contractCreation,</span>
<span class="term-fg32">+		rules.IsHomestead,</span>
<span class="term-fg32">+		rules.IsIstanbul,</span>
<span class="term-fg32">+		rules.IsShanghai,</span>
<span class="term-fg32">+		msg.FeeCurrency,</span>
<span class="term-fg32">+		st.evm.Context.FeeCurrencyContext.IntrinsicGasCosts,</span>
 	)
<span class="term-fg31">-</span>
<span class="term-fg31">-	&#47;&#47; Check clauses 4-5, subtract intrinsic gas if everything is correct</span>
<span class="term-fg31">-	gas, err := IntrinsicGas(msg.Data, msg.AccessList, contractCreation, rules.IsHomestead, rules.IsIstanbul, rules.IsShanghai)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -491,11 +624,6 @@</span> 	&#47;&#47; Check whether the init code size has been exceeded.
 	if rules.IsShanghai &amp;&amp; contractCreation &amp;&amp; len(msg.Data) &gt; params.MaxInitCodeSize {
 		return nil, fmt.Errorf(&quot;%w: code size %v limit %v&quot;, ErrMaxInitCodeSizeExceeded, len(msg.Data), params.MaxInitCodeSize)
 	}
<span class="term-fg31">-</span>
<span class="term-fg31">-	&#47;&#47; Execute the preparatory steps for state transition which includes:</span>
<span class="term-fg31">-	&#47;&#47; - prepare accessList(post-berlin)</span>
<span class="term-fg31">-	&#47;&#47; - reset transient storage(eip 1153)</span>
<span class="term-fg31">-	st.state.Prepare(rules, msg.From, st.evm.Context.Coinbase, msg.To, vm.ActivePrecompiles(rules), msg.AccessList)</span>
&nbsp;
 	var (
 		ret   []byte
<span class="term-fg36">@@ -544,38 +672,10 @@</span> 			Err:         vmerr,
 			ReturnData:  ret,
 		}, nil
 	}
<span class="term-fg31">-	effectiveTip := msg.GasPrice</span>
<span class="term-fg31">-	if rules.IsLondon {</span>
<span class="term-fg31">-		effectiveTip = cmath.BigMin(msg.GasTipCap, new(big.Int).Sub(msg.GasFeeCap, st.evm.Context.BaseFee))</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	effectiveTipU256, _ := uint256.FromBig(effectiveTip)</span>
&nbsp;
<span class="term-fg31">-	if st.evm.Config.NoBaseFee &amp;&amp; msg.GasFeeCap.Sign() == 0 &amp;&amp; msg.GasTipCap.Sign() == 0 {</span>
<span class="term-fg31">-		&#47;&#47; Skip fee payment when NoBaseFee is set and the fee fields</span>
<span class="term-fg31">-		&#47;&#47; are 0. This avoids a negative effectiveTip being applied to</span>
<span class="term-fg31">-		&#47;&#47; the coinbase when simulating calls.</span>
<span class="term-fg31">-	} else {</span>
<span class="term-fg31">-		fee := new(uint256.Int).SetUint64(st.gasUsed())</span>
<span class="term-fg31">-		fee.Mul(fee, effectiveTipU256)</span>
<span class="term-fg31">-		st.state.AddBalance(st.evm.Context.Coinbase, fee)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-	&#47;&#47; Check that we are post bedrock to enable op-geth to be able to create pseudo pre-bedrock blocks (these are pre-bedrock, but don&#39;t follow l2 geth rules)</span>
<span class="term-fg31">-	&#47;&#47; Note optimismConfig will not be nil if rules.IsOptimismBedrock is true</span>
<span class="term-fg31">-	if optimismConfig := st.evm.ChainConfig().Optimism; optimismConfig != nil &amp;&amp; rules.IsOptimismBedrock &amp;&amp; !st.msg.IsDepositTx {</span>
<span class="term-fg31">-		gasCost := new(big.Int).Mul(new(big.Int).SetUint64(st.gasUsed()), st.evm.Context.BaseFee)</span>
<span class="term-fg31">-		amtU256, overflow := uint256.FromBig(gasCost)</span>
<span class="term-fg31">-		if overflow {</span>
<span class="term-fg31">-			return nil, fmt.Errorf(&quot;optimism gas cost overflows U256: %d&quot;, gasCost)</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		st.state.AddBalance(params.OptimismBaseFeeRecipient, amtU256)</span>
<span class="term-fg31">-		if l1Cost := st.evm.Context.L1CostFunc(st.msg.RollupCostData, st.evm.Context.Time); l1Cost != nil {</span>
<span class="term-fg31">-			amtU256, overflow = uint256.FromBig(l1Cost)</span>
<span class="term-fg31">-			if overflow {</span>
<span class="term-fg31">-				return nil, fmt.Errorf(&quot;optimism l1 cost overflows U256: %d&quot;, l1Cost)</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			st.state.AddBalance(params.OptimismL1FeeRecipient, amtU256)</span>
<span class="term-fg31">-		}</span>
<span class="term-fg32">+	err = st.distributeTxFees()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
 	}
&nbsp;
 	return &amp;ExecutionResult{
<span class="term-fg36">@@ -594,10 +694,7 @@</span> 		refund = st.state.GetRefund()
 	}
 	st.gasRemaining += refund
&nbsp;
<span class="term-fg31">-	&#47;&#47; Return ETH for remaining gas, exchanged at the original rate.</span>
<span class="term-fg31">-	remaining := uint256.NewInt(st.gasRemaining)</span>
<span class="term-fg31">-	remaining = remaining.Mul(remaining, uint256.MustFromBig(st.msg.GasPrice))</span>
<span class="term-fg31">-	st.state.AddBalance(st.msg.From, remaining)</span>
<span class="term-fg32">+	&#47;&#47; Gas refund now handled in `distributeTxFees`</span>
&nbsp;
 	&#47;&#47; Also return remaining gas to the block gas counter so it is
 	&#47;&#47; available for the next transaction.
<span class="term-fg36">@@ -615,3 +712,115 @@</span> &#47;&#47; blobGasUsed returns the amount of blob gas used by the message.
 func (st *StateTransition) blobGasUsed() uint64 {
 	return uint64(len(st.msg.BlobHashes) * params.BlobTxBlobGasPerBlob)
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; distributeTxFees calculates the amounts and recipients of transaction fees and credits the accounts.</span>
<span class="term-fg32">+func (st *StateTransition) distributeTxFees() error {</span>
<span class="term-fg32">+	if st.evm.Config.NoBaseFee &amp;&amp; st.msg.GasFeeCap.Sign() == 0 &amp;&amp; st.msg.GasTipCap.Sign() == 0 {</span>
<span class="term-fg32">+		&#47;&#47; Skip fee payment when NoBaseFee is set and the fee fields</span>
<span class="term-fg32">+		&#47;&#47; are 0. This avoids a negative effectiveTip being applied to</span>
<span class="term-fg32">+		&#47;&#47; the coinbase when simulating calls.</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Determine the refund and transaction fee to be distributed.</span>
<span class="term-fg32">+	refund := new(big.Int).Mul(new(big.Int).SetUint64(st.gasRemaining), st.msg.GasPrice)</span>
<span class="term-fg32">+	gasUsed := new(big.Int).SetUint64(st.gasUsed())</span>
<span class="term-fg32">+	totalTxFee := new(big.Int).Mul(gasUsed, st.msg.GasPrice)</span>
<span class="term-fg32">+	from := st.msg.From</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Divide the transaction into a base (the minimum transaction fee) and tip (any extra, or min(max tip, feecap - GPM) if espresso).</span>
<span class="term-fg32">+	baseTxFee := new(big.Int).Mul(gasUsed, st.calculateBaseFee())</span>
<span class="term-fg32">+	&#47;&#47; No need to do effectiveTip calculation, because st.gasPrice == effectiveGasPrice, and effectiveTip = effectiveGasPrice - baseTxFee</span>
<span class="term-fg32">+	tipTxFee := new(big.Int).Sub(totalTxFee, baseTxFee)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	feeCurrency := st.msg.FeeCurrency</span>
<span class="term-fg32">+	feeHandlerAddress := addresses.FeeHandlerAddress</span>
<span class="term-fg32">+	if st.evm.ChainConfig().ChainID != nil &amp;&amp; st.evm.ChainConfig().ChainID.Uint64() == addresses.AlfajoresChainID {</span>
<span class="term-fg32">+		feeHandlerAddress = addresses.FeeHandlerAlfajoresAddress</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	log.Trace(&quot;distributeTxFees&quot;, &quot;from&quot;, from, &quot;refund&quot;, refund, &quot;feeCurrency&quot;, st.msg.FeeCurrency,</span>
<span class="term-fg32">+		&quot;coinbaseFeeRecipient&quot;, st.evm.Context.Coinbase, &quot;coinbaseFee&quot;, tipTxFee,</span>
<span class="term-fg32">+		&quot;feeHandler&quot;, feeHandlerAddress, &quot;communityFundFee&quot;, baseTxFee)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	rules := st.evm.ChainConfig().Rules(st.evm.Context.BlockNumber, st.evm.Context.Random != nil, st.evm.Context.Time)</span>
<span class="term-fg32">+	var l1Cost *big.Int</span>
<span class="term-fg32">+	&#47;&#47; Check that we are post bedrock to enable op-geth to be able to create pseudo pre-bedrock blocks (these are pre-bedrock, but don&#39;t follow l2 geth rules)</span>
<span class="term-fg32">+	&#47;&#47; Note optimismConfig will not be nil if rules.IsOptimismBedrock is true</span>
<span class="term-fg32">+	if optimismConfig := st.evm.ChainConfig().Optimism; optimismConfig != nil &amp;&amp;</span>
<span class="term-fg32">+		rules.IsOptimismBedrock &amp;&amp; !st.msg.IsDepositTx {</span>
<span class="term-fg32">+		l1Cost = st.evm.Context.L1CostFunc(st.msg.RollupCostData, st.evm.Context.Time)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		tipTxFeeU256, overflow := uint256.FromBig(tipTxFee)</span>
<span class="term-fg32">+		if overflow {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;celo tip overflows U256: %d&quot;, tipTxFee)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		st.state.AddBalance(st.evm.Context.Coinbase, tipTxFeeU256)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		refundU256, overflow := uint256.FromBig(refund)</span>
<span class="term-fg32">+		if overflow {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;celo refund overflows U256: %d&quot;, refund)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		st.state.AddBalance(from, refundU256)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		baseTxFeeU256, overflow := uint256.FromBig(baseTxFee)</span>
<span class="term-fg32">+		if overflow {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;celo base fee overflows U256: %d&quot;, baseTxFee)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if rules.IsCel2 {</span>
<span class="term-fg32">+			st.state.AddBalance(feeHandlerAddress, baseTxFeeU256)</span>
<span class="term-fg32">+		} else if st.evm.ChainConfig().Optimism != nil {</span>
<span class="term-fg32">+			st.state.AddBalance(params.OptimismBaseFeeRecipient, baseTxFeeU256)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		l1CostU256, overflow := uint256.FromBig(l1Cost)</span>
<span class="term-fg32">+		if overflow {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;optimism l1 cost overflows U256: %d&quot;, l1Cost)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if l1Cost != nil {</span>
<span class="term-fg32">+			st.state.AddBalance(params.OptimismL1FeeRecipient, l1CostU256)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		if l1Cost != nil {</span>
<span class="term-fg32">+			l1Cost, _ = exchange.ConvertCeloToCurrency(st.evm.Context.FeeCurrencyContext.ExchangeRates, feeCurrency, l1Cost)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if err := contracts.CreditFees(</span>
<span class="term-fg32">+			st.evm,</span>
<span class="term-fg32">+			feeCurrency,</span>
<span class="term-fg32">+			from,</span>
<span class="term-fg32">+			st.evm.Context.Coinbase,</span>
<span class="term-fg32">+			feeHandlerAddress,</span>
<span class="term-fg32">+			params.OptimismL1FeeRecipient,</span>
<span class="term-fg32">+			refund,</span>
<span class="term-fg32">+			tipTxFee,</span>
<span class="term-fg32">+			baseTxFee,</span>
<span class="term-fg32">+			l1Cost,</span>
<span class="term-fg32">+			st.feeCurrencyGasUsed,</span>
<span class="term-fg32">+		); err != nil {</span>
<span class="term-fg32">+			err = fmt.Errorf(&quot;error crediting fee-currency: %w&quot;, err)</span>
<span class="term-fg32">+			log.Error(&quot;Error crediting&quot;, &quot;from&quot;, from, &quot;coinbase&quot;, st.evm.Context.Coinbase, &quot;feeHandler&quot;, feeHandlerAddress, &quot;err&quot;, err)</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; calculateBaseFee returns the correct base fee to use during fee calculations</span>
<span class="term-fg32">+&#47;&#47; This is the base fee from the header if no fee currency is used, but the</span>
<span class="term-fg32">+&#47;&#47; base fee converted to fee currency when a fee currency is used.</span>
<span class="term-fg32">+func (st *StateTransition) calculateBaseFee() *big.Int {</span>
<span class="term-fg32">+	baseFee := st.evm.Context.BaseFee</span>
<span class="term-fg32">+	if baseFee == nil {</span>
<span class="term-fg32">+		&#47;&#47; This can happen in pre EIP-1559 environments</span>
<span class="term-fg32">+		baseFee = big.NewInt(0)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if st.msg.FeeCurrency != nil {</span>
<span class="term-fg32">+		&#47;&#47; Existence of the fee currency has been checked in `preCheck`</span>
<span class="term-fg32">+		baseFee, _ = exchange.ConvertCeloToCurrency(st.evm.Context.FeeCurrencyContext.ExchangeRates, st.msg.FeeCurrency, baseFee)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return baseFee</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-15c2babdd4c750260344aed8" role="button"
                       aria-expanded="false" aria-controls="id-15c2babdd4c750260344aed8">
                        <code>core/txpool/blobpool/blobpool.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/txpool/blobpool/blobpool.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/blobpool/blobpool.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-13</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-15c2babdd4c750260344aed8"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;blobpool&#47;blobpool.go CELO&#47;core&#47;txpool&#47;blobpool&#47;blobpool.go</span>
<span class="term-fg1">index 15e5b8c2c4e55eaa0539cafb7647d37464e206dc..1cbcc81e67def951114825831438c1dac558aa59 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;txpool&#47;blobpool&#47;blobpool.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;blobpool&#47;blobpool.go</span>
<span class="term-fg36">@@ -32,6 +32,7 @@</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;misc&#47;eip1559&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;misc&#47;eip4844&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;txpool&quot;
<span class="term-fg36">@@ -116,7 +117,7 @@</span> 		hash:       tx.Hash(),
 		id:         id,
 		size:       size,
 		nonce:      tx.Nonce(),
<span class="term-fg31">-		costCap:    uint256.MustFromBig(tx.Cost()),</span>
<span class="term-fg32">+		costCap:    uint256.MustFromBig(tx.NativeCost()),</span>
 		execTipCap: uint256.MustFromBig(tx.GasTipCap()),
 		execFeeCap: uint256.MustFromBig(tx.GasFeeCap()),
 		blobFeeCap: uint256.MustFromBig(tx.BlobGasFeeCap()),
<span class="term-fg36">@@ -315,6 +316,10 @@</span> 	discoverFeed event.Feed &#47;&#47; Event feed to send out new tx events on pool discovery (reorg excluded)
 	insertFeed   event.Feed &#47;&#47; Event feed to send out new tx events on pool inclusion (reorg included)
&nbsp;
 	lock sync.RWMutex &#47;&#47; Mutex protecting the pool during reorg handling
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific</span>
<span class="term-fg32">+	celoBackend        *contracts.CeloBackend &#47;&#47; For fee currency balances &amp; exchange rate calculation</span>
<span class="term-fg32">+	feeCurrencyContext common.FeeCurrencyContext</span>
 }
&nbsp;
 &#47;&#47; New creates a new blob transaction pool to gather, sort and filter inbound
<span class="term-fg36">@@ -370,6 +375,7 @@</span> 	if err != nil {
 		return err
 	}
 	p.head, p.state = head, state
<span class="term-fg32">+	p.recreateCeloProperties()</span>
&nbsp;
 	&#47;&#47; Index all transactions on disk and delete anything unprocessable
 	var fails []uint64
<span class="term-fg36">@@ -796,6 +802,7 @@</span> 		return
 	}
 	p.head = newHead
 	p.state = statedb
<span class="term-fg32">+	p.recreateCeloProperties()</span>
&nbsp;
 	&#47;&#47; Run the reorg between the old and new head and figure out which accounts
 	&#47;&#47; need to be rechecked and which transactions need to be readded
<span class="term-fg36">@@ -1081,13 +1088,13 @@</span> &#47;&#47; rules and adheres to some heuristic limits of the local node (price and size).
 func (p *BlobPool) validateTx(tx *types.Transaction) error {
 	&#47;&#47; Ensure the transaction adheres to basic pool filters (type, size, tip) and
 	&#47;&#47; consensus rules
<span class="term-fg31">-	baseOpts := &amp;txpool.ValidationOptions{</span>
<span class="term-fg31">-		Config:  p.chain.Config(),</span>
<span class="term-fg31">-		Accept:  1 &lt;&lt; types.BlobTxType,</span>
<span class="term-fg31">-		MaxSize: txMaxSize,</span>
<span class="term-fg31">-		MinTip:  p.gasTip.ToBig(),</span>
<span class="term-fg32">+	baseOpts := &amp;txpool.CeloValidationOptions{</span>
<span class="term-fg32">+		Config:    p.chain.Config(),</span>
<span class="term-fg32">+		AcceptSet: txpool.NewAcceptSet(types.BlobTxType),</span>
<span class="term-fg32">+		MaxSize:   txMaxSize,</span>
<span class="term-fg32">+		MinTip:    p.gasTip.ToBig(),</span>
 	}
<span class="term-fg31">-	if err := txpool.ValidateTransaction(tx, p.head, p.signer, baseOpts); err != nil {</span>
<span class="term-fg32">+	if err := txpool.CeloValidateTransaction(tx, p.head, p.signer, baseOpts, p.feeCurrencyContext); err != nil {</span>
 		return err
 	}
 	&#47;&#47; Ensure the transaction adheres to the stateful pool filters (nonce, balance)
<span class="term-fg36">@@ -1107,20 +1114,24 @@</span> 				return have, 0
 			}
 			return have, maxTxsPerAccount - have
 		},
<span class="term-fg31">-		ExistingExpenditure: func(addr common.Address) *big.Int {</span>
<span class="term-fg32">+		ExistingExpenditure: func(addr common.Address) (*big.Int, *big.Int) {</span>
 			if spent := p.spent[addr]; spent != nil {
<span class="term-fg31">-				return spent.ToBig()</span>
<span class="term-fg32">+				return new(big.Int), spent.ToBig()</span>
 			}
<span class="term-fg31">-			return new(big.Int)</span>
<span class="term-fg32">+			return new(big.Int), new(big.Int)</span>
 		},
<span class="term-fg31">-		ExistingCost: func(addr common.Address, nonce uint64) *big.Int {</span>
<span class="term-fg32">+		ExistingCost: func(addr common.Address, nonce uint64) (*big.Int, *big.Int) {</span>
 			next := p.state.GetNonce(addr)
 			if uint64(len(p.index[addr])) &gt; nonce-next {
<span class="term-fg31">-				return p.index[addr][int(tx.Nonce()-next)].costCap.ToBig()</span>
<span class="term-fg32">+				return new(big.Int), p.index[addr][int(tx.Nonce()-next)].costCap.ToBig()</span>
 			}
<span class="term-fg31">-			return nil</span>
<span class="term-fg32">+			return nil, nil</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		ExistingBalance: func(addr common.Address, feeCurrency *common.Address) *big.Int {</span>
<span class="term-fg32">+			return contracts.GetFeeBalance(p.celoBackend, addr, feeCurrency)</span>
 		},
 	}
<span class="term-fg32">+</span>
 	if err := txpool.ValidateTransactionWithState(tx, p.signer, stateOpts); err != nil {
 		return err
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-249f4808ca1e480c2da90fd8" role="button"
                       aria-expanded="false" aria-controls="id-249f4808ca1e480c2da90fd8">
                        <code>core/txpool/blobpool/celo_blobpool.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/blobpool/celo_blobpool.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+18</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-249f4808ca1e480c2da90fd8"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;blobpool&#47;celo_blobpool.go CELO&#47;core&#47;txpool&#47;blobpool&#47;celo_blobpool.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7b453a3ca44edcc8b4e218ea1c4233f38c3c1ae8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;blobpool&#47;celo_blobpool.go</span>
<span class="term-fg36">@@ -0,0 +1,18 @@</span>
<span class="term-fg32">+package blobpool</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (pool *BlobPool) recreateCeloProperties() {</span>
<span class="term-fg32">+	pool.celoBackend = &amp;contracts.CeloBackend{</span>
<span class="term-fg32">+		ChainConfig: pool.chain.Config(),</span>
<span class="term-fg32">+		State:       pool.state,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	currencyContext, err := contracts.GetFeeCurrencyContext(pool.celoBackend)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		log.Error(&quot;Error trying to get fee currency context in txpool.&quot;, &quot;cause&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	pool.feeCurrencyContext = currencyContext</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-391fee832c79f1fef9ca4199" role="button"
                       aria-expanded="false" aria-controls="id-391fee832c79f1fef9ca4199">
                        <code>core/txpool/celo_validation.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/celo_validation.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+60</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-391fee832c79f1fef9ca4199"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;celo_validation.go CELO&#47;core&#47;txpool&#47;celo_validation.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..91e2025ff51f02337af5e6a39a5f74be008aea8f</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;celo_validation.go</span>
<span class="term-fg36">@@ -0,0 +1,60 @@</span>
<span class="term-fg32">+package txpool</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; AcceptSet is a set of accepted transaction types for a transaction subpool.</span>
<span class="term-fg32">+type AcceptSet = map[uint8]struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CeloValidationOptions define certain differences between transaction validation</span>
<span class="term-fg32">+&#47;&#47; across the different pools without having to duplicate those checks.</span>
<span class="term-fg32">+&#47;&#47; In comparison to the standard ValidationOptions, the Accept field has been</span>
<span class="term-fg32">+&#47;&#47; changed to allow to test for CeloDynamicFeeTx types.</span>
<span class="term-fg32">+type CeloValidationOptions struct {</span>
<span class="term-fg32">+	Config *params.ChainConfig &#47;&#47; Chain configuration to selectively validate based on current fork rules</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	AcceptSet AcceptSet &#47;&#47; Set of transaction types that should be accepted for the calling pool</span>
<span class="term-fg32">+	MaxSize   uint64    &#47;&#47; Maximum size of a transaction that the caller can meaningfully handle</span>
<span class="term-fg32">+	MinTip    *big.Int  &#47;&#47; Minimum gas tip needed to allow a transaction into the caller pool</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	EffectiveGasCeil uint64 &#47;&#47; if non-zero, a gas ceiling to enforce independent of the header&#39;s gaslimit value</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewAcceptSet creates a new AcceptSet with the types provided.</span>
<span class="term-fg32">+func NewAcceptSet(types ...uint8) AcceptSet {</span>
<span class="term-fg32">+	m := make(AcceptSet, len(types))</span>
<span class="term-fg32">+	for _, t := range types {</span>
<span class="term-fg32">+		m[t] = struct{}{}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return m</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Accepts returns true iff txType is accepted by this CeloValidationOptions.</span>
<span class="term-fg32">+func (cvo *CeloValidationOptions) Accepts(txType uint8) bool {</span>
<span class="term-fg32">+	_, ok := cvo.AcceptSet[txType]</span>
<span class="term-fg32">+	return ok</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CeloValidateTransaction is a helper method to check whether a transaction is valid</span>
<span class="term-fg32">+&#47;&#47; according to the consensus rules, but does not check state-dependent validation</span>
<span class="term-fg32">+&#47;&#47; (balance, nonce, etc).</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; This check is public to allow different transaction pools to check the basic</span>
<span class="term-fg32">+&#47;&#47; rules without duplicating code and running the risk of missed updates.</span>
<span class="term-fg32">+func CeloValidateTransaction(tx *types.Transaction, head *types.Header,</span>
<span class="term-fg32">+	signer types.Signer, opts *CeloValidationOptions, currencyCtx common.FeeCurrencyContext) error {</span>
<span class="term-fg32">+	if err := ValidateTransaction(tx, head, signer, opts, currencyCtx); err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if !common.IsCurrencyAllowed(currencyCtx.ExchangeRates, tx.FeeCurrency()) {</span>
<span class="term-fg32">+		return exchange.ErrUnregisteredFeeCurrency</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-441be7abf75384706c0b5d9d" role="button"
                       aria-expanded="false" aria-controls="id-441be7abf75384706c0b5d9d">
                        <code>core/txpool/legacypool/celo_legacypool.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/legacypool/celo_legacypool.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+43</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-441be7abf75384706c0b5d9d"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;legacypool&#47;celo_legacypool.go CELO&#47;core&#47;txpool&#47;legacypool&#47;celo_legacypool.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a6f4da7a2ba8874ecf70e055188f66bf256db896</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;legacypool&#47;celo_legacypool.go</span>
<span class="term-fg36">@@ -0,0 +1,43 @@</span>
<span class="term-fg32">+package legacypool</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; filter Filters transactions from the given list, according to remaining balance (per currency)</span>
<span class="term-fg32">+&#47;&#47; and gasLimit. Returns drops and invalid txs.</span>
<span class="term-fg32">+func (pool *LegacyPool) filter(list *list, addr common.Address, gasLimit uint64) (types.Transactions, types.Transactions) {</span>
<span class="term-fg32">+	&#47;&#47; CELO: drop all transactions that no longer have a registered currency</span>
<span class="term-fg32">+	dropsAllowlist, invalidsAllowlist := list.FilterAllowlisted(pool.feeCurrencyContext.ExchangeRates)</span>
<span class="term-fg32">+	&#47;&#47; Check from which currencies we need to get balances</span>
<span class="term-fg32">+	currenciesInList := list.FeeCurrencies()</span>
<span class="term-fg32">+	drops, invalids := list.Filter(pool.getBalances(addr, currenciesInList), gasLimit)</span>
<span class="term-fg32">+	totalDrops := append(dropsAllowlist, drops...)</span>
<span class="term-fg32">+	totalInvalids := append(invalidsAllowlist, invalids...)</span>
<span class="term-fg32">+	return totalDrops, totalInvalids</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (pool *LegacyPool) getBalances(address common.Address, currencies []common.Address) map[common.Address]*uint256.Int {</span>
<span class="term-fg32">+	balances := make(map[common.Address]*uint256.Int, len(currencies))</span>
<span class="term-fg32">+	for _, curr := range currencies {</span>
<span class="term-fg32">+		balances[curr] = uint256.MustFromBig(contracts.GetFeeBalance(pool.celoBackend, address, &amp;curr))</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return balances</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (pool *LegacyPool) recreateCeloProperties() {</span>
<span class="term-fg32">+	pool.celoBackend = &amp;contracts.CeloBackend{</span>
<span class="term-fg32">+		ChainConfig: pool.chainconfig,</span>
<span class="term-fg32">+		State:       pool.currentState,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	feeCurrencyContext, err := contracts.GetFeeCurrencyContext(pool.celoBackend)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		log.Error(&quot;Error trying to get fee currency context in txpool.&quot;, &quot;cause&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	pool.feeCurrencyContext = feeCurrencyContext</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-553347e34f032bf571de2935" role="button"
                       aria-expanded="false" aria-controls="id-553347e34f032bf571de2935">
                        <code>core/txpool/legacypool/celo_list.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/legacypool/celo_list.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+127</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-553347e34f032bf571de2935"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;legacypool&#47;celo_list.go CELO&#47;core&#47;txpool&#47;legacypool&#47;celo_list.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5d2de2837f93f881a38a5adb92887bd6a9c1ef22</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;legacypool&#47;celo_list.go</span>
<span class="term-fg36">@@ -0,0 +1,127 @@</span>
<span class="term-fg32">+package legacypool</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (l *list) FilterAllowlisted(rates common.ExchangeRates) (types.Transactions, types.Transactions) {</span>
<span class="term-fg32">+	removed := l.txs.Filter(func(tx *types.Transaction) bool {</span>
<span class="term-fg32">+		return !common.IsCurrencyAllowed(rates, tx.FeeCurrency())</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if len(removed) == 0 {</span>
<span class="term-fg32">+		return nil, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	invalid := l.dropInvalidsAfterRemovalAndReheap(removed)</span>
<span class="term-fg32">+	l.subTotalCost(removed)</span>
<span class="term-fg32">+	l.subTotalCost(invalid)</span>
<span class="term-fg32">+	return removed, invalid</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (l *list) dropInvalidsAfterRemovalAndReheap(removed types.Transactions) types.Transactions {</span>
<span class="term-fg32">+	var invalids types.Transactions</span>
<span class="term-fg32">+	&#47;&#47; If the list was strict, filter anything above the lowest nonce</span>
<span class="term-fg32">+	&#47;&#47; Note that the &#39;invalid&#39; txs have no intersection with the &#39;removed&#39; txs</span>
<span class="term-fg32">+	if l.strict {</span>
<span class="term-fg32">+		lowest := uint64(math.MaxUint64)</span>
<span class="term-fg32">+		for _, tx := range removed {</span>
<span class="term-fg32">+			if nonce := tx.Nonce(); lowest &gt; nonce {</span>
<span class="term-fg32">+				lowest = nonce</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		invalids = l.txs.filter(func(tx *types.Transaction) bool { return tx.Nonce() &gt; lowest })</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	l.txs.reheap()</span>
<span class="term-fg32">+	return invalids</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (l *list) FeeCurrencies() []common.Address {</span>
<span class="term-fg32">+	currencySet := make(map[common.Address]interface{})</span>
<span class="term-fg32">+	currencySet[getCurrencyKey(nil)] = struct{}{} &#47;&#47; Always include native token to handle potential value transfers</span>
<span class="term-fg32">+	for _, tx := range l.txs.items {</span>
<span class="term-fg32">+		&#47;&#47; native currency (nil) represented as Zero address</span>
<span class="term-fg32">+		currencySet[getCurrencyKey(tx.FeeCurrency())] = struct{}{}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	currencies := make([]common.Address, 0, len(currencySet))</span>
<span class="term-fg32">+	for curr := range currencySet {</span>
<span class="term-fg32">+		currencies = append(currencies, curr)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return currencies</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func getCurrencyKey(feeCurrency *common.Address) common.Address {</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		return common.ZeroAddress</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return *feeCurrency</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *list) totalCostVar(feeCurrency *common.Address) *uint256.Int {</span>
<span class="term-fg32">+	key := getCurrencyKey(feeCurrency)</span>
<span class="term-fg32">+	if tc, ok := c.totalCost[key]; ok {</span>
<span class="term-fg32">+		return tc</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	newTc := new(uint256.Int)</span>
<span class="term-fg32">+	c.totalCost[key] = newTc</span>
<span class="term-fg32">+	return newTc</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *list) TotalCostFor(feeCurrency *common.Address) *uint256.Int {</span>
<span class="term-fg32">+	if tc, ok := c.totalCost[getCurrencyKey(feeCurrency)]; ok {</span>
<span class="term-fg32">+		return new(uint256.Int).Set(tc)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return new(uint256.Int)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *list) costCapFor(feeCurrency *common.Address) *uint256.Int {</span>
<span class="term-fg32">+	if tc, ok := c.costCap[getCurrencyKey(feeCurrency)]; ok {</span>
<span class="term-fg32">+		return tc</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return new(uint256.Int)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *list) updateCostCapFor(feeCurrency *common.Address, possibleCap *uint256.Int) {</span>
<span class="term-fg32">+	currentCap := c.costCapFor(feeCurrency)</span>
<span class="term-fg32">+	if possibleCap.Cmp(currentCap) &gt; 0 {</span>
<span class="term-fg32">+		c.costCap[getCurrencyKey(feeCurrency)] = possibleCap</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *list) costCapsLowerThan(costLimits map[common.Address]*uint256.Int) bool {</span>
<span class="term-fg32">+	for curr, cap := range c.costCap {</span>
<span class="term-fg32">+		limit, ok := costLimits[curr]</span>
<span class="term-fg32">+		if !ok || limit == nil {</span>
<span class="term-fg32">+			&#47;&#47; If there&#39;s no limit for the currency we can assume the limit is zero</span>
<span class="term-fg32">+			return cap.IsZero()</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if cap.Cmp(limit) &gt; 0 {</span>
<span class="term-fg32">+			return false</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return true</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *list) setCapsTo(caps map[common.Address]*uint256.Int) {</span>
<span class="term-fg32">+	c.costCap = make(map[common.Address]*uint256.Int)</span>
<span class="term-fg32">+	for curr, cap := range caps {</span>
<span class="term-fg32">+		if cap == nil || cap.IsZero() {</span>
<span class="term-fg32">+			c.costCap[curr] = new(uint256.Int)</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			c.costCap[curr] = new(uint256.Int).Set(cap)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetNativeBaseFee returns the base fee for this priceHeap</span>
<span class="term-fg32">+func (h *priceHeap) GetNativeBaseFee() *big.Int {</span>
<span class="term-fg32">+	if h.ratesAndFees == nil {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return h.ratesAndFees.GetNativeBaseFee()</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0461ba9d8b7990a92abb12ec" role="button"
                       aria-expanded="false" aria-controls="id-0461ba9d8b7990a92abb12ec">
                        <code>core/txpool/legacypool/celo_list_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/legacypool/celo_list_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+199</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0461ba9d8b7990a92abb12ec"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;legacypool&#47;celo_list_test.go CELO&#47;core&#47;txpool&#47;legacypool&#47;celo_list_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..86782f41ded861297605af14b37556b510b96c0e</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;legacypool&#47;celo_list_test.go</span>
<span class="term-fg36">@@ -0,0 +1,199 @@</span>
<span class="term-fg32">+package legacypool</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;assert&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func txC(nonce int, feeCap int, tipCap int, gas int, currency *common.Address) *types.Transaction {</span>
<span class="term-fg32">+	return types.NewTx(&amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+		GasFeeCap:   big.NewInt(int64(feeCap)),</span>
<span class="term-fg32">+		GasTipCap:   big.NewInt(int64(tipCap)),</span>
<span class="term-fg32">+		FeeCurrency: currency,</span>
<span class="term-fg32">+		Gas:         uint64(gas),</span>
<span class="term-fg32">+		Nonce:       uint64(nonce),</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestListFeeCost(t *testing.T) {</span>
<span class="term-fg32">+	curr1 := common.HexToAddress(&quot;0002&quot;)</span>
<span class="term-fg32">+	curr2 := common.HexToAddress(&quot;0004&quot;)</span>
<span class="term-fg32">+	curr3 := common.HexToAddress(&quot;0006&quot;)</span>
<span class="term-fg32">+	rates := common.ExchangeRates{</span>
<span class="term-fg32">+		curr1: big.NewRat(2, 1),</span>
<span class="term-fg32">+		curr2: big.NewRat(4, 1),</span>
<span class="term-fg32">+		curr3: big.NewRat(6, 1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Insert the transactions in a random order</span>
<span class="term-fg32">+	list := newList(false)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	list.Add(txC(7, 1, 1, 10000, &amp;curr1), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(10000), list.TotalCostFor(&amp;curr1).Uint64())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	toBeRemoved := txC(8, 2, 1, 15000, &amp;curr2)</span>
<span class="term-fg32">+	list.Add(toBeRemoved, DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(30000), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(10000), list.TotalCostFor(&amp;curr1).Uint64())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	list.Add(txC(9, 3, 2, 5000, &amp;curr3), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(15000), list.TotalCostFor(&amp;curr3).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(30000), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(10000), list.TotalCostFor(&amp;curr1).Uint64())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Add another tx from curr1, check it adds properly</span>
<span class="term-fg32">+	list.Add(txC(10, 1, 1, 10000, &amp;curr1), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(15000), list.TotalCostFor(&amp;curr3).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(30000), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(20000), list.TotalCostFor(&amp;curr1).Uint64())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Remove a tx from curr2, check it subtracts properly</span>
<span class="term-fg32">+	removed, _ := list.Remove(toBeRemoved)</span>
<span class="term-fg32">+	assert.True(t, removed)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	assert.Equal(t, uint64(15000), list.TotalCostFor(&amp;curr3).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(0), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(20000), list.TotalCostFor(&amp;curr1).Uint64())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestFilterAllowlisted(t *testing.T) {</span>
<span class="term-fg32">+	curr1 := common.HexToAddress(&quot;0002&quot;)</span>
<span class="term-fg32">+	curr2 := common.HexToAddress(&quot;0004&quot;)</span>
<span class="term-fg32">+	curr3 := common.HexToAddress(&quot;0006&quot;)</span>
<span class="term-fg32">+	rates := common.ExchangeRates{</span>
<span class="term-fg32">+		curr1: big.NewRat(2, 1),</span>
<span class="term-fg32">+		curr2: big.NewRat(4, 1),</span>
<span class="term-fg32">+		curr3: big.NewRat(6, 1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	list := newList(false)</span>
<span class="term-fg32">+	list.Add(txC(7, 1, 1, 10000, &amp;curr1), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	toBeRemoved := txC(8, 2, 1, 15000, &amp;curr2)</span>
<span class="term-fg32">+	list.Add(toBeRemoved, DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	list.Add(txC(9, 1, 1, 10000, &amp;curr1), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(30000), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	removed, invalids := list.FilterAllowlisted(common.ExchangeRates{curr1: nil, curr3: nil})</span>
<span class="term-fg32">+	assert.Len(t, removed, 1)</span>
<span class="term-fg32">+	assert.Len(t, invalids, 0)</span>
<span class="term-fg32">+	assert.Equal(t, removed[0], toBeRemoved)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(0), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestFilterAllowlistedStrict(t *testing.T) {</span>
<span class="term-fg32">+	curr1 := common.HexToAddress(&quot;0002&quot;)</span>
<span class="term-fg32">+	curr2 := common.HexToAddress(&quot;0004&quot;)</span>
<span class="term-fg32">+	curr3 := common.HexToAddress(&quot;0006&quot;)</span>
<span class="term-fg32">+	rates := common.ExchangeRates{</span>
<span class="term-fg32">+		curr1: big.NewRat(2, 1),</span>
<span class="term-fg32">+		curr2: big.NewRat(4, 1),</span>
<span class="term-fg32">+		curr3: big.NewRat(6, 1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	list := newList(true)</span>
<span class="term-fg32">+	list.Add(txC(7, 1, 1, 10000, &amp;curr1), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	toBeRemoved := txC(8, 2, 1, 15000, &amp;curr2)</span>
<span class="term-fg32">+	list.Add(toBeRemoved, DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	toBeInvalid := txC(9, 1, 1, 10000, &amp;curr3)</span>
<span class="term-fg32">+	list.Add(toBeInvalid, DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	removed, invalids := list.FilterAllowlisted(common.ExchangeRates{curr1: nil, curr3: nil})</span>
<span class="term-fg32">+	assert.Len(t, removed, 1)</span>
<span class="term-fg32">+	assert.Len(t, invalids, 1)</span>
<span class="term-fg32">+	assert.Equal(t, removed[0], toBeRemoved)</span>
<span class="term-fg32">+	assert.Equal(t, invalids[0], toBeInvalid)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(0), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(0), list.TotalCostFor(&amp;curr3).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(10000), list.TotalCostFor(&amp;curr1).Uint64())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestFilterBalance(t *testing.T) {</span>
<span class="term-fg32">+	curr1 := common.HexToAddress(&quot;0002&quot;)</span>
<span class="term-fg32">+	curr2 := common.HexToAddress(&quot;0004&quot;)</span>
<span class="term-fg32">+	curr3 := common.HexToAddress(&quot;0006&quot;)</span>
<span class="term-fg32">+	rates := common.ExchangeRates{</span>
<span class="term-fg32">+		curr1: big.NewRat(2, 1),</span>
<span class="term-fg32">+		curr2: big.NewRat(4, 1),</span>
<span class="term-fg32">+		curr3: big.NewRat(6, 1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	list := newList(false)</span>
<span class="term-fg32">+	&#47;&#47; each tx costs 10000 in each currency</span>
<span class="term-fg32">+	list.Add(txC(7, 1, 1, 10000, &amp;curr1), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	toBeRemoved := txC(8, 1, 1, 10000, &amp;curr2)</span>
<span class="term-fg32">+	list.Add(toBeRemoved, DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	list.Add(txC(9, 1, 1, 10000, &amp;curr3), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	removed, invalids := list.Filter(map[common.Address]*uint256.Int{</span>
<span class="term-fg32">+		curr1: uint256.NewInt(10000),</span>
<span class="term-fg32">+		curr2: uint256.NewInt(9999),</span>
<span class="term-fg32">+		curr3: uint256.NewInt(10000),</span>
<span class="term-fg32">+	}, 15000)</span>
<span class="term-fg32">+	assert.Len(t, removed, 1)</span>
<span class="term-fg32">+	assert.Len(t, invalids, 0)</span>
<span class="term-fg32">+	assert.Equal(t, removed[0], toBeRemoved)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(0), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestFilterBalanceStrict(t *testing.T) {</span>
<span class="term-fg32">+	curr1 := common.HexToAddress(&quot;0002&quot;)</span>
<span class="term-fg32">+	curr2 := common.HexToAddress(&quot;0004&quot;)</span>
<span class="term-fg32">+	curr3 := common.HexToAddress(&quot;0006&quot;)</span>
<span class="term-fg32">+	rates := common.ExchangeRates{</span>
<span class="term-fg32">+		curr1: big.NewRat(2, 1),</span>
<span class="term-fg32">+		curr2: big.NewRat(4, 1),</span>
<span class="term-fg32">+		curr3: big.NewRat(6, 1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	list := newList(true)</span>
<span class="term-fg32">+	&#47;&#47; each tx costs 10000 in each currency</span>
<span class="term-fg32">+	list.Add(txC(7, 1, 1, 10000, &amp;curr1), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	toBeRemoved := txC(8, 1, 1, 10000, &amp;curr2)</span>
<span class="term-fg32">+	list.Add(toBeRemoved, DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	toBeInvalid := txC(9, 1, 1, 10000, &amp;curr3)</span>
<span class="term-fg32">+	list.Add(toBeInvalid, DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	removed, invalids := list.Filter(map[common.Address]*uint256.Int{</span>
<span class="term-fg32">+		curr1: uint256.NewInt(10001),</span>
<span class="term-fg32">+		curr2: uint256.NewInt(9999),</span>
<span class="term-fg32">+		curr3: uint256.NewInt(10001),</span>
<span class="term-fg32">+	}, 15000)</span>
<span class="term-fg32">+	assert.Len(t, removed, 1)</span>
<span class="term-fg32">+	assert.Len(t, invalids, 1)</span>
<span class="term-fg32">+	assert.Equal(t, removed[0], toBeRemoved)</span>
<span class="term-fg32">+	assert.Equal(t, invalids[0], toBeInvalid)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(0), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+	assert.Equal(t, uint64(0), list.TotalCostFor(&amp;curr3).Uint64())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestFilterBalanceGasLimit(t *testing.T) {</span>
<span class="term-fg32">+	curr1 := common.HexToAddress(&quot;0002&quot;)</span>
<span class="term-fg32">+	curr2 := common.HexToAddress(&quot;0004&quot;)</span>
<span class="term-fg32">+	curr3 := common.HexToAddress(&quot;0006&quot;)</span>
<span class="term-fg32">+	rates := common.ExchangeRates{</span>
<span class="term-fg32">+		curr1: big.NewRat(2, 1),</span>
<span class="term-fg32">+		curr2: big.NewRat(4, 1),</span>
<span class="term-fg32">+		curr3: big.NewRat(6, 1),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	list := newList(false)</span>
<span class="term-fg32">+	&#47;&#47; each tx costs 10000 in each currency</span>
<span class="term-fg32">+	list.Add(txC(7, 1, 1, 10000, &amp;curr1), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	toBeRemoved := txC(8, 1, 1, 10001, &amp;curr2)</span>
<span class="term-fg32">+	list.Add(toBeRemoved, DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+	list.Add(txC(9, 1, 1, 10000, &amp;curr3), DefaultConfig.PriceBump, nil, rates)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	removed, invalids := list.Filter(map[common.Address]*uint256.Int{</span>
<span class="term-fg32">+		curr1: uint256.NewInt(20000),</span>
<span class="term-fg32">+		curr2: uint256.NewInt(20000),</span>
<span class="term-fg32">+		curr3: uint256.NewInt(20000),</span>
<span class="term-fg32">+	}, 10000)</span>
<span class="term-fg32">+	assert.Len(t, removed, 1)</span>
<span class="term-fg32">+	assert.Len(t, invalids, 0)</span>
<span class="term-fg32">+	assert.Equal(t, removed[0], toBeRemoved)</span>
<span class="term-fg32">+	assert.Equal(t, uint64(0), list.TotalCostFor(&amp;curr2).Uint64())</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f49148bc10a61b6efe79fc1b" role="button"
                       aria-expanded="false" aria-controls="id-f49148bc10a61b6efe79fc1b">
                        <code>core/txpool/legacypool/legacypool.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/txpool/legacypool/legacypool.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/legacypool/legacypool.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+85</span></div>
                            <div class="text-start"><span class="text-danger">-57</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f49148bc10a61b6efe79fc1b"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;legacypool&#47;legacypool.go CELO&#47;core&#47;txpool&#47;legacypool&#47;legacypool.go</span>
<span class="term-fg1">index 161e3e84018f3a0ffd8e8fc32fb025d7bffb7a37..b2b6c042a5d9c8018a1c0aaf66b268a87120128b 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;txpool&#47;legacypool&#47;legacypool.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;legacypool&#47;legacypool.go</span>
<span class="term-fg36">@@ -29,6 +29,7 @@</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;prque&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;misc&#47;eip1559&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;txpool&quot;
<span class="term-fg36">@@ -101,6 +102,16 @@</span> 	localGauge   = metrics.NewRegisteredGauge(&quot;txpool&#47;local&quot;, nil)
 	slotsGauge   = metrics.NewRegisteredGauge(&quot;txpool&#47;slots&quot;, nil)
&nbsp;
 	reheapTimer = metrics.NewRegisteredTimer(&quot;txpool&#47;reheap&quot;, nil)
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific metrics</span>
<span class="term-fg32">+	validTxMeterByTxType = map[byte]metrics.Meter{</span>
<span class="term-fg32">+		types.LegacyTxType:           metrics.NewRegisteredMeter(&quot;txpool&#47;txtype&#47;legacy&quot;, nil),</span>
<span class="term-fg32">+		types.AccessListTxType:       metrics.NewRegisteredMeter(&quot;txpool&#47;txtype&#47;accesslist&quot;, nil),</span>
<span class="term-fg32">+		types.DynamicFeeTxType:       metrics.NewRegisteredMeter(&quot;txpool&#47;txtype&#47;dynamicfee&quot;, nil),</span>
<span class="term-fg32">+		types.BlobTxType:             metrics.NewRegisteredMeter(&quot;txpool&#47;txtype&#47;blob&quot;, nil),</span>
<span class="term-fg32">+		types.CeloDynamicFeeTxV2Type: metrics.NewRegisteredMeter(&quot;txpool&#47;txtype&#47;cip64&quot;, nil),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	validTxMeterByFeeCurrency = map[common.Address]metrics.Meter{}</span>
 )
&nbsp;
 &#47;&#47; BlockChain defines the minimal set of methods needed to back a tx pool with
<span class="term-fg36">@@ -239,6 +250,10 @@</span>
 	changesSinceReorg int &#47;&#47; A counter for how many drops we&#39;ve performed in-between reorg.
&nbsp;
 	l1CostFn txpool.L1CostFunc &#47;&#47; To apply L1 costs as rollup, optional field, may be nil.
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific</span>
<span class="term-fg32">+	celoBackend        *contracts.CeloBackend    &#47;&#47; For fee currency balances &amp; exchange rate calculation</span>
<span class="term-fg32">+	feeCurrencyContext common.FeeCurrencyContext &#47;&#47; context for fee currencies</span>
 }
&nbsp;
 type txpoolResetRequest struct {
<span class="term-fg36">@@ -285,7 +300,7 @@</span> &#47;&#47; Filter returns whether the given transaction can be consumed by the legacy
 &#47;&#47; pool, specifically, whether it is a Legacy, AccessList or Dynamic transaction.
 func (pool *LegacyPool) Filter(tx *types.Transaction) bool {
 	switch tx.Type() {
<span class="term-fg31">-	case types.LegacyTxType, types.AccessListTxType, types.DynamicFeeTxType:</span>
<span class="term-fg32">+	case types.LegacyTxType, types.AccessListTxType, types.DynamicFeeTxType, types.CeloDynamicFeeTxV2Type:</span>
 		return true
 	default:
 		return false
<span class="term-fg36">@@ -316,6 +331,7 @@</span> 	}
 	pool.currentHead.Store(head)
 	pool.currentState = statedb
 	pool.pendingNonces = newNoncer(statedb)
<span class="term-fg32">+	pool.recreateCeloProperties()</span>
&nbsp;
 	&#47;&#47; Start the reorg loop early, so it can handle requests generated during
 	&#47;&#47; journal loading.
<span class="term-fg36">@@ -545,15 +561,11 @@</span> 	defer pool.mu.Unlock()
&nbsp;
 	&#47;&#47; Convert the new uint256.Int types to the old big.Int ones used by the legacy pool
 	var (
<span class="term-fg31">-		minTipBig  *big.Int</span>
<span class="term-fg31">-		baseFeeBig *big.Int</span>
<span class="term-fg32">+		minTipBig *big.Int</span>
 	)
 	if filter.MinTip != nil {
 		minTipBig = filter.MinTip.ToBig()
 	}
<span class="term-fg31">-	if filter.BaseFee != nil {</span>
<span class="term-fg31">-		baseFeeBig = filter.BaseFee.ToBig()</span>
<span class="term-fg31">-	}</span>
 	pending := make(map[common.Address][]*txpool.LazyTransaction, len(pool.pending))
 	for addr, list := range pool.pending {
 		txs := list.Flatten()
<span class="term-fg36">@@ -561,7 +573,7 @@</span>
 		&#47;&#47; If the miner requests tip enforcement, cap the lists now
 		if minTipBig != nil &amp;&amp; !pool.locals.contains(addr) {
 			for i, tx := range txs {
<span class="term-fg31">-				if tx.EffectiveGasTipIntCmp(minTipBig, baseFeeBig) &lt; 0 {</span>
<span class="term-fg32">+				if tx.EffectiveGasTipIntCmp(minTipBig, pool.priced.urgent.GetNativeBaseFee()) &lt; 0 {</span>
 					txs = txs[:i]
 					break
 				}
<span class="term-fg36">@@ -571,14 +583,15 @@</span> 		if len(txs) &gt; 0 {
 			lazies := make([]*txpool.LazyTransaction, len(txs))
 			for i := 0; i &lt; len(txs); i++ {
 				lazies[i] = &amp;txpool.LazyTransaction{
<span class="term-fg31">-					Pool:      pool,</span>
<span class="term-fg31">-					Hash:      txs[i].Hash(),</span>
<span class="term-fg31">-					Tx:        txs[i],</span>
<span class="term-fg31">-					Time:      txs[i].Time(),</span>
<span class="term-fg31">-					GasFeeCap: uint256.MustFromBig(txs[i].GasFeeCap()),</span>
<span class="term-fg31">-					GasTipCap: uint256.MustFromBig(txs[i].GasTipCap()),</span>
<span class="term-fg31">-					Gas:       txs[i].Gas(),</span>
<span class="term-fg31">-					BlobGas:   txs[i].BlobGas(),</span>
<span class="term-fg32">+					Pool:        pool,</span>
<span class="term-fg32">+					Hash:        txs[i].Hash(),</span>
<span class="term-fg32">+					Tx:          txs[i],</span>
<span class="term-fg32">+					Time:        txs[i].Time(),</span>
<span class="term-fg32">+					GasFeeCap:   uint256.MustFromBig(txs[i].GasFeeCap()),</span>
<span class="term-fg32">+					GasTipCap:   uint256.MustFromBig(txs[i].GasTipCap()),</span>
<span class="term-fg32">+					Gas:         txs[i].Gas(),</span>
<span class="term-fg32">+					BlobGas:     txs[i].BlobGas(),</span>
<span class="term-fg32">+					FeeCurrency: txs[i].FeeCurrency(),</span>
 				}
 			}
 			pending[addr] = lazies
<span class="term-fg36">@@ -633,12 +646,13 @@</span> &#47;&#47; rules, but does not check state-dependent validation such as sufficient balance.
 &#47;&#47; This check is meant as an early check which only needs to be performed once,
 &#47;&#47; and does not require the pool mutex to be held.
 func (pool *LegacyPool) validateTxBasics(tx *types.Transaction, local bool) error {
<span class="term-fg31">-	opts := &amp;txpool.ValidationOptions{</span>
<span class="term-fg32">+	opts := &amp;txpool.CeloValidationOptions{</span>
 		Config: pool.chainconfig,
<span class="term-fg31">-		Accept: 0 |</span>
<span class="term-fg31">-			1&lt;&lt;types.LegacyTxType |</span>
<span class="term-fg31">-			1&lt;&lt;types.AccessListTxType |</span>
<span class="term-fg31">-			1&lt;&lt;types.DynamicFeeTxType,</span>
<span class="term-fg32">+		AcceptSet: txpool.NewAcceptSet(</span>
<span class="term-fg32">+			types.LegacyTxType,</span>
<span class="term-fg32">+			types.AccessListTxType,</span>
<span class="term-fg32">+			types.DynamicFeeTxType,</span>
<span class="term-fg32">+			types.CeloDynamicFeeTxV2Type),</span>
 		MaxSize:          txMaxSize,
 		MinTip:           pool.gasTip.Load().ToBig(),
 		EffectiveGasCeil: pool.config.EffectiveGasCeil,
<span class="term-fg36">@@ -646,7 +660,7 @@</span> 	}
 	if local {
 		opts.MinTip = new(big.Int)
 	}
<span class="term-fg31">-	if err := txpool.ValidateTransaction(tx, pool.currentHead.Load(), pool.signer, opts); err != nil {</span>
<span class="term-fg32">+	if err := txpool.CeloValidateTransaction(tx, pool.currentHead.Load(), pool.signer, opts, pool.feeCurrencyContext); err != nil {</span>
 		return err
 	}
 	return nil
<span class="term-fg36">@@ -669,31 +683,51 @@</span> 				have += list.Len()
 			}
 			return have, math.MaxInt
 		},
<span class="term-fg31">-		ExistingExpenditure: func(addr common.Address) *big.Int {</span>
<span class="term-fg32">+		ExistingExpenditure: func(addr common.Address) (*big.Int, *big.Int) {</span>
 			if list := pool.pending[addr]; list != nil {
<span class="term-fg31">-				return list.totalcost.ToBig()</span>
<span class="term-fg32">+				return list.TotalCostFor(tx.FeeCurrency()).ToBig(), list.TotalCostFor(nil).ToBig()</span>
 			}
<span class="term-fg31">-			return new(big.Int)</span>
<span class="term-fg32">+			return new(big.Int), new(big.Int)</span>
 		},
<span class="term-fg31">-		ExistingCost: func(addr common.Address, nonce uint64) *big.Int {</span>
<span class="term-fg32">+		ExistingCost: func(addr common.Address, nonce uint64) (*big.Int, *big.Int) {</span>
 			if list := pool.pending[addr]; list != nil {
<span class="term-fg32">+				feeCurrency := tx.FeeCurrency()</span>
 				if tx := list.txs.Get(nonce); tx != nil {
<span class="term-fg31">-					cost := tx.Cost()</span>
<span class="term-fg32">+					feeCurrencyCost, nativeCost := tx.Cost()</span>
 					if pool.l1CostFn != nil {
 						if l1Cost := pool.l1CostFn(tx.RollupCostData()); l1Cost != nil { &#47;&#47; add rollup cost
<span class="term-fg31">-							cost = cost.Add(cost, l1Cost)</span>
<span class="term-fg32">+							nativeCost = nativeCost.Add(nativeCost, l1Cost)</span>
 						}
 					}
<span class="term-fg31">-					return cost</span>
<span class="term-fg32">+					if tx.FeeCurrency() != feeCurrency {</span>
<span class="term-fg32">+						&#47;&#47; We are only interested in costs in the same currency</span>
<span class="term-fg32">+						feeCurrencyCost = new(big.Int)</span>
<span class="term-fg32">+					}</span>
<span class="term-fg32">+					return feeCurrencyCost, nativeCost</span>
 				}
 			}
<span class="term-fg31">-			return nil</span>
<span class="term-fg32">+			return nil, nil</span>
 		},
 		L1CostFn: pool.l1CostFn,
<span class="term-fg32">+		ExistingBalance: func(addr common.Address, feeCurrency *common.Address) *big.Int {</span>
<span class="term-fg32">+			return contracts.GetFeeBalance(pool.celoBackend, addr, feeCurrency)</span>
<span class="term-fg32">+		},</span>
 	}
<span class="term-fg32">+</span>
 	if err := txpool.ValidateTransactionWithState(tx, pool.signer, opts); err != nil {
 		return err
 	}
<span class="term-fg32">+	if tx.FeeCurrency() != nil {</span>
<span class="term-fg32">+		from, err := pool.signer.Sender(tx) &#47;&#47; already validated (and cached), but cleaner to check</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			log.Error(&quot;Transaction sender recovery failed&quot;, &quot;err&quot;, err)</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		&#47;&#47;NOTE: we only test the `debitFees` call here.</span>
<span class="term-fg32">+		&#47;&#47; If the `creditFees` reverts (or runs out of gas), the transaction will</span>
<span class="term-fg32">+		&#47;&#47; not be invalidated here and will be included in the block.</span>
<span class="term-fg32">+		return contracts.TryDebitFees(tx, from, pool.celoBackend, pool.feeCurrencyContext)</span>
<span class="term-fg32">+	}</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -812,7 +846,7 @@</span>
 	&#47;&#47; Try to replace an existing transaction in the pending pool
 	if list := pool.pending[from]; list != nil &amp;&amp; list.Contains(tx.Nonce()) {
 		&#47;&#47; Nonce already pending, check if required price bump is met
<span class="term-fg31">-		inserted, old := list.Add(tx, pool.config.PriceBump, pool.l1CostFn)</span>
<span class="term-fg32">+		inserted, old := list.Add(tx, pool.config.PriceBump, pool.l1CostFn, pool.feeCurrencyContext.ExchangeRates)</span>
 		if !inserted {
 			pendingDiscardMeter.Mark(1)
 			return false, txpool.ErrReplaceUnderpriced
<span class="term-fg36">@@ -886,7 +920,7 @@</span> 	from, _ := types.Sender(pool.signer, tx) &#47;&#47; already validated
 	if pool.queue[from] == nil {
 		pool.queue[from] = newList(false)
 	}
<span class="term-fg31">-	inserted, old := pool.queue[from].Add(tx, pool.config.PriceBump, pool.l1CostFn)</span>
<span class="term-fg32">+	inserted, old := pool.queue[from].Add(tx, pool.config.PriceBump, pool.l1CostFn, pool.feeCurrencyContext.ExchangeRates)</span>
 	if !inserted {
 		&#47;&#47; An older transaction was better, discard this
 		queuedDiscardMeter.Mark(1)
<span class="term-fg36">@@ -940,7 +974,7 @@</span> 		pool.pending[addr] = newList(true)
 	}
 	list := pool.pending[addr]
&nbsp;
<span class="term-fg31">-	inserted, old := list.Add(tx, pool.config.PriceBump, pool.l1CostFn)</span>
<span class="term-fg32">+	inserted, old := list.Add(tx, pool.config.PriceBump, pool.l1CostFn, pool.feeCurrencyContext.ExchangeRates)</span>
 	if !inserted {
 		&#47;&#47; An older transaction was better, discard this
 		pool.all.Remove(hash)
<span class="term-fg36">@@ -1073,6 +1107,19 @@</span> 		replaced, err := pool.add(tx, local)
 		errs[i] = err
 		if err == nil &amp;&amp; !replaced {
 			dirty.addTx(tx)
<span class="term-fg32">+			if tx.FeeCurrency() != nil {</span>
<span class="term-fg32">+				feeCurrencyMeter, ok := validTxMeterByFeeCurrency[*tx.FeeCurrency()]</span>
<span class="term-fg32">+				if !ok {</span>
<span class="term-fg32">+					feeCurrencyMeter = metrics.NewRegisteredMeter(</span>
<span class="term-fg32">+						&quot;txpool&#47;feecurrency&#47;&quot;+tx.FeeCurrency().Hex(),</span>
<span class="term-fg32">+						nil)</span>
<span class="term-fg32">+					validTxMeterByFeeCurrency[*tx.FeeCurrency()] = feeCurrencyMeter</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+				feeCurrencyMeter.Mark(1)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if txTypeMeter, ok := validTxMeterByTxType[tx.Type()]; ok {</span>
<span class="term-fg32">+				txTypeMeter.Mark(1)</span>
<span class="term-fg32">+			}</span>
 		}
 	}
 	validTxMeter.Mark(int64(len(dirty.accounts)))
<span class="term-fg36">@@ -1336,7 +1383,7 @@</span> 		pool.demoteUnexecutables()
 		if reset.newHead != nil {
 			if pool.chainconfig.IsLondon(new(big.Int).Add(reset.newHead.Number, big.NewInt(1))) {
 				pendingBaseFee := eip1559.CalcBaseFee(pool.chainconfig, reset.newHead, reset.newHead.Time+1)
<span class="term-fg31">-				pool.priced.SetBaseFee(pendingBaseFee)</span>
<span class="term-fg32">+				pool.priced.SetBaseFeeAndRates(pendingBaseFee, pool.feeCurrencyContext.ExchangeRates)</span>
 			} else {
 				pool.priced.Reheap()
 			}
<span class="term-fg36">@@ -1466,6 +1513,7 @@</span> 	}
 	pool.currentHead.Store(newHead)
 	pool.currentState = statedb
 	pool.pendingNonces = newNoncer(statedb)
<span class="term-fg32">+	pool.recreateCeloProperties()</span>
&nbsp;
 	if costFn := types.NewL1CostFunc(pool.chainconfig, statedb); costFn != nil {
 		pool.l1CostFn = func(rollupCostData types.RollupCostData) *big.Int {
<span class="term-fg36">@@ -1479,24 +1527,6 @@</span> 	core.SenderCacher.Recover(pool.signer, reinject)
 	pool.addTxsLocked(reinject, false)
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; reduceBalanceByL1Cost returns the given balance, reduced by the L1Cost of the first transaction in list if applicable</span>
<span class="term-fg31">-&#47;&#47; Other txs will get filtered out necessary.</span>
<span class="term-fg31">-func (pool *LegacyPool) reduceBalanceByL1Cost(list *list, balance *uint256.Int) *uint256.Int {</span>
<span class="term-fg31">-	if !list.Empty() &amp;&amp; pool.l1CostFn != nil {</span>
<span class="term-fg31">-		el := list.txs.FirstElement()</span>
<span class="term-fg31">-		if l1Cost := pool.l1CostFn(el.RollupCostData()); l1Cost != nil {</span>
<span class="term-fg31">-			l1Cost256 := uint256.MustFromBig(l1Cost)</span>
<span class="term-fg31">-			if l1Cost256.Cmp(balance) &gt;= 0 {</span>
<span class="term-fg31">-				&#47;&#47; Avoid underflow</span>
<span class="term-fg31">-				balance = uint256.NewInt(0)</span>
<span class="term-fg31">-			} else {</span>
<span class="term-fg31">-				balance = new(uint256.Int).Sub(balance, l1Cost256)</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	return balance</span>
<span class="term-fg31">-}</span>
<span class="term-fg31">-</span>
 &#47;&#47; promoteExecutables moves transactions that have become processable from the
 &#47;&#47; future queue to the set of pending transactions. During this process, all
 &#47;&#47; invalidated transactions (low nonce, low balance) are deleted.
<span class="term-fg36">@@ -1518,10 +1548,9 @@</span> 			hash := tx.Hash()
 			pool.all.Remove(hash)
 		}
 		log.Trace(&quot;Removed old queued transactions&quot;, &quot;count&quot;, len(forwards))
<span class="term-fg31">-		balance := pool.currentState.GetBalance(addr)</span>
<span class="term-fg31">-		balance = pool.reduceBalanceByL1Cost(list, balance)</span>
<span class="term-fg32">+</span>
 		&#47;&#47; Drop all transactions that are too costly (low balance or out of gas)
<span class="term-fg31">-		drops, _ := list.Filter(balance, gasLimit)</span>
<span class="term-fg32">+		drops, _ := pool.filter(list, addr, gasLimit)</span>
 		for _, tx := range drops {
 			hash := tx.Hash()
 			pool.all.Remove(hash)
<span class="term-fg36">@@ -1721,10 +1750,9 @@</span> 			hash := tx.Hash()
 			pool.all.Remove(hash)
 			log.Trace(&quot;Removed old pending transaction&quot;, &quot;hash&quot;, hash)
 		}
<span class="term-fg31">-		balance := pool.currentState.GetBalance(addr)</span>
<span class="term-fg31">-		balance = pool.reduceBalanceByL1Cost(list, balance)</span>
<span class="term-fg32">+</span>
 		&#47;&#47; Drop all transactions that are too costly (low balance or out of gas), and queue any invalids back for later
<span class="term-fg31">-		drops, invalids := list.Filter(balance, gasLimit)</span>
<span class="term-fg32">+		drops, invalids := pool.filter(list, addr, gasLimit)</span>
 		for _, tx := range drops {
 			hash := tx.Hash()
 			log.Trace(&quot;Removed unpayable pending transaction&quot;, &quot;hash&quot;, hash)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-00b1992dd11cfcbf97f287ef" role="button"
                       aria-expanded="false" aria-controls="id-00b1992dd11cfcbf97f287ef">
                        <code>core/txpool/legacypool/legacypool_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/txpool/legacypool/legacypool_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/legacypool/legacypool_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-00b1992dd11cfcbf97f287ef"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;legacypool&#47;legacypool_test.go CELO&#47;core&#47;txpool&#47;legacypool&#47;legacypool_test.go</span>
<span class="term-fg1">index 427f95096d3dba3c7d64b6ddcd8ea548fbf1d49c..b9913fa4d432a9a21906033dafe05be11ebd5d18 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;txpool&#47;legacypool&#47;legacypool_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;legacypool&#47;legacypool_test.go</span>
<span class="term-fg36">@@ -199,6 +199,9 @@</span> 		}
 		if nonce := pool.pendingNonces.get(addr); nonce != last+1 {
 			return fmt.Errorf(&quot;pending nonce mismatch: have %v, want %v&quot;, nonce, last+1)
 		}
<span class="term-fg32">+		if txs.TotalCostFor(nil).Cmp(new(uint256.Int)) &lt; 0 {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;totalcost went negative: %v&quot;, txs.TotalCostFor(nil))</span>
<span class="term-fg32">+		}</span>
 	}
 	return nil
 }
<span class="term-fg36">@@ -2072,7 +2075,7 @@</span> 	}
&nbsp;
 	add(false)
 	for baseFee = 0; baseFee &lt;= 1000; baseFee += 100 {
<span class="term-fg31">-		pool.priced.SetBaseFee(big.NewInt(int64(baseFee)))</span>
<span class="term-fg32">+		pool.priced.SetBaseFeeAndRates(big.NewInt(int64(baseFee)), nil)</span>
 		add(true)
 		check(highCap, &quot;fee cap&quot;)
 		add(false)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-60668d7428a4ac10139bc0a8" role="button"
                       aria-expanded="false" aria-controls="id-60668d7428a4ac10139bc0a8">
                        <code>core/txpool/legacypool/list.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/txpool/legacypool/list.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/legacypool/list.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+54</span></div>
                            <div class="text-start"><span class="text-danger">-53</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-60668d7428a4ac10139bc0a8"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;legacypool&#47;list.go CELO&#47;core&#47;txpool&#47;legacypool&#47;list.go</span>
<span class="term-fg1">index 380001cabc96ec9f0ffc8e0142a7014ee0e8412e..778facc8211aba8152aecd8ecc22c3edfc058835 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;txpool&#47;legacypool&#47;list.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;legacypool&#47;list.go</span>
<span class="term-fg36">@@ -18,7 +18,6 @@</span> package legacypool
&nbsp;
 import (
 	&quot;container&#47;heap&quot;
<span class="term-fg31">-	&quot;math&quot;</span>
 	&quot;math&#47;big&quot;
 	&quot;sort&quot;
 	&quot;sync&quot;
<span class="term-fg36">@@ -26,6 +25,7 @@</span> 	&quot;sync&#47;atomic&quot;
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;txpool&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;holiman&#47;uint256&quot;
<span class="term-fg36">@@ -283,9 +283,9 @@</span> type list struct {
 	strict bool       &#47;&#47; Whether nonces are strictly continuous or not
 	txs    *sortedMap &#47;&#47; Heap indexed sorted hash map of the transactions
&nbsp;
<span class="term-fg31">-	costcap   *uint256.Int &#47;&#47; Price of the highest costing transaction (reset only if exceeds balance)</span>
<span class="term-fg31">-	gascap    uint64       &#47;&#47; Gas limit of the highest spending transaction (reset only if exceeds block limit)</span>
<span class="term-fg31">-	totalcost *uint256.Int &#47;&#47; Total cost of all transactions in the list</span>
<span class="term-fg32">+	costCap   map[common.Address]*uint256.Int &#47;&#47; Price of the highest costing transaction per currency (reset only if exceeds balance)</span>
<span class="term-fg32">+	gascap    uint64                          &#47;&#47; Gas limit of the highest spending transaction (reset only if exceeds block limit)</span>
<span class="term-fg32">+	totalCost map[common.Address]*uint256.Int &#47;&#47; Total cost of all transactions in the list (by currency)</span>
 }
&nbsp;
 &#47;&#47; newList creates a new transaction list for maintaining nonce-indexable fast,
<span class="term-fg36">@@ -294,8 +294,8 @@</span> func newList(strict bool) *list {
 	return &amp;list{
 		strict:    strict,
 		txs:       newSortedMap(),
<span class="term-fg31">-		costcap:   new(uint256.Int),</span>
<span class="term-fg31">-		totalcost: new(uint256.Int),</span>
<span class="term-fg32">+		costCap:   make(map[common.Address]*uint256.Int),</span>
<span class="term-fg32">+		totalCost: make(map[common.Address]*uint256.Int),</span>
 	}
 }
&nbsp;
<span class="term-fg36">@@ -310,11 +310,12 @@</span> &#47;&#47; transaction was accepted, and if yes, any previous transaction it replaced.
 &#47;&#47;
 &#47;&#47; If the new transaction is accepted into the list, the lists&#39; cost and gas
 &#47;&#47; thresholds are also potentially updated.
<span class="term-fg31">-func (l *list) Add(tx *types.Transaction, priceBump uint64, l1CostFn txpool.L1CostFunc) (bool, *types.Transaction) {</span>
<span class="term-fg32">+func (l *list) Add(tx *types.Transaction, priceBump uint64, _ txpool.L1CostFunc, rates common.ExchangeRates) (bool, *types.Transaction) {</span>
 	&#47;&#47; If there&#39;s an older better transaction, abort
 	old := l.txs.Get(tx.Nonce())
 	if old != nil {
<span class="term-fg31">-		if old.GasFeeCapCmp(tx) &gt;= 0 || old.GasTipCapCmp(tx) &gt;= 0 {</span>
<span class="term-fg32">+		&#47;&#47; Short circuit when it&#39;s clear that the new tx is worse</span>
<span class="term-fg32">+		if common.AreSameAddress(old.FeeCurrency(), tx.FeeCurrency()) &amp;&amp; (old.GasFeeCapCmp(tx) &gt;= 0 || old.GasTipCapCmp(tx) &gt;= 0) {</span>
 			return false, nil
 		}
 		&#47;&#47; thresholdFeeCap = oldFC  * (100 + priceBump) &#47; 100
<span class="term-fg36">@@ -327,31 +328,39 @@</span> 		b := big.NewInt(100)
 		thresholdFeeCap := aFeeCap.Div(aFeeCap, b)
 		thresholdTip := aTip.Div(aTip, b)
&nbsp;
<span class="term-fg32">+		var thresholdFeeCapInCurrency = thresholdFeeCap</span>
<span class="term-fg32">+		var thresholdTipInCurrency = thresholdTip</span>
<span class="term-fg32">+		if tx.FeeCurrency() != old.FeeCurrency() {</span>
<span class="term-fg32">+			thresholdFeeCapInCurrency = exchange.ConvertCurrency(rates, thresholdFeeCap, old.FeeCurrency(), tx.FeeCurrency())</span>
<span class="term-fg32">+			thresholdTipInCurrency = exchange.ConvertCurrency(rates, thresholdTip, old.FeeCurrency(), tx.FeeCurrency())</span>
<span class="term-fg32">+		}</span>
 		&#47;&#47; We have to ensure that both the new fee cap and tip are higher than the
 		&#47;&#47; old ones as well as checking the percentage threshold to ensure that
 		&#47;&#47; this is accurate for low (Wei-level) gas price replacements.
<span class="term-fg31">-		if tx.GasFeeCapIntCmp(thresholdFeeCap) &lt; 0 || tx.GasTipCapIntCmp(thresholdTip) &lt; 0 {</span>
<span class="term-fg32">+		if tx.GasFeeCapIntCmp(thresholdFeeCapInCurrency) &lt; 0 || tx.GasTipCapIntCmp(thresholdTipInCurrency) &lt; 0 {</span>
 			return false, nil
 		}
 		&#47;&#47; Old is being replaced, subtract old cost
 		l.subTotalCost([]*types.Transaction{old})
 	}
<span class="term-fg31">-	&#47;&#47; Add new tx cost to totalcost</span>
<span class="term-fg31">-	cost, overflow := uint256.FromBig(tx.Cost())</span>
<span class="term-fg32">+	&#47;&#47; Add new tx cost to total cost</span>
<span class="term-fg32">+	feeCurrencyTc := l.totalCostVar(tx.FeeCurrency())</span>
<span class="term-fg32">+	nativeTc := l.totalCostVar(&amp;common.ZeroAddress)</span>
<span class="term-fg32">+	feeCurrencyCostBig, nativeCostBig := tx.Cost()</span>
<span class="term-fg32">+	feeCurrencyCost, overflow := uint256.FromBig(feeCurrencyCostBig)</span>
 	if overflow {
 		return false, nil
 	}
<span class="term-fg31">-	l.totalcost.Add(l.totalcost, cost)</span>
<span class="term-fg31">-	if l1CostFn != nil {</span>
<span class="term-fg31">-		if l1Cost := l1CostFn(tx.RollupCostData()); l1Cost != nil { &#47;&#47; add rollup cost</span>
<span class="term-fg31">-			l.totalcost.Add(l.totalcost, cost)</span>
<span class="term-fg31">-		}</span>
<span class="term-fg32">+	nativeCost, overflow := uint256.FromBig(nativeCostBig)</span>
<span class="term-fg32">+	if overflow {</span>
<span class="term-fg32">+		return false, nil</span>
 	}
<span class="term-fg32">+	feeCurrencyTc.Add(feeCurrencyTc, feeCurrencyCost)</span>
<span class="term-fg32">+	nativeTc.Add(nativeTc, nativeCost)</span>
 	&#47;&#47; Otherwise overwrite the old transaction with the current one
 	l.txs.Put(tx)
<span class="term-fg31">-	if l.costcap.Cmp(cost) &lt; 0 {</span>
<span class="term-fg31">-		l.costcap = cost</span>
<span class="term-fg31">-	}</span>
<span class="term-fg32">+	l.updateCostCapFor(tx.FeeCurrency(), feeCurrencyCost)</span>
<span class="term-fg32">+	l.updateCostCapFor(&amp;common.ZeroAddress, nativeCost)</span>
 	if gas := tx.Gas(); l.gascap &lt; gas {
 		l.gascap = gas
 	}
<span class="term-fg36">@@ -376,33 +385,25 @@</span> &#47;&#47; This method uses the cached costcap and gascap to quickly decide if there&#39;s even
 &#47;&#47; a point in calculating all the costs or if the balance covers all. If the threshold
 &#47;&#47; is lower than the costgas cap, the caps will be reset to a new high after removing
 &#47;&#47; the newly invalidated transactions.
<span class="term-fg31">-func (l *list) Filter(costLimit *uint256.Int, gasLimit uint64) (types.Transactions, types.Transactions) {</span>
<span class="term-fg32">+func (l *list) Filter(costLimits map[common.Address]*uint256.Int, gasLimit uint64) (types.Transactions, types.Transactions) {</span>
 	&#47;&#47; If all transactions are below the threshold, short circuit
<span class="term-fg31">-	if l.costcap.Cmp(costLimit) &lt;= 0 &amp;&amp; l.gascap &lt;= gasLimit {</span>
<span class="term-fg32">+	if l.costCapsLowerThan(costLimits) &amp;&amp; l.gascap &lt;= gasLimit {</span>
 		return nil, nil
 	}
<span class="term-fg31">-	l.costcap = new(uint256.Int).Set(costLimit) &#47;&#47; Lower the caps to the thresholds</span>
<span class="term-fg32">+	l.setCapsTo(costLimits) &#47;&#47; Lower the caps to the thresholds</span>
 	l.gascap = gasLimit
&nbsp;
 	&#47;&#47; Filter out all the transactions above the account&#39;s funds
 	removed := l.txs.Filter(func(tx *types.Transaction) bool {
<span class="term-fg31">-		return tx.Gas() &gt; gasLimit || tx.Cost().Cmp(costLimit.ToBig()) &gt; 0</span>
<span class="term-fg32">+		feeCurrencyCost, nativeCost := tx.Cost()</span>
<span class="term-fg32">+		return tx.Gas() &gt; gasLimit || feeCurrencyCost.Cmp(l.costCapFor(tx.FeeCurrency()).ToBig()) &gt; 0 || nativeCost.Cmp(l.costCapFor(&amp;common.ZeroAddress).ToBig()) &gt; 0</span>
 	})
&nbsp;
 	if len(removed) == 0 {
 		return nil, nil
 	}
<span class="term-fg31">-	var invalids types.Transactions</span>
<span class="term-fg31">-	&#47;&#47; If the list was strict, filter anything above the lowest nonce</span>
<span class="term-fg31">-	if l.strict {</span>
<span class="term-fg31">-		lowest := uint64(math.MaxUint64)</span>
<span class="term-fg31">-		for _, tx := range removed {</span>
<span class="term-fg31">-			if nonce := tx.Nonce(); lowest &gt; nonce {</span>
<span class="term-fg31">-				lowest = nonce</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		invalids = l.txs.filter(func(tx *types.Transaction) bool { return tx.Nonce() &gt; lowest })</span>
<span class="term-fg31">-	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	invalids := l.dropInvalidsAfterRemovalAndReheap(removed)</span>
 	&#47;&#47; Reset total cost
 	l.subTotalCost(removed)
 	l.subTotalCost(invalids)
<span class="term-fg36">@@ -477,9 +478,16 @@</span> &#47;&#47; subTotalCost subtracts the cost of the given transactions from the
 &#47;&#47; total cost of all transactions.
 func (l *list) subTotalCost(txs []*types.Transaction) {
 	for _, tx := range txs {
<span class="term-fg31">-		_, underflow := l.totalcost.SubOverflow(l.totalcost, uint256.MustFromBig(tx.Cost()))</span>
<span class="term-fg32">+		feeCurrencyCost, nativeCost := tx.Cost()</span>
<span class="term-fg32">+		feeCurrencyTc := l.totalCostVar(tx.FeeCurrency())</span>
<span class="term-fg32">+		nativeTc := l.totalCostVar(&amp;common.ZeroAddress)</span>
<span class="term-fg32">+		_, underflow := feeCurrencyTc.SubOverflow(feeCurrencyTc, uint256.MustFromBig(feeCurrencyCost))</span>
 		if underflow {
<span class="term-fg31">-			panic(&quot;totalcost underflow&quot;)</span>
<span class="term-fg32">+			panic(&quot;totalcost underflow (feecurrency)&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		_, underflow = nativeTc.SubOverflow(nativeTc, uint256.MustFromBig(nativeCost))</span>
<span class="term-fg32">+		if underflow {</span>
<span class="term-fg32">+			panic(&quot;totalcost underflow (native)&quot;)</span>
 		}
 	}
 }
<span class="term-fg36">@@ -489,8 +497,11 @@</span> &#47;&#47; price-sorted transactions to discard when the pool fills up. If baseFee is set
 &#47;&#47; then the heap is sorted based on the effective tip based on the given base fee.
 &#47;&#47; If baseFee is nil then the sorting is based on gasFeeCap.
 type priceHeap struct {
<span class="term-fg31">-	baseFee *big.Int &#47;&#47; heap should always be re-sorted after baseFee is changed</span>
<span class="term-fg31">-	list    []*types.Transaction</span>
<span class="term-fg32">+	list []*types.Transaction</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific</span>
<span class="term-fg32">+	ratesAndFees *exchange.RatesAndFees &#47;&#47; current exchange rates and basefees</span>
<span class="term-fg32">+	&#47;&#47; heap should always be re-sorted after ratesAndFees is changed</span>
 }
&nbsp;
 func (h *priceHeap) Len() int      { return len(h.list) }
<span class="term-fg36">@@ -508,18 +519,7 @@</span> 	}
 }
&nbsp;
 func (h *priceHeap) cmp(a, b *types.Transaction) int {
<span class="term-fg31">-	if h.baseFee != nil {</span>
<span class="term-fg31">-		&#47;&#47; Compare effective tips if baseFee is specified</span>
<span class="term-fg31">-		if c := a.EffectiveGasTipCmp(b, h.baseFee); c != 0 {</span>
<span class="term-fg31">-			return c</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	&#47;&#47; Compare fee caps if baseFee is not specified or effective tips are equal</span>
<span class="term-fg31">-	if c := a.GasFeeCapCmp(b); c != 0 {</span>
<span class="term-fg31">-		return c</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	&#47;&#47; Compare tips if effective tips and fee caps are equal</span>
<span class="term-fg31">-	return a.GasTipCapCmp(b)</span>
<span class="term-fg32">+	return types.CompareWithRates(a, b, h.ratesAndFees)</span>
 }
&nbsp;
 func (h *priceHeap) Push(x interface{}) {
<span class="term-fg36">@@ -693,9 +693,10 @@</span> 	heap.Init(&amp;l.floating)
 	reheapTimer.Update(time.Since(start))
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; SetBaseFee updates the base fee and triggers a re-heap. Note that Removed is not</span>
<span class="term-fg32">+&#47;&#47; SetBaseFeeAndRates updates the base fee and triggers a re-heap. Note that Removed is not</span>
 &#47;&#47; necessary to call right before SetBaseFee when processing a new block.
<span class="term-fg31">-func (l *pricedList) SetBaseFee(baseFee *big.Int) {</span>
<span class="term-fg31">-	l.urgent.baseFee = baseFee</span>
<span class="term-fg32">+func (l *pricedList) SetBaseFeeAndRates(baseFee *big.Int, rates common.ExchangeRates) {</span>
<span class="term-fg32">+	l.urgent.ratesAndFees = exchange.NewRatesAndFees(rates, baseFee)</span>
<span class="term-fg32">+	l.floating.ratesAndFees = exchange.NewRatesAndFees(rates, nil)</span>
 	l.Reheap()
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-11ab4d4571067604c497d76b" role="button"
                       aria-expanded="false" aria-controls="id-11ab4d4571067604c497d76b">
                        <code>core/txpool/legacypool/list_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/txpool/legacypool/list_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/legacypool/list_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-11ab4d4571067604c497d76b"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;legacypool&#47;list_test.go CELO&#47;core&#47;txpool&#47;legacypool&#47;list_test.go</span>
<span class="term-fg1">index 9f341a7f2026a9ef79944f542fbde08d558c21e2..55537e5965f1b33e905d4c6e933e8d500342ab31 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;txpool&#47;legacypool&#47;list_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;legacypool&#47;list_test.go</span>
<span class="term-fg36">@@ -24,7 +24,6 @@</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
<span class="term-fg31">-	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
 )
&nbsp;
 &#47;&#47; Tests that transactions can be added to strict lists and list contents and
<span class="term-fg36">@@ -40,7 +39,7 @@</span> 	}
 	&#47;&#47; Insert the transactions in a random order
 	list := newList(true)
 	for _, v := range rand.Perm(len(txs)) {
<span class="term-fg31">-		list.Add(txs[v], DefaultConfig.PriceBump, nil)</span>
<span class="term-fg32">+		list.Add(txs[v], DefaultConfig.PriceBump, nil, nil)</span>
 	}
 	&#47;&#47; Verify internal state
 	if len(list.txs.items) != len(txs) {
<span class="term-fg36">@@ -63,8 +62,9 @@</span> 		value := big.NewInt(100)
 		gasprice, _ := new(big.Int).SetString(&quot;0xffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff&quot;, 0)
 		gaslimit := uint64(i)
 		tx, _ := types.SignTx(types.NewTransaction(uint64(i), common.Address{}, value, gaslimit, gasprice, nil), types.HomesteadSigner{}, key)
<span class="term-fg31">-		t.Logf(&quot;cost: %x bitlen: %d\n&quot;, tx.Cost(), tx.Cost().BitLen())</span>
<span class="term-fg31">-		list.Add(tx, DefaultConfig.PriceBump, nil)</span>
<span class="term-fg32">+		costFeeCurrency, costNative := tx.Cost()</span>
<span class="term-fg32">+		t.Logf(&quot;cost: %x %x\n&quot;, costFeeCurrency, costNative)</span>
<span class="term-fg32">+		list.Add(tx, DefaultConfig.PriceBump, nil, nil)</span>
 	}
 }
&nbsp;
<span class="term-fg36">@@ -77,13 +77,11 @@</span> 	for i := 0; i &lt; len(txs); i++ {
 		txs[i] = transaction(uint64(i), 0, key)
 	}
 	&#47;&#47; Insert the transactions in a random order
<span class="term-fg31">-	priceLimit := uint256.NewInt(DefaultConfig.PriceLimit)</span>
 	b.ResetTimer()
 	for i := 0; i &lt; b.N; i++ {
 		list := newList(true)
 		for _, v := range rand.Perm(len(txs)) {
<span class="term-fg31">-			list.Add(txs[v], DefaultConfig.PriceBump, nil)</span>
<span class="term-fg31">-			list.Filter(priceLimit, DefaultConfig.PriceBump)</span>
<span class="term-fg32">+			list.Add(txs[v], DefaultConfig.PriceBump, nil, nil)</span>
 		}
 	}
 }
<span class="term-fg36">@@ -102,7 +100,7 @@</span> 	for i := 0; i &lt; b.N; i++ {
 		list := newList(true)
 		&#47;&#47; Insert the transactions in a random order
 		for _, v := range rand.Perm(len(txs)) {
<span class="term-fg31">-			list.Add(txs[v], DefaultConfig.PriceBump, nil)</span>
<span class="term-fg32">+			list.Add(txs[v], DefaultConfig.PriceBump, nil, nil)</span>
 		}
 		b.StartTimer()
 		list.Cap(list.Len() - 1)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-00c49d11b1b48113564ef89a" role="button"
                       aria-expanded="false" aria-controls="id-00c49d11b1b48113564ef89a">
                        <code>core/txpool/subpool.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/txpool/subpool.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/subpool.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-00c49d11b1b48113564ef89a"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;subpool.go CELO&#47;core&#47;txpool&#47;subpool.go</span>
<span class="term-fg1">index 9881ed1b8f960f0a61b7666a5a22412fa0228779..5e0c850fd01cc70eaa271c7fb050126593aeeff3 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;txpool&#47;subpool.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;subpool.go</span>
<span class="term-fg36">@@ -41,6 +41,9 @@</span> 	GasTipCap *uint256.Int &#47;&#47; Maximum miner tip per gas the transaction can pay
&nbsp;
 	Gas     uint64 &#47;&#47; Amount of gas required by the transaction
 	BlobGas uint64 &#47;&#47; Amount of blob gas required by the transaction
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo</span>
<span class="term-fg32">+	FeeCurrency *common.Address</span>
 }
&nbsp;
 &#47;&#47; Resolve retrieves the full transaction belonging to a lazy handle if it is still</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-02b97abbe4b4cdfe2a2034ae" role="button"
                       aria-expanded="false" aria-controls="id-02b97abbe4b4cdfe2a2034ae">
                        <code>core/txpool/validation.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/txpool/validation.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/txpool/validation.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+61</span></div>
                            <div class="text-start"><span class="text-danger">-20</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-02b97abbe4b4cdfe2a2034ae"><span class="term-fg1">diff --git op-geth&#47;core&#47;txpool&#47;validation.go CELO&#47;core&#47;txpool&#47;validation.go</span>
<span class="term-fg1">index 0cf916228b7e7a131643c7828cd19f8256fb2750..b2f438eea0aa9406a4deec5045572beeed9b0332 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;txpool&#47;validation.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;txpool&#47;validation.go</span>
<span class="term-fg36">@@ -73,7 +73,8 @@</span> &#47;&#47; (balance, nonce, etc).
 &#47;&#47;
 &#47;&#47; This check is public to allow different transaction pools to check the basic
 &#47;&#47; rules without duplicating code and running the risk of missed updates.
<span class="term-fg31">-func ValidateTransaction(tx *types.Transaction, head *types.Header, signer types.Signer, opts *ValidationOptions) error {</span>
<span class="term-fg32">+&#47;&#47; ONLY TO BE CALLED FROM &quot;CeloValidateTransaction&quot;</span>
<span class="term-fg32">+func ValidateTransaction(tx *types.Transaction, head *types.Header, signer types.Signer, opts *CeloValidationOptions, currencyCtx common.FeeCurrencyContext) error {</span>
 	&#47;&#47; No unauthenticated deposits allowed in the transaction pool.
 	&#47;&#47; This is for spam protection, not consensus,
 	&#47;&#47; as the external engine-API user authenticates deposits.
<span class="term-fg36">@@ -84,7 +85,7 @@</span> 	if opts.Config.IsOptimism() &amp;&amp; tx.Type() == types.BlobTxType {
 		return core.ErrTxTypeNotSupported
 	}
 	&#47;&#47; Ensure transactions not implemented by the calling pool are rejected
<span class="term-fg31">-	if opts.Accept&amp;(1&lt;&lt;tx.Type()) == 0 {</span>
<span class="term-fg32">+	if !opts.Accepts(tx.Type()) {</span>
 		return fmt.Errorf(&quot;%w: tx type %v not supported by this pool&quot;, core.ErrTxTypeNotSupported, tx.Type())
 	}
 	&#47;&#47; Before performing any expensive validations, sanity check that the tx is
<span class="term-fg36">@@ -132,7 +133,16 @@</span> 		return ErrInvalidSender
 	}
 	&#47;&#47; Ensure the transaction has more gas than the bare minimum needed to cover
 	&#47;&#47; the transaction metadata
<span class="term-fg31">-	intrGas, err := core.IntrinsicGas(tx.Data(), tx.AccessList(), tx.To() == nil, true, opts.Config.IsIstanbul(head.Number), opts.Config.IsShanghai(head.Number, head.Time))</span>
<span class="term-fg32">+	intrGas, err := core.IntrinsicGas(</span>
<span class="term-fg32">+		tx.Data(),</span>
<span class="term-fg32">+		tx.AccessList(),</span>
<span class="term-fg32">+		tx.To() == nil,</span>
<span class="term-fg32">+		true,</span>
<span class="term-fg32">+		opts.Config.IsIstanbul(head.Number),</span>
<span class="term-fg32">+		opts.Config.IsShanghai(head.Number, head.Time),</span>
<span class="term-fg32">+		tx.FeeCurrency(),</span>
<span class="term-fg32">+		currencyCtx.IntrinsicGasCosts,</span>
<span class="term-fg32">+	)</span>
 	if err != nil {
 		return err
 	}
<span class="term-fg36">@@ -201,7 +211,7 @@</span>
 &#47;&#47; ValidationOptionsWithState define certain differences between stateful transaction
 &#47;&#47; validation across the different pools without having to duplicate those checks.
 type ValidationOptionsWithState struct {
<span class="term-fg31">-	State *state.StateDB &#47;&#47; State database to check nonces and balances against</span>
<span class="term-fg32">+	State *state.StateDB &#47;&#47; State database to check nonces</span>
&nbsp;
 	&#47;&#47; FirstNonceGap is an optional callback to retrieve the first nonce gap in
 	&#47;&#47; the list of pooled transactions of a specific account. If this method is
<span class="term-fg36">@@ -216,14 +226,27 @@</span> 	UsedAndLeftSlots func(addr common.Address) (int, int)
&nbsp;
 	&#47;&#47; ExistingExpenditure is a mandatory callback to retrieve the cumulative
 	&#47;&#47; cost of the already pooled transactions to check for overdrafts.
<span class="term-fg31">-	ExistingExpenditure func(addr common.Address) *big.Int</span>
<span class="term-fg32">+	&#47;&#47; Returns (feeCurrencySpent, nativeSpent), where feeCurrencySpent only</span>
<span class="term-fg32">+	&#47;&#47; includes the spending for txs with the relevant feeCurrency.</span>
<span class="term-fg32">+	&#47;&#47; The feeCurrency relevant for feeCurrencySpent is fixed for every</span>
<span class="term-fg32">+	&#47;&#47; instance of ExistingExpenditure and therefore not passed in as a</span>
<span class="term-fg32">+	&#47;&#47; parameter.</span>
<span class="term-fg32">+	ExistingExpenditure func(addr common.Address) (*big.Int, *big.Int)</span>
&nbsp;
 	&#47;&#47; ExistingCost is a mandatory callback to retrieve an already pooled
 	&#47;&#47; transaction&#39;s cost with the given nonce to check for overdrafts.
<span class="term-fg31">-	ExistingCost func(addr common.Address, nonce uint64) *big.Int</span>
<span class="term-fg32">+	&#47;&#47; Returns (feeCurrencyCost, nativeCost), where feeCurrencyCost only</span>
<span class="term-fg32">+	&#47;&#47; includes the spending for txs with the relevant feeCurrency.</span>
<span class="term-fg32">+	&#47;&#47; The feeCurrency relevant for feeCurrencyCost is fixed for every</span>
<span class="term-fg32">+	&#47;&#47; instance of ExistingCost, and therefore not passed in as a</span>
<span class="term-fg32">+	&#47;&#47; parameter.</span>
<span class="term-fg32">+	ExistingCost func(addr common.Address, nonce uint64) (*big.Int, *big.Int)</span>
&nbsp;
 	&#47;&#47; L1CostFn is an optional extension, to validate L1 rollup costs of a tx
 	L1CostFn L1CostFunc
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; ExistingBalance for a currency, to check for balance to cover transaction costs.</span>
<span class="term-fg32">+	ExistingBalance func(addr common.Address, feeCurrency *common.Address) *big.Int</span>
 }
&nbsp;
 &#47;&#47; ValidateTransactionWithState is a helper method to check whether a transaction
<span class="term-fg36">@@ -251,30 +274,48 @@</span> 		}
 	}
 	&#47;&#47; Ensure the transactor has enough funds to cover the transaction costs
 	var (
<span class="term-fg31">-		balance = opts.State.GetBalance(from).ToBig()</span>
<span class="term-fg31">-		cost    = tx.Cost()</span>
<span class="term-fg32">+		feeCurrencyBalance          = opts.ExistingBalance(from, tx.FeeCurrency())</span>
<span class="term-fg32">+		nativeBalance               = opts.ExistingBalance(from, &amp;common.ZeroAddress)</span>
<span class="term-fg32">+		feeCurrencyCost, nativeCost = tx.Cost()</span>
 	)
<span class="term-fg32">+	if feeCurrencyBalance == nil {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;feeCurrencyBalance is nil for FeeCurrency %x&quot;, tx.FeeCurrency())</span>
<span class="term-fg32">+	}</span>
 	if opts.L1CostFn != nil {
 		if l1Cost := opts.L1CostFn(tx.RollupCostData()); l1Cost != nil { &#47;&#47; add rollup cost
<span class="term-fg31">-			cost = cost.Add(cost, l1Cost)</span>
<span class="term-fg32">+			nativeCost = nativeCost.Add(nativeCost, l1Cost)</span>
 		}
 	}
<span class="term-fg31">-	if balance.Cmp(cost) &lt; 0 {</span>
<span class="term-fg31">-		return fmt.Errorf(&quot;%w: balance %v, tx cost %v, overshot %v&quot;, core.ErrInsufficientFunds, balance, cost, new(big.Int).Sub(cost, balance))</span>
<span class="term-fg32">+	if feeCurrencyBalance.Cmp(feeCurrencyCost) &lt; 0 {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;%w: balance %v, tx cost %v, overshot %v, fee currency: %v&quot;, core.ErrInsufficientFunds, feeCurrencyBalance, feeCurrencyCost, new(big.Int).Sub(feeCurrencyCost, feeCurrencyBalance), tx.FeeCurrency().Hex())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if nativeBalance.Cmp(nativeCost) &lt; 0 {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;%w: balance %v, tx cost %v, overshot %v&quot;, core.ErrInsufficientFunds, nativeBalance, nativeCost, new(big.Int).Sub(nativeCost, nativeBalance))</span>
 	}
 	&#47;&#47; Ensure the transactor has enough funds to cover for replacements or nonce
 	&#47;&#47; expansions without overdrafts
<span class="term-fg31">-	spent := opts.ExistingExpenditure(from)</span>
<span class="term-fg31">-	if prev := opts.ExistingCost(from, tx.Nonce()); prev != nil {</span>
<span class="term-fg31">-		bump := new(big.Int).Sub(cost, prev)</span>
<span class="term-fg31">-		need := new(big.Int).Add(spent, bump)</span>
<span class="term-fg31">-		if balance.Cmp(need) &lt; 0 {</span>
<span class="term-fg31">-			return fmt.Errorf(&quot;%w: balance %v, queued cost %v, tx bumped %v, overshot %v&quot;, core.ErrInsufficientFunds, balance, spent, bump, new(big.Int).Sub(need, balance))</span>
<span class="term-fg32">+	feeCurrencySpent, nativeSpent := opts.ExistingExpenditure(from)</span>
<span class="term-fg32">+	if feeCurrencyPrev, nativePrev := opts.ExistingCost(from, tx.Nonce()); feeCurrencyPrev != nil {</span>
<span class="term-fg32">+		&#47;&#47; Costs from all transactions refer to the same currency,</span>
<span class="term-fg32">+		&#47;&#47; which is ensured by ExistingCost and ExistingExpenditure.</span>
<span class="term-fg32">+		feeCurrencyBump := new(big.Int).Sub(feeCurrencyCost, feeCurrencyPrev)</span>
<span class="term-fg32">+		feeCurrencyNeed := new(big.Int).Add(feeCurrencySpent, feeCurrencyBump)</span>
<span class="term-fg32">+		nativeBump := new(big.Int).Sub(nativeCost, nativePrev)</span>
<span class="term-fg32">+		nativeNeed := new(big.Int).Add(nativeSpent, nativeBump)</span>
<span class="term-fg32">+		if feeCurrencyBalance.Cmp(feeCurrencyNeed) &lt; 0 {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;%w: balance %v, queued cost %v, tx bumped %v, overshot %v, feeCurrency %v&quot;, core.ErrInsufficientFunds, feeCurrencyBalance, feeCurrencySpent, feeCurrencyBump, new(big.Int).Sub(feeCurrencyNeed, feeCurrencyBalance), tx.FeeCurrency())</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if nativeBalance.Cmp(nativeNeed) &lt; 0 {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;%w: balance %v, queued cost %v, tx bumped %v, overshot %v&quot;, core.ErrInsufficientFunds, nativeBalance, nativeSpent, nativeBump, new(big.Int).Sub(nativeNeed, nativeBalance))</span>
 		}
 	} else {
<span class="term-fg31">-		need := new(big.Int).Add(spent, cost)</span>
<span class="term-fg31">-		if balance.Cmp(need) &lt; 0 {</span>
<span class="term-fg31">-			return fmt.Errorf(&quot;%w: balance %v, queued cost %v, tx cost %v, overshot %v&quot;, core.ErrInsufficientFunds, balance, spent, cost, new(big.Int).Sub(need, balance))</span>
<span class="term-fg32">+		feeCurrencyNeed := new(big.Int).Add(feeCurrencySpent, feeCurrencyCost)</span>
<span class="term-fg32">+		nativeNeed := new(big.Int).Add(nativeSpent, nativeCost)</span>
<span class="term-fg32">+		if feeCurrencyBalance.Cmp(feeCurrencyNeed) &lt; 0 {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;%w: balance %v, queued cost %v, tx cost %v, overshot %v, feeCurrency %v&quot;, core.ErrInsufficientFunds, feeCurrencyBalance, feeCurrencySpent, feeCurrencyCost, new(big.Int).Sub(feeCurrencyNeed, feeCurrencyBalance), tx.FeeCurrency())</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if nativeBalance.Cmp(nativeNeed) &lt; 0 {</span>
<span class="term-fg32">+			return fmt.Errorf(&quot;%w: balance %v, queued cost %v, tx cost %v, overshot %v&quot;, core.ErrInsufficientFunds, nativeBalance, nativeSpent, nativeCost, new(big.Int).Sub(nativeNeed, nativeBalance))</span>
 		}
 		&#47;&#47; Transaction takes a new nonce value out of the pool. Ensure it doesn&#39;t
 		&#47;&#47; overflow the number of permitted transactions from a single account</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-dc87057a65a0eb6dc01e05b4" role="button"
                       aria-expanded="false" aria-controls="id-dc87057a65a0eb6dc01e05b4">
                        <code>core/types/celo_dynamic_fee_tx.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_dynamic_fee_tx.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+136</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dc87057a65a0eb6dc01e05b4"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_dynamic_fee_tx.go CELO&#47;core&#47;types&#47;celo_dynamic_fee_tx.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..f1fab1f4d8ce6e078311d6335e6fb117404cf019</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_dynamic_fee_tx.go</span>
<span class="term-fg36">@@ -0,0 +1,136 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2024 The Celo Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the celo library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the celo library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;bytes&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const CeloDynamicFeeTxType = 0x7c</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type CeloDynamicFeeTx struct {</span>
<span class="term-fg32">+	ChainID             *big.Int</span>
<span class="term-fg32">+	Nonce               uint64</span>
<span class="term-fg32">+	GasTipCap           *big.Int</span>
<span class="term-fg32">+	GasFeeCap           *big.Int</span>
<span class="term-fg32">+	Gas                 uint64</span>
<span class="term-fg32">+	FeeCurrency         *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means native currency</span>
<span class="term-fg32">+	GatewayFeeRecipient *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means no gateway fee is paid</span>
<span class="term-fg32">+	GatewayFee          *big.Int        `rlp:&quot;nil&quot;`</span>
<span class="term-fg32">+	To                  *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means contract creation</span>
<span class="term-fg32">+	Value               *big.Int</span>
<span class="term-fg32">+	Data                []byte</span>
<span class="term-fg32">+	AccessList          AccessList</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Signature values</span>
<span class="term-fg32">+	V *big.Int `json:&quot;v&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	R *big.Int `json:&quot;r&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	S *big.Int `json:&quot;s&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; copy creates a deep copy of the transaction data and initializes all fields.</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) copy() TxData {</span>
<span class="term-fg32">+	cpy := &amp;CeloDynamicFeeTx{</span>
<span class="term-fg32">+		Nonce:               tx.Nonce,</span>
<span class="term-fg32">+		To:                  copyAddressPtr(tx.To),</span>
<span class="term-fg32">+		Data:                common.CopyBytes(tx.Data),</span>
<span class="term-fg32">+		Gas:                 tx.Gas,</span>
<span class="term-fg32">+		FeeCurrency:         copyAddressPtr(tx.FeeCurrency),</span>
<span class="term-fg32">+		GatewayFeeRecipient: copyAddressPtr(tx.GatewayFeeRecipient),</span>
<span class="term-fg32">+		&#47;&#47; These are copied below.</span>
<span class="term-fg32">+		AccessList: make(AccessList, len(tx.AccessList)),</span>
<span class="term-fg32">+		GatewayFee: new(big.Int),</span>
<span class="term-fg32">+		Value:      new(big.Int),</span>
<span class="term-fg32">+		ChainID:    new(big.Int),</span>
<span class="term-fg32">+		GasTipCap:  new(big.Int),</span>
<span class="term-fg32">+		GasFeeCap:  new(big.Int),</span>
<span class="term-fg32">+		V:          new(big.Int),</span>
<span class="term-fg32">+		R:          new(big.Int),</span>
<span class="term-fg32">+		S:          new(big.Int),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	copy(cpy.AccessList, tx.AccessList)</span>
<span class="term-fg32">+	if tx.Value != nil {</span>
<span class="term-fg32">+		cpy.Value.Set(tx.Value)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.ChainID != nil {</span>
<span class="term-fg32">+		cpy.ChainID.Set(tx.ChainID)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.GasTipCap != nil {</span>
<span class="term-fg32">+		cpy.GasTipCap.Set(tx.GasTipCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.GasFeeCap != nil {</span>
<span class="term-fg32">+		cpy.GasFeeCap.Set(tx.GasFeeCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.GatewayFee != nil {</span>
<span class="term-fg32">+		cpy.GatewayFee.Set(tx.GatewayFee)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.V != nil {</span>
<span class="term-fg32">+		cpy.V.Set(tx.V)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.R != nil {</span>
<span class="term-fg32">+		cpy.R.Set(tx.R)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.S != nil {</span>
<span class="term-fg32">+		cpy.S.Set(tx.S)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return cpy</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; accessors for innerTx.</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) txType() byte           { return CeloDynamicFeeTxType }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) chainID() *big.Int      { return tx.ChainID }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) accessList() AccessList { return tx.AccessList }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) data() []byte           { return tx.Data }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) gas() uint64            { return tx.Gas }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) gasFeeCap() *big.Int    { return tx.GasFeeCap }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) gasTipCap() *big.Int    { return tx.GasTipCap }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) gasPrice() *big.Int     { return tx.GasFeeCap }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) value() *big.Int        { return tx.Value }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) nonce() uint64          { return tx.Nonce }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) to() *common.Address    { return tx.To }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) isSystemTx() bool       { return false }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) effectiveGasPrice(dst *big.Int, baseFee *big.Int) *big.Int {</span>
<span class="term-fg32">+	if baseFee == nil {</span>
<span class="term-fg32">+		return dst.Set(tx.GasFeeCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	tip := dst.Sub(tx.GasFeeCap, baseFee)</span>
<span class="term-fg32">+	if tip.Cmp(tx.GasTipCap) &gt; 0 {</span>
<span class="term-fg32">+		tip.Set(tx.GasTipCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return tip.Add(tip, baseFee)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) rawSignatureValues() (v, r, s *big.Int) {</span>
<span class="term-fg32">+	return tx.V, tx.R, tx.S</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) setSignatureValues(chainID, v, r, s *big.Int) {</span>
<span class="term-fg32">+	tx.ChainID, tx.V, tx.R, tx.S = chainID, v, r, s</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) encode(b *bytes.Buffer) error {</span>
<span class="term-fg32">+	return rlp.Encode(b, tx)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTx) decode(input []byte) error {</span>
<span class="term-fg32">+	return rlp.DecodeBytes(input, tx)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3f386fbb6b3ffc67599af88e" role="button"
                       aria-expanded="false" aria-controls="id-3f386fbb6b3ffc67599af88e">
                        <code>core/types/celo_transaction_signing.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_transaction_signing.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+118</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3f386fbb6b3ffc67599af88e"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_transaction_signing.go CELO&#47;core&#47;types&#47;celo_transaction_signing.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..823d9212d52cf6687625c889a872808777bc1fbb</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_transaction_signing.go</span>
<span class="term-fg36">@@ -0,0 +1,118 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2024 The Celo Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the celo library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the celo library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;errors&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	ErrDeprecatedTxType = errors.New(&quot;deprecated transaction type&quot;)</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; celoSigner acts as an overlay signer that handles celo specific signing</span>
<span class="term-fg32">+&#47;&#47; functionality and hands off to an upstream signer for any other transaction</span>
<span class="term-fg32">+&#47;&#47; types. Unlike the signers in the go-ethereum library, the celoSigner is</span>
<span class="term-fg32">+&#47;&#47; configured with a list of forks that determine it&#39;s signing capabilities so</span>
<span class="term-fg32">+&#47;&#47; there should not be a need to create any further signers to handle celo</span>
<span class="term-fg32">+&#47;&#47; specific transaction types.</span>
<span class="term-fg32">+type celoSigner struct {</span>
<span class="term-fg32">+	upstreamSigner Signer</span>
<span class="term-fg32">+	chainID        *big.Int</span>
<span class="term-fg32">+	activatedForks forks</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; makeCeloSigner creates a new celoSigner that is configured to handle all</span>
<span class="term-fg32">+&#47;&#47; celo forks that are active at the given block time. If there are no active</span>
<span class="term-fg32">+&#47;&#47; celo forks the upstream signer will be returned.</span>
<span class="term-fg32">+func makeCeloSigner(chainConfig *params.ChainConfig, blockTime uint64, upstreamSigner Signer) Signer {</span>
<span class="term-fg32">+	s := &amp;celoSigner{</span>
<span class="term-fg32">+		chainID:        chainConfig.ChainID,</span>
<span class="term-fg32">+		upstreamSigner: upstreamSigner,</span>
<span class="term-fg32">+		activatedForks: celoForks.activeForks(blockTime, chainConfig),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; If there are no active celo forks, return the upstream signer</span>
<span class="term-fg32">+	if len(s.activatedForks) == 0 {</span>
<span class="term-fg32">+		return upstreamSigner</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return s</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; latestCeloSigner creates a new celoSigner that is configured to handle all</span>
<span class="term-fg32">+&#47;&#47; celo forks for non celo transaction types it will delegate to the given</span>
<span class="term-fg32">+&#47;&#47; upstream signer.</span>
<span class="term-fg32">+func latestCeloSigner(chainID *big.Int, upstreamSigner Signer) Signer {</span>
<span class="term-fg32">+	return &amp;celoSigner{</span>
<span class="term-fg32">+		chainID:        chainID,</span>
<span class="term-fg32">+		upstreamSigner: upstreamSigner,</span>
<span class="term-fg32">+		activatedForks: celoForks,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Sender implements Signer.</span>
<span class="term-fg32">+func (c *celoSigner) Sender(tx *Transaction) (common.Address, error) {</span>
<span class="term-fg32">+	if funcs := c.findTxFuncs(tx); funcs != nil {</span>
<span class="term-fg32">+		return funcs.sender(tx, funcs.hash, c.ChainID())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return c.upstreamSigner.Sender(tx)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; SignatureValues implements Signer.</span>
<span class="term-fg32">+func (c *celoSigner) SignatureValues(tx *Transaction, sig []byte) (r *big.Int, s *big.Int, v *big.Int, err error) {</span>
<span class="term-fg32">+	if funcs := c.findTxFuncs(tx); funcs != nil {</span>
<span class="term-fg32">+		return funcs.signatureValues(tx, sig, c.ChainID())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return c.upstreamSigner.SignatureValues(tx, sig)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Hash implements Signer.</span>
<span class="term-fg32">+func (c *celoSigner) Hash(tx *Transaction) common.Hash {</span>
<span class="term-fg32">+	if funcs := c.findTxFuncs(tx); funcs != nil {</span>
<span class="term-fg32">+		return funcs.hash(tx, c.ChainID())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return c.upstreamSigner.Hash(tx)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; findTxFuncs returns the txFuncs for the given tx if it is supported by one</span>
<span class="term-fg32">+&#47;&#47; of the active forks. Note that this mechanism can be used to deprecate</span>
<span class="term-fg32">+&#47;&#47; support for tx types by having forks return deprecatedTxFuncs for a tx type.</span>
<span class="term-fg32">+func (c *celoSigner) findTxFuncs(tx *Transaction) *txFuncs {</span>
<span class="term-fg32">+	return c.activatedForks.findTxFuncs(tx)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; ChainID implements Signer.</span>
<span class="term-fg32">+func (c *celoSigner) ChainID() *big.Int {</span>
<span class="term-fg32">+	return c.chainID</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Equal implements Signer.</span>
<span class="term-fg32">+func (c *celoSigner) Equal(s Signer) bool {</span>
<span class="term-fg32">+	&#47;&#47; Normally signers just check to see if the chainID and type are equal,</span>
<span class="term-fg32">+	&#47;&#47; because their logic is hardcoded to a specific fork. In our case we need</span>
<span class="term-fg32">+	&#47;&#47; to also know that the two signers have matching latest forks.</span>
<span class="term-fg32">+	other, ok := s.(*celoSigner)</span>
<span class="term-fg32">+	return ok &amp;&amp; c.ChainID() == other.ChainID() &amp;&amp; c.latestFork().equal(other.latestFork())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoSigner) latestFork() fork {</span>
<span class="term-fg32">+	return c.activatedForks[len(c.activatedForks)-1]</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a756da15a0afdc7405e074b7" role="button"
                       aria-expanded="false" aria-controls="id-a756da15a0afdc7405e074b7">
                        <code>core/types/receipt.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/types/receipt.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/receipt.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+108</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a756da15a0afdc7405e074b7"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;receipt.go CELO&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg1">index 4bc83bf988f84dbe37f3fc0a04577c2838f9363a..6c46d55265f33fafe2eebb8c092886e80b05ace2 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;receipt.go</span>
<span class="term-fg36">@@ -92,6 +92,11 @@</span> 	L1Fee               *big.Int   `json:&quot;l1Fee,omitempty&quot;`               &#47;&#47; Present from pre-bedrock
 	FeeScalar           *big.Float `json:&quot;l1FeeScalar,omitempty&quot;`         &#47;&#47; Present from pre-bedrock to Ecotone. Nil after Ecotone
 	L1BaseFeeScalar     *uint64    `json:&quot;l1BaseFeeScalar,omitempty&quot;`     &#47;&#47; Always nil prior to the Ecotone hardfork
 	L1BlobBaseFeeScalar *uint64    `json:&quot;l1BlobBaseFeeScalar,omitempty&quot;` &#47;&#47; Always nil prior to the Ecotone hardfork
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo</span>
<span class="term-fg32">+	&#47;&#47; The BaseFee is stored in fee currency for fee currency txs. We need</span>
<span class="term-fg32">+	&#47;&#47; this field to calculate the EffectiveGasPrice for fee currency txs.</span>
<span class="term-fg32">+	BaseFee *big.Int `json:&quot;baseFee,omitempty&quot;`</span>
 }
&nbsp;
 type receiptMarshaling struct {
<span class="term-fg36">@@ -140,6 +145,15 @@</span> 	&#47;&#47; which post-Canyon receipt hash function to invoke.
 	DepositReceiptVersion *uint64 `rlp:&quot;optional&quot;`
 }
&nbsp;
<span class="term-fg32">+type celoDynamicReceiptRLP struct {</span>
<span class="term-fg32">+	PostStateOrStatus []byte</span>
<span class="term-fg32">+	CumulativeGasUsed uint64</span>
<span class="term-fg32">+	Bloom             Bloom</span>
<span class="term-fg32">+	Logs              []*Log</span>
<span class="term-fg32">+	&#47;&#47; BaseFee was introduced as mandatory in Cel2 ONLY for the CeloDynamicFeeTxs</span>
<span class="term-fg32">+	BaseFee *big.Int `rlp:&quot;optional&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; storedReceiptRLP is the storage encoding of a receipt.
 type storedReceiptRLP struct {
 	PostStateOrStatus []byte
<span class="term-fg36">@@ -154,6 +168,14 @@</span> 	&#47;&#47; which post-Canyon receipt hash function to invoke.
 	DepositReceiptVersion *uint64 `rlp:&quot;optional&quot;`
 }
&nbsp;
<span class="term-fg32">+type celoDynamicFeeStoredReceiptRLP struct {</span>
<span class="term-fg32">+	CeloDynamicReceiptMarker []interface{} &#47;&#47; Marker to distinguish this from storedReceiptRLP</span>
<span class="term-fg32">+	PostStateOrStatus        []byte</span>
<span class="term-fg32">+	CumulativeGasUsed        uint64</span>
<span class="term-fg32">+	Logs                     []*Log</span>
<span class="term-fg32">+	BaseFee                  *big.Int `rlp:&quot;optional&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; LegacyOptimismStoredReceiptRLP is the pre bedrock storage encoding of a
 &#47;&#47; receipt. It will only exist in the database if it was migrated using the
 &#47;&#47; migration tool. Nodes that sync using snap-sync will not have any of these
<span class="term-fg36">@@ -256,6 +278,9 @@</span> &#47;&#47; encodeTyped writes the canonical encoding of a typed receipt to w.
 func (r *Receipt) encodeTyped(data *receiptRLP, w *bytes.Buffer) error {
 	w.WriteByte(r.Type)
 	switch r.Type {
<span class="term-fg32">+	case CeloDynamicFeeTxV2Type:</span>
<span class="term-fg32">+		withBaseFee := &amp;celoDynamicReceiptRLP{data.PostStateOrStatus, data.CumulativeGasUsed, data.Bloom, data.Logs, r.BaseFee}</span>
<span class="term-fg32">+		return rlp.Encode(w, withBaseFee)</span>
 	case DepositTxType:
 		withNonce := &amp;depositReceiptRLP{data.PostStateOrStatus, data.CumulativeGasUsed, data.Bloom, data.Logs, r.DepositNonce, r.DepositReceiptVersion}
 		return rlp.Encode(w, withNonce)
<span class="term-fg36">@@ -329,7 +354,7 @@</span> 	if len(b) &lt;= 1 {
 		return errShortTypedReceipt
 	}
 	switch b[0] {
<span class="term-fg31">-	case DynamicFeeTxType, AccessListTxType, BlobTxType:</span>
<span class="term-fg32">+	case DynamicFeeTxType, AccessListTxType, BlobTxType, CeloDynamicFeeTxType:</span>
 		var data receiptRLP
 		err := rlp.DecodeBytes(b[1:], &amp;data)
 		if err != nil {
<span class="term-fg36">@@ -337,6 +362,15 @@</span> 			return err
 		}
 		r.Type = b[0]
 		return r.setFromRLP(data)
<span class="term-fg32">+	case CeloDynamicFeeTxV2Type:</span>
<span class="term-fg32">+		var data celoDynamicReceiptRLP</span>
<span class="term-fg32">+		err := rlp.DecodeBytes(b[1:], &amp;data)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		r.Type = b[0]</span>
<span class="term-fg32">+		r.BaseFee = data.BaseFee</span>
<span class="term-fg32">+		return r.setFromRLP(receiptRLP{data.PostStateOrStatus, data.CumulativeGasUsed, data.Bloom, data.Logs})</span>
 	case DepositTxType:
 		var data depositReceiptRLP
 		err := rlp.DecodeBytes(b[1:], &amp;data)
<span class="term-fg36">@@ -401,6 +435,11 @@</span> &#47;&#47; into an RLP stream.
 func (r *ReceiptForStorage) EncodeRLP(_w io.Writer) error {
 	w := rlp.NewEncoderBuffer(_w)
 	outerList := w.List()
<span class="term-fg32">+	if r.Type == CeloDynamicFeeTxV2Type {</span>
<span class="term-fg32">+		&#47;&#47; Mark receipt as CeloDynamicFee receipt by starting with an empty list</span>
<span class="term-fg32">+		listIndex := w.List()</span>
<span class="term-fg32">+		w.ListEnd(listIndex)</span>
<span class="term-fg32">+	}</span>
 	w.WriteBytes((*Receipt)(r).statusEncoding())
 	w.WriteUint64(r.CumulativeGasUsed)
 	logList := w.List()
<span class="term-fg36">@@ -416,10 +455,25 @@</span> 		if r.DepositReceiptVersion != nil {
 			w.WriteUint64(*r.DepositReceiptVersion)
 		}
 	}
<span class="term-fg32">+	if r.Type == CeloDynamicFeeTxV2Type &amp;&amp; r.BaseFee != nil {</span>
<span class="term-fg32">+		w.WriteBigInt(r.BaseFee)</span>
<span class="term-fg32">+	}</span>
 	w.ListEnd(outerList)
 	return w.Flush()
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; Detect CeloDynamicFee receipts by looking at the first list element</span>
<span class="term-fg32">+&#47;&#47; To distinguish these receipts from the very similar normal receipts, an</span>
<span class="term-fg32">+&#47;&#47; empty list is added as the first element of the RLP-serialized struct.</span>
<span class="term-fg32">+func isCeloDynamicFeeReceipt(blob []byte) bool {</span>
<span class="term-fg32">+	listHeaderSize := 1 &#47;&#47; Length of the list header representing the struct in bytes</span>
<span class="term-fg32">+	if blob[0] &gt; 0xf7 {</span>
<span class="term-fg32">+		listHeaderSize += int(blob[0]) - 0xf7</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	firstListElement := blob[listHeaderSize] &#47;&#47; First byte of first list element</span>
<span class="term-fg32">+	return firstListElement == 0xc0</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; DecodeRLP implements rlp.Decoder, and loads both consensus and implementation
 &#47;&#47; fields of a receipt from an RLP stream.
 func (r *ReceiptForStorage) DecodeRLP(s *rlp.Stream) error {
<span class="term-fg36">@@ -429,6 +483,9 @@</span> 	if err != nil {
 		return err
 	}
 	&#47;&#47; First try to decode the latest receipt database format, try the pre-bedrock Optimism legacy format otherwise.
<span class="term-fg32">+	if isCeloDynamicFeeReceipt(blob) {</span>
<span class="term-fg32">+		return decodeStoredCeloDynamicFeeReceiptRLP(r, blob)</span>
<span class="term-fg32">+	}</span>
 	if err := decodeStoredReceiptRLP(r, blob); err == nil {
 		return nil
 	}
<span class="term-fg36">@@ -465,6 +522,21 @@</span> 	r.FeeScalar = scalar
 	return nil
 }
&nbsp;
<span class="term-fg32">+func decodeStoredCeloDynamicFeeReceiptRLP(r *ReceiptForStorage, blob []byte) error {</span>
<span class="term-fg32">+	var stored celoDynamicFeeStoredReceiptRLP</span>
<span class="term-fg32">+	if err := rlp.DecodeBytes(blob, &amp;stored); err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if err := (*Receipt)(r).setStatus(stored.PostStateOrStatus); err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r.CumulativeGasUsed = stored.CumulativeGasUsed</span>
<span class="term-fg32">+	r.Logs = stored.Logs</span>
<span class="term-fg32">+	r.Bloom = CreateBloom(Receipts{(*Receipt)(r)})</span>
<span class="term-fg32">+	r.BaseFee = stored.BaseFee</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func decodeStoredReceiptRLP(r *ReceiptForStorage, blob []byte) error {
 	var stored storedReceiptRLP
 	if err := rlp.DecodeBytes(blob, &amp;stored); err != nil {
<span class="term-fg36">@@ -502,8 +574,11 @@</span> 		return
 	}
 	w.WriteByte(r.Type)
 	switch r.Type {
<span class="term-fg31">-	case AccessListTxType, DynamicFeeTxType, BlobTxType:</span>
<span class="term-fg32">+	case AccessListTxType, DynamicFeeTxType, BlobTxType, CeloDynamicFeeTxType:</span>
 		rlp.Encode(w, data)
<span class="term-fg32">+	case CeloDynamicFeeTxV2Type:</span>
<span class="term-fg32">+		celoDynamicData := &amp;celoDynamicReceiptRLP{data.PostStateOrStatus, data.CumulativeGasUsed, data.Bloom, data.Logs, r.BaseFee}</span>
<span class="term-fg32">+		rlp.Encode(w, celoDynamicData)</span>
 	case DepositTxType:
 		if r.DepositReceiptVersion != nil {
 			&#47;&#47; post-canyon receipt hash computation update
<span class="term-fg36">@@ -525,14 +600,28 @@</span> func (rs Receipts) DeriveFields(config *params.ChainConfig, hash common.Hash, number uint64, time uint64, baseFee *big.Int, blobGasPrice *big.Int, txs []*Transaction) error {
 	signer := MakeSigner(config, new(big.Int).SetUint64(number), time)
&nbsp;
 	logIndex := uint(0)
<span class="term-fg31">-	if len(txs) != len(rs) {</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; If rs are one longer than txs it indicates the presence of a celo block receipt.</span>
<span class="term-fg32">+	if len(txs) != len(rs) &amp;&amp; len(txs)+1 != len(rs) {</span>
 		return errors.New(&quot;transaction and receipt count mismatch&quot;)
 	}
<span class="term-fg31">-	for i := 0; i &lt; len(rs); i++ {</span>
<span class="term-fg32">+	for i := 0; i &lt; len(txs); i++ {</span>
 		&#47;&#47; The transaction type and hash can be retrieved from the transaction itself
 		rs[i].Type = txs[i].Type()
 		rs[i].TxHash = txs[i].Hash()
<span class="term-fg31">-		rs[i].EffectiveGasPrice = txs[i].inner.effectiveGasPrice(new(big.Int), baseFee)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; Pre-gingerbred the base fee was stored in state, but we don&#39;t try to recover it here, since A) we don&#39;t have</span>
<span class="term-fg32">+		&#47;&#47; access to the objects required to get the state and B) retrieving the base fee is quite code heavy and we</span>
<span class="term-fg32">+		&#47;&#47; don&#39;t want to bring that code across from the celo L1 to op-geth. In the celo L1 we would return a nil base</span>
<span class="term-fg32">+		&#47;&#47; fee if the state was not available, so that is what we do here.</span>
<span class="term-fg32">+		if config.IsGingerbread(new(big.Int).SetUint64(number)) {</span>
<span class="term-fg32">+			&#47;&#47; The post transition CeloDynamicFeeV2Txs set the baseFee in the receipt</span>
<span class="term-fg32">+			if rs[i].BaseFee == nil {</span>
<span class="term-fg32">+				rs[i].EffectiveGasPrice = txs[i].inner.effectiveGasPrice(new(big.Int), baseFee)</span>
<span class="term-fg32">+			} else {</span>
<span class="term-fg32">+				rs[i].EffectiveGasPrice = txs[i].inner.effectiveGasPrice(new(big.Int), rs[i].BaseFee)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
&nbsp;
 		&#47;&#47; EIP-4844 blob transaction fields
 		if txs[i].Type() == BlobTxType {
<span class="term-fg36">@@ -575,6 +664,20 @@</span> 			rs[i].Logs[j].Index = logIndex
 			logIndex++
 		}
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; This is a celo block receipt, which uses the block hash in place of the tx hash.</span>
<span class="term-fg32">+	if len(txs)+1 == len(rs) {</span>
<span class="term-fg32">+		j := len(txs)</span>
<span class="term-fg32">+		for k := 0; k &lt; len(rs[j].Logs); k++ {</span>
<span class="term-fg32">+			rs[j].Logs[k].BlockNumber = number</span>
<span class="term-fg32">+			rs[j].Logs[k].BlockHash = hash</span>
<span class="term-fg32">+			rs[j].Logs[k].TxHash = hash</span>
<span class="term-fg32">+			rs[j].Logs[k].TxIndex = uint(j)</span>
<span class="term-fg32">+			rs[j].Logs[k].Index = logIndex</span>
<span class="term-fg32">+			logIndex++</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	if config.Optimism != nil &amp;&amp; len(txs) &gt;= 2 &amp;&amp; config.IsBedrock(new(big.Int).SetUint64(number)) { &#47;&#47; need at least an info tx and a non-info tx
 		gasParams, err := extractL1GasParams(config, time, txs[0].Data())
 		if err != nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-800c839eb43dc071c15b2429" role="button"
                       aria-expanded="false" aria-controls="id-800c839eb43dc071c15b2429">
                        <code>core/types/receipt_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/types/receipt_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/receipt_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+41</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-800c839eb43dc071c15b2429"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;receipt_test.go CELO&#47;core&#47;types&#47;receipt_test.go</span>
<span class="term-fg1">index 1156f3e94f2d176d8eb1eb936ba3741527450a17..58c67f3790a4b8cdf0feecf025595af0c188d3b6 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;types&#47;receipt_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;receipt_test.go</span>
<span class="term-fg36">@@ -99,6 +99,24 @@</span> 			},
 		},
 		Type: DynamicFeeTxType,
 	}
<span class="term-fg32">+	celoDynamicFeeReceipt = &amp;Receipt{</span>
<span class="term-fg32">+		Status:            ReceiptStatusFailed,</span>
<span class="term-fg32">+		CumulativeGasUsed: 1,</span>
<span class="term-fg32">+		Logs: []*Log{</span>
<span class="term-fg32">+			{</span>
<span class="term-fg32">+				Address: common.BytesToAddress([]byte{0x11}),</span>
<span class="term-fg32">+				Topics:  []common.Hash{common.HexToHash(&quot;dead&quot;), common.HexToHash(&quot;beef&quot;)},</span>
<span class="term-fg32">+				Data:    []byte{0x01, 0x00, 0xff},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			{</span>
<span class="term-fg32">+				Address: common.BytesToAddress([]byte{0x01, 0x11}),</span>
<span class="term-fg32">+				Topics:  []common.Hash{common.HexToHash(&quot;dead&quot;), common.HexToHash(&quot;beef&quot;)},</span>
<span class="term-fg32">+				Data:    []byte{0x01, 0x00, 0xff},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		BaseFee: new(big.Int).SetUint64(1),</span>
<span class="term-fg32">+		Type:    CeloDynamicFeeTxV2Type,</span>
<span class="term-fg32">+	}</span>
 	depositReceiptNoNonce = &amp;Receipt{
 		Status:            ReceiptStatusFailed,
 		CumulativeGasUsed: 1,
<span class="term-fg36">@@ -624,6 +642,24 @@</span> 	eip1559Want := common.FromHex(&quot;02f901c58001b9010000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000010000080000000000000000000004000000000000000000000000000040000000000000000000000000000800000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000f8bef85d940000000000000000000000000000000000000011f842a0000000000000000000000000000000000000000000000000000000000000deada0000000000000000000000000000000000000000000000000000000000000beef830100fff85d940000000000000000000000000000000000000111f842a0000000000000000000000000000000000000000000000000000000000000deada0000000000000000000000000000000000000000000000000000000000000beef830100ff&quot;)
 	if !bytes.Equal(have, eip1559Want) {
 		t.Errorf(&quot;encoded RLP mismatch, got %x want %x&quot;, have, eip1559Want)
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo Dynamic Fee Receipt</span>
<span class="term-fg32">+	buf.Reset()</span>
<span class="term-fg32">+	celoDynamicFeeReceipt.Bloom = CreateBloom(Receipts{celoDynamicFeeReceipt})</span>
<span class="term-fg32">+	have, err = celoDynamicFeeReceipt.MarshalBinary()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		t.Fatalf(&quot;marshal binary error: %v&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	celoDynamicFeeReceipts := Receipts{celoDynamicFeeReceipt}</span>
<span class="term-fg32">+	celoDynamicFeeReceipts.EncodeIndex(0, buf)</span>
<span class="term-fg32">+	haveEncodeIndex = buf.Bytes()</span>
<span class="term-fg32">+	if !bytes.Equal(have, haveEncodeIndex) {</span>
<span class="term-fg32">+		t.Errorf(&quot;BinaryMarshal and EncodeIndex mismatch, got %x want %x&quot;, have, haveEncodeIndex)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	celoDynamicFeeWant := common.FromHex(&quot;7bf901c68001b9010000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000014000000000000000000000000000000000000000000000000000000000000000000000000000010000080000000000000000000004000000000000000000000000000040000000000000000000000000000800000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000f8bef85d940000000000000000000000000000000000000011f842a0000000000000000000000000000000000000000000000000000000000000deada0000000000000000000000000000000000000000000000000000000000000beef830100fff85d940000000000000000000000000000000000000111f842a0000000000000000000000000000000000000000000000000000000000000deada0000000000000000000000000000000000000000000000000000000000000beef830100ff01&quot;)</span>
<span class="term-fg32">+	if !bytes.Equal(have, celoDynamicFeeWant) {</span>
<span class="term-fg32">+		t.Errorf(&quot;encoded RLP mismatch, got %x want %x&quot;, have, celoDynamicFeeWant)</span>
<span class="term-fg32">+	}</span>
 }
&nbsp;
 func TestReceiptUnmarshalBinary(t *testing.T) {
<span class="term-fg36">@@ -1002,6 +1038,7 @@</span> 	}{
 		{name: &quot;Legacy&quot;, rcpt: legacyReceipt},
 		{name: &quot;AccessList&quot;, rcpt: accessListReceipt},
 		{name: &quot;EIP1559&quot;, rcpt: eip1559Receipt},
<span class="term-fg32">+		{name: &quot;CeloDynamicFee&quot;, rcpt: celoDynamicFeeReceipt},</span>
 		{name: &quot;DepositNoNonce&quot;, rcpt: depositReceiptNoNonce},
 		{name: &quot;DepositWithNonce&quot;, rcpt: depositReceiptWithNonce},
 		{name: &quot;DepositWithNonceAndVersion&quot;, rcpt: depositReceiptWithNonceAndVersion},
<span class="term-fg36">@@ -1038,6 +1075,7 @@</span> 	}{
 		{name: &quot;Legacy&quot;, rcpt: legacyReceipt},
 		{name: &quot;AccessList&quot;, rcpt: accessListReceipt},
 		{name: &quot;EIP1559&quot;, rcpt: eip1559Receipt},
<span class="term-fg32">+		{name: &quot;CeloDynamicFee&quot;, rcpt: celoDynamicFeeReceipt},</span>
 		{name: &quot;DepositNoNonce&quot;, rcpt: depositReceiptNoNonce},
 		{name: &quot;DepositWithNonce&quot;, rcpt: depositReceiptWithNonce},
 		{name: &quot;DepositWithNonceAndVersion&quot;, rcpt: depositReceiptWithNonceAndVersion},
<span class="term-fg36">@@ -1056,6 +1094,9 @@</span> 			require.Equal(t, test.rcpt.CumulativeGasUsed, d.CumulativeGasUsed)
 			require.Equal(t, test.rcpt.Logs, d.Logs)
 			require.Equal(t, test.rcpt.DepositNonce, d.DepositNonce)
 			require.Equal(t, test.rcpt.DepositReceiptVersion, d.DepositReceiptVersion)
<span class="term-fg32">+			if test.rcpt.Type == CeloDynamicFeeTxV2Type {</span>
<span class="term-fg32">+				require.Equal(t, test.rcpt.EffectiveGasPrice, d.EffectiveGasPrice)</span>
<span class="term-fg32">+			}</span>
 		})
 	}
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-77fd1ea5bf27d9dabd91a2c2" role="button"
                       aria-expanded="false" aria-controls="id-77fd1ea5bf27d9dabd91a2c2">
                        <code>core/types/transaction.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/types/transaction.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/transaction.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+24</span></div>
                            <div class="text-start"><span class="text-danger">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-77fd1ea5bf27d9dabd91a2c2"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;transaction.go CELO&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg1">index 95ecac5fae971e8096865aea25b9955dc34e0ad5..63f313734f3e973c5f59fbb44040c1c5540a484b 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;transaction.go</span>
<span class="term-fg36">@@ -203,6 +203,11 @@</span> func (tx *Transaction) decodeTyped(b []byte) (TxData, error) {
 	if len(b) &lt;= 1 {
 		return nil, errShortTypedTx
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	if inner, isCelo, err := celoDecodeTyped(b); isCelo {</span>
<span class="term-fg32">+		return inner, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	var inner TxData
 	switch b[0] {
 	case AccessListTxType:
<span class="term-fg36">@@ -360,14 +365,29 @@</span> func (tx *Transaction) IsSystemTx() bool {
 	return tx.inner.isSystemTx()
 }
&nbsp;
<span class="term-fg31">-&#47;&#47; Cost returns (gas * gasPrice) + (blobGas * blobGasPrice) + value.</span>
<span class="term-fg31">-func (tx *Transaction) Cost() *big.Int {</span>
<span class="term-fg32">+&#47;&#47; Cost returns both components of the tx costs:</span>
<span class="term-fg32">+&#47;&#47; - cost in feeCurrency: (gas * gasPrice) + (blobGas * blobGasPrice)</span>
<span class="term-fg32">+&#47;&#47; - native token cost: value sent to target contract</span>
<span class="term-fg32">+&#47;&#47; For non-feeCurrency transactions, the first value is zero and the second is the total cost.</span>
<span class="term-fg32">+func (tx *Transaction) Cost() (*big.Int, *big.Int) {</span>
 	total := new(big.Int).Mul(tx.GasPrice(), new(big.Int).SetUint64(tx.Gas()))
 	if tx.Type() == BlobTxType {
 		total.Add(total, new(big.Int).Mul(tx.BlobGasFeeCap(), new(big.Int).SetUint64(tx.BlobGas())))
 	}
<span class="term-fg31">-	total.Add(total, tx.Value())</span>
<span class="term-fg31">-	return total</span>
<span class="term-fg32">+	if tx.FeeCurrency() == nil {</span>
<span class="term-fg32">+		nativeCost := total.Add(total, tx.Value())</span>
<span class="term-fg32">+		return new(big.Int), nativeCost</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		&#47;&#47; Will need to be updated for CIP-66</span>
<span class="term-fg32">+		nativeCost := tx.Value()</span>
<span class="term-fg32">+		return total, nativeCost</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Returns the native token component of the transaction cost.</span>
<span class="term-fg32">+func (tx *Transaction) NativeCost() *big.Int {</span>
<span class="term-fg32">+	_, nativeCost := tx.Cost()</span>
<span class="term-fg32">+	return nativeCost</span>
 }
&nbsp;
 &#47;&#47; RollupCostData caches the information needed to efficiently compute the data availability fee</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-20d4934c80f75066c157dcd3" role="button"
                       aria-expanded="false" aria-controls="id-20d4934c80f75066c157dcd3">
                        <code>core/types/transaction_marshalling.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/types/transaction_marshalling.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/transaction_marshalling.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-20d4934c80f75066c157dcd3"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;transaction_marshalling.go CELO&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg1">index 253e4f03de82c53bfe2b48037a728d6397e1a6ec..3b68418d86349b3b69e570ee6412a5f2dfee0ace 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;transaction_marshalling.go</span>
<span class="term-fg36">@@ -63,6 +63,9 @@</span> 	Proofs      []kzg4844.Proof      `json:&quot;proofs,omitempty&quot;`
&nbsp;
 	&#47;&#47; Only used for encoding:
 	Hash common.Hash `json:&quot;hash&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific fields</span>
<span class="term-fg32">+	FeeCurrency *common.Address `json:&quot;feeCurrency,omitempty&quot;` &#47;&#47; nil means native currency</span>
 }
&nbsp;
 &#47;&#47; yParityValue returns the YParity value from JSON. For backwards-compatibility reasons,
<span class="term-fg36">@@ -87,6 +90,9 @@</span> }
&nbsp;
 &#47;&#47; MarshalJSON marshals as JSON with a hash.
 func (tx *Transaction) MarshalJSON() ([]byte, error) {
<span class="term-fg32">+	if marshalled, isCelo, err := celoTransactionMarshal(tx); isCelo {</span>
<span class="term-fg32">+		return marshalled, err</span>
<span class="term-fg32">+	}</span>
 	var enc txJSON
 	&#47;&#47; These are set for all tx types.
 	enc.Hash = tx.Hash()
<span class="term-fg36">@@ -188,6 +194,12 @@</span> 	}
&nbsp;
 	&#47;&#47; Decode &#47; verify fields according to transaction type.
 	var inner TxData
<span class="term-fg32">+</span>
<span class="term-fg32">+	if isCelo, err := celoTransactionUnmarshal(dec, &amp;inner); isCelo {</span>
<span class="term-fg32">+		tx.setDecoded(inner, 0)</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	switch dec.Type {
 	case LegacyTxType:
 		var itx LegacyTx</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b9b445e980cd8955decf161c" role="button"
                       aria-expanded="false" aria-controls="id-b9b445e980cd8955decf161c">
                        <code>core/types/transaction_signing.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/types/transaction_signing.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/transaction_signing.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b9b445e980cd8955decf161c"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;transaction_signing.go CELO&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg1">index 0ffe8c92d770bdb938ce10a0a253404cbc32824b..616c524eb23cb0b74453484c56e3743133cd50b0 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;transaction_signing.go</span>
<span class="term-fg36">@@ -53,6 +53,10 @@</span> 		signer = HomesteadSigner{}
 	default:
 		signer = FrontierSigner{}
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Apply the celo overlay signer, if no celo forks have been enabled then the given signer is returned.</span>
<span class="term-fg32">+	signer = makeCeloSigner(config, blockTime, signer)</span>
<span class="term-fg32">+</span>
 	return signer
 }
&nbsp;
<span class="term-fg36">@@ -67,6 +71,9 @@</span> func LatestSigner(config *params.ChainConfig) Signer {
 	if config.ChainID != nil {
 		if config.CancunTime != nil &amp;&amp; !config.IsOptimism() {
 			return NewCancunSigner(config.ChainID)
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if config.Cel2Time != nil {</span>
<span class="term-fg32">+			return latestCeloSigner(config.ChainID, NewLondonSigner(config.ChainID))</span>
 		}
 		if config.LondonBlock != nil {
 			return NewLondonSigner(config.ChainID)
<span class="term-fg36">@@ -92,7 +99,7 @@</span> func LatestSignerForChainID(chainID *big.Int) Signer {
 	if chainID == nil {
 		return HomesteadSigner{}
 	}
<span class="term-fg31">-	return NewCancunSigner(chainID)</span>
<span class="term-fg32">+	return latestCeloSigner(chainID, NewCancunSigner(chainID))</span>
 }
&nbsp;
 &#47;&#47; SignTx signs the transaction using the given signer and private key.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3fffb8d5b8d6880c49531331" role="button"
                       aria-expanded="false" aria-controls="id-3fffb8d5b8d6880c49531331">
                        <code>core/types/tx_legacy.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/types/tx_legacy.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/tx_legacy.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+25</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3fffb8d5b8d6880c49531331"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;tx_legacy.go CELO&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg1">index bcb65c39349a3a1bef78948af48a30a1e14c71ba..782c3934c74eff4cbd26c290f72073be92c0d528 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;tx_legacy.go</span>
<span class="term-fg36">@@ -25,13 +25,25 @@</span> )
&nbsp;
 &#47;&#47; LegacyTx is the transaction data of the original Ethereum transactions.
 type LegacyTx struct {
<span class="term-fg31">-	Nonce    uint64          &#47;&#47; nonce of sender account</span>
<span class="term-fg31">-	GasPrice *big.Int        &#47;&#47; wei per gas</span>
<span class="term-fg31">-	Gas      uint64          &#47;&#47; gas limit</span>
<span class="term-fg31">-	To       *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means contract creation</span>
<span class="term-fg31">-	Value    *big.Int        &#47;&#47; wei amount</span>
<span class="term-fg31">-	Data     []byte          &#47;&#47; contract invocation input data</span>
<span class="term-fg31">-	V, R, S  *big.Int        &#47;&#47; signature values</span>
<span class="term-fg32">+	Nonce    uint64   &#47;&#47; nonce of sender account</span>
<span class="term-fg32">+	GasPrice *big.Int &#47;&#47; wei per gas</span>
<span class="term-fg32">+	Gas      uint64   &#47;&#47; gas limit</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo-specific fields</span>
<span class="term-fg32">+	FeeCurrency         *common.Address &#47;&#47; nil means native currency</span>
<span class="term-fg32">+	GatewayFeeRecipient *common.Address &#47;&#47; nil means no gateway fee is paid</span>
<span class="term-fg32">+	GatewayFee          *big.Int</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	To      *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means contract creation</span>
<span class="term-fg32">+	Value   *big.Int        &#47;&#47; wei amount</span>
<span class="term-fg32">+	Data    []byte          &#47;&#47; contract invocation input data</span>
<span class="term-fg32">+	V, R, S *big.Int        &#47;&#47; signature values</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; This is only used when marshaling to JSON.</span>
<span class="term-fg32">+	Hash *common.Hash `rlp:&quot;-&quot;`</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Whether this is a celo legacy transaction (i.e. with FeeCurrency, GatewayFeeRecipient and GatewayFee)</span>
<span class="term-fg32">+	CeloLegacy bool `rlp:&quot;-&quot;`</span>
 }
&nbsp;
 &#47;&#47; NewTransaction creates an unsigned legacy transaction.
<span class="term-fg36">@@ -72,6 +84,12 @@</span> 		GasPrice: new(big.Int),
 		V:        new(big.Int),
 		R:        new(big.Int),
 		S:        new(big.Int),
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; Celo specific fields</span>
<span class="term-fg32">+		FeeCurrency:         copyAddressPtr(tx.FeeCurrency),</span>
<span class="term-fg32">+		GatewayFeeRecipient: copyAddressPtr(tx.GatewayFeeRecipient),</span>
<span class="term-fg32">+		GatewayFee:          copyBigInt(tx.GatewayFee),</span>
<span class="term-fg32">+		CeloLegacy:          tx.CeloLegacy,</span>
 	}
 	if tx.Value != nil {
 		cpy.Value.Set(tx.Value)</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-65a8fe190b03afa7e538905d"role="button" aria-expanded="false" aria-controls="id-65a8fe190b03afa7e538905d">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h3>Celo contracts</h3></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+2490</span></div>
                    <div class="text-start"><span class="text-danger">-0</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-65a8fe190b03afa7e538905d">
        <div><p>Contract bindings are necessary for token duality and gas currencies.
The corresponding contracts are included to generate the bindings and test these features.</p>
</div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-025f9c28bf22f647a64429b7" role="button"
                       aria-expanded="false" aria-controls="id-025f9c28bf22f647a64429b7">
                        <code>contracts/celo/README.md</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/README.md" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+18</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-025f9c28bf22f647a64429b7"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;README.md CELO&#47;contracts&#47;celo&#47;README.md</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3a0735f1fecc93d0c9e1f5932a755c022d139ad2</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;README.md</span>
<span class="term-fg36">@@ -0,0 +1,18 @@</span>
<span class="term-fg32">+# Celo contracts bytecode and ABI</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## Why contracts in this repo?</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+The contracts bytecode is used to generate the genesis block in `geth --dev`</span>
<span class="term-fg32">+mode while the ABI is used to generate the contract bindings in `abigen`. The</span>
<span class="term-fg32">+bindings are necessary to access the FeeCurrencyDirectory and fee currencies.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## How to update to newer contracts</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+To compile contracts in the optimism repo and extract their ABI and bin-runtime</span>
<span class="term-fg32">+for relevant contracts into this repo, run `compiled&#47;update.sh`. If your</span>
<span class="term-fg32">+optimism repo is not at `~&#47;optimism`, set the `CELO_OPTIMISM_REPO` env variable</span>
<span class="term-fg32">+accordingly. The same is true for `~&#47;celo-monorepo` and the `CELO_MONOREPO` env var.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## How to rebuild ABI wrappers</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Use `go generate`, e.g. as `go generate .&#47;contracts&#47;celo&#47;celo.go`.</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-34a2b3e890c6cc4c0dfe807b" role="button"
                       aria-expanded="false" aria-controls="id-34a2b3e890c6cc4c0dfe807b">
                        <code>contracts/celo/abigen/FeeCurrency.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/abigen/FeeCurrency.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+822</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-34a2b3e890c6cc4c0dfe807b"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;abigen&#47;FeeCurrency.go CELO&#47;contracts&#47;celo&#47;abigen&#47;FeeCurrency.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..64b51d54185afdb0838eda5b80a8c9728b3e56e3</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;abigen&#47;FeeCurrency.go</span>
<span class="term-fg36">@@ -0,0 +1,822 @@</span>
<span class="term-fg32">+&#47;&#47; Code generated - DO NOT EDIT.</span>
<span class="term-fg32">+&#47;&#47; This file is a generated binding and any manual changes will be lost.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package abigen</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;errors&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;strings&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	ethereum &quot;github.com&#47;ethereum&#47;go-ethereum&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&#47;bind&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;event&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Reference imports to suppress errors if they are not otherwise used.</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	_ = errors.New</span>
<span class="term-fg32">+	_ = big.NewInt</span>
<span class="term-fg32">+	_ = strings.NewReader</span>
<span class="term-fg32">+	_ = ethereum.NotFound</span>
<span class="term-fg32">+	_ = bind.Bind</span>
<span class="term-fg32">+	_ = common.Big1</span>
<span class="term-fg32">+	_ = types.BloomLookup</span>
<span class="term-fg32">+	_ = event.NewSubscription</span>
<span class="term-fg32">+	_ = abi.ConvertType</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyMetaData contains all meta data concerning the FeeCurrency contract.</span>
<span class="term-fg32">+var FeeCurrencyMetaData = &amp;bind.MetaData{</span>
<span class="term-fg32">+	ABI: &quot;[{\&quot;type\&quot;:\&quot;constructor\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;name_\&quot;,\&quot;type\&quot;:\&quot;string\&quot;,\&quot;internalType\&quot;:\&quot;string\&quot;},{\&quot;name\&quot;:\&quot;symbol_\&quot;,\&quot;type\&quot;:\&quot;string\&quot;,\&quot;internalType\&quot;:\&quot;string\&quot;}],\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;allowance\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;owner\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;spender\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;stateMutability\&quot;:\&quot;view\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;approve\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;spender\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;amount\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;,\&quot;internalType\&quot;:\&quot;bool\&quot;}],\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;balanceOf\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;account\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;stateMutability\&quot;:\&quot;view\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;creditGasFees\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;from\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;feeRecipient\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;communityFund\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;refund\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;},{\&quot;name\&quot;:\&quot;tipTxFee\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;},{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;},{\&quot;name\&quot;:\&quot;baseTxFee\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;outputs\&quot;:[],\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;debitGasFees\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;from\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;value\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;outputs\&quot;:[],\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;decimals\&quot;,\&quot;inputs\&quot;:[],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint8\&quot;,\&quot;internalType\&quot;:\&quot;uint8\&quot;}],\&quot;stateMutability\&quot;:\&quot;view\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;decreaseAllowance\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;spender\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;subtractedValue\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;,\&quot;internalType\&quot;:\&quot;bool\&quot;}],\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;increaseAllowance\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;spender\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;addedValue\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;,\&quot;internalType\&quot;:\&quot;bool\&quot;}],\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;name\&quot;,\&quot;inputs\&quot;:[],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;string\&quot;,\&quot;internalType\&quot;:\&quot;string\&quot;}],\&quot;stateMutability\&quot;:\&quot;view\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;symbol\&quot;,\&quot;inputs\&quot;:[],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;string\&quot;,\&quot;internalType\&quot;:\&quot;string\&quot;}],\&quot;stateMutability\&quot;:\&quot;view\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;totalSupply\&quot;,\&quot;inputs\&quot;:[],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;stateMutability\&quot;:\&quot;view\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;transfer\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;to\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;amount\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;,\&quot;internalType\&quot;:\&quot;bool\&quot;}],\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;transferFrom\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;from\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;to\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;amount\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;bool\&quot;,\&quot;internalType\&quot;:\&quot;bool\&quot;}],\&quot;stateMutability\&quot;:\&quot;nonpayable\&quot;},{\&quot;type\&quot;:\&quot;event\&quot;,\&quot;name\&quot;:\&quot;Approval\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;owner\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;indexed\&quot;:true,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;spender\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;indexed\&quot;:true,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;value\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;indexed\&quot;:false,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;anonymous\&quot;:false},{\&quot;type\&quot;:\&quot;event\&quot;,\&quot;name\&quot;:\&quot;Transfer\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;from\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;indexed\&quot;:true,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;to\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;indexed\&quot;:true,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;value\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;indexed\&quot;:false,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;anonymous\&quot;:false}]&quot;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyABI is the input ABI used to generate the binding from.</span>
<span class="term-fg32">+&#47;&#47; Deprecated: Use FeeCurrencyMetaData.ABI instead.</span>
<span class="term-fg32">+var FeeCurrencyABI = FeeCurrencyMetaData.ABI</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrency is an auto generated Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrency struct {</span>
<span class="term-fg32">+	FeeCurrencyCaller     &#47;&#47; Read-only binding to the contract</span>
<span class="term-fg32">+	FeeCurrencyTransactor &#47;&#47; Write-only binding to the contract</span>
<span class="term-fg32">+	FeeCurrencyFilterer   &#47;&#47; Log filterer for contract events</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyCaller is an auto generated read-only Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyCaller struct {</span>
<span class="term-fg32">+	contract *bind.BoundContract &#47;&#47; Generic contract wrapper for the low level calls</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyTransactor is an auto generated write-only Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyTransactor struct {</span>
<span class="term-fg32">+	contract *bind.BoundContract &#47;&#47; Generic contract wrapper for the low level calls</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyFilterer is an auto generated log filtering Go binding around an Ethereum contract events.</span>
<span class="term-fg32">+type FeeCurrencyFilterer struct {</span>
<span class="term-fg32">+	contract *bind.BoundContract &#47;&#47; Generic contract wrapper for the low level calls</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencySession is an auto generated Go binding around an Ethereum contract,</span>
<span class="term-fg32">+&#47;&#47; with pre-set call and transact options.</span>
<span class="term-fg32">+type FeeCurrencySession struct {</span>
<span class="term-fg32">+	Contract     *FeeCurrency      &#47;&#47; Generic contract binding to set the session for</span>
<span class="term-fg32">+	CallOpts     bind.CallOpts     &#47;&#47; Call options to use throughout this session</span>
<span class="term-fg32">+	TransactOpts bind.TransactOpts &#47;&#47; Transaction auth options to use throughout this session</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyCallerSession is an auto generated read-only Go binding around an Ethereum contract,</span>
<span class="term-fg32">+&#47;&#47; with pre-set call options.</span>
<span class="term-fg32">+type FeeCurrencyCallerSession struct {</span>
<span class="term-fg32">+	Contract *FeeCurrencyCaller &#47;&#47; Generic contract caller binding to set the session for</span>
<span class="term-fg32">+	CallOpts bind.CallOpts      &#47;&#47; Call options to use throughout this session</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyTransactorSession is an auto generated write-only Go binding around an Ethereum contract,</span>
<span class="term-fg32">+&#47;&#47; with pre-set transact options.</span>
<span class="term-fg32">+type FeeCurrencyTransactorSession struct {</span>
<span class="term-fg32">+	Contract     *FeeCurrencyTransactor &#47;&#47; Generic contract transactor binding to set the session for</span>
<span class="term-fg32">+	TransactOpts bind.TransactOpts      &#47;&#47; Transaction auth options to use throughout this session</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyRaw is an auto generated low-level Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyRaw struct {</span>
<span class="term-fg32">+	Contract *FeeCurrency &#47;&#47; Generic contract binding to access the raw methods on</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyCallerRaw is an auto generated low-level read-only Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyCallerRaw struct {</span>
<span class="term-fg32">+	Contract *FeeCurrencyCaller &#47;&#47; Generic read-only contract binding to access the raw methods on</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyTransactorRaw is an auto generated low-level write-only Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyTransactorRaw struct {</span>
<span class="term-fg32">+	Contract *FeeCurrencyTransactor &#47;&#47; Generic write-only contract binding to access the raw methods on</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewFeeCurrency creates a new instance of FeeCurrency, bound to a specific deployed contract.</span>
<span class="term-fg32">+func NewFeeCurrency(address common.Address, backend bind.ContractBackend) (*FeeCurrency, error) {</span>
<span class="term-fg32">+	contract, err := bindFeeCurrency(address, backend, backend, backend)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrency{FeeCurrencyCaller: FeeCurrencyCaller{contract: contract}, FeeCurrencyTransactor: FeeCurrencyTransactor{contract: contract}, FeeCurrencyFilterer: FeeCurrencyFilterer{contract: contract}}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewFeeCurrencyCaller creates a new read-only instance of FeeCurrency, bound to a specific deployed contract.</span>
<span class="term-fg32">+func NewFeeCurrencyCaller(address common.Address, caller bind.ContractCaller) (*FeeCurrencyCaller, error) {</span>
<span class="term-fg32">+	contract, err := bindFeeCurrency(address, caller, nil, nil)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyCaller{contract: contract}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewFeeCurrencyTransactor creates a new write-only instance of FeeCurrency, bound to a specific deployed contract.</span>
<span class="term-fg32">+func NewFeeCurrencyTransactor(address common.Address, transactor bind.ContractTransactor) (*FeeCurrencyTransactor, error) {</span>
<span class="term-fg32">+	contract, err := bindFeeCurrency(address, nil, transactor, nil)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyTransactor{contract: contract}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewFeeCurrencyFilterer creates a new log filterer instance of FeeCurrency, bound to a specific deployed contract.</span>
<span class="term-fg32">+func NewFeeCurrencyFilterer(address common.Address, filterer bind.ContractFilterer) (*FeeCurrencyFilterer, error) {</span>
<span class="term-fg32">+	contract, err := bindFeeCurrency(address, nil, nil, filterer)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyFilterer{contract: contract}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; bindFeeCurrency binds a generic wrapper to an already deployed contract.</span>
<span class="term-fg32">+func bindFeeCurrency(address common.Address, caller bind.ContractCaller, transactor bind.ContractTransactor, filterer bind.ContractFilterer) (*bind.BoundContract, error) {</span>
<span class="term-fg32">+	parsed, err := FeeCurrencyMetaData.GetAbi()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return bind.NewBoundContract(address, *parsed, caller, transactor, filterer), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Call invokes the (constant) contract method with params as input values and</span>
<span class="term-fg32">+&#47;&#47; sets the output to result. The result type might be a single field for simple</span>
<span class="term-fg32">+&#47;&#47; returns, a slice of interfaces for anonymous returns and a struct for named</span>
<span class="term-fg32">+&#47;&#47; returns.</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyRaw) Call(opts *bind.CallOpts, result *[]interface{}, method string, params ...interface{}) error {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.FeeCurrencyCaller.contract.Call(opts, result, method, params...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transfer initiates a plain transaction to move funds to the contract, calling</span>
<span class="term-fg32">+&#47;&#47; its default method if one is available.</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyRaw) Transfer(opts *bind.TransactOpts) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.FeeCurrencyTransactor.contract.Transfer(opts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transact invokes the (paid) contract method with params as input values.</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyRaw) Transact(opts *bind.TransactOpts, method string, params ...interface{}) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.FeeCurrencyTransactor.contract.Transact(opts, method, params...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Call invokes the (constant) contract method with params as input values and</span>
<span class="term-fg32">+&#47;&#47; sets the output to result. The result type might be a single field for simple</span>
<span class="term-fg32">+&#47;&#47; returns, a slice of interfaces for anonymous returns and a struct for named</span>
<span class="term-fg32">+&#47;&#47; returns.</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCallerRaw) Call(opts *bind.CallOpts, result *[]interface{}, method string, params ...interface{}) error {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.contract.Call(opts, result, method, params...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transfer initiates a plain transaction to move funds to the contract, calling</span>
<span class="term-fg32">+&#47;&#47; its default method if one is available.</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorRaw) Transfer(opts *bind.TransactOpts) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.contract.Transfer(opts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transact invokes the (paid) contract method with params as input values.</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorRaw) Transact(opts *bind.TransactOpts, method string, params ...interface{}) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.contract.Transact(opts, method, params...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Allowance is a free data retrieval call binding the contract method 0xdd62ed3e.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function allowance(address owner, address spender) view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCaller) Allowance(opts *bind.CallOpts, owner common.Address, spender common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrency.contract.Call(opts, &amp;out, &quot;allowance&quot;, owner, spender)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *new(*big.Int), err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return out0, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Allowance is a free data retrieval call binding the contract method 0xdd62ed3e.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function allowance(address owner, address spender) view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) Allowance(owner common.Address, spender common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Allowance(&amp;_FeeCurrency.CallOpts, owner, spender)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Allowance is a free data retrieval call binding the contract method 0xdd62ed3e.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function allowance(address owner, address spender) view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCallerSession) Allowance(owner common.Address, spender common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Allowance(&amp;_FeeCurrency.CallOpts, owner, spender)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; BalanceOf is a free data retrieval call binding the contract method 0x70a08231.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function balanceOf(address account) view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCaller) BalanceOf(opts *bind.CallOpts, account common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrency.contract.Call(opts, &amp;out, &quot;balanceOf&quot;, account)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *new(*big.Int), err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return out0, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; BalanceOf is a free data retrieval call binding the contract method 0x70a08231.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function balanceOf(address account) view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) BalanceOf(account common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.BalanceOf(&amp;_FeeCurrency.CallOpts, account)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; BalanceOf is a free data retrieval call binding the contract method 0x70a08231.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function balanceOf(address account) view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCallerSession) BalanceOf(account common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.BalanceOf(&amp;_FeeCurrency.CallOpts, account)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Decimals is a free data retrieval call binding the contract method 0x313ce567.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function decimals() view returns(uint8)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCaller) Decimals(opts *bind.CallOpts) (uint8, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrency.contract.Call(opts, &amp;out, &quot;decimals&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *new(uint8), err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	out0 := *abi.ConvertType(out[0], new(uint8)).(*uint8)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return out0, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Decimals is a free data retrieval call binding the contract method 0x313ce567.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function decimals() view returns(uint8)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) Decimals() (uint8, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Decimals(&amp;_FeeCurrency.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Decimals is a free data retrieval call binding the contract method 0x313ce567.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function decimals() view returns(uint8)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCallerSession) Decimals() (uint8, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Decimals(&amp;_FeeCurrency.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Name is a free data retrieval call binding the contract method 0x06fdde03.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function name() view returns(string)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCaller) Name(opts *bind.CallOpts) (string, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrency.contract.Call(opts, &amp;out, &quot;name&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *new(string), err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	out0 := *abi.ConvertType(out[0], new(string)).(*string)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return out0, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Name is a free data retrieval call binding the contract method 0x06fdde03.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function name() view returns(string)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) Name() (string, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Name(&amp;_FeeCurrency.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Name is a free data retrieval call binding the contract method 0x06fdde03.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function name() view returns(string)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCallerSession) Name() (string, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Name(&amp;_FeeCurrency.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Symbol is a free data retrieval call binding the contract method 0x95d89b41.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function symbol() view returns(string)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCaller) Symbol(opts *bind.CallOpts) (string, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrency.contract.Call(opts, &amp;out, &quot;symbol&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *new(string), err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	out0 := *abi.ConvertType(out[0], new(string)).(*string)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return out0, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Symbol is a free data retrieval call binding the contract method 0x95d89b41.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function symbol() view returns(string)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) Symbol() (string, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Symbol(&amp;_FeeCurrency.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Symbol is a free data retrieval call binding the contract method 0x95d89b41.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function symbol() view returns(string)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCallerSession) Symbol() (string, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Symbol(&amp;_FeeCurrency.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TotalSupply is a free data retrieval call binding the contract method 0x18160ddd.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function totalSupply() view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCaller) TotalSupply(opts *bind.CallOpts) (*big.Int, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrency.contract.Call(opts, &amp;out, &quot;totalSupply&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *new(*big.Int), err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	out0 := *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return out0, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TotalSupply is a free data retrieval call binding the contract method 0x18160ddd.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function totalSupply() view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) TotalSupply() (*big.Int, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.TotalSupply(&amp;_FeeCurrency.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TotalSupply is a free data retrieval call binding the contract method 0x18160ddd.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function totalSupply() view returns(uint256)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyCallerSession) TotalSupply() (*big.Int, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.TotalSupply(&amp;_FeeCurrency.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Approve is a paid mutator transaction binding the contract method 0x095ea7b3.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function approve(address spender, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactor) Approve(opts *bind.TransactOpts, spender common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.contract.Transact(opts, &quot;approve&quot;, spender, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Approve is a paid mutator transaction binding the contract method 0x095ea7b3.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function approve(address spender, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) Approve(spender common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Approve(&amp;_FeeCurrency.TransactOpts, spender, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Approve is a paid mutator transaction binding the contract method 0x095ea7b3.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function approve(address spender, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorSession) Approve(spender common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Approve(&amp;_FeeCurrency.TransactOpts, spender, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CreditGasFees is a paid mutator transaction binding the contract method 0x6a30b253.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function creditGasFees(address from, address feeRecipient, address , address communityFund, uint256 refund, uint256 tipTxFee, uint256 , uint256 baseTxFee) returns()</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactor) CreditGasFees(opts *bind.TransactOpts, from common.Address, feeRecipient common.Address, arg2 common.Address, communityFund common.Address, refund *big.Int, tipTxFee *big.Int, arg6 *big.Int, baseTxFee *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.contract.Transact(opts, &quot;creditGasFees&quot;, from, feeRecipient, arg2, communityFund, refund, tipTxFee, arg6, baseTxFee)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CreditGasFees is a paid mutator transaction binding the contract method 0x6a30b253.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function creditGasFees(address from, address feeRecipient, address , address communityFund, uint256 refund, uint256 tipTxFee, uint256 , uint256 baseTxFee) returns()</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) CreditGasFees(from common.Address, feeRecipient common.Address, arg2 common.Address, communityFund common.Address, refund *big.Int, tipTxFee *big.Int, arg6 *big.Int, baseTxFee *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.CreditGasFees(&amp;_FeeCurrency.TransactOpts, from, feeRecipient, arg2, communityFund, refund, tipTxFee, arg6, baseTxFee)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CreditGasFees is a paid mutator transaction binding the contract method 0x6a30b253.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function creditGasFees(address from, address feeRecipient, address , address communityFund, uint256 refund, uint256 tipTxFee, uint256 , uint256 baseTxFee) returns()</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorSession) CreditGasFees(from common.Address, feeRecipient common.Address, arg2 common.Address, communityFund common.Address, refund *big.Int, tipTxFee *big.Int, arg6 *big.Int, baseTxFee *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.CreditGasFees(&amp;_FeeCurrency.TransactOpts, from, feeRecipient, arg2, communityFund, refund, tipTxFee, arg6, baseTxFee)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; DebitGasFees is a paid mutator transaction binding the contract method 0x58cf9672.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function debitGasFees(address from, uint256 value) returns()</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactor) DebitGasFees(opts *bind.TransactOpts, from common.Address, value *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.contract.Transact(opts, &quot;debitGasFees&quot;, from, value)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; DebitGasFees is a paid mutator transaction binding the contract method 0x58cf9672.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function debitGasFees(address from, uint256 value) returns()</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) DebitGasFees(from common.Address, value *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.DebitGasFees(&amp;_FeeCurrency.TransactOpts, from, value)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; DebitGasFees is a paid mutator transaction binding the contract method 0x58cf9672.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function debitGasFees(address from, uint256 value) returns()</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorSession) DebitGasFees(from common.Address, value *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.DebitGasFees(&amp;_FeeCurrency.TransactOpts, from, value)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; DecreaseAllowance is a paid mutator transaction binding the contract method 0xa457c2d7.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function decreaseAllowance(address spender, uint256 subtractedValue) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactor) DecreaseAllowance(opts *bind.TransactOpts, spender common.Address, subtractedValue *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.contract.Transact(opts, &quot;decreaseAllowance&quot;, spender, subtractedValue)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; DecreaseAllowance is a paid mutator transaction binding the contract method 0xa457c2d7.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function decreaseAllowance(address spender, uint256 subtractedValue) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) DecreaseAllowance(spender common.Address, subtractedValue *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.DecreaseAllowance(&amp;_FeeCurrency.TransactOpts, spender, subtractedValue)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; DecreaseAllowance is a paid mutator transaction binding the contract method 0xa457c2d7.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function decreaseAllowance(address spender, uint256 subtractedValue) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorSession) DecreaseAllowance(spender common.Address, subtractedValue *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.DecreaseAllowance(&amp;_FeeCurrency.TransactOpts, spender, subtractedValue)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IncreaseAllowance is a paid mutator transaction binding the contract method 0x39509351.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function increaseAllowance(address spender, uint256 addedValue) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactor) IncreaseAllowance(opts *bind.TransactOpts, spender common.Address, addedValue *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.contract.Transact(opts, &quot;increaseAllowance&quot;, spender, addedValue)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IncreaseAllowance is a paid mutator transaction binding the contract method 0x39509351.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function increaseAllowance(address spender, uint256 addedValue) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) IncreaseAllowance(spender common.Address, addedValue *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.IncreaseAllowance(&amp;_FeeCurrency.TransactOpts, spender, addedValue)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IncreaseAllowance is a paid mutator transaction binding the contract method 0x39509351.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function increaseAllowance(address spender, uint256 addedValue) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorSession) IncreaseAllowance(spender common.Address, addedValue *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.IncreaseAllowance(&amp;_FeeCurrency.TransactOpts, spender, addedValue)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transfer is a paid mutator transaction binding the contract method 0xa9059cbb.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function transfer(address to, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactor) Transfer(opts *bind.TransactOpts, to common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.contract.Transact(opts, &quot;transfer&quot;, to, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transfer is a paid mutator transaction binding the contract method 0xa9059cbb.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function transfer(address to, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) Transfer(to common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Transfer(&amp;_FeeCurrency.TransactOpts, to, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transfer is a paid mutator transaction binding the contract method 0xa9059cbb.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function transfer(address to, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorSession) Transfer(to common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.Transfer(&amp;_FeeCurrency.TransactOpts, to, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TransferFrom is a paid mutator transaction binding the contract method 0x23b872dd.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function transferFrom(address from, address to, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactor) TransferFrom(opts *bind.TransactOpts, from common.Address, to common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.contract.Transact(opts, &quot;transferFrom&quot;, from, to, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TransferFrom is a paid mutator transaction binding the contract method 0x23b872dd.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function transferFrom(address from, address to, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencySession) TransferFrom(from common.Address, to common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.TransferFrom(&amp;_FeeCurrency.TransactOpts, from, to, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; TransferFrom is a paid mutator transaction binding the contract method 0x23b872dd.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function transferFrom(address from, address to, uint256 amount) returns(bool)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyTransactorSession) TransferFrom(from common.Address, to common.Address, amount *big.Int) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrency.Contract.TransferFrom(&amp;_FeeCurrency.TransactOpts, from, to, amount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyApprovalIterator is returned from FilterApproval and is used to iterate over the raw logs and unpacked data for Approval events raised by the FeeCurrency contract.</span>
<span class="term-fg32">+type FeeCurrencyApprovalIterator struct {</span>
<span class="term-fg32">+	Event *FeeCurrencyApproval &#47;&#47; Event containing the contract specifics and raw log</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	contract *bind.BoundContract &#47;&#47; Generic contract to use for unpacking event data</span>
<span class="term-fg32">+	event    string              &#47;&#47; Event name to use for unpacking event data</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	logs chan types.Log        &#47;&#47; Log channel receiving the found contract events</span>
<span class="term-fg32">+	sub  ethereum.Subscription &#47;&#47; Subscription for errors, completion and termination</span>
<span class="term-fg32">+	done bool                  &#47;&#47; Whether the subscription completed delivering logs</span>
<span class="term-fg32">+	fail error                 &#47;&#47; Occurred error to stop iteration</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Next advances the iterator to the subsequent event, returning whether there</span>
<span class="term-fg32">+&#47;&#47; are any more events found. In case of a retrieval or parsing error, false is</span>
<span class="term-fg32">+&#47;&#47; returned and Error() can be queried for the exact failure.</span>
<span class="term-fg32">+func (it *FeeCurrencyApprovalIterator) Next() bool {</span>
<span class="term-fg32">+	&#47;&#47; If the iterator failed, stop iterating</span>
<span class="term-fg32">+	if it.fail != nil {</span>
<span class="term-fg32">+		return false</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; If the iterator completed, deliver directly whatever&#39;s available</span>
<span class="term-fg32">+	if it.done {</span>
<span class="term-fg32">+		select {</span>
<span class="term-fg32">+		case log := &lt;-it.logs:</span>
<span class="term-fg32">+			it.Event = new(FeeCurrencyApproval)</span>
<span class="term-fg32">+			if err := it.contract.UnpackLog(it.Event, it.event, log); err != nil {</span>
<span class="term-fg32">+				it.fail = err</span>
<span class="term-fg32">+				return false</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			it.Event.Raw = log</span>
<span class="term-fg32">+			return true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		default:</span>
<span class="term-fg32">+			return false</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Iterator still in progress, wait for either a data or an error event</span>
<span class="term-fg32">+	select {</span>
<span class="term-fg32">+	case log := &lt;-it.logs:</span>
<span class="term-fg32">+		it.Event = new(FeeCurrencyApproval)</span>
<span class="term-fg32">+		if err := it.contract.UnpackLog(it.Event, it.event, log); err != nil {</span>
<span class="term-fg32">+			it.fail = err</span>
<span class="term-fg32">+			return false</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		it.Event.Raw = log</span>
<span class="term-fg32">+		return true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	case err := &lt;-it.sub.Err():</span>
<span class="term-fg32">+		it.done = true</span>
<span class="term-fg32">+		it.fail = err</span>
<span class="term-fg32">+		return it.Next()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Error returns any retrieval or parsing error occurred during filtering.</span>
<span class="term-fg32">+func (it *FeeCurrencyApprovalIterator) Error() error {</span>
<span class="term-fg32">+	return it.fail</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Close terminates the iteration process, releasing any pending underlying</span>
<span class="term-fg32">+&#47;&#47; resources.</span>
<span class="term-fg32">+func (it *FeeCurrencyApprovalIterator) Close() error {</span>
<span class="term-fg32">+	it.sub.Unsubscribe()</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyApproval represents a Approval event raised by the FeeCurrency contract.</span>
<span class="term-fg32">+type FeeCurrencyApproval struct {</span>
<span class="term-fg32">+	Owner   common.Address</span>
<span class="term-fg32">+	Spender common.Address</span>
<span class="term-fg32">+	Value   *big.Int</span>
<span class="term-fg32">+	Raw     types.Log &#47;&#47; Blockchain specific contextual infos</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FilterApproval is a free log retrieval operation binding the contract event 0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: event Approval(address indexed owner, address indexed spender, uint256 value)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyFilterer) FilterApproval(opts *bind.FilterOpts, owner []common.Address, spender []common.Address) (*FeeCurrencyApprovalIterator, error) {</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var ownerRule []interface{}</span>
<span class="term-fg32">+	for _, ownerItem := range owner {</span>
<span class="term-fg32">+		ownerRule = append(ownerRule, ownerItem)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var spenderRule []interface{}</span>
<span class="term-fg32">+	for _, spenderItem := range spender {</span>
<span class="term-fg32">+		spenderRule = append(spenderRule, spenderItem)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	logs, sub, err := _FeeCurrency.contract.FilterLogs(opts, &quot;Approval&quot;, ownerRule, spenderRule)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyApprovalIterator{contract: _FeeCurrency.contract, event: &quot;Approval&quot;, logs: logs, sub: sub}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; WatchApproval is a free log subscription operation binding the contract event 0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: event Approval(address indexed owner, address indexed spender, uint256 value)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyFilterer) WatchApproval(opts *bind.WatchOpts, sink chan&lt;- *FeeCurrencyApproval, owner []common.Address, spender []common.Address) (event.Subscription, error) {</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var ownerRule []interface{}</span>
<span class="term-fg32">+	for _, ownerItem := range owner {</span>
<span class="term-fg32">+		ownerRule = append(ownerRule, ownerItem)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var spenderRule []interface{}</span>
<span class="term-fg32">+	for _, spenderItem := range spender {</span>
<span class="term-fg32">+		spenderRule = append(spenderRule, spenderItem)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	logs, sub, err := _FeeCurrency.contract.WatchLogs(opts, &quot;Approval&quot;, ownerRule, spenderRule)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return event.NewSubscription(func(quit &lt;-chan struct{}) error {</span>
<span class="term-fg32">+		defer sub.Unsubscribe()</span>
<span class="term-fg32">+		for {</span>
<span class="term-fg32">+			select {</span>
<span class="term-fg32">+			case log := &lt;-logs:</span>
<span class="term-fg32">+				&#47;&#47; New log arrived, parse the event and forward to the user</span>
<span class="term-fg32">+				event := new(FeeCurrencyApproval)</span>
<span class="term-fg32">+				if err := _FeeCurrency.contract.UnpackLog(event, &quot;Approval&quot;, log); err != nil {</span>
<span class="term-fg32">+					return err</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+				event.Raw = log</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				select {</span>
<span class="term-fg32">+				case sink &lt;- event:</span>
<span class="term-fg32">+				case err := &lt;-sub.Err():</span>
<span class="term-fg32">+					return err</span>
<span class="term-fg32">+				case &lt;-quit:</span>
<span class="term-fg32">+					return nil</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			case err := &lt;-sub.Err():</span>
<span class="term-fg32">+				return err</span>
<span class="term-fg32">+			case &lt;-quit:</span>
<span class="term-fg32">+				return nil</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; ParseApproval is a log parse operation binding the contract event 0x8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: event Approval(address indexed owner, address indexed spender, uint256 value)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyFilterer) ParseApproval(log types.Log) (*FeeCurrencyApproval, error) {</span>
<span class="term-fg32">+	event := new(FeeCurrencyApproval)</span>
<span class="term-fg32">+	if err := _FeeCurrency.contract.UnpackLog(event, &quot;Approval&quot;, log); err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	event.Raw = log</span>
<span class="term-fg32">+	return event, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyTransferIterator is returned from FilterTransfer and is used to iterate over the raw logs and unpacked data for Transfer events raised by the FeeCurrency contract.</span>
<span class="term-fg32">+type FeeCurrencyTransferIterator struct {</span>
<span class="term-fg32">+	Event *FeeCurrencyTransfer &#47;&#47; Event containing the contract specifics and raw log</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	contract *bind.BoundContract &#47;&#47; Generic contract to use for unpacking event data</span>
<span class="term-fg32">+	event    string              &#47;&#47; Event name to use for unpacking event data</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	logs chan types.Log        &#47;&#47; Log channel receiving the found contract events</span>
<span class="term-fg32">+	sub  ethereum.Subscription &#47;&#47; Subscription for errors, completion and termination</span>
<span class="term-fg32">+	done bool                  &#47;&#47; Whether the subscription completed delivering logs</span>
<span class="term-fg32">+	fail error                 &#47;&#47; Occurred error to stop iteration</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Next advances the iterator to the subsequent event, returning whether there</span>
<span class="term-fg32">+&#47;&#47; are any more events found. In case of a retrieval or parsing error, false is</span>
<span class="term-fg32">+&#47;&#47; returned and Error() can be queried for the exact failure.</span>
<span class="term-fg32">+func (it *FeeCurrencyTransferIterator) Next() bool {</span>
<span class="term-fg32">+	&#47;&#47; If the iterator failed, stop iterating</span>
<span class="term-fg32">+	if it.fail != nil {</span>
<span class="term-fg32">+		return false</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; If the iterator completed, deliver directly whatever&#39;s available</span>
<span class="term-fg32">+	if it.done {</span>
<span class="term-fg32">+		select {</span>
<span class="term-fg32">+		case log := &lt;-it.logs:</span>
<span class="term-fg32">+			it.Event = new(FeeCurrencyTransfer)</span>
<span class="term-fg32">+			if err := it.contract.UnpackLog(it.Event, it.event, log); err != nil {</span>
<span class="term-fg32">+				it.fail = err</span>
<span class="term-fg32">+				return false</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			it.Event.Raw = log</span>
<span class="term-fg32">+			return true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		default:</span>
<span class="term-fg32">+			return false</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Iterator still in progress, wait for either a data or an error event</span>
<span class="term-fg32">+	select {</span>
<span class="term-fg32">+	case log := &lt;-it.logs:</span>
<span class="term-fg32">+		it.Event = new(FeeCurrencyTransfer)</span>
<span class="term-fg32">+		if err := it.contract.UnpackLog(it.Event, it.event, log); err != nil {</span>
<span class="term-fg32">+			it.fail = err</span>
<span class="term-fg32">+			return false</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		it.Event.Raw = log</span>
<span class="term-fg32">+		return true</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	case err := &lt;-it.sub.Err():</span>
<span class="term-fg32">+		it.done = true</span>
<span class="term-fg32">+		it.fail = err</span>
<span class="term-fg32">+		return it.Next()</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Error returns any retrieval or parsing error occurred during filtering.</span>
<span class="term-fg32">+func (it *FeeCurrencyTransferIterator) Error() error {</span>
<span class="term-fg32">+	return it.fail</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Close terminates the iteration process, releasing any pending underlying</span>
<span class="term-fg32">+&#47;&#47; resources.</span>
<span class="term-fg32">+func (it *FeeCurrencyTransferIterator) Close() error {</span>
<span class="term-fg32">+	it.sub.Unsubscribe()</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyTransfer represents a Transfer event raised by the FeeCurrency contract.</span>
<span class="term-fg32">+type FeeCurrencyTransfer struct {</span>
<span class="term-fg32">+	From  common.Address</span>
<span class="term-fg32">+	To    common.Address</span>
<span class="term-fg32">+	Value *big.Int</span>
<span class="term-fg32">+	Raw   types.Log &#47;&#47; Blockchain specific contextual infos</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FilterTransfer is a free log retrieval operation binding the contract event 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: event Transfer(address indexed from, address indexed to, uint256 value)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyFilterer) FilterTransfer(opts *bind.FilterOpts, from []common.Address, to []common.Address) (*FeeCurrencyTransferIterator, error) {</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var fromRule []interface{}</span>
<span class="term-fg32">+	for _, fromItem := range from {</span>
<span class="term-fg32">+		fromRule = append(fromRule, fromItem)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var toRule []interface{}</span>
<span class="term-fg32">+	for _, toItem := range to {</span>
<span class="term-fg32">+		toRule = append(toRule, toItem)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	logs, sub, err := _FeeCurrency.contract.FilterLogs(opts, &quot;Transfer&quot;, fromRule, toRule)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyTransferIterator{contract: _FeeCurrency.contract, event: &quot;Transfer&quot;, logs: logs, sub: sub}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; WatchTransfer is a free log subscription operation binding the contract event 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: event Transfer(address indexed from, address indexed to, uint256 value)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyFilterer) WatchTransfer(opts *bind.WatchOpts, sink chan&lt;- *FeeCurrencyTransfer, from []common.Address, to []common.Address) (event.Subscription, error) {</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var fromRule []interface{}</span>
<span class="term-fg32">+	for _, fromItem := range from {</span>
<span class="term-fg32">+		fromRule = append(fromRule, fromItem)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var toRule []interface{}</span>
<span class="term-fg32">+	for _, toItem := range to {</span>
<span class="term-fg32">+		toRule = append(toRule, toItem)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	logs, sub, err := _FeeCurrency.contract.WatchLogs(opts, &quot;Transfer&quot;, fromRule, toRule)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return event.NewSubscription(func(quit &lt;-chan struct{}) error {</span>
<span class="term-fg32">+		defer sub.Unsubscribe()</span>
<span class="term-fg32">+		for {</span>
<span class="term-fg32">+			select {</span>
<span class="term-fg32">+			case log := &lt;-logs:</span>
<span class="term-fg32">+				&#47;&#47; New log arrived, parse the event and forward to the user</span>
<span class="term-fg32">+				event := new(FeeCurrencyTransfer)</span>
<span class="term-fg32">+				if err := _FeeCurrency.contract.UnpackLog(event, &quot;Transfer&quot;, log); err != nil {</span>
<span class="term-fg32">+					return err</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+				event.Raw = log</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				select {</span>
<span class="term-fg32">+				case sink &lt;- event:</span>
<span class="term-fg32">+				case err := &lt;-sub.Err():</span>
<span class="term-fg32">+					return err</span>
<span class="term-fg32">+				case &lt;-quit:</span>
<span class="term-fg32">+					return nil</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			case err := &lt;-sub.Err():</span>
<span class="term-fg32">+				return err</span>
<span class="term-fg32">+			case &lt;-quit:</span>
<span class="term-fg32">+				return nil</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; ParseTransfer is a log parse operation binding the contract event 0xddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: event Transfer(address indexed from, address indexed to, uint256 value)</span>
<span class="term-fg32">+func (_FeeCurrency *FeeCurrencyFilterer) ParseTransfer(log types.Log) (*FeeCurrencyTransfer, error) {</span>
<span class="term-fg32">+	event := new(FeeCurrencyTransfer)</span>
<span class="term-fg32">+	if err := _FeeCurrency.contract.UnpackLog(event, &quot;Transfer&quot;, log); err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	event.Raw = log</span>
<span class="term-fg32">+	return event, nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d62c8b918ecdbdad2cec4e7a" role="button"
                       aria-expanded="false" aria-controls="id-d62c8b918ecdbdad2cec4e7a">
                        <code>contracts/celo/abigen/FeeCurrencyDirectory.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/abigen/FeeCurrencyDirectory.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+294</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d62c8b918ecdbdad2cec4e7a"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;abigen&#47;FeeCurrencyDirectory.go CELO&#47;contracts&#47;celo&#47;abigen&#47;FeeCurrencyDirectory.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..d79c9bba15b1259761880cdeded76868b1c7108f</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;abigen&#47;FeeCurrencyDirectory.go</span>
<span class="term-fg36">@@ -0,0 +1,294 @@</span>
<span class="term-fg32">+&#47;&#47; Code generated - DO NOT EDIT.</span>
<span class="term-fg32">+&#47;&#47; This file is a generated binding and any manual changes will be lost.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package abigen</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;errors&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;strings&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	ethereum &quot;github.com&#47;ethereum&#47;go-ethereum&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&#47;bind&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;event&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Reference imports to suppress errors if they are not otherwise used.</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	_ = errors.New</span>
<span class="term-fg32">+	_ = big.NewInt</span>
<span class="term-fg32">+	_ = strings.NewReader</span>
<span class="term-fg32">+	_ = ethereum.NotFound</span>
<span class="term-fg32">+	_ = bind.Bind</span>
<span class="term-fg32">+	_ = common.Big1</span>
<span class="term-fg32">+	_ = types.BloomLookup</span>
<span class="term-fg32">+	_ = event.NewSubscription</span>
<span class="term-fg32">+	_ = abi.ConvertType</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IFeeCurrencyDirectoryCurrencyConfig is an auto generated low-level Go binding around an user-defined struct.</span>
<span class="term-fg32">+type IFeeCurrencyDirectoryCurrencyConfig struct {</span>
<span class="term-fg32">+	Oracle       common.Address</span>
<span class="term-fg32">+	IntrinsicGas *big.Int</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryMetaData contains all meta data concerning the FeeCurrencyDirectory contract.</span>
<span class="term-fg32">+var FeeCurrencyDirectoryMetaData = &amp;bind.MetaData{</span>
<span class="term-fg32">+	ABI: &quot;[{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;getCurrencies\&quot;,\&quot;inputs\&quot;:[],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;address[]\&quot;,\&quot;internalType\&quot;:\&quot;address[]\&quot;}],\&quot;stateMutability\&quot;:\&quot;view\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;getCurrencyConfig\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;token\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;\&quot;,\&quot;type\&quot;:\&quot;tuple\&quot;,\&quot;internalType\&quot;:\&quot;structIFeeCurrencyDirectory.CurrencyConfig\&quot;,\&quot;components\&quot;:[{\&quot;name\&quot;:\&quot;oracle\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;},{\&quot;name\&quot;:\&quot;intrinsicGas\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}]}],\&quot;stateMutability\&quot;:\&quot;view\&quot;},{\&quot;type\&quot;:\&quot;function\&quot;,\&quot;name\&quot;:\&quot;getExchangeRate\&quot;,\&quot;inputs\&quot;:[{\&quot;name\&quot;:\&quot;token\&quot;,\&quot;type\&quot;:\&quot;address\&quot;,\&quot;internalType\&quot;:\&quot;address\&quot;}],\&quot;outputs\&quot;:[{\&quot;name\&quot;:\&quot;numerator\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;},{\&quot;name\&quot;:\&quot;denominator\&quot;,\&quot;type\&quot;:\&quot;uint256\&quot;,\&quot;internalType\&quot;:\&quot;uint256\&quot;}],\&quot;stateMutability\&quot;:\&quot;view\&quot;}]&quot;,</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryABI is the input ABI used to generate the binding from.</span>
<span class="term-fg32">+&#47;&#47; Deprecated: Use FeeCurrencyDirectoryMetaData.ABI instead.</span>
<span class="term-fg32">+var FeeCurrencyDirectoryABI = FeeCurrencyDirectoryMetaData.ABI</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectory is an auto generated Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyDirectory struct {</span>
<span class="term-fg32">+	FeeCurrencyDirectoryCaller     &#47;&#47; Read-only binding to the contract</span>
<span class="term-fg32">+	FeeCurrencyDirectoryTransactor &#47;&#47; Write-only binding to the contract</span>
<span class="term-fg32">+	FeeCurrencyDirectoryFilterer   &#47;&#47; Log filterer for contract events</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryCaller is an auto generated read-only Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyDirectoryCaller struct {</span>
<span class="term-fg32">+	contract *bind.BoundContract &#47;&#47; Generic contract wrapper for the low level calls</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryTransactor is an auto generated write-only Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyDirectoryTransactor struct {</span>
<span class="term-fg32">+	contract *bind.BoundContract &#47;&#47; Generic contract wrapper for the low level calls</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryFilterer is an auto generated log filtering Go binding around an Ethereum contract events.</span>
<span class="term-fg32">+type FeeCurrencyDirectoryFilterer struct {</span>
<span class="term-fg32">+	contract *bind.BoundContract &#47;&#47; Generic contract wrapper for the low level calls</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectorySession is an auto generated Go binding around an Ethereum contract,</span>
<span class="term-fg32">+&#47;&#47; with pre-set call and transact options.</span>
<span class="term-fg32">+type FeeCurrencyDirectorySession struct {</span>
<span class="term-fg32">+	Contract     *FeeCurrencyDirectory &#47;&#47; Generic contract binding to set the session for</span>
<span class="term-fg32">+	CallOpts     bind.CallOpts         &#47;&#47; Call options to use throughout this session</span>
<span class="term-fg32">+	TransactOpts bind.TransactOpts     &#47;&#47; Transaction auth options to use throughout this session</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryCallerSession is an auto generated read-only Go binding around an Ethereum contract,</span>
<span class="term-fg32">+&#47;&#47; with pre-set call options.</span>
<span class="term-fg32">+type FeeCurrencyDirectoryCallerSession struct {</span>
<span class="term-fg32">+	Contract *FeeCurrencyDirectoryCaller &#47;&#47; Generic contract caller binding to set the session for</span>
<span class="term-fg32">+	CallOpts bind.CallOpts               &#47;&#47; Call options to use throughout this session</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryTransactorSession is an auto generated write-only Go binding around an Ethereum contract,</span>
<span class="term-fg32">+&#47;&#47; with pre-set transact options.</span>
<span class="term-fg32">+type FeeCurrencyDirectoryTransactorSession struct {</span>
<span class="term-fg32">+	Contract     *FeeCurrencyDirectoryTransactor &#47;&#47; Generic contract transactor binding to set the session for</span>
<span class="term-fg32">+	TransactOpts bind.TransactOpts               &#47;&#47; Transaction auth options to use throughout this session</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryRaw is an auto generated low-level Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyDirectoryRaw struct {</span>
<span class="term-fg32">+	Contract *FeeCurrencyDirectory &#47;&#47; Generic contract binding to access the raw methods on</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryCallerRaw is an auto generated low-level read-only Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyDirectoryCallerRaw struct {</span>
<span class="term-fg32">+	Contract *FeeCurrencyDirectoryCaller &#47;&#47; Generic read-only contract binding to access the raw methods on</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrencyDirectoryTransactorRaw is an auto generated low-level write-only Go binding around an Ethereum contract.</span>
<span class="term-fg32">+type FeeCurrencyDirectoryTransactorRaw struct {</span>
<span class="term-fg32">+	Contract *FeeCurrencyDirectoryTransactor &#47;&#47; Generic write-only contract binding to access the raw methods on</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewFeeCurrencyDirectory creates a new instance of FeeCurrencyDirectory, bound to a specific deployed contract.</span>
<span class="term-fg32">+func NewFeeCurrencyDirectory(address common.Address, backend bind.ContractBackend) (*FeeCurrencyDirectory, error) {</span>
<span class="term-fg32">+	contract, err := bindFeeCurrencyDirectory(address, backend, backend, backend)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyDirectory{FeeCurrencyDirectoryCaller: FeeCurrencyDirectoryCaller{contract: contract}, FeeCurrencyDirectoryTransactor: FeeCurrencyDirectoryTransactor{contract: contract}, FeeCurrencyDirectoryFilterer: FeeCurrencyDirectoryFilterer{contract: contract}}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewFeeCurrencyDirectoryCaller creates a new read-only instance of FeeCurrencyDirectory, bound to a specific deployed contract.</span>
<span class="term-fg32">+func NewFeeCurrencyDirectoryCaller(address common.Address, caller bind.ContractCaller) (*FeeCurrencyDirectoryCaller, error) {</span>
<span class="term-fg32">+	contract, err := bindFeeCurrencyDirectory(address, caller, nil, nil)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyDirectoryCaller{contract: contract}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewFeeCurrencyDirectoryTransactor creates a new write-only instance of FeeCurrencyDirectory, bound to a specific deployed contract.</span>
<span class="term-fg32">+func NewFeeCurrencyDirectoryTransactor(address common.Address, transactor bind.ContractTransactor) (*FeeCurrencyDirectoryTransactor, error) {</span>
<span class="term-fg32">+	contract, err := bindFeeCurrencyDirectory(address, nil, transactor, nil)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyDirectoryTransactor{contract: contract}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewFeeCurrencyDirectoryFilterer creates a new log filterer instance of FeeCurrencyDirectory, bound to a specific deployed contract.</span>
<span class="term-fg32">+func NewFeeCurrencyDirectoryFilterer(address common.Address, filterer bind.ContractFilterer) (*FeeCurrencyDirectoryFilterer, error) {</span>
<span class="term-fg32">+	contract, err := bindFeeCurrencyDirectory(address, nil, nil, filterer)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;FeeCurrencyDirectoryFilterer{contract: contract}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; bindFeeCurrencyDirectory binds a generic wrapper to an already deployed contract.</span>
<span class="term-fg32">+func bindFeeCurrencyDirectory(address common.Address, caller bind.ContractCaller, transactor bind.ContractTransactor, filterer bind.ContractFilterer) (*bind.BoundContract, error) {</span>
<span class="term-fg32">+	parsed, err := FeeCurrencyDirectoryMetaData.GetAbi()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return bind.NewBoundContract(address, *parsed, caller, transactor, filterer), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Call invokes the (constant) contract method with params as input values and</span>
<span class="term-fg32">+&#47;&#47; sets the output to result. The result type might be a single field for simple</span>
<span class="term-fg32">+&#47;&#47; returns, a slice of interfaces for anonymous returns and a struct for named</span>
<span class="term-fg32">+&#47;&#47; returns.</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryRaw) Call(opts *bind.CallOpts, result *[]interface{}, method string, params ...interface{}) error {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.FeeCurrencyDirectoryCaller.contract.Call(opts, result, method, params...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transfer initiates a plain transaction to move funds to the contract, calling</span>
<span class="term-fg32">+&#47;&#47; its default method if one is available.</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryRaw) Transfer(opts *bind.TransactOpts) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.FeeCurrencyDirectoryTransactor.contract.Transfer(opts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transact invokes the (paid) contract method with params as input values.</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryRaw) Transact(opts *bind.TransactOpts, method string, params ...interface{}) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.FeeCurrencyDirectoryTransactor.contract.Transact(opts, method, params...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Call invokes the (constant) contract method with params as input values and</span>
<span class="term-fg32">+&#47;&#47; sets the output to result. The result type might be a single field for simple</span>
<span class="term-fg32">+&#47;&#47; returns, a slice of interfaces for anonymous returns and a struct for named</span>
<span class="term-fg32">+&#47;&#47; returns.</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryCallerRaw) Call(opts *bind.CallOpts, result *[]interface{}, method string, params ...interface{}) error {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.contract.Call(opts, result, method, params...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transfer initiates a plain transaction to move funds to the contract, calling</span>
<span class="term-fg32">+&#47;&#47; its default method if one is available.</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryTransactorRaw) Transfer(opts *bind.TransactOpts) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.contract.Transfer(opts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Transact invokes the (paid) contract method with params as input values.</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryTransactorRaw) Transact(opts *bind.TransactOpts, method string, params ...interface{}) (*types.Transaction, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.contract.Transact(opts, method, params...)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetCurrencies is a free data retrieval call binding the contract method 0x61c661de.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getCurrencies() view returns(address[])</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryCaller) GetCurrencies(opts *bind.CallOpts) ([]common.Address, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrencyDirectory.contract.Call(opts, &amp;out, &quot;getCurrencies&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *new([]common.Address), err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	out0 := *abi.ConvertType(out[0], new([]common.Address)).(*[]common.Address)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return out0, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetCurrencies is a free data retrieval call binding the contract method 0x61c661de.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getCurrencies() view returns(address[])</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectorySession) GetCurrencies() ([]common.Address, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.GetCurrencies(&amp;_FeeCurrencyDirectory.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetCurrencies is a free data retrieval call binding the contract method 0x61c661de.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getCurrencies() view returns(address[])</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryCallerSession) GetCurrencies() ([]common.Address, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.GetCurrencies(&amp;_FeeCurrencyDirectory.CallOpts)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetCurrencyConfig is a free data retrieval call binding the contract method 0xeab43d97.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getCurrencyConfig(address token) view returns((address,uint256))</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryCaller) GetCurrencyConfig(opts *bind.CallOpts, token common.Address) (IFeeCurrencyDirectoryCurrencyConfig, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrencyDirectory.contract.Call(opts, &amp;out, &quot;getCurrencyConfig&quot;, token)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *new(IFeeCurrencyDirectoryCurrencyConfig), err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	out0 := *abi.ConvertType(out[0], new(IFeeCurrencyDirectoryCurrencyConfig)).(*IFeeCurrencyDirectoryCurrencyConfig)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return out0, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetCurrencyConfig is a free data retrieval call binding the contract method 0xeab43d97.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getCurrencyConfig(address token) view returns((address,uint256))</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectorySession) GetCurrencyConfig(token common.Address) (IFeeCurrencyDirectoryCurrencyConfig, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.GetCurrencyConfig(&amp;_FeeCurrencyDirectory.CallOpts, token)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetCurrencyConfig is a free data retrieval call binding the contract method 0xeab43d97.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getCurrencyConfig(address token) view returns((address,uint256))</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryCallerSession) GetCurrencyConfig(token common.Address) (IFeeCurrencyDirectoryCurrencyConfig, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.GetCurrencyConfig(&amp;_FeeCurrencyDirectory.CallOpts, token)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetExchangeRate is a free data retrieval call binding the contract method 0xefb7601d.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getExchangeRate(address token) view returns(uint256 numerator, uint256 denominator)</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryCaller) GetExchangeRate(opts *bind.CallOpts, token common.Address) (struct {</span>
<span class="term-fg32">+	Numerator   *big.Int</span>
<span class="term-fg32">+	Denominator *big.Int</span>
<span class="term-fg32">+}, error) {</span>
<span class="term-fg32">+	var out []interface{}</span>
<span class="term-fg32">+	err := _FeeCurrencyDirectory.contract.Call(opts, &amp;out, &quot;getExchangeRate&quot;, token)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	outstruct := new(struct {</span>
<span class="term-fg32">+		Numerator   *big.Int</span>
<span class="term-fg32">+		Denominator *big.Int</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return *outstruct, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	outstruct.Numerator = *abi.ConvertType(out[0], new(*big.Int)).(**big.Int)</span>
<span class="term-fg32">+	outstruct.Denominator = *abi.ConvertType(out[1], new(*big.Int)).(**big.Int)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return *outstruct, err</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetExchangeRate is a free data retrieval call binding the contract method 0xefb7601d.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getExchangeRate(address token) view returns(uint256 numerator, uint256 denominator)</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectorySession) GetExchangeRate(token common.Address) (struct {</span>
<span class="term-fg32">+	Numerator   *big.Int</span>
<span class="term-fg32">+	Denominator *big.Int</span>
<span class="term-fg32">+}, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.GetExchangeRate(&amp;_FeeCurrencyDirectory.CallOpts, token)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetExchangeRate is a free data retrieval call binding the contract method 0xefb7601d.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; Solidity: function getExchangeRate(address token) view returns(uint256 numerator, uint256 denominator)</span>
<span class="term-fg32">+func (_FeeCurrencyDirectory *FeeCurrencyDirectoryCallerSession) GetExchangeRate(token common.Address) (struct {</span>
<span class="term-fg32">+	Numerator   *big.Int</span>
<span class="term-fg32">+	Denominator *big.Int</span>
<span class="term-fg32">+}, error) {</span>
<span class="term-fg32">+	return _FeeCurrencyDirectory.Contract.GetExchangeRate(&amp;_FeeCurrencyDirectory.CallOpts, token)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d9d9de40292c19537b9e3ef9" role="button"
                       aria-expanded="false" aria-controls="id-d9d9de40292c19537b9e3ef9">
                        <code>contracts/celo/celo.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/celo.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+18</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d9d9de40292c19537b9e3ef9"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;celo.go CELO&#47;contracts&#47;celo&#47;celo.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..eee8c63da824cc170cbabbe8e6f17f199d10ab2f</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;celo.go</span>
<span class="term-fg36">@@ -0,0 +1,18 @@</span>
<span class="term-fg32">+package celo</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import _ &quot;embed&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;go:generate go run ..&#47;..&#47;cmd&#47;abigen --pkg abigen --out abigen&#47;FeeCurrency.go --abi compiled&#47;FeeCurrency.abi --type FeeCurrency</span>
<span class="term-fg32">+&#47;&#47;go:generate go run ..&#47;..&#47;cmd&#47;abigen --pkg abigen --out abigen&#47;FeeCurrencyDirectory.go --abi compiled&#47;IFeeCurrencyDirectory.abi --type FeeCurrencyDirectory</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;go:embed compiled&#47;GoldToken.bin-runtime</span>
<span class="term-fg32">+var CeloTokenBytecodeRaw []byte</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;go:embed compiled&#47;FeeCurrency.bin-runtime</span>
<span class="term-fg32">+var FeeCurrencyBytecodeRaw []byte</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;go:embed compiled&#47;FeeCurrencyDirectory.bin-runtime</span>
<span class="term-fg32">+var FeeCurrencyDirectoryBytecodeRaw []byte</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47;go:embed compiled&#47;MockOracle.bin-runtime</span>
<span class="term-fg32">+var MockOracleBytecodeRaw []byte</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ee23b8ef67fe37312a90d4ed" role="button"
                       aria-expanded="false" aria-controls="id-ee23b8ef67fe37312a90d4ed">
                        <code>contracts/celo/compiled/FeeCurrency.abi</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/FeeCurrency.abi" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+354</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ee23b8ef67fe37312a90d4ed"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrency.abi CELO&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrency.abi</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..279f6f754ab9192a2b8eb5f90a3aec6639c5e551</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrency.abi</span>
<span class="term-fg36">@@ -0,0 +1,354 @@</span>
<span class="term-fg32">+[</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;constructor&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;name_&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;string&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;string&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;symbol_&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;string&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;string&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;allowance&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;owner&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;approve&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;amount&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;balanceOf&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;account&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;creditGasFees&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;from&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;feeRecipient&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;communityFund&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;refund&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;tipTxFee&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;baseTxFee&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;debitGasFees&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;from&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;decimals&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint8&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;decreaseAllowance&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;subtractedValue&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;increaseAllowance&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;addedValue&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;name&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;string&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;string&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;symbol&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;string&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;string&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;totalSupply&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;transfer&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;to&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;amount&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;transferFrom&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;from&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;to&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;amount&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;event&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;Approval&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;owner&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: false,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;anonymous&quot;: false</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;event&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;Transfer&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;from&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;to&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: false,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;anonymous&quot;: false</span>
<span class="term-fg32">+  }</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-d52a38baa740ed7c0c29cac4" role="button"
                       aria-expanded="false" aria-controls="id-d52a38baa740ed7c0c29cac4">
                        <code>contracts/celo/compiled/FeeCurrency.bin-runtime</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/FeeCurrency.bin-runtime" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-d52a38baa740ed7c0c29cac4"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrency.bin-runtime CELO&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrency.bin-runtime</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..236826b180339f87deee821e74369a225b3d85db</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrency.bin-runtime</span>
<span class="term-fg36">@@ -0,0 +1 @@</span>
<span class="term-fg32">+0x608060405234801561001057600080fd5b50600436106100df5760003560e01c806358cf96721161008c57806395d89b411161006657806395d89b41146101ca578063a457c2d7146101d2578063a9059cbb146101e5578063dd62ed3e146101f857600080fd5b806358cf96721461016c5780636a30b2531461018157806370a082311461019457600080fd5b806323b872dd116100bd57806323b872dd14610137578063313ce5671461014a578063395093511461015957600080fd5b806306fdde03146100e4578063095ea7b31461010257806318160ddd14610125575b600080fd5b6100ec61023e565b6040516100f99190610c15565b60405180910390f35b610115610110366004610cb1565b6102d0565b60405190151581526020016100f9565b6002545b6040519081526020016100f9565b610115610145366004610cdb565b6102e8565b604051601281526020016100f9565b610115610167366004610cb1565b61030e565b61017f61017a366004610cb1565b61035a565b005b61017f61018f366004610d17565b61041e565b6101296101a2366004610d8f565b73ffffffffffffffffffffffffffffffffffffffff1660009081526020819052604090205490565b6100ec610510565b6101156101e0366004610cb1565b61051f565b6101156101f3366004610cb1565b6105fb565b610129610206366004610daa565b73ffffffffffffffffffffffffffffffffffffffff918216600090815260016020908152604080832093909416825291909152205490565b60606003805461024d90610ddd565b80601f016020809104026020016040519081016040528092919081815260200182805461027990610ddd565b80156102c65780601f1061029b576101008083540402835291602001916102c6565b820191906000526020600020905b8154815290600101906020018083116102a957829003601f168201915b5050505050905090565b6000336102de818585610609565b5060019392505050565b6000336102f68582856107bc565b610301858585610893565b60019150505b9392505050565b33600081815260016020908152604080832073ffffffffffffffffffffffffffffffffffffffff871684529091528120549091906102de9082908690610355908790610e5f565b610609565b33156103c7576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601060248201527f4f6e6c7920564d2063616e2063616c6c0000000000000000000000000000000060448201526064015b60405180910390fd5b73ffffffffffffffffffffffffffffffffffffffff8216600090815260208190526040812080548392906103fc908490610e77565b9250508190555080600260008282546104159190610e77565b90915550505050565b3315610486576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601060248201527f4f6e6c7920564d2063616e2063616c6c0000000000000000000000000000000060448201526064016103be565b73ffffffffffffffffffffffffffffffffffffffff8816600090815260208190526040812080548692906104bb908490610e5f565b909155506104cc9050888683610b46565b6104d69085610e5f565b93506104e3888885610b46565b6104ed9085610e5f565b935083600260008282546105019190610e5f565b90915550505050505050505050565b60606004805461024d90610ddd565b33600081815260016020908152604080832073ffffffffffffffffffffffffffffffffffffffff87168452909152812054909190838110156105e3576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602560248201527f45524332303a2064656372656173656420616c6c6f77616e63652062656c6f7760448201527f207a65726f00000000000000000000000000000000000000000000000000000060648201526084016103be565b6105f08286868403610609565b506001949350505050565b6000336102de818585610893565b73ffffffffffffffffffffffffffffffffffffffff83166106ab576040517f08c379a0000000000000000000000000000000000000000000000000000000008152602060048201526024808201527f45524332303a20617070726f76652066726f6d20746865207a65726f2061646460448201527f726573730000000000000000000000000000000000000000000000000000000060648201526084016103be565b73ffffffffffffffffffffffffffffffffffffffff821661074e576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602260248201527f45524332303a20617070726f766520746f20746865207a65726f20616464726560448201527f737300000000000000000000000000000000000000000000000000000000000060648201526084016103be565b73ffffffffffffffffffffffffffffffffffffffff83811660008181526001602090815260408083209487168084529482529182902085905590518481527f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925910160405180910390a3505050565b73ffffffffffffffffffffffffffffffffffffffff8381166000908152600160209081526040808320938616835292905220547fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff811461088d5781811015610880576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152601d60248201527f45524332303a20696e73756666696369656e7420616c6c6f77616e636500000060448201526064016103be565b61088d8484848403610609565b50505050565b73ffffffffffffffffffffffffffffffffffffffff8316610936576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602560248201527f45524332303a207472616e736665722066726f6d20746865207a65726f20616460448201527f647265737300000000000000000000000000000000000000000000000000000060648201526084016103be565b73ffffffffffffffffffffffffffffffffffffffff82166109d9576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602360248201527f45524332303a207472616e7366657220746f20746865207a65726f206164647260448201527f657373000000000000000000000000000000000000000000000000000000000060648201526084016103be565b73ffffffffffffffffffffffffffffffffffffffff831660009081526020819052604090205481811015610a8f576040517f08c379a000000000000000000000000000000000000000000000000000000000815260206004820152602660248201527f45524332303a207472616e7366657220616d6f756e742065786365656473206260448201527f616c616e6365000000000000000000000000000000000000000000000000000060648201526084016103be565b73ffffffffffffffffffffffffffffffffffffffff808516600090815260208190526040808220858503905591851681529081208054849290610ad3908490610e5f565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610b3991815260200190565b60405180910390a361088d565b600073ffffffffffffffffffffffffffffffffffffffff8316610b6b57506000610307565b73ffffffffffffffffffffffffffffffffffffffff831660009081526020819052604081208054849290610ba0908490610e5f565b925050819055508273ffffffffffffffffffffffffffffffffffffffff168473ffffffffffffffffffffffffffffffffffffffff167fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef84604051610c0691815260200190565b60405180910390a35092915050565b600060208083528351808285015260005b81811015610c4257858101830151858201604001528201610c26565b81811115610c54576000604083870101525b50601f017fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffe016929092016040019392505050565b803573ffffffffffffffffffffffffffffffffffffffff81168114610cac57600080fd5b919050565b60008060408385031215610cc457600080fd5b610ccd83610c88565b946020939093013593505050565b600080600060608486031215610cf057600080fd5b610cf984610c88565b9250610d0760208501610c88565b9150604084013590509250925092565b600080600080600080600080610100898b031215610d3457600080fd5b610d3d89610c88565b9750610d4b60208a01610c88565b9650610d5960408a01610c88565b9550610d6760608a01610c88565b979a969950949760808101359660a0820135965060c0820135955060e0909101359350915050565b600060208284031215610da157600080fd5b61030782610c88565b60008060408385031215610dbd57600080fd5b610dc683610c88565b9150610dd460208401610c88565b90509250929050565b600181811c90821680610df157607f821691505b602082108103610e2a577f4e487b7100000000000000000000000000000000000000000000000000000000600052602260045260246000fd5b50919050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b60008219821115610e7257610e72610e30565b500190565b600082821015610e8957610e89610e30565b50039056fea164736f6c634300080f000a</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3ea161e2a66fe1a7aa66c7ae" role="button"
                       aria-expanded="false" aria-controls="id-3ea161e2a66fe1a7aa66c7ae">
                        <code>contracts/celo/compiled/FeeCurrencyDirectory.bin-runtime</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/FeeCurrencyDirectory.bin-runtime" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3ea161e2a66fe1a7aa66c7ae"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrencyDirectory.bin-runtime CELO&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrencyDirectory.bin-runtime</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..79b9c0731e3d8bb39908819291fcd1f31d5d2ce0</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;FeeCurrencyDirectory.bin-runtime</span>
<span class="term-fg36">@@ -0,0 +1 @@</span>
<span class="term-fg32">+0x608060405234801561001057600080fd5b50600436106100b45760003560e01c8063715018a611610071578063715018a6146101905780638129fc1c146101985780638da5cb5b146101a0578063eab43d97146101c9578063efb7601d14610245578063f2fde38b1461026d57600080fd5b8063158ef93e146100b957806316be73a8146100db578063216ab7df146100f057806354255be0146101035780636036cba31461012957806361c661de1461017b575b600080fd5b6000546100c69060ff1681565b60405190151581526020015b60405180910390f35b6100ee6100e9366004610939565b610280565b005b6100ee6100fe366004610963565b61045d565b6001806000806040805194855260208501939093529183015260608201526080016100d2565b61015c61013736600461099f565b600160208190526000918252604090912080549101546001600160a01b039091169082565b604080516001600160a01b0390931683526020830191909152016100d2565b61018361062a565b6040516100d291906109c1565b6100ee61068c565b6100ee6106c8565b60005461010090046001600160a01b03166040516001600160a01b0390911681526020016100d2565b6102216101d736600461099f565b604080518082018252600080825260209182018190526001600160a01b03938416815260018083529083902083518085019094528054909416835292909201549181019190915290565b6040805182516001600160a01b0316815260209283015192810192909252016100d2565b61025861025336600461099f565b610731565b604080519283526020830191909152016100d2565b6100ee61027b36600461099f565b610823565b6000546001600160a01b036101009091041633146102b95760405162461bcd60e51b81526004016102b090610a0e565b60405180910390fd5b60025481106103005760405162461bcd60e51b8152602060048201526013602482015272496e646578206f7574206f6620626f756e647360681b60448201526064016102b0565b816001600160a01b03166002828154811061031d5761031d610a43565b6000918252602090912001546001600160a01b03161461037f5760405162461bcd60e51b815260206004820152601a60248201527f496e64657820646f6573206e6f74206d6174636820746f6b656e00000000000060448201526064016102b0565b6001600160a01b0382166000908152600160208190526040822080546001600160a01b03191681558101919091556002805490916103bc91610a59565b815481106103cc576103cc610a43565b600091825260209091200154600280546001600160a01b0390921691839081106103f8576103f8610a43565b9060005260206000200160006101000a8154816001600160a01b0302191690836001600160a01b03160217905550600280548061043757610437610a80565b600082815260209020810160001990810180546001600160a01b03191690550190555050565b6000546001600160a01b0361010090910416331461048d5760405162461bcd60e51b81526004016102b090610a0e565b6001600160a01b0382166104e35760405162461bcd60e51b815260206004820152601d60248201527f4f7261636c6520616464726573732063616e6e6f74206265207a65726f00000060448201526064016102b0565b600081116105335760405162461bcd60e51b815260206004820152601c60248201527f496e7472696e736963206761732063616e6e6f74206265207a65726f0000000060448201526064016102b0565b6001600160a01b0383811660009081526001602052604090205416156105a55760405162461bcd60e51b815260206004820152602160248201527f43757272656e637920616c726561647920696e20746865206469726563746f726044820152607960f81b60648201526084016102b0565b6040805180820182526001600160a01b039384168152602080820193845294841660008181526001968790529283209151825495166001600160a01b031995861617825592519085015560028054948501815590527f405787fa12a823e0f2b7631cc41b3ba8828b3321ca811111fa75cd3aa3bb5ace90920180549091169091179055565b6060600280548060200260200160405190810160405280929190818152602001828054801561068257602002820191906000526020600020905b81546001600160a01b03168152600190910190602001808311610664575b5050505050905090565b6000546001600160a01b036101009091041633146106bc5760405162461bcd60e51b81526004016102b090610a0e565b6106c660006108c4565b565b60005460ff161561071b5760405162461bcd60e51b815260206004820152601c60248201527f636f6e747261637420616c726561647920696e697469616c697a65640000000060448201526064016102b0565b6000805460ff191660011790556106c6336108c4565b6001600160a01b03818116600090815260016020526040812054909182911661079c5760405162461bcd60e51b815260206004820152601d60248201527f43757272656e6379206e6f7420696e20746865206469726563746f727900000060448201526064016102b0565b6001600160a01b038381166000818152600160205260409081902054905163efb7601d60e01b815260048101929092529091169063efb7601d906024016040805180830381865afa1580156107f5573d6000803e3d6000fd5b505050506040513d601f19601f820116820180604052508101906108199190610a96565b9094909350915050565b6000546001600160a01b036101009091041633146108535760405162461bcd60e51b81526004016102b090610a0e565b6001600160a01b0381166108b85760405162461bcd60e51b815260206004820152602660248201527f4f776e61626c653a206e6577206f776e657220697320746865207a65726f206160448201526564647265737360d01b60648201526084016102b0565b6108c1816108c4565b50565b600080546001600160a01b03838116610100818102610100600160a81b0319851617855560405193049190911692909183917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a35050565b80356001600160a01b038116811461093457600080fd5b919050565b6000806040838503121561094c57600080fd5b6109558361091d565b946020939093013593505050565b60008060006060848603121561097857600080fd5b6109818461091d565b925061098f6020850161091d565b9150604084013590509250925092565b6000602082840312156109b157600080fd5b6109ba8261091d565b9392505050565b6020808252825182820181905260009190848201906040850190845b81811015610a025783516001600160a01b0316835292840192918401916001016109dd565b50909695505050505050565b6020808252818101527f4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e6572604082015260600190565b634e487b7160e01b600052603260045260246000fd5b81810381811115610a7a57634e487b7160e01b600052601160045260246000fd5b92915050565b634e487b7160e01b600052603160045260246000fd5b60008060408385031215610aa957600080fd5b50508051602090910151909290915056fea2646970667358221220127159ea8f76efe84815c2177266f0115f42dfbdd3b1fd1624548e208504750e64736f6c63430008130033</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-edbda8661adcb758e3cf06c8" role="button"
                       aria-expanded="false" aria-controls="id-edbda8661adcb758e3cf06c8">
                        <code>contracts/celo/compiled/GoldToken.abi</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/GoldToken.abi" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+669</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-edbda8661adcb758e3cf06c8"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;GoldToken.abi CELO&#47;contracts&#47;celo&#47;compiled&#47;GoldToken.abi</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..d0d8926dac24f7446be224c6d0494d6bf799c8cd</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;GoldToken.abi</span>
<span class="term-fg36">@@ -0,0 +1,669 @@</span>
<span class="term-fg32">+[</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;constructor&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;test&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;allocatedSupply&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;allowance&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;_owner&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;approve&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;balanceOf&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;_owner&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;burn&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;celoTokenDistributionSchedule&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;contract ICeloDistributionSchedule&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;circulatingSupply&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;decimals&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint8&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;decreaseAllowance&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;depositAmount&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;_depositAmount&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;getBurnedAmount&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;getVersionNumber&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;pure&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;increaseAllowance&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;increaseSupply&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;amount&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;initialize&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;registryAddress&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;initialized&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;isL2&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;isOwner&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;mint&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;to&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;name&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;string&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;string&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;owner&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;registry&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;contract IRegistry&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;renounceOwnership&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;setCeloTokenDistributionScheduleAddress&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;celoTokenDistributionScheduleAddress&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;setRegistry&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;registryAddress&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;symbol&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;string&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;string&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;totalSupply&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;transfer&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;to&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;transferFrom&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;from&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;to&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;transferOwnership&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;newOwner&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;transferWithComment&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;to&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;comment&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;string&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;string&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;bool&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;bool&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;withdrawAmount&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;_withdrawAmount&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;withdrawn&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;event&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;Approval&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;owner&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;spender&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: false,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;anonymous&quot;: false</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;event&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;OwnershipTransferred&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;previousOwner&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;newOwner&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;anonymous&quot;: false</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;event&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;RegistrySet&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;registryAddress&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;anonymous&quot;: false</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;event&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;SetCeloTokenDistributionScheduleAddress&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;newScheduleAddress&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;anonymous&quot;: false</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;event&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;Transfer&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;from&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;to&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: true,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;value&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: false,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;anonymous&quot;: false</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;event&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;TransferComment&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;comment&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;string&quot;,</span>
<span class="term-fg32">+        &quot;indexed&quot;: false,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;string&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;anonymous&quot;: false</span>
<span class="term-fg32">+  }</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-978c43113ed65dda07132967" role="button"
                       aria-expanded="false" aria-controls="id-978c43113ed65dda07132967">
                        <code>contracts/celo/compiled/GoldToken.bin-runtime</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/GoldToken.bin-runtime" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-978c43113ed65dda07132967"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;GoldToken.bin-runtime CELO&#47;contracts&#47;celo&#47;compiled&#47;GoldToken.bin-runtime</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6417be2913ecbddc6540400a74de1524bf696bc1</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;GoldToken.bin-runtime</span>
<span class="term-fg36">@@ -0,0 +1 @@</span>
<span class="term-fg32">+0x608060405234801561001057600080fd5b50600436106101fb5760003560e01c80637b1039991161011a578063a91ee0dc116100ad578063d4d83cfb1161007c578063d4d83cfb14610565578063db2b4d101461056d578063dd62ed3e14610593578063e1d6aceb146105c1578063f2fde38b14610646576101fb565b8063a91ee0dc146104f4578063b921e1631461051a578063c4d66de814610537578063c80ec5221461055d576101fb565b80639358928b116100e95780639358928b1461048c57806395d89b4114610494578063a457c2d71461049c578063a9059cbb146104c8576101fb565b80637b1039991461043b57806387f8ab261461045f5780638da5cb5b1461047c5780638f32d59b14610484576101fb565b8063395093511161019257806354255be01161016157806354255be0146103d757806370a0823114610405578063715018a61461042b57806376348f7114610433576101fb565b8063395093511461035a5780633a70a5ca1461038657806340c10f191461038e57806342966c68146103ba576101fb565b806318160ddd116101ce57806318160ddd146102e457806323b872dd146102fe578063265126bd14610334578063313ce5671461033c576101fb565b80630562b9f71461020057806306fdde031461021f578063095ea7b31461029c578063158ef93e146102dc575b600080fd5b61021d6004803603602081101561021657600080fd5b503561066c565b005b61022761070d565b6040805160208082528351818301528351919283929083019185019080838360005b83811015610261578181015183820152602001610249565b50505050905090810190601f16801561028e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6102c8600480360360408110156102b257600080fd5b506001600160a01b038135169060200135610739565b604080519115158252519081900360200190f35b6102c86107fe565b6102ec610807565b60408051918252519081900360200190f35b6102c86004803603606081101561031457600080fd5b506001600160a01b03813581169160208101359091169060400135610846565b6102ec610b17565b610344610b29565b6040805160ff9092168252519081900360200190f35b6102c86004803603604081101561037057600080fd5b506001600160a01b038135169060200135610b2e565b6102ec610c2a565b6102c8600480360360408110156103a457600080fd5b506001600160a01b038135169060200135610c8e565b6102c8600480360360208110156103d057600080fd5b5035610eb6565b6103df610ec4565b604080519485526020850193909352838301919091526060830152519081900360800190f35b6102ec6004803603602081101561041b57600080fd5b50356001600160a01b0316610ed1565b61021d610ede565b6102c8610f74565b610443610f88565b604080516001600160a01b039092168252519081900360200190f35b61021d6004803603602081101561047557600080fd5b5035610f97565b610443611033565b6102c8611047565b6102ec611070565b61022761109e565b6102c8600480360360408110156104b257600080fd5b506001600160a01b0381351690602001356110bc565b6102c8600480360360408110156104de57600080fd5b506001600160a01b0381351690602001356110f1565b61021d6004803603602081101561050a57600080fd5b50356001600160a01b0316611104565b61021d6004803603602081101561053057600080fd5b50356111f0565b61021d6004803603602081101561054d57600080fd5b50356001600160a01b0316611257565b6102ec6112d4565b6104436112da565b61021d6004803603602081101561058357600080fd5b50356001600160a01b03166112e9565b6102ec600480360360408110156105a957600080fd5b506001600160a01b03813581169160200135166113e3565b6102c8600480360360608110156105d757600080fd5b6001600160a01b038235169160208101359181019060608101604082013564010000000081111561060757600080fd5b82018360208201111561061957600080fd5b8035906020019184600183028401116401000000008311171561063b57600080fd5b50909250905061140e565b61021d6004803603602081101561065c57600080fd5b50356001600160a01b0316611486565b610674610f74565b6106af5760405162461bcd60e51b81526004018080602001828103825260238152602001806119e76023913960400191505060405180910390fd5b6016602160991b0133146106f45760405162461bcd60e51b81526004018080602001828103825260228152602001806119076022913960400191505060405180910390fd5b600454610707908263ffffffff6114d616565b60045550565b60408051808201909152601181527010d95b1bc81b985d1a5d9948185cdcd95d607a1b60208201525b90565b60006001600160a01b038316610796576040805162461bcd60e51b815260206004820152601a60248201527f63616e6e6f742073657420616c6c6f77616e636520666f722030000000000000604482015290519081900360640190fd5b3360008181526003602090815260408083206001600160a01b03881680855290835292819020869055805186815290519293927f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925929181900390910190a35060015b92915050565b60005460ff1681565b6000610811610f74565b1561083d57600454610836906b033b2e3c9fd0803ce80000009063ffffffff61153016565b9050610736565b50600254610736565b60006001600160a01b03831661088d5760405162461bcd60e51b815260040180806020018281038252602a815260200180611a0a602a913960400191505060405180910390fd5b61089684610ed1565b8211156108d45760405162461bcd60e51b81526004018080602001828103825260298152602001806119be6029913960400191505060405180910390fd5b6001600160a01b03841660009081526003602090815260408083203384529091529020548211156109365760405162461bcd60e51b8152600401808060200182810382526036815260200180611a346036913960400191505060405180910390fd5b600060fd815a9087878760405160200180846001600160a01b03166001600160a01b03168152602001836001600160a01b03166001600160a01b0316815260200182815260200193505050506040516020818303038152906040526040518082805190602001908083835b602083106109c05780518252601f1990920191602091820191016109a1565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381858888f193505050503d8060008114610a23576040519150601f19603f3d011682016040523d82523d6000602084013e610a28565b606091505b50508091505080610a77576040805162461bcd60e51b815260206004820152601460248201527310d15313c81d1c985b9cd9995c8819985a5b195960621b604482015290519081900360640190fd5b6001600160a01b0385166000908152600360209081526040808320338452909152902054610aab908463ffffffff61153016565b6001600160a01b03808716600081815260036020908152604080832033845282529182902094909455805187815290519288169391927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef929181900390910190a3506001949350505050565b6000610b2461dead610ed1565b905090565b601290565b60006001600160a01b038316610b8b576040805162461bcd60e51b815260206004820152601a60248201527f63616e6e6f742073657420616c6c6f77616e636520666f722030000000000000604482015290519081900360640190fd5b3360009081526003602090815260408083206001600160a01b038716845290915281205490610bc0828563ffffffff6114d616565b3360008181526003602090815260408083206001600160a01b038b16808552908352928190208590558051858152905194955091937f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259281900390910190a3506001949350505050565b6000610c34610f74565b610c6f5760405162461bcd60e51b81526004018080602001828103825260238152602001806119e76023913960400191505060405180910390fd5b506005546001600160a01b0316316b033b2e3c9fd0803ce80000000390565b6000610c98611572565b3315610cde576040805162461bcd60e51b815260206004820152601060248201526f13db9b1e4815934818d85b8818d85b1b60821b604482015290519081900360640190fd5b81610ceb575060016107f8565b6001600160a01b038316610d305760405162461bcd60e51b81526004018080602001828103825260268152602001806119296026913960400191505060405180910390fd5b600254610d43908363ffffffff6114d616565b600255600060fd815a6040805160006020808301919091526001600160a01b038a168284015260608083018a905283518084039091018152608090920192839052815193949391929182918401908083835b60208310610db45780518252601f199092019160209182019101610d95565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381858888f193505050503d8060008114610e17576040519150601f19603f3d011682016040523d82523d6000602084013e610e1c565b606091505b50508091505080610e6b576040805162461bcd60e51b815260206004820152601460248201527310d15313c81d1c985b9cd9995c8819985a5b195960621b604482015290519081900360640190fd5b6040805184815290516001600160a01b038616916000917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360200190a35060019392505050565b60006107f861dead836115b8565b6001806003600090919293565b6001600160a01b03163190565b610ee6611047565b610f25576040805162461bcd60e51b8152602060048201819052602482015260008051602061199e833981519152604482015290519081900360640190fd5b600080546040516101009091046001600160a01b0316907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908390a360008054610100600160a81b0319169055565b63ffffffff6018602160991b013b16151590565b6001546001600160a01b031681565b3315610fdd576040805162461bcd60e51b815260206004820152601060248201526f13db9b1e4815934818d85b8818d85b1b60821b604482015290519081900360640190fd5b610fe5610f74565b6110205760405162461bcd60e51b81526004018080602001828103825260238152602001806119e76023913960400191505060405180910390fd5b600454610707908263ffffffff61153016565b60005461010090046001600160a01b031690565b6000805461010090046001600160a01b031661106161176f565b6001600160a01b031614905090565b6000610b2461107f6000610ed1565b61109261108a610b17565b611092610807565b9063ffffffff61153016565b60408051808201909152600481526343454c4f60e01b602082015290565b3360009081526003602090815260408083206001600160a01b038616845290915281205481610bc0828563ffffffff61153016565b60006110fd8383611773565b9392505050565b61110c611047565b61114b576040805162461bcd60e51b8152602060048201819052602482015260008051602061199e833981519152604482015290519081900360640190fd5b6001600160a01b0381166111a6576040805162461bcd60e51b815260206004820181905260248201527f43616e6e6f7420726567697374657220746865206e756c6c2061646472657373604482015290519081900360640190fd5b600180546001600160a01b0319166001600160a01b0383169081179091556040517f27fe5f0c1c3b1ed427cc63d0f05759ffdecf9aec9e18d31ef366fc8a6cb5dc3b90600090a250565b6111f8611572565b331561123e576040805162461bcd60e51b815260206004820152601060248201526f13db9b1e4815934818d85b8818d85b1b60821b604482015290519081900360640190fd5b600254611251908263ffffffff6114d616565b60025550565b60005460ff16156112af576040805162461bcd60e51b815260206004820152601c60248201527f636f6e747261637420616c726561647920696e697469616c697a656400000000604482015290519081900360640190fd5b6000805460ff191660011781556002556112c8336117c4565b6112d181611104565b50565b60045481565b6005546001600160a01b031681565b6112f1611047565b611330576040805162461bcd60e51b8152602060048201819052602482015260008051602061199e833981519152604482015290519081900360640190fd5b6001600160a01b03811615158061135557506005546001600160a01b03828116911614155b611399576040805162461bcd60e51b815260206004820152601060248201526f24b73b30b634b21030b2323932b9b99760811b604482015290519081900360640190fd5b600580546001600160a01b0319166001600160a01b0383169081179091556040517f4b0e16c81bce2248d2d60ed469d2fe74152253bde95ba850f22ae056723980a690600090a250565b6001600160a01b03918216600090815260036020908152604080832093909416825291909152205490565b60008061141b8686611773565b90507fe5d4e30fb8364e57bc4d662a07d0cf36f4c34552004c4c3624620a2c1d1c03dc848460405180806020018281038252848482818152602001925080828437600083820152604051601f909101601f19169092018290039550909350505050a195945050505050565b61148e611047565b6114cd576040805162461bcd60e51b8152602060048201819052602482015260008051602061199e833981519152604482015290519081900360640190fd5b6112d1816117c4565b6000828201838110156110fd576040805162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b60006110fd83836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f77000081525061186f565b61157a610f74565b156115b65760405162461bcd60e51b81526004018080602001828103825260298152602001806119756029913960400191505060405180910390fd5b565b60006115c333610ed1565b8211156116015760405162461bcd60e51b81526004018080602001828103825260298152602001806119be6029913960400191505060405180910390fd5b600060fd815a60408051336020808301919091526001600160a01b038a168284015260608083018a905283518084039091018152608090920192839052815193949391929182918401908083835b6020831061166e5780518252601f19909201916020918201910161164f565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381858888f193505050503d80600081146116d1576040519150601f19603f3d011682016040523d82523d6000602084013e6116d6565b606091505b50508091505080611725576040805162461bcd60e51b815260206004820152601460248201527310d15313c81d1c985b9cd9995c8819985a5b195960621b604482015290519081900360640190fd5b6040805184815290516001600160a01b0386169133917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360200190a35060019392505050565b3390565b60006001600160a01b0383166117ba5760405162461bcd60e51b815260040180806020018281038252602a815260200180611a0a602a913960400191505060405180910390fd5b6110fd83836115b8565b6001600160a01b0381166118095760405162461bcd60e51b815260040180806020018281038252602681526020018061194f6026913960400191505060405180910390fd5b600080546040516001600160a01b038085169361010090930416917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a3600080546001600160a01b0390921661010002610100600160a81b0319909216919091179055565b600081848411156118fe5760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b838110156118c35781810151838201526020016118ab565b50505050905090810190601f1680156118f05780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b50505090039056fe4f6e6c79204c32546f4c314d6573736167655061737365722063616e2063616c6c2e6d696e7420617474656d7074656420746f2072657365727665642061646472657373203078304f776e61626c653a206e6577206f776e657220697320746865207a65726f206164647265737354686973206d6574686f64206973206e6f206c6f6e67657220737570706f7274656420696e204c322e4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e65727472616e736665722076616c75652065786365656465642062616c616e6365206f662073656e64657254686973206d6574686f64206973206e6f7420737570706f7274656420696e204c312e7472616e7366657220617474656d7074656420746f2072657365727665642061646472657373203078307472616e736665722076616c75652065786365656465642073656e646572277320616c6c6f77616e636520666f72207370656e646572a265627a7a72315820883737fc20fdb370fa6d2083191051192e78e14b9c9ed5974e58cd42d97124f264736f6c63430005110032</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b424414c783a7b423710138d" role="button"
                       aria-expanded="false" aria-controls="id-b424414c783a7b423710138d">
                        <code>contracts/celo/compiled/IFeeCurrencyDirectory.abi</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/IFeeCurrencyDirectory.abi" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+70</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b424414c783a7b423710138d"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;IFeeCurrencyDirectory.abi CELO&#47;contracts&#47;celo&#47;compiled&#47;IFeeCurrencyDirectory.abi</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..90e071e994d161090a9347dfc7cf32ad918153d7</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;IFeeCurrencyDirectory.abi</span>
<span class="term-fg36">@@ -0,0 +1,70 @@</span>
<span class="term-fg32">+[</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;getCurrencies&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address[]&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address[]&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;getCurrencyConfig&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;token&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;tuple&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;struct IFeeCurrencyDirectory.CurrencyConfig&quot;,</span>
<span class="term-fg32">+        &quot;components&quot;: [</span>
<span class="term-fg32">+          {</span>
<span class="term-fg32">+            &quot;name&quot;: &quot;oracle&quot;,</span>
<span class="term-fg32">+            &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+            &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+          },</span>
<span class="term-fg32">+          {</span>
<span class="term-fg32">+            &quot;name&quot;: &quot;intrinsicGas&quot;,</span>
<span class="term-fg32">+            &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+            &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+          }</span>
<span class="term-fg32">+        ]</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;getExchangeRate&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;token&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;numerator&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;denominator&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  }</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-36174f0a70f2b43330ba325d" role="button"
                       aria-expanded="false" aria-controls="id-36174f0a70f2b43330ba325d">
                        <code>contracts/celo/compiled/MockOracle.abi</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/MockOracle.abi" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+49</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-36174f0a70f2b43330ba325d"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;MockOracle.abi CELO&#47;contracts&#47;celo&#47;compiled&#47;MockOracle.abi</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..76bb6049a808f525e8460cd3ee1547e64de327c4</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;MockOracle.abi</span>
<span class="term-fg36">@@ -0,0 +1,49 @@</span>
<span class="term-fg32">+[</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;getExchangeRate&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;_token&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;view&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  {</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;function&quot;,</span>
<span class="term-fg32">+    &quot;name&quot;: &quot;setExchangeRate&quot;,</span>
<span class="term-fg32">+    &quot;inputs&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;_token&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;address&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;address&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;_numerator&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;name&quot;: &quot;_denominator&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;uint256&quot;,</span>
<span class="term-fg32">+        &quot;internalType&quot;: &quot;uint256&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;outputs&quot;: [],</span>
<span class="term-fg32">+    &quot;stateMutability&quot;: &quot;nonpayable&quot;</span>
<span class="term-fg32">+  }</span>
<span class="term-fg32">+]</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3f41144da6ed819f59e59c8e" role="button"
                       aria-expanded="false" aria-controls="id-3f41144da6ed819f59e59c8e">
                        <code>contracts/celo/compiled/MockOracle.bin-runtime</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/MockOracle.bin-runtime" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3f41144da6ed819f59e59c8e"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;MockOracle.bin-runtime CELO&#47;contracts&#47;celo&#47;compiled&#47;MockOracle.bin-runtime</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a82a67d31ce2048d3b6579467d5fbc8ec83df59f</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;MockOracle.bin-runtime</span>
<span class="term-fg36">@@ -0,0 +1 @@</span>
<span class="term-fg32">+0x608060405234801561001057600080fd5b50600436106100365760003560e01c806358a5514f1461003b578063efb7601d1461007a575b600080fd5b61007861004936600461012d565b60009190915560015542600255600380546001600160a01b0319166001600160a01b0392909216919091179055565b005b61008d610088366004610160565b6100a6565b6040805192835260208301919091520160405180910390f35b60035460009081906001600160a01b038481169116146101025760405162461bcd60e51b8152602060048201526013602482015272151bdad95b881b9bdd081cdd5c1c1bdc9d1959606a1b604482015260640160405180910390fd5b60005460015491509150915091565b80356001600160a01b038116811461012857600080fd5b919050565b60008060006060848603121561014257600080fd5b61014b84610111565b95602085013595506040909401359392505050565b60006020828403121561017257600080fd5b61017b82610111565b939250505056fea2646970667358221220532d5a8180e3477753af960cd2ec6ffab9b57df9b867e656e78ca4ec2164930664736f6c63430008130033</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e33c7d591373420bd1943bf3" role="button"
                       aria-expanded="false" aria-controls="id-e33c7d591373420bd1943bf3">
                        <code>contracts/celo/compiled/update.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo/compiled/update.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+27</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e33c7d591373420bd1943bf3"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo&#47;compiled&#47;update.sh CELO&#47;contracts&#47;celo&#47;compiled&#47;update.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..d0f32423e162f3c0a479ef29dd41472c8566b148</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo&#47;compiled&#47;update.sh</span>
<span class="term-fg36">@@ -0,0 +1,27 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+SCRIPT_DIR=$(readlink -f &quot;$(dirname &quot;$0&quot;)&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+CONTRACTS_DIR=${CELO_OPTIMISM_REPO:-~&#47;optimism}&#47;packages&#47;contracts-bedrock</span>
<span class="term-fg32">+forge build --root &quot;$CONTRACTS_DIR&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+for contract in FeeCurrency</span>
<span class="term-fg32">+do</span>
<span class="term-fg32">+	contract_json=&quot;$CONTRACTS_DIR&#47;forge-artifacts&#47;$contract.sol&#47;$contract.json&quot;</span>
<span class="term-fg32">+	jq .abi &quot;$contract_json&quot; &gt; &quot;$SCRIPT_DIR&#47;$contract.abi&quot;</span>
<span class="term-fg32">+	jq .deployedBytecode.object -r &quot;$contract_json&quot; &gt; &quot;$SCRIPT_DIR&#47;$contract.bin-runtime&quot;</span>
<span class="term-fg32">+done</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+CONTRACTS_DIR=${CELO_MONOREPO:-~&#47;celo-monorepo}&#47;packages&#47;protocol</span>
<span class="term-fg32">+forge build --root &quot;$CONTRACTS_DIR&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+for contract in GoldToken FeeCurrencyDirectory IFeeCurrencyDirectory MockOracle</span>
<span class="term-fg32">+do</span>
<span class="term-fg32">+	contract_json=&quot;$CONTRACTS_DIR&#47;out&#47;$contract.sol&#47;$contract.json&quot;</span>
<span class="term-fg32">+	jq .abi &quot;$contract_json&quot; &gt; &quot;$SCRIPT_DIR&#47;$contract.abi&quot;</span>
<span class="term-fg32">+	jq .deployedBytecode.object -r &quot;$contract_json&quot; &gt; &quot;$SCRIPT_DIR&#47;$contract.bin-runtime&quot;</span>
<span class="term-fg32">+done</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# We only need the abi for the interface (IFeeCurrencyDirectory) and the</span>
<span class="term-fg32">+# bytecode for the implementation (FeeCurrencyDirectory), so let&#39;s delete the other.</span>
<span class="term-fg32">+rm &quot;$SCRIPT_DIR&#47;IFeeCurrencyDirectory.bin-runtime&quot; &quot;$SCRIPT_DIR&#47;FeeCurrencyDirectory.abi&quot;</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-efa1ffe1c3b3cae917f83cdd" role="button"
                       aria-expanded="false" aria-controls="id-efa1ffe1c3b3cae917f83cdd">
                        <code>core/celo_genesis.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/celo_genesis.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+165</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-efa1ffe1c3b3cae917f83cdd"><span class="term-fg1">diff --git op-geth&#47;core&#47;celo_genesis.go CELO&#47;core&#47;celo_genesis.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..66dc89869d57e0f60429734406a27518ecbee461</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;celo_genesis.go</span>
<span class="term-fg36">@@ -0,0 +1,165 @@</span>
<span class="term-fg32">+package core</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;encoding&#47;hex&quot;</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&#47;addresses&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&#47;celo&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Decode 0x prefixed hex string from file (including trailing newline)</span>
<span class="term-fg32">+func DecodeHex(hexbytes []byte) ([]byte, error) {</span>
<span class="term-fg32">+	&#47;&#47; Strip 0x prefix and trailing newline</span>
<span class="term-fg32">+	hexbytes = hexbytes[2 : len(hexbytes)-1] &#47;&#47; strip 0x prefix</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Decode hex string</span>
<span class="term-fg32">+	bytes := make([]byte, hex.DecodedLen(len(hexbytes)))</span>
<span class="term-fg32">+	_, err := hex.Decode(bytes, hexbytes)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;DecodeHex: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return bytes, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Calculate address in evm mapping: keccak(key ++ mapping_slot)</span>
<span class="term-fg32">+func CalcMapAddr(slot common.Hash, key common.Hash) common.Hash {</span>
<span class="term-fg32">+	return crypto.Keccak256Hash(append(key.Bytes(), slot.Bytes()...))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Increase a hash value by `i`, used for addresses in 32byte fields</span>
<span class="term-fg32">+func incHash(addr common.Hash, i int64) common.Hash {</span>
<span class="term-fg32">+	return common.BigToHash(new(big.Int).Add(addr.Big(), big.NewInt(i)))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	DevPrivateKey, _ = crypto.HexToECDSA(&quot;2771aff413cac48d9f8c114fabddd9195a2129f3c2c436caa07e27bb7f58ead5&quot;)</span>
<span class="term-fg32">+	DevAddr          = common.BytesToAddress(DevAddr32.Bytes())</span>
<span class="term-fg32">+	DevAddr32        = common.HexToHash(&quot;0x42cf1bbc38BaAA3c4898ce8790e21eD2738c6A4a&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	DevFeeCurrencyAddr  = common.HexToAddress(&quot;0xce16&quot;) &#47;&#47; worth twice as much as native CELO</span>
<span class="term-fg32">+	DevFeeCurrencyAddr2 = common.HexToAddress(&quot;0xce17&quot;) &#47;&#47; worth half as much as native CELO</span>
<span class="term-fg32">+	DevBalance, _       = new(big.Int).SetString(&quot;100000000000000000000&quot;, 10)</span>
<span class="term-fg32">+	rateNumerator, _    = new(big.Int).SetString(&quot;2000000000000000000000000&quot;, 10)</span>
<span class="term-fg32">+	rateNumerator2, _   = new(big.Int).SetString(&quot;500000000000000000000000&quot;, 10)</span>
<span class="term-fg32">+	rateDenominator, _  = new(big.Int).SetString(&quot;1000000000000000000000000&quot;, 10)</span>
<span class="term-fg32">+	mockOracleAddr      = common.HexToAddress(&quot;0xbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0001&quot;)</span>
<span class="term-fg32">+	mockOracleAddr2     = common.HexToAddress(&quot;0xbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0002&quot;)</span>
<span class="term-fg32">+	mockOracleAddr3     = common.HexToAddress(&quot;0xbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0003&quot;)</span>
<span class="term-fg32">+	FaucetAddr          = common.HexToAddress(&quot;0xfcf982bb4015852e706100b14e21f947a5bb718e&quot;)</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func celoGenesisAccounts(fundedAddr common.Address) GenesisAlloc {</span>
<span class="term-fg32">+	&#47;&#47; Initialize Bytecodes</span>
<span class="term-fg32">+	celoTokenBytecode, err := DecodeHex(celo.CeloTokenBytecodeRaw)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		panic(err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	feeCurrencyBytecode, err := DecodeHex(celo.FeeCurrencyBytecodeRaw)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		panic(err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	feeCurrencyDirectoryBytecode, err := DecodeHex(celo.FeeCurrencyDirectoryBytecodeRaw)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		panic(err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	mockOracleBytecode, err := DecodeHex(celo.MockOracleBytecodeRaw)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		panic(err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var devBalance32 common.Hash</span>
<span class="term-fg32">+	DevBalance.FillBytes(devBalance32[:])</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	arrayAtSlot2 := crypto.Keccak256Hash(common.HexToHash(&quot;0x2&quot;).Bytes())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	faucetBalance, ok := new(big.Int).SetString(&quot;500000000000000000000000000&quot;, 10) &#47;&#47; 500M</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		panic(&quot;Couldn not set faucet balance!&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	genesisAccounts := map[common.Address]GenesisAccount{</span>
<span class="term-fg32">+		addresses.CeloTokenAddress: {</span>
<span class="term-fg32">+			Code:    celoTokenBytecode,</span>
<span class="term-fg32">+			Balance: big.NewInt(0),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		DevFeeCurrencyAddr: {</span>
<span class="term-fg32">+			Code:    feeCurrencyBytecode,</span>
<span class="term-fg32">+			Balance: big.NewInt(0),</span>
<span class="term-fg32">+			Storage: map[common.Hash]common.Hash{</span>
<span class="term-fg32">+				CalcMapAddr(common.HexToHash(&quot;0x0&quot;), DevAddr32):                              devBalance32, &#47;&#47; _balances[DevAddr]</span>
<span class="term-fg32">+				CalcMapAddr(common.HexToHash(&quot;0x0&quot;), common.BytesToHash(fundedAddr.Bytes())): devBalance32, &#47;&#47; _balances[fund]</span>
<span class="term-fg32">+				common.HexToHash(&quot;0x2&quot;): devBalance32, &#47;&#47; _totalSupply</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		DevFeeCurrencyAddr2: {</span>
<span class="term-fg32">+			Code:    feeCurrencyBytecode,</span>
<span class="term-fg32">+			Balance: big.NewInt(0),</span>
<span class="term-fg32">+			Storage: map[common.Hash]common.Hash{</span>
<span class="term-fg32">+				CalcMapAddr(common.HexToHash(&quot;0x0&quot;), DevAddr32):                              devBalance32, &#47;&#47; _balances[DevAddr]</span>
<span class="term-fg32">+				CalcMapAddr(common.HexToHash(&quot;0x0&quot;), common.BytesToHash(fundedAddr.Bytes())): devBalance32, &#47;&#47; _balances[fund]</span>
<span class="term-fg32">+				common.HexToHash(&quot;0x2&quot;): devBalance32, &#47;&#47; _totalSupply</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		mockOracleAddr: {</span>
<span class="term-fg32">+			Code:    mockOracleBytecode,</span>
<span class="term-fg32">+			Balance: big.NewInt(0),</span>
<span class="term-fg32">+			Storage: map[common.Hash]common.Hash{</span>
<span class="term-fg32">+				common.HexToHash(&quot;0x0&quot;): common.BigToHash(rateNumerator),</span>
<span class="term-fg32">+				common.HexToHash(&quot;0x1&quot;): common.BigToHash(rateDenominator),</span>
<span class="term-fg32">+				common.HexToHash(&quot;0x3&quot;): common.BytesToHash(DevFeeCurrencyAddr.Bytes()),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		mockOracleAddr2: {</span>
<span class="term-fg32">+			Code:    mockOracleBytecode,</span>
<span class="term-fg32">+			Balance: big.NewInt(0),</span>
<span class="term-fg32">+			Storage: map[common.Hash]common.Hash{</span>
<span class="term-fg32">+				common.HexToHash(&quot;0x0&quot;): common.BigToHash(rateNumerator2),</span>
<span class="term-fg32">+				common.HexToHash(&quot;0x1&quot;): common.BigToHash(rateDenominator),</span>
<span class="term-fg32">+				common.HexToHash(&quot;0x3&quot;): common.BytesToHash(DevFeeCurrencyAddr2.Bytes()),</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		mockOracleAddr3: {</span>
<span class="term-fg32">+			Code:    mockOracleBytecode,</span>
<span class="term-fg32">+			Balance: big.NewInt(0),</span>
<span class="term-fg32">+			&#47;&#47; This oracle is available for tests of contracts outside the celo_genesis, so no initialization is done at this point</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		DevAddr: {</span>
<span class="term-fg32">+			Balance: DevBalance,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		FaucetAddr: {</span>
<span class="term-fg32">+			Balance: faucetBalance,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; FeeCurrencyDirectory</span>
<span class="term-fg32">+	devAddrOffset1 := common.Hash{}</span>
<span class="term-fg32">+	copy(devAddrOffset1[11:], DevAddr.Bytes())</span>
<span class="term-fg32">+	feeCurrencyDirectoryStorage := map[common.Hash]common.Hash{</span>
<span class="term-fg32">+		&#47;&#47; owner, slot 0 offset 1</span>
<span class="term-fg32">+		common.HexToHash(&quot;0x0&quot;): devAddrOffset1,</span>
<span class="term-fg32">+		&#47;&#47; add entries to currencyList at slot 2</span>
<span class="term-fg32">+		common.HexToHash(&quot;0x2&quot;):  common.HexToHash(&quot;0x2&quot;),                         &#47;&#47; array length 2</span>
<span class="term-fg32">+		arrayAtSlot2:             common.BytesToHash(DevFeeCurrencyAddr.Bytes()),  &#47;&#47; FeeCurrency</span>
<span class="term-fg32">+		incHash(arrayAtSlot2, 1): common.BytesToHash(DevFeeCurrencyAddr2.Bytes()), &#47;&#47; FeeCurrency2</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; add entries to currencyConfig mapping</span>
<span class="term-fg32">+	addFeeCurrencyToStorage(DevFeeCurrencyAddr, mockOracleAddr, feeCurrencyDirectoryStorage)</span>
<span class="term-fg32">+	addFeeCurrencyToStorage(DevFeeCurrencyAddr2, mockOracleAddr2, feeCurrencyDirectoryStorage)</span>
<span class="term-fg32">+	genesisAccounts[addresses.FeeCurrencyDirectoryAddress] = GenesisAccount{</span>
<span class="term-fg32">+		Code:    feeCurrencyDirectoryBytecode,</span>
<span class="term-fg32">+		Balance: big.NewInt(0),</span>
<span class="term-fg32">+		Storage: feeCurrencyDirectoryStorage,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return genesisAccounts</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func addFeeCurrencyToStorage(feeCurrencyAddr common.Address, oracleAddr common.Address, storage map[common.Hash]common.Hash) {</span>
<span class="term-fg32">+	structStart := CalcMapAddr(common.HexToHash(&quot;0x1&quot;), common.BytesToHash(feeCurrencyAddr.Bytes()))</span>
<span class="term-fg32">+	storage[structStart] = common.BytesToHash(oracleAddr.Bytes())          &#47;&#47; oracle</span>
<span class="term-fg32">+	storage[incHash(structStart, 1)] = common.BigToHash(big.NewInt(50000)) &#47;&#47; intrinsicGas</span>
<span class="term-fg32">+}</span></div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-8e060e7a3219feb9eb8d502a"role="button" aria-expanded="false" aria-controls="id-8e060e7a3219feb9eb8d502a">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h3>Chain config</h3></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+132</span></div>
                    <div class="text-start"><span class="text-danger">-25</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-8e060e7a3219feb9eb8d502a">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1e25f7e8ac42accf6f471bde" role="button"
                       aria-expanded="false" aria-controls="id-1e25f7e8ac42accf6f471bde">
                        <code>core/genesis.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/genesis.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/genesis.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+34</span></div>
                            <div class="text-start"><span class="text-danger">-10</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1e25f7e8ac42accf6f471bde"><span class="term-fg1">diff --git op-geth&#47;core&#47;genesis.go CELO&#47;core&#47;genesis.go</span>
<span class="term-fg1">index 934eb6e234d06291af5537530038015bc67a6086..177c05d4e45a167ba87e1ea6ea490edb0963ded7 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;genesis.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;genesis.go</span>
<span class="term-fg36">@@ -60,8 +60,8 @@</span> 	Config     *params.ChainConfig `json:&quot;config&quot;`
 	Nonce      uint64              `json:&quot;nonce&quot;`
 	Timestamp  uint64              `json:&quot;timestamp&quot;`
 	ExtraData  []byte              `json:&quot;extraData&quot;`
<span class="term-fg31">-	GasLimit   uint64              `json:&quot;gasLimit&quot;   gencodec:&quot;required&quot;`</span>
<span class="term-fg31">-	Difficulty *big.Int            `json:&quot;difficulty&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	GasLimit   uint64              `json:&quot;gasLimit&quot;`</span>
<span class="term-fg32">+	Difficulty *big.Int            `json:&quot;difficulty&quot;`</span>
 	Mixhash    common.Hash         `json:&quot;mixHash&quot;`
 	Coinbase   common.Address      `json:&quot;coinbase&quot;`
 	Alloc      types.GenesisAlloc  `json:&quot;alloc&quot;      gencodec:&quot;required&quot;`
<span class="term-fg36">@@ -227,6 +227,8 @@</span> 	OverrideOptimismEcotone *uint64
 	OverrideOptimismFjord   *uint64
 	ApplySuperchainUpgrades bool
 	OverrideOptimismInterop *uint64
<span class="term-fg32">+	&#47;&#47; celo</span>
<span class="term-fg32">+	OverrideOptimismCel2 *uint64</span>
 }
&nbsp;
 &#47;&#47; SetupGenesisBlock writes or updates the genesis block in db.
<span class="term-fg36">@@ -282,8 +284,9 @@</span> 			}
 			if overrides != nil &amp;&amp; overrides.OverrideOptimismCanyon != nil {
 				config.CanyonTime = overrides.OverrideOptimismCanyon
 				config.ShanghaiTime = overrides.OverrideOptimismCanyon
<span class="term-fg31">-				if config.Optimism != nil &amp;&amp; config.Optimism.EIP1559DenominatorCanyon == 0 {</span>
<span class="term-fg31">-					config.Optimism.EIP1559DenominatorCanyon = 250</span>
<span class="term-fg32">+				if config.Optimism != nil &amp;&amp; (config.Optimism.EIP1559DenominatorCanyon == nil || *config.Optimism.EIP1559DenominatorCanyon == 0) {</span>
<span class="term-fg32">+					eip1559DenominatorCanyon := uint64(250)</span>
<span class="term-fg32">+					config.Optimism.EIP1559DenominatorCanyon = &amp;eip1559DenominatorCanyon</span>
 				}
 			}
 			if overrides != nil &amp;&amp; overrides.OverrideOptimismEcotone != nil {
<span class="term-fg36">@@ -296,6 +299,9 @@</span> 			}
 			if overrides != nil &amp;&amp; overrides.OverrideOptimismInterop != nil {
 				config.InteropTime = overrides.OverrideOptimismInterop
 			}
<span class="term-fg32">+			if overrides != nil &amp;&amp; overrides.OverrideOptimismCel2 != nil {</span>
<span class="term-fg32">+				config.Cel2Time = overrides.OverrideOptimismCel2</span>
<span class="term-fg32">+			}</span>
 		}
 	}
 	&#47;&#47; Just commit the new block if there is no stored genesis block.
<span class="term-fg36">@@ -376,7 +382,11 @@</span> 	head := rawdb.ReadHeadHeader(db)
 	if head == nil {
 		return newcfg, stored, errors.New(&quot;missing head header&quot;)
 	}
<span class="term-fg31">-	compatErr := storedcfg.CheckCompatible(newcfg, head.Number.Uint64(), head.Time)</span>
<span class="term-fg32">+	var genesisTimestamp *uint64</span>
<span class="term-fg32">+	if genesis != nil {</span>
<span class="term-fg32">+		genesisTimestamp = &amp;genesis.Timestamp</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	compatErr := storedcfg.CheckCompatible(newcfg, head.Number.Uint64(), head.Time, genesisTimestamp)</span>
 	if compatErr != nil &amp;&amp; ((head.Number.Uint64() != 0 &amp;&amp; compatErr.RewindToBlock != 0) || (head.Time != 0 &amp;&amp; compatErr.RewindToTime != 0)) {
 		return newcfg, stored, compatErr
 	}
<span class="term-fg36">@@ -470,11 +480,19 @@</span> 		MixDigest:  g.Mixhash,
 		Coinbase:   g.Coinbase,
 		Root:       root,
 	}
<span class="term-fg31">-	if g.GasLimit == 0 {</span>
<span class="term-fg31">-		head.GasLimit = params.GenesisGasLimit</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if g.Difficulty == nil &amp;&amp; g.Mixhash == (common.Hash{}) {</span>
<span class="term-fg31">-		head.Difficulty = params.GenesisDifficulty</span>
<span class="term-fg32">+	&#47;&#47; Don&#39;t set defaults for gas limit and difficulty for migrated celo chains.</span>
<span class="term-fg32">+	&#47;&#47; I.E. when Cel2Time is set &amp; non zero. Since migrated celo chains can</span>
<span class="term-fg32">+	&#47;&#47; have gas limit and difficulty unset in the genesis.</span>
<span class="term-fg32">+	if g.Config.Cel2Time == nil || g.Config.IsCel2(0) {</span>
<span class="term-fg32">+		if g.GasLimit == 0 {</span>
<span class="term-fg32">+			head.GasLimit = params.GenesisGasLimit</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if g.Difficulty == nil &amp;&amp; g.Mixhash == (common.Hash{}) {</span>
<span class="term-fg32">+			head.Difficulty = params.GenesisDifficulty</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	} else if g.Difficulty == nil {</span>
<span class="term-fg32">+		&#47;&#47; In the case of migrated chains we ensure a zero rather than nil difficulty.</span>
<span class="term-fg32">+		head.Difficulty = new(big.Int)</span>
 	}
 	if g.Config != nil &amp;&amp; g.Config.IsLondon(common.Big0) {
 		if g.BaseFee != nil {
<span class="term-fg36">@@ -628,6 +646,12 @@</span> 	}
 	if faucet != nil {
 		genesis.Alloc[*faucet] = types.Account{Balance: new(big.Int).Sub(new(big.Int).Lsh(big.NewInt(1), 256), big.NewInt(9))}
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Add state from celoGenesisAccounts</span>
<span class="term-fg32">+	for addr, data := range celoGenesisAccounts(common.HexToAddress(&quot;0x2&quot;)) {</span>
<span class="term-fg32">+		genesis.Alloc[addr] = data</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	return genesis
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-179fb975d34d3d23bf3f28f5" role="button"
                       aria-expanded="false" aria-controls="id-179fb975d34d3d23bf3f28f5">
                        <code>params/config.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/params/config.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/params/config.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+97</span></div>
                            <div class="text-start"><span class="text-danger">-14</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-179fb975d34d3d23bf3f28f5"><span class="term-fg1">diff --git op-geth&#47;params&#47;config.go CELO&#47;params&#47;config.go</span>
<span class="term-fg1">index b3a96a96af5d8aaad615faeac05c5e155dbfe2e2..0532598abe7530e8b6c2bd7a0eba6a6bc877cb6b 100644</span>
<span class="term-fg1">--- op-geth&#47;params&#47;config.go</span>
<span class="term-fg1">+++ CELO&#47;params&#47;config.go</span>
<span class="term-fg36">@@ -35,6 +35,7 @@</span>
 const (
 	OPMainnetChainID        = 10
 	OPGoerliChainID         = 420
<span class="term-fg32">+	CeloMainnetChainID      = 42220</span>
 	BaseMainnetChainID      = 8453
 	BaseGoerliChainID       = 84531
 	baseSepoliaChainID      = 84532
<span class="term-fg36">@@ -209,6 +210,8 @@</span> 		LondonBlock:                   big.NewInt(0),
 		ArrowGlacierBlock:             big.NewInt(0),
 		GrayGlacierBlock:              big.NewInt(0),
 		ShanghaiTime:                  newUint64(0),
<span class="term-fg32">+		Cel2Time:                      newUint64(0),</span>
<span class="term-fg32">+		GingerbreadBlock:              big.NewInt(0),</span>
 		TerminalTotalDifficulty:       big.NewInt(0),
 		TerminalTotalDifficultyPassed: true,
 	}
<span class="term-fg36">@@ -267,6 +270,39 @@</span> 		ShanghaiTime:                  nil,
 		CancunTime:                    nil,
 		PragueTime:                    nil,
 		VerkleTime:                    nil,
<span class="term-fg32">+		GingerbreadBlock:              big.NewInt(0),</span>
<span class="term-fg32">+		Cel2Time:                      newUint64(0),</span>
<span class="term-fg32">+		TerminalTotalDifficulty:       nil,</span>
<span class="term-fg32">+		TerminalTotalDifficultyPassed: false,</span>
<span class="term-fg32">+		Ethash:                        new(EthashConfig),</span>
<span class="term-fg32">+		Clique:                        nil,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; TestChainConfigNoCel2 contains every protocol change (EIPs) introduced</span>
<span class="term-fg32">+	&#47;&#47; and accepted by the Ethereum core developers for testing purposes.</span>
<span class="term-fg32">+	TestChainConfigNoCel2 = &amp;ChainConfig{</span>
<span class="term-fg32">+		ChainID:                       big.NewInt(1),</span>
<span class="term-fg32">+		HomesteadBlock:                big.NewInt(0),</span>
<span class="term-fg32">+		DAOForkBlock:                  nil,</span>
<span class="term-fg32">+		DAOForkSupport:                false,</span>
<span class="term-fg32">+		EIP150Block:                   big.NewInt(0),</span>
<span class="term-fg32">+		EIP155Block:                   big.NewInt(0),</span>
<span class="term-fg32">+		EIP158Block:                   big.NewInt(0),</span>
<span class="term-fg32">+		ByzantiumBlock:                big.NewInt(0),</span>
<span class="term-fg32">+		ConstantinopleBlock:           big.NewInt(0),</span>
<span class="term-fg32">+		PetersburgBlock:               big.NewInt(0),</span>
<span class="term-fg32">+		IstanbulBlock:                 big.NewInt(0),</span>
<span class="term-fg32">+		MuirGlacierBlock:              big.NewInt(0),</span>
<span class="term-fg32">+		BerlinBlock:                   big.NewInt(0),</span>
<span class="term-fg32">+		LondonBlock:                   big.NewInt(0),</span>
<span class="term-fg32">+		ArrowGlacierBlock:             big.NewInt(0),</span>
<span class="term-fg32">+		GrayGlacierBlock:              big.NewInt(0),</span>
<span class="term-fg32">+		MergeNetsplitBlock:            nil,</span>
<span class="term-fg32">+		ShanghaiTime:                  nil,</span>
<span class="term-fg32">+		CancunTime:                    nil,</span>
<span class="term-fg32">+		PragueTime:                    nil,</span>
<span class="term-fg32">+		VerkleTime:                    nil,</span>
<span class="term-fg32">+		Cel2Time:                      nil,</span>
 		TerminalTotalDifficulty:       nil,
 		TerminalTotalDifficultyPassed: false,
 		Ethash:                        new(EthashConfig),
<span class="term-fg36">@@ -293,6 +329,7 @@</span> 		LondonBlock:                   big.NewInt(0),
 		ArrowGlacierBlock:             big.NewInt(0),
 		GrayGlacierBlock:              big.NewInt(0),
 		MergeNetsplitBlock:            big.NewInt(0),
<span class="term-fg32">+		GingerbreadBlock:              big.NewInt(0),</span>
 		ShanghaiTime:                  newUint64(0),
 		CancunTime:                    newUint64(0),
 		PragueTime:                    nil,
<span class="term-fg36">@@ -398,6 +435,9 @@</span> 	FjordTime   *uint64 `json:&quot;fjordTime,omitempty&quot;`   &#47;&#47; Fjord switch time (nil = no fork, 0 = already on Optimism Fjord)
&nbsp;
 	InteropTime *uint64 `json:&quot;interopTime,omitempty&quot;` &#47;&#47; Interop switch time (nil = no fork, 0 = already on optimism interop)
&nbsp;
<span class="term-fg32">+	Cel2Time         *uint64  `json:&quot;cel2Time,omitempty&quot;`         &#47;&#47; Cel2 switch time (nil = no fork, 0 = already on optimism cel2)</span>
<span class="term-fg32">+	GingerbreadBlock *big.Int `json:&quot;gingerbreadBlock,omitempty&quot;` &#47;&#47; Gingerbread switch block (nil = no fork, 0 = already activated)</span>
<span class="term-fg32">+</span>
 	&#47;&#47; TerminalTotalDifficulty is the amount of total difficulty reached by
 	&#47;&#47; the network that triggers the consensus upgrade.
 	TerminalTotalDifficulty *big.Int `json:&quot;terminalTotalDifficulty,omitempty&quot;`
<span class="term-fg36">@@ -436,9 +476,9 @@</span> }
&nbsp;
 &#47;&#47; OptimismConfig is the optimism config.
 type OptimismConfig struct {
<span class="term-fg31">-	EIP1559Elasticity        uint64 `json:&quot;eip1559Elasticity&quot;`</span>
<span class="term-fg31">-	EIP1559Denominator       uint64 `json:&quot;eip1559Denominator&quot;`</span>
<span class="term-fg31">-	EIP1559DenominatorCanyon uint64 `json:&quot;eip1559DenominatorCanyon&quot;`</span>
<span class="term-fg32">+	EIP1559Elasticity        uint64  `json:&quot;eip1559Elasticity&quot;`</span>
<span class="term-fg32">+	EIP1559Denominator       uint64  `json:&quot;eip1559Denominator&quot;`</span>
<span class="term-fg32">+	EIP1559DenominatorCanyon *uint64 `json:&quot;eip1559DenominatorCanyon,omitempty&quot;`</span>
 }
&nbsp;
 &#47;&#47; String implements the stringer interface, returning the optimism fee config details.
<span class="term-fg36">@@ -551,6 +591,9 @@</span> 		banner += fmt.Sprintf(&quot; - Fjord:                       @%-10v\n&quot;, *c.FjordTime)
 	}
 	if c.InteropTime != nil {
 		banner += fmt.Sprintf(&quot; - Interop:                     @%-10v\n&quot;, *c.InteropTime)
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if c.Cel2Time != nil {</span>
<span class="term-fg32">+		banner += fmt.Sprintf(&quot; - Cel2:                        @%-10v\n&quot;, *c.Cel2Time)</span>
 	}
 	return banner
 }
<span class="term-fg36">@@ -680,6 +723,15 @@</span> func (c *ChainConfig) IsInterop(time uint64) bool {
 	return isTimestampForked(c.InteropTime, time)
 }
&nbsp;
<span class="term-fg32">+func (c *ChainConfig) IsCel2(time uint64) bool {</span>
<span class="term-fg32">+	return isTimestampForked(c.Cel2Time, time)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsGingerbread returns whether num represents a block number after the Gingerbread fork</span>
<span class="term-fg32">+func (c *ChainConfig) IsGingerbread(num *big.Int) bool {</span>
<span class="term-fg32">+	return isBlockForked(c.GingerbreadBlock, num)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; IsOptimism returns whether the node is an optimism node or not.
 func (c *ChainConfig) IsOptimism() bool {
 	return c.Optimism != nil
<span class="term-fg36">@@ -713,7 +765,7 @@</span> }
&nbsp;
 &#47;&#47; CheckCompatible checks whether scheduled fork transitions have been imported
 &#47;&#47; with a mismatching chain configuration.
<span class="term-fg31">-func (c *ChainConfig) CheckCompatible(newcfg *ChainConfig, height uint64, time uint64) *ConfigCompatError {</span>
<span class="term-fg32">+func (c *ChainConfig) CheckCompatible(newcfg *ChainConfig, height, time uint64, genesisTimestamp *uint64) *ConfigCompatError {</span>
 	var (
 		bhead = new(big.Int).SetUint64(height)
 		btime = time
<span class="term-fg36">@@ -721,7 +773,7 @@</span> 	)
 	&#47;&#47; Iterate checkCompatible to find the lowest conflict.
 	var lasterr *ConfigCompatError
 	for {
<span class="term-fg31">-		err := c.checkCompatible(newcfg, bhead, btime)</span>
<span class="term-fg32">+		err := c.checkCompatible(newcfg, bhead, btime, genesisTimestamp)</span>
 		if err == nil || (lasterr != nil &amp;&amp; err.RewindToBlock == lasterr.RewindToBlock &amp;&amp; err.RewindToTime == lasterr.RewindToTime) {
 			break
 		}
<span class="term-fg36">@@ -804,7 +856,7 @@</span> 	}
 	return nil
 }
&nbsp;
<span class="term-fg31">-func (c *ChainConfig) checkCompatible(newcfg *ChainConfig, headNumber *big.Int, headTimestamp uint64) *ConfigCompatError {</span>
<span class="term-fg32">+func (c *ChainConfig) checkCompatible(newcfg *ChainConfig, headNumber *big.Int, headTimestamp uint64, genesisTimestamp *uint64) *ConfigCompatError {</span>
 	if isForkBlockIncompatible(c.HomesteadBlock, newcfg.HomesteadBlock, headNumber) {
 		return newBlockCompatError(&quot;Homestead fork block&quot;, c.HomesteadBlock, newcfg.HomesteadBlock)
 	}
<span class="term-fg36">@@ -860,18 +912,36 @@</span> 	}
 	if isForkBlockIncompatible(c.MergeNetsplitBlock, newcfg.MergeNetsplitBlock, headNumber) {
 		return newBlockCompatError(&quot;Merge netsplit fork block&quot;, c.MergeNetsplitBlock, newcfg.MergeNetsplitBlock)
 	}
<span class="term-fg31">-	if isForkTimestampIncompatible(c.ShanghaiTime, newcfg.ShanghaiTime, headTimestamp) {</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.ShanghaiTime, newcfg.ShanghaiTime, headTimestamp, genesisTimestamp) {</span>
 		return newTimestampCompatError(&quot;Shanghai fork timestamp&quot;, c.ShanghaiTime, newcfg.ShanghaiTime)
 	}
<span class="term-fg31">-	if isForkTimestampIncompatible(c.CancunTime, newcfg.CancunTime, headTimestamp) {</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.CancunTime, newcfg.CancunTime, headTimestamp, genesisTimestamp) {</span>
 		return newTimestampCompatError(&quot;Cancun fork timestamp&quot;, c.CancunTime, newcfg.CancunTime)
 	}
<span class="term-fg31">-	if isForkTimestampIncompatible(c.PragueTime, newcfg.PragueTime, headTimestamp) {</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.PragueTime, newcfg.PragueTime, headTimestamp, genesisTimestamp) {</span>
 		return newTimestampCompatError(&quot;Prague fork timestamp&quot;, c.PragueTime, newcfg.PragueTime)
 	}
<span class="term-fg31">-	if isForkTimestampIncompatible(c.VerkleTime, newcfg.VerkleTime, headTimestamp) {</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.VerkleTime, newcfg.VerkleTime, headTimestamp, genesisTimestamp) {</span>
 		return newTimestampCompatError(&quot;Verkle fork timestamp&quot;, c.VerkleTime, newcfg.VerkleTime)
 	}
<span class="term-fg32">+	if isForkBlockIncompatible(c.BedrockBlock, newcfg.BedrockBlock, headNumber) {</span>
<span class="term-fg32">+		return newBlockCompatError(&quot;Bedrock fork block&quot;, c.BedrockBlock, newcfg.BedrockBlock)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.RegolithTime, newcfg.RegolithTime, headTimestamp, genesisTimestamp) {</span>
<span class="term-fg32">+		return newTimestampCompatError(&quot;Regolith fork timestamp&quot;, c.RegolithTime, newcfg.RegolithTime)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.CanyonTime, newcfg.CanyonTime, headTimestamp, genesisTimestamp) {</span>
<span class="term-fg32">+		return newTimestampCompatError(&quot;Canyon fork timestamp&quot;, c.CanyonTime, newcfg.CanyonTime)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.EcotoneTime, newcfg.EcotoneTime, headTimestamp, genesisTimestamp) {</span>
<span class="term-fg32">+		return newTimestampCompatError(&quot;Ecotone fork timestamp&quot;, c.EcotoneTime, newcfg.EcotoneTime)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.FjordTime, newcfg.FjordTime, headTimestamp, genesisTimestamp) {</span>
<span class="term-fg32">+		return newTimestampCompatError(&quot;Fjord fork timestamp&quot;, c.FjordTime, newcfg.FjordTime)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if isForkTimestampIncompatible(c.InteropTime, newcfg.InteropTime, headTimestamp, genesisTimestamp) {</span>
<span class="term-fg32">+		return newTimestampCompatError(&quot;Interop fork timestamp&quot;, c.InteropTime, newcfg.InteropTime)</span>
<span class="term-fg32">+	}</span>
 	return nil
 }
&nbsp;
<span class="term-fg36">@@ -880,7 +950,10 @@</span> &#47;&#47; The time parameters is the timestamp of the block to determine if Canyon is active or not
 func (c *ChainConfig) BaseFeeChangeDenominator(time uint64) uint64 {
 	if c.Optimism != nil {
 		if c.IsCanyon(time) {
<span class="term-fg31">-			return c.Optimism.EIP1559DenominatorCanyon</span>
<span class="term-fg32">+			if c.Optimism.EIP1559DenominatorCanyon == nil || *c.Optimism.EIP1559DenominatorCanyon == 0 {</span>
<span class="term-fg32">+				panic(&quot;invalid ChainConfig.Optimism.EIP1559DenominatorCanyon value: &#39;0&#39; or &#39;nil&#39;&quot;)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return *c.Optimism.EIP1559DenominatorCanyon</span>
 		}
 		return c.Optimism.EIP1559Denominator
 	}
<span class="term-fg36">@@ -913,7 +986,7 @@</span> 	}
 }
&nbsp;
 &#47;&#47; isForkBlockIncompatible returns true if a fork scheduled at block s1 cannot be
<span class="term-fg31">-&#47;&#47; rescheduled to block s2 because head is already past the fork.</span>
<span class="term-fg32">+&#47;&#47; rescheduled to block s2 because head is already past the fork and the fork was scheduled after genesis</span>
 func isForkBlockIncompatible(s1, s2, head *big.Int) bool {
 	return (isBlockForked(s1, head) || isBlockForked(s2, head)) &amp;&amp; !configBlockEqual(s1, s2)
 }
<span class="term-fg36">@@ -940,8 +1013,15 @@</span> }
&nbsp;
 &#47;&#47; isForkTimestampIncompatible returns true if a fork scheduled at timestamp s1
 &#47;&#47; cannot be rescheduled to timestamp s2 because head is already past the fork.
<span class="term-fg31">-func isForkTimestampIncompatible(s1, s2 *uint64, head uint64) bool {</span>
<span class="term-fg31">-	return (isTimestampForked(s1, head) || isTimestampForked(s2, head)) &amp;&amp; !configTimestampEqual(s1, s2)</span>
<span class="term-fg32">+func isForkTimestampIncompatible(s1, s2 *uint64, head uint64, genesis *uint64) bool {</span>
<span class="term-fg32">+	return (isTimestampForked(s1, head) || isTimestampForked(s2, head)) &amp;&amp; !configTimestampEqual(s1, s2) &amp;&amp; !isTimestampPreGenesis(s1, genesis) &amp;&amp; !isTimestampPreGenesis(s2, genesis)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func isTimestampPreGenesis(s, genesis *uint64) bool {</span>
<span class="term-fg32">+	if s == nil || genesis == nil {</span>
<span class="term-fg32">+		return false</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return *s &lt; *genesis</span>
 }
&nbsp;
 &#47;&#47; isTimestampForked returns whether a fork scheduled at timestamp s is active
<span class="term-fg36">@@ -1047,6 +1127,7 @@</span> 	IsMerge, IsShanghai, IsCancun, IsPrague                 bool
 	IsVerkle                                                bool
 	IsOptimismBedrock, IsOptimismRegolith                   bool
 	IsOptimismCanyon, IsOptimismFjord                       bool
<span class="term-fg32">+	IsCel2                                                  bool</span>
 }
&nbsp;
 &#47;&#47; Rules ensures c&#39;s ChainID is not nil.
<span class="term-fg36">@@ -1079,5 +1160,7 @@</span> 		IsOptimismBedrock:  isMerge &amp;&amp; c.IsOptimismBedrock(num),
 		IsOptimismRegolith: isMerge &amp;&amp; c.IsOptimismRegolith(timestamp),
 		IsOptimismCanyon:   isMerge &amp;&amp; c.IsOptimismCanyon(timestamp),
 		IsOptimismFjord:    isMerge &amp;&amp; c.IsOptimismFjord(timestamp),
<span class="term-fg32">+		&#47;&#47; Celo</span>
<span class="term-fg32">+		IsCel2: c.IsCel2(timestamp),</span>
 	}
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a0395ffef7def7e74467f942" role="button"
                       aria-expanded="false" aria-controls="id-a0395ffef7def7e74467f942">
                        <code>params/protocol_params.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/params/protocol_params.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/params/protocol_params.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a0395ffef7def7e74467f942"><span class="term-fg1">diff --git op-geth&#47;params&#47;protocol_params.go CELO&#47;params&#47;protocol_params.go</span>
<span class="term-fg1">index 5e2a0632afbeeb1ae2341791f076615cea6fe092..88fb80ba6084b6b0c3596756c806112f1ea28c9b 100644</span>
<span class="term-fg1">--- op-geth&#47;params&#47;protocol_params.go</span>
<span class="term-fg1">+++ CELO&#47;params&#47;protocol_params.go</span>
<span class="term-fg36">@@ -135,7 +135,7 @@</span> 	DefaultBaseFeeChangeDenominator = 8          &#47;&#47; Bounds the amount the base fee can change between blocks.
 	DefaultElasticityMultiplier     = 2          &#47;&#47; Bounds the maximum gas limit an EIP-1559 block may have.
 	InitialBaseFee                  = 1000000000 &#47;&#47; Initial base fee for EIP-1559 blocks.
&nbsp;
<span class="term-fg31">-	MaxCodeSize     = 24576           &#47;&#47; Maximum bytecode to permit for a contract</span>
<span class="term-fg32">+	MaxCodeSize     = 65536           &#47;&#47; Maximum bytecode to permit for a contract</span>
 	MaxInitCodeSize = 2 * MaxCodeSize &#47;&#47; Maximum initcode to permit in a creation transaction and create instructions
&nbsp;
 	&#47;&#47; Precompiled contract gas prices</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-7af09fe2bb7f816dbf6ef780"role="button" aria-expanded="false" aria-controls="id-7af09fe2bb7f816dbf6ef780">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h3>E2E tests</h3></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+2443</span></div>
                    <div class="text-start"><span class="text-danger">-0</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-7af09fe2bb7f816dbf6ef780">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5c8311bce14de78d4fe84ede" role="button"
                       aria-expanded="false" aria-controls="id-5c8311bce14de78d4fe84ede">
                        <code>e2e_test/.gitignore</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/.gitignore" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5c8311bce14de78d4fe84ede"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;.gitignore CELO&#47;e2e_test&#47;.gitignore</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..d93e90bc6936c69f4976f29030cd041295ba09cb</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;.gitignore</span>
<span class="term-fg36">@@ -0,0 +1,3 @@</span>
<span class="term-fg32">+cache</span>
<span class="term-fg32">+out</span>
<span class="term-fg32">+geth.log</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e86a184bd8673627f8d0972b" role="button"
                       aria-expanded="false" aria-controls="id-e86a184bd8673627f8d0972b">
                        <code>e2e_test/debug-fee-currency/DebugFeeCurrency.sol</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/debug-fee-currency/DebugFeeCurrency.sol" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+770</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e86a184bd8673627f8d0972b"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;debug-fee-currency&#47;DebugFeeCurrency.sol CELO&#47;e2e_test&#47;debug-fee-currency&#47;DebugFeeCurrency.sol</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7f269dd5f20b56904ec98212b8ec93b212c0d83b</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;debug-fee-currency&#47;DebugFeeCurrency.sol</span>
<span class="term-fg36">@@ -0,0 +1,770 @@</span>
<span class="term-fg32">+pragma solidity ^0.8.13;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; OpenZeppelin Contracts (last updated v5.0.0) (token&#47;ERC20&#47;ERC20.sol)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; OpenZeppelin Contracts (last updated v5.0.0) (token&#47;ERC20&#47;IERC20.sol)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;**</span>
<span class="term-fg32">+ * @dev Interface of the ERC20 standard as defined in the EIP.</span>
<span class="term-fg32">+ *&#47;</span>
<span class="term-fg32">+interface IERC20 {</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Emitted when `value` tokens are moved from one account (`from`) to</span>
<span class="term-fg32">+     * another (`to`).</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Note that `value` may be zero.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    event Transfer(address indexed from, address indexed to, uint256 value);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Emitted when the allowance of a `spender` for an `owner` is set by</span>
<span class="term-fg32">+     * a call to {approve}. `value` is the new allowance.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    event Approval(address indexed owner, address indexed spender, uint256 value);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the value of tokens in existence.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function totalSupply() external view returns (uint256);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the value of tokens owned by `account`.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function balanceOf(address account) external view returns (uint256);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Moves a `value` amount of tokens from the caller&#39;s account to `to`.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Returns a boolean value indicating whether the operation succeeded.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits a {Transfer} event.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function transfer(address to, uint256 value) external returns (bool);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the remaining number of tokens that `spender` will be</span>
<span class="term-fg32">+     * allowed to spend on behalf of `owner` through {transferFrom}. This is</span>
<span class="term-fg32">+     * zero by default.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * This value changes when {approve} or {transferFrom} are called.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function allowance(address owner, address spender) external view returns (uint256);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Sets a `value` amount of tokens as the allowance of `spender` over the</span>
<span class="term-fg32">+     * caller&#39;s tokens.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Returns a boolean value indicating whether the operation succeeded.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * IMPORTANT: Beware that changing an allowance with this method brings the risk</span>
<span class="term-fg32">+     * that someone may use both the old and the new allowance by unfortunate</span>
<span class="term-fg32">+     * transaction ordering. One possible solution to mitigate this race</span>
<span class="term-fg32">+     * condition is to first reduce the spender&#39;s allowance to 0 and set the</span>
<span class="term-fg32">+     * desired value afterwards:</span>
<span class="term-fg32">+     * https:&#47;&#47;github.com&#47;ethereum&#47;EIPs&#47;issues&#47;20#issuecomment-263524729</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits an {Approval} event.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function approve(address spender, uint256 value) external returns (bool);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Moves a `value` amount of tokens from `from` to `to` using the</span>
<span class="term-fg32">+     * allowance mechanism. `value` is then deducted from the caller&#39;s</span>
<span class="term-fg32">+     * allowance.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Returns a boolean value indicating whether the operation succeeded.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits a {Transfer} event.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function transferFrom(address from, address to, uint256 value) external returns (bool);</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; OpenZeppelin Contracts (last updated v5.0.0) (token&#47;ERC20&#47;extensions&#47;IERC20Metadata.sol)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;**</span>
<span class="term-fg32">+ * @dev Interface for the optional metadata functions from the ERC20 standard.</span>
<span class="term-fg32">+ *&#47;</span>
<span class="term-fg32">+interface IERC20Metadata is IERC20 {</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the name of the token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function name() external view returns (string memory);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the symbol of the token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function symbol() external view returns (string memory);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the decimals places of the token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function decimals() external view returns (uint8);</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; OpenZeppelin Contracts (last updated v5.0.1) (utils&#47;Context.sol)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;**</span>
<span class="term-fg32">+ * @dev Provides information about the current execution context, including the</span>
<span class="term-fg32">+ * sender of the transaction and its data. While these are generally available</span>
<span class="term-fg32">+ * via msg.sender and msg.data, they should not be accessed in such a direct</span>
<span class="term-fg32">+ * manner, since when dealing with meta-transactions the account sending and</span>
<span class="term-fg32">+ * paying for execution may not be the actual sender (as far as an application</span>
<span class="term-fg32">+ * is concerned).</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * This contract is only required for intermediate, library-like contracts.</span>
<span class="term-fg32">+ *&#47;</span>
<span class="term-fg32">+abstract contract Context {</span>
<span class="term-fg32">+    function _msgSender() internal view virtual returns (address) {</span>
<span class="term-fg32">+        return msg.sender;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    function _msgData() internal view virtual returns (bytes calldata) {</span>
<span class="term-fg32">+        return msg.data;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    function _contextSuffixLength() internal view virtual returns (uint256) {</span>
<span class="term-fg32">+        return 0;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; OpenZeppelin Contracts (last updated v5.0.0) (interfaces&#47;draft-IERC6093.sol)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;**</span>
<span class="term-fg32">+ * @dev Standard ERC20 Errors</span>
<span class="term-fg32">+ * Interface of the https:&#47;&#47;eips.ethereum.org&#47;EIPS&#47;eip-6093[ERC-6093] custom errors for ERC20 tokens.</span>
<span class="term-fg32">+ *&#47;</span>
<span class="term-fg32">+interface IERC20Errors {</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates an error related to the current `balance` of a `sender`. Used in transfers.</span>
<span class="term-fg32">+     * @param sender Address whose tokens are being transferred.</span>
<span class="term-fg32">+     * @param balance Current balance for the interacting account.</span>
<span class="term-fg32">+     * @param needed Minimum amount required to perform a transfer.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC20InsufficientBalance(address sender, uint256 balance, uint256 needed);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the token `sender`. Used in transfers.</span>
<span class="term-fg32">+     * @param sender Address whose tokens are being transferred.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC20InvalidSender(address sender);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the token `receiver`. Used in transfers.</span>
<span class="term-fg32">+     * @param receiver Address to which tokens are being transferred.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC20InvalidReceiver(address receiver);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `spender`’s `allowance`. Used in transfers.</span>
<span class="term-fg32">+     * @param spender Address that may be allowed to operate on tokens without being their owner.</span>
<span class="term-fg32">+     * @param allowance Amount of tokens a `spender` is allowed to operate with.</span>
<span class="term-fg32">+     * @param needed Minimum amount required to perform a transfer.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC20InsufficientAllowance(address spender, uint256 allowance, uint256 needed);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `approver` of a token to be approved. Used in approvals.</span>
<span class="term-fg32">+     * @param approver Address initiating an approval operation.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC20InvalidApprover(address approver);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `spender` to be approved. Used in approvals.</span>
<span class="term-fg32">+     * @param spender Address that may be allowed to operate on tokens without being their owner.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC20InvalidSpender(address spender);</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;**</span>
<span class="term-fg32">+ * @dev Standard ERC721 Errors</span>
<span class="term-fg32">+ * Interface of the https:&#47;&#47;eips.ethereum.org&#47;EIPS&#47;eip-6093[ERC-6093] custom errors for ERC721 tokens.</span>
<span class="term-fg32">+ *&#47;</span>
<span class="term-fg32">+interface IERC721Errors {</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates that an address can&#39;t be an owner. For example, `address(0)` is a forbidden owner in EIP-20.</span>
<span class="term-fg32">+     * Used in balance queries.</span>
<span class="term-fg32">+     * @param owner Address of the current owner of a token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC721InvalidOwner(address owner);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a `tokenId` whose `owner` is the zero address.</span>
<span class="term-fg32">+     * @param tokenId Identifier number of a token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC721NonexistentToken(uint256 tokenId);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates an error related to the ownership over a particular token. Used in transfers.</span>
<span class="term-fg32">+     * @param sender Address whose tokens are being transferred.</span>
<span class="term-fg32">+     * @param tokenId Identifier number of a token.</span>
<span class="term-fg32">+     * @param owner Address of the current owner of a token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC721IncorrectOwner(address sender, uint256 tokenId, address owner);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the token `sender`. Used in transfers.</span>
<span class="term-fg32">+     * @param sender Address whose tokens are being transferred.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC721InvalidSender(address sender);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the token `receiver`. Used in transfers.</span>
<span class="term-fg32">+     * @param receiver Address to which tokens are being transferred.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC721InvalidReceiver(address receiver);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `operator`’s approval. Used in transfers.</span>
<span class="term-fg32">+     * @param operator Address that may be allowed to operate on tokens without being their owner.</span>
<span class="term-fg32">+     * @param tokenId Identifier number of a token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC721InsufficientApproval(address operator, uint256 tokenId);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `approver` of a token to be approved. Used in approvals.</span>
<span class="term-fg32">+     * @param approver Address initiating an approval operation.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC721InvalidApprover(address approver);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `operator` to be approved. Used in approvals.</span>
<span class="term-fg32">+     * @param operator Address that may be allowed to operate on tokens without being their owner.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC721InvalidOperator(address operator);</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;**</span>
<span class="term-fg32">+ * @dev Standard ERC1155 Errors</span>
<span class="term-fg32">+ * Interface of the https:&#47;&#47;eips.ethereum.org&#47;EIPS&#47;eip-6093[ERC-6093] custom errors for ERC1155 tokens.</span>
<span class="term-fg32">+ *&#47;</span>
<span class="term-fg32">+interface IERC1155Errors {</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates an error related to the current `balance` of a `sender`. Used in transfers.</span>
<span class="term-fg32">+     * @param sender Address whose tokens are being transferred.</span>
<span class="term-fg32">+     * @param balance Current balance for the interacting account.</span>
<span class="term-fg32">+     * @param needed Minimum amount required to perform a transfer.</span>
<span class="term-fg32">+     * @param tokenId Identifier number of a token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC1155InsufficientBalance(address sender, uint256 balance, uint256 needed, uint256 tokenId);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the token `sender`. Used in transfers.</span>
<span class="term-fg32">+     * @param sender Address whose tokens are being transferred.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC1155InvalidSender(address sender);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the token `receiver`. Used in transfers.</span>
<span class="term-fg32">+     * @param receiver Address to which tokens are being transferred.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC1155InvalidReceiver(address receiver);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `operator`’s approval. Used in transfers.</span>
<span class="term-fg32">+     * @param operator Address that may be allowed to operate on tokens without being their owner.</span>
<span class="term-fg32">+     * @param owner Address of the current owner of a token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC1155MissingApprovalForAll(address operator, address owner);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `approver` of a token to be approved. Used in approvals.</span>
<span class="term-fg32">+     * @param approver Address initiating an approval operation.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC1155InvalidApprover(address approver);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates a failure with the `operator` to be approved. Used in approvals.</span>
<span class="term-fg32">+     * @param operator Address that may be allowed to operate on tokens without being their owner.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC1155InvalidOperator(address operator);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Indicates an array length mismatch between ids and values in a safeBatchTransferFrom operation.</span>
<span class="term-fg32">+     * Used in batch transfers.</span>
<span class="term-fg32">+     * @param idsLength Length of the array of token identifiers</span>
<span class="term-fg32">+     * @param valuesLength Length of the array of token amounts</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    error ERC1155InvalidArrayLength(uint256 idsLength, uint256 valuesLength);</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;**</span>
<span class="term-fg32">+ * @dev Implementation of the {IERC20} interface.</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * This implementation is agnostic to the way tokens are created. This means</span>
<span class="term-fg32">+ * that a supply mechanism has to be added in a derived contract using {_mint}.</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * TIP: For a detailed writeup see our guide</span>
<span class="term-fg32">+ * https:&#47;&#47;forum.openzeppelin.com&#47;t&#47;how-to-implement-erc20-supply-mechanisms&#47;226[How</span>
<span class="term-fg32">+ * to implement supply mechanisms].</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * The default value of {decimals} is 18. To change this, you should override</span>
<span class="term-fg32">+ * this function so it returns a different value.</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * We have followed general OpenZeppelin Contracts guidelines: functions revert</span>
<span class="term-fg32">+ * instead returning `false` on failure. This behavior is nonetheless</span>
<span class="term-fg32">+ * conventional and does not conflict with the expectations of ERC20</span>
<span class="term-fg32">+ * applications.</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * Additionally, an {Approval} event is emitted on calls to {transferFrom}.</span>
<span class="term-fg32">+ * This allows applications to reconstruct the allowance for all accounts just</span>
<span class="term-fg32">+ * by listening to said events. Other implementations of the EIP may not emit</span>
<span class="term-fg32">+ * these events, as it isn&#39;t required by the specification.</span>
<span class="term-fg32">+ *&#47;</span>
<span class="term-fg32">+abstract contract ERC20 is Context, IERC20, IERC20Metadata, IERC20Errors {</span>
<span class="term-fg32">+    mapping(address account =&gt; uint256) private _balances;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    mapping(address account =&gt; mapping(address spender =&gt; uint256)) private _allowances;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    uint256 private _totalSupply;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    string private _name;</span>
<span class="term-fg32">+    string private _symbol;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Sets the values for {name} and {symbol}.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * All two of these values are immutable: they can only be set once during</span>
<span class="term-fg32">+     * construction.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    constructor(string memory name_, string memory symbol_) {</span>
<span class="term-fg32">+        _name = name_;</span>
<span class="term-fg32">+        _symbol = symbol_;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the name of the token.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function name() public view virtual returns (string memory) {</span>
<span class="term-fg32">+        return _name;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the symbol of the token, usually a shorter version of the</span>
<span class="term-fg32">+     * name.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function symbol() public view virtual returns (string memory) {</span>
<span class="term-fg32">+        return _symbol;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Returns the number of decimals used to get its user representation.</span>
<span class="term-fg32">+     * For example, if `decimals` equals `2`, a balance of `505` tokens should</span>
<span class="term-fg32">+     * be displayed to a user as `5.05` (`505 &#47; 10 ** 2`).</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Tokens usually opt for a value of 18, imitating the relationship between</span>
<span class="term-fg32">+     * Ether and Wei. This is the default value returned by this function, unless</span>
<span class="term-fg32">+     * it&#39;s overridden.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * NOTE: This information is only used for _display_ purposes: it in</span>
<span class="term-fg32">+     * no way affects any of the arithmetic of the contract, including</span>
<span class="term-fg32">+     * {IERC20-balanceOf} and {IERC20-transfer}.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function decimals() public view virtual returns (uint8) {</span>
<span class="term-fg32">+        return 18;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev See {IERC20-totalSupply}.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function totalSupply() public view virtual returns (uint256) {</span>
<span class="term-fg32">+        return _totalSupply;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev See {IERC20-balanceOf}.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function balanceOf(address account) public view virtual returns (uint256) {</span>
<span class="term-fg32">+        return _balances[account];</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev See {IERC20-transfer}.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Requirements:</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * - `to` cannot be the zero address.</span>
<span class="term-fg32">+     * - the caller must have a balance of at least `value`.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function transfer(address to, uint256 value) public virtual returns (bool) {</span>
<span class="term-fg32">+        address owner = _msgSender();</span>
<span class="term-fg32">+        _transfer(owner, to, value);</span>
<span class="term-fg32">+        return true;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev See {IERC20-allowance}.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function allowance(address owner, address spender) public view virtual returns (uint256) {</span>
<span class="term-fg32">+        return _allowances[owner][spender];</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev See {IERC20-approve}.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * NOTE: If `value` is the maximum `uint256`, the allowance is not updated on</span>
<span class="term-fg32">+     * `transferFrom`. This is semantically equivalent to an infinite approval.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Requirements:</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * - `spender` cannot be the zero address.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function approve(address spender, uint256 value) public virtual returns (bool) {</span>
<span class="term-fg32">+        address owner = _msgSender();</span>
<span class="term-fg32">+        _approve(owner, spender, value);</span>
<span class="term-fg32">+        return true;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev See {IERC20-transferFrom}.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits an {Approval} event indicating the updated allowance. This is not</span>
<span class="term-fg32">+     * required by the EIP. See the note at the beginning of {ERC20}.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * NOTE: Does not update the allowance if the current allowance</span>
<span class="term-fg32">+     * is the maximum `uint256`.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Requirements:</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * - `from` and `to` cannot be the zero address.</span>
<span class="term-fg32">+     * - `from` must have a balance of at least `value`.</span>
<span class="term-fg32">+     * - the caller must have allowance for ``from``&#39;s tokens of at least</span>
<span class="term-fg32">+     * `value`.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function transferFrom(address from, address to, uint256 value) public virtual returns (bool) {</span>
<span class="term-fg32">+        address spender = _msgSender();</span>
<span class="term-fg32">+        _spendAllowance(from, spender, value);</span>
<span class="term-fg32">+        _transfer(from, to, value);</span>
<span class="term-fg32">+        return true;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Moves a `value` amount of tokens from `from` to `to`.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * This internal function is equivalent to {transfer}, and can be used to</span>
<span class="term-fg32">+     * e.g. implement automatic token fees, slashing mechanisms, etc.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits a {Transfer} event.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * NOTE: This function is not virtual, {_update} should be overridden instead.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function _transfer(address from, address to, uint256 value) internal {</span>
<span class="term-fg32">+        if (from == address(0)) {</span>
<span class="term-fg32">+            revert ERC20InvalidSender(address(0));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        if (to == address(0)) {</span>
<span class="term-fg32">+            revert ERC20InvalidReceiver(address(0));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        _update(from, to, value);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Transfers a `value` amount of tokens from `from` to `to`, or alternatively mints (or burns) if `from`</span>
<span class="term-fg32">+     * (or `to`) is the zero address. All customizations to transfers, mints, and burns should be done by overriding</span>
<span class="term-fg32">+     * this function.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits a {Transfer} event.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function _update(address from, address to, uint256 value) internal virtual {</span>
<span class="term-fg32">+        if (from == address(0)) {</span>
<span class="term-fg32">+            &#47;&#47; Overflow check required: The rest of the code assumes that totalSupply never overflows</span>
<span class="term-fg32">+            _totalSupply += value;</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            uint256 fromBalance = _balances[from];</span>
<span class="term-fg32">+            if (fromBalance &lt; value) {</span>
<span class="term-fg32">+                revert ERC20InsufficientBalance(from, fromBalance, value);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            unchecked {</span>
<span class="term-fg32">+                &#47;&#47; Overflow not possible: value &lt;= fromBalance &lt;= totalSupply.</span>
<span class="term-fg32">+                _balances[from] = fromBalance - value;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if (to == address(0)) {</span>
<span class="term-fg32">+            unchecked {</span>
<span class="term-fg32">+                &#47;&#47; Overflow not possible: value &lt;= totalSupply or value &lt;= fromBalance &lt;= totalSupply.</span>
<span class="term-fg32">+                _totalSupply -= value;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        } else {</span>
<span class="term-fg32">+            unchecked {</span>
<span class="term-fg32">+                &#47;&#47; Overflow not possible: balance + value is at most totalSupply, which we know fits into a uint256.</span>
<span class="term-fg32">+                _balances[to] += value;</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        emit Transfer(from, to, value);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Creates a `value` amount of tokens and assigns them to `account`, by transferring it from address(0).</span>
<span class="term-fg32">+     * Relies on the `_update` mechanism</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits a {Transfer} event with `from` set to the zero address.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * NOTE: This function is not virtual, {_update} should be overridden instead.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function _mint(address account, uint256 value) internal {</span>
<span class="term-fg32">+        if (account == address(0)) {</span>
<span class="term-fg32">+            revert ERC20InvalidReceiver(address(0));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        _update(address(0), account, value);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Destroys a `value` amount of tokens from `account`, lowering the total supply.</span>
<span class="term-fg32">+     * Relies on the `_update` mechanism.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits a {Transfer} event with `to` set to the zero address.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * NOTE: This function is not virtual, {_update} should be overridden instead</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function _burn(address account, uint256 value) internal {</span>
<span class="term-fg32">+        if (account == address(0)) {</span>
<span class="term-fg32">+            revert ERC20InvalidSender(address(0));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        _update(account, address(0), value);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Sets `value` as the allowance of `spender` over the `owner` s tokens.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * This internal function is equivalent to `approve`, and can be used to</span>
<span class="term-fg32">+     * e.g. set automatic allowances for certain subsystems, etc.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Emits an {Approval} event.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Requirements:</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * - `owner` cannot be the zero address.</span>
<span class="term-fg32">+     * - `spender` cannot be the zero address.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Overrides to this logic should be done to the variant with an additional `bool emitEvent` argument.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function _approve(address owner, address spender, uint256 value) internal {</span>
<span class="term-fg32">+        _approve(owner, spender, value, true);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Variant of {_approve} with an optional flag to enable or disable the {Approval} event.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * By default (when calling {_approve}) the flag is set to true. On the other hand, approval changes made by</span>
<span class="term-fg32">+     * `_spendAllowance` during the `transferFrom` operation set the flag to false. This saves gas by not emitting any</span>
<span class="term-fg32">+     * `Approval` event during `transferFrom` operations.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Anyone who wishes to continue emitting `Approval` events on the`transferFrom` operation can force the flag to</span>
<span class="term-fg32">+     * true using the following override:</span>
<span class="term-fg32">+     * ```</span>
<span class="term-fg32">+     * function _approve(address owner, address spender, uint256 value, bool) internal virtual override {</span>
<span class="term-fg32">+     *     super._approve(owner, spender, value, true);</span>
<span class="term-fg32">+     * }</span>
<span class="term-fg32">+     * ```</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Requirements are the same as {_approve}.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function _approve(address owner, address spender, uint256 value, bool emitEvent) internal virtual {</span>
<span class="term-fg32">+        if (owner == address(0)) {</span>
<span class="term-fg32">+            revert ERC20InvalidApprover(address(0));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        if (spender == address(0)) {</span>
<span class="term-fg32">+            revert ERC20InvalidSpender(address(0));</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+        _allowances[owner][spender] = value;</span>
<span class="term-fg32">+        if (emitEvent) {</span>
<span class="term-fg32">+            emit Approval(owner, spender, value);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;**</span>
<span class="term-fg32">+     * @dev Updates `owner` s allowance for `spender` based on spent `value`.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Does not update the allowance value in case of infinite allowance.</span>
<span class="term-fg32">+     * Revert if not enough allowance is available.</span>
<span class="term-fg32">+     *</span>
<span class="term-fg32">+     * Does not emit an {Approval} event.</span>
<span class="term-fg32">+     *&#47;</span>
<span class="term-fg32">+    function _spendAllowance(address owner, address spender, uint256 value) internal virtual {</span>
<span class="term-fg32">+        uint256 currentAllowance = allowance(owner, spender);</span>
<span class="term-fg32">+        if (currentAllowance != type(uint256).max) {</span>
<span class="term-fg32">+            if (currentAllowance &lt; value) {</span>
<span class="term-fg32">+                revert ERC20InsufficientAllowance(spender, currentAllowance, value);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+            unchecked {</span>
<span class="term-fg32">+                _approve(owner, spender, currentAllowance - value, false);</span>
<span class="term-fg32">+            }</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;**</span>
<span class="term-fg32">+ * @notice This interface should be implemented for tokens which are supposed to</span>
<span class="term-fg32">+ * act as fee currencies on the Celo blockchain, meaning that they can be</span>
<span class="term-fg32">+ * used to pay gas fees for CIP-64 transactions (and some older tx types).</span>
<span class="term-fg32">+ * See https:&#47;&#47;github.com&#47;celo-org&#47;celo-proposals&#47;blob&#47;master&#47;CIPs&#47;cip-0064.md</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * @notice Before executing a tx with non-empty `feeCurrency` field, the fee</span>
<span class="term-fg32">+ * currency&#39;s `debitGasFees` function is called to reserve the maximum</span>
<span class="term-fg32">+ * amount of gas token that tx can spend. After the tx has been executed, the</span>
<span class="term-fg32">+ * `creditGasFees` function is called to refund any unused gas and credit</span>
<span class="term-fg32">+ * the spent fees to the appropriate recipients. Events which are emitted in</span>
<span class="term-fg32">+ * these functions will show up for every tx using the token as a</span>
<span class="term-fg32">+ * fee currency.</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * @dev Requirements:</span>
<span class="term-fg32">+ * - The functions will be called by the blockchain client with `msg.sender</span>
<span class="term-fg32">+ * == address(0)`. If this condition is not met, the functions must</span>
<span class="term-fg32">+ * revert to prevent malicious users from crediting their accounts directly.</span>
<span class="term-fg32">+ * - `creditGasFees` must credit all specified amounts. If this is not</span>
<span class="term-fg32">+ * possible the functions must revert to prevent inconsistencies between</span>
<span class="term-fg32">+ * the debited and credited amounts.</span>
<span class="term-fg32">+ *</span>
<span class="term-fg32">+ * @dev Notes on compatibility:</span>
<span class="term-fg32">+ * - There are two versions of `creditGasFees`: one for the current</span>
<span class="term-fg32">+ * (2024-01-16) blockchain implementation and a more future-proof version</span>
<span class="term-fg32">+ * that omits deprecated fields and accommodates potential new recipients</span>
<span class="term-fg32">+ * that might become necessary on later blockchain implementations. Both</span>
<span class="term-fg32">+ * versions should be implemented to increase compatibility.</span>
<span class="term-fg32">+ *&#47;</span>
<span class="term-fg32">+interface IFeeCurrency is IERC20 {</span>
<span class="term-fg32">+    &#47;&#47;&#47; @notice Called before transaction execution to reserve the maximum amount of gas</span>
<span class="term-fg32">+    &#47;&#47;&#47; that can be used by the transaction.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - The implementation must deduct `value` from `from`&#39;s balance.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - Must revert if `msg.sender` is not the zero address.</span>
<span class="term-fg32">+    function debitGasFees(address from, uint256 value) external;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; @notice New function signature, will be used when all fee currencies have migrated.</span>
<span class="term-fg32">+    &#47;&#47;&#47; Credited amounts include gas refund, base fee and tip. Future additions</span>
<span class="term-fg32">+    &#47;&#47;&#47; may include L1 gas fee when Celo becomes and L2.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - The implementation must increase each `recipient`&#39;s balance by corresponding `amount`.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - Must revert if `msg.sender` is not the zero address.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - Must revert if `recipients` and `amounts` have different lengths.</span>
<span class="term-fg32">+    function creditGasFees(address[] calldata recipients, uint256[] calldata amounts) external;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47;&#47; @notice Old function signature for backwards compatibility</span>
<span class="term-fg32">+    &#47;&#47;&#47; - Must revert if `msg.sender` is not the zero address.</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `refundAmount` must be credited to `refundRecipient`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `tipAmount` must be credited to `tipRecipient`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `baseFeeAmount` must be credited to `baseFeeRecipient`</span>
<span class="term-fg32">+    &#47;&#47;&#47; - `_gatewayFeeRecipient` and `_gatewayFeeAmount` only exist for backwards</span>
<span class="term-fg32">+    &#47;&#47;&#47;   compatibility reasons and will always be zero.</span>
<span class="term-fg32">+    function creditGasFees(</span>
<span class="term-fg32">+        address refundRecipient,</span>
<span class="term-fg32">+        address tipRecipient,</span>
<span class="term-fg32">+        address _gatewayFeeRecipient,</span>
<span class="term-fg32">+        address baseFeeRecipient,</span>
<span class="term-fg32">+        uint256 refundAmount,</span>
<span class="term-fg32">+        uint256 tipAmount,</span>
<span class="term-fg32">+        uint256 _gatewayFeeAmount,</span>
<span class="term-fg32">+        uint256 baseFeeAmount</span>
<span class="term-fg32">+    ) external;</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+contract FeeCurrency is ERC20, IFeeCurrency {</span>
<span class="term-fg32">+    constructor(uint256 initialSupply) ERC20(&quot;ExampleFeeCurrency&quot;, &quot;EFC&quot;) {</span>
<span class="term-fg32">+        _mint(msg.sender, initialSupply);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    modifier onlyVm() {</span>
<span class="term-fg32">+        require(msg.sender == address(0), &quot;Only VM can call&quot;);</span>
<span class="term-fg32">+        _;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    function debitGasFees(address from, uint256 value) external onlyVm {</span>
<span class="term-fg32">+        _burn(from, value);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; New function signature, will be used when all fee currencies have migrated</span>
<span class="term-fg32">+    function creditGasFees(address[] calldata recipients, uint256[] calldata amounts) public onlyVm {</span>
<span class="term-fg32">+        require(recipients.length == amounts.length, &quot;Recipients and amounts must be the same length.&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for (uint256 i = 0; i &lt; recipients.length; i++) {</span>
<span class="term-fg32">+            _mint(recipients[i], amounts[i]);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; Old function signature for backwards compatibility</span>
<span class="term-fg32">+    function creditGasFees(</span>
<span class="term-fg32">+        address from,</span>
<span class="term-fg32">+        address feeRecipient,</span>
<span class="term-fg32">+        address, &#47;&#47; gatewayFeeRecipient, unused</span>
<span class="term-fg32">+        address communityFund,</span>
<span class="term-fg32">+        uint256 refund,</span>
<span class="term-fg32">+        uint256 tipTxFee,</span>
<span class="term-fg32">+        uint256, &#47;&#47; gatewayFee, unused</span>
<span class="term-fg32">+        uint256 baseTxFee</span>
<span class="term-fg32">+    ) public onlyVm {</span>
<span class="term-fg32">+        &#47;&#47; Calling the new creditGasFees would make sense here, but that is not</span>
<span class="term-fg32">+        &#47;&#47; possible due to its calldata arguments.</span>
<span class="term-fg32">+        _mint(from, refund);</span>
<span class="term-fg32">+        _mint(feeRecipient, tipTxFee);</span>
<span class="term-fg32">+        _mint(communityFund, baseTxFee);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+contract DebugFeeCurrency is ERC20, IFeeCurrency {</span>
<span class="term-fg32">+    bool failOnDebit;</span>
<span class="term-fg32">+    bool failOnCredit;</span>
<span class="term-fg32">+    bool highGasOnCredit;</span>
<span class="term-fg32">+    mapping(uint256 =&gt; uint256) private _dummyMap;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    constructor(uint256 initialSupply, bool _failOnDebit, bool _failOnCredit, bool _highGasOnCredit) ERC20(&quot;DebugFeeCurrency&quot;, &quot;DFC&quot;) {</span>
<span class="term-fg32">+        _mint(msg.sender, initialSupply);</span>
<span class="term-fg32">+        failOnDebit = _failOnDebit;</span>
<span class="term-fg32">+        failOnCredit = _failOnCredit;</span>
<span class="term-fg32">+        highGasOnCredit = _highGasOnCredit;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    modifier onlyVm() {</span>
<span class="term-fg32">+        require(msg.sender == address(0), &quot;Only VM can call&quot;);</span>
<span class="term-fg32">+        _;</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    function debitGasFees(address from, uint256 value) external onlyVm {</span>
<span class="term-fg32">+        require(!failOnDebit, &quot;This DebugFeeCurrency always fails in debitGasFees!&quot;);</span>
<span class="term-fg32">+        _burn(from, value);</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; New function signature, will be used when all fee currencies have migrated</span>
<span class="term-fg32">+    function creditGasFees(address[] calldata recipients, uint256[] calldata amounts) public onlyVm {</span>
<span class="term-fg32">+        require(!failOnCredit, &quot;This DebugFeeCurrency always fails in (new) creditGasFees!&quot;);</span>
<span class="term-fg32">+        require(recipients.length == amounts.length, &quot;Recipients and amounts must be the same length.&quot;);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        for (uint256 i = 0; i &lt; recipients.length; i++) {</span>
<span class="term-fg32">+            _mint(recipients[i], amounts[i]);</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if (highGasOnCredit){</span>
<span class="term-fg32">+            induceHighGasCost();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    function induceHighGasCost() internal view  {</span>
<span class="term-fg32">+        &#47;&#47; SLOAD for non existing touched_storage_slots</span>
<span class="term-fg32">+        &#47;&#47; 2100 * 3000 gas = 630.0000</span>
<span class="term-fg32">+        for (uint256 i = 0; i &lt; 3000; i++) {</span>
<span class="term-fg32">+            _dummyMap[i];</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+    &#47;&#47; Old function signature for backwards compatibility</span>
<span class="term-fg32">+    function creditGasFees(</span>
<span class="term-fg32">+        address from,</span>
<span class="term-fg32">+        address feeRecipient,</span>
<span class="term-fg32">+        address, &#47;&#47; gatewayFeeRecipient, unused</span>
<span class="term-fg32">+        address communityFund,</span>
<span class="term-fg32">+        uint256 refund,</span>
<span class="term-fg32">+        uint256 tipTxFee,</span>
<span class="term-fg32">+        uint256, &#47;&#47; gatewayFee, unused</span>
<span class="term-fg32">+        uint256 baseTxFee</span>
<span class="term-fg32">+    ) public onlyVm {</span>
<span class="term-fg32">+        require(!failOnCredit, &quot;This DebugFeeCurrency always fails in (old) creditGasFees!&quot;);</span>
<span class="term-fg32">+        &#47;&#47; Calling the new creditGasFees would make sense here, but that is not</span>
<span class="term-fg32">+        &#47;&#47; possible due to its calldata arguments.</span>
<span class="term-fg32">+        _mint(from, refund);</span>
<span class="term-fg32">+        _mint(feeRecipient, tipTxFee);</span>
<span class="term-fg32">+        _mint(communityFund, baseTxFee);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        if (highGasOnCredit){</span>
<span class="term-fg32">+            induceHighGasCost();</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5003f993cf7ca6ffd431fa51" role="button"
                       aria-expanded="false" aria-controls="id-5003f993cf7ca6ffd431fa51">
                        <code>e2e_test/debug-fee-currency/deploy_and_send_tx.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/debug-fee-currency/deploy_and_send_tx.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5003f993cf7ca6ffd431fa51"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;debug-fee-currency&#47;deploy_and_send_tx.sh CELO&#47;e2e_test&#47;debug-fee-currency&#47;deploy_and_send_tx.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1cfd9eec73c188914306b9e19df645f0618b7c5b</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;debug-fee-currency&#47;deploy_and_send_tx.sh</span>
<span class="term-fg36">@@ -0,0 +1,13 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+#shellcheck disable=SC2034,SC2155,SC2086</span>
<span class="term-fg32">+set -xeo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+export FEE_CURRENCY=$(\</span>
<span class="term-fg32">+	forge create --root . --contracts . --private-key $ACC_PRIVKEY DebugFeeCurrency.sol:DebugFeeCurrency --constructor-args &#39;100000000000000000000000000&#39; $1 $2 $3 --json\</span>
<span class="term-fg32">+	| jq .deployedTo -r)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+cast send --private-key $ACC_PRIVKEY $ORACLE3 &#39;setExchangeRate(address, uint256, uint256)&#39; $FEE_CURRENCY 2ether 1ether</span>
<span class="term-fg32">+cast send --private-key $ACC_PRIVKEY $FEE_CURRENCY_DIRECTORY_ADDR &#39;setCurrencyConfig(address, address, uint256)&#39; $FEE_CURRENCY $ORACLE3 60000</span>
<span class="term-fg32">+echo Fee currency: $FEE_CURRENCY</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+(cd ..&#47;js-tests&#47; &amp;&amp; .&#47;send_tx.mjs &quot;$(cast chain-id)&quot; $ACC_PRIVKEY $FEE_CURRENCY)</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-15eb09c319e4724302b65bc3" role="button"
                       aria-expanded="false" aria-controls="id-15eb09c319e4724302b65bc3">
                        <code>e2e_test/js-tests/Makefile</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/js-tests/Makefile" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-15eb09c319e4724302b65bc3"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;js-tests&#47;Makefile CELO&#47;e2e_test&#47;js-tests&#47;Makefile</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..69555e594b4419c7c012ddc56d5403d88f4cd142</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;js-tests&#47;Makefile</span>
<span class="term-fg36">@@ -0,0 +1,2 @@</span>
<span class="term-fg32">+format:</span>
<span class="term-fg32">+	npx @biomejs&#47;biome format --write .</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-80ae5ab2c2290f79427bee03" role="button"
                       aria-expanded="false" aria-controls="id-80ae5ab2c2290f79427bee03">
                        <code>e2e_test/js-tests/package-lock.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/js-tests/package-lock.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1109</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-80ae5ab2c2290f79427bee03"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;js-tests&#47;package-lock.json CELO&#47;e2e_test&#47;js-tests&#47;package-lock.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e9d3322a249d2178182cfe11c5742afe1e7432d0</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;js-tests&#47;package-lock.json</span>
<span class="term-fg36">@@ -0,0 +1,1109 @@</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+  &quot;name&quot;: &quot;js-tests&quot;,</span>
<span class="term-fg32">+  &quot;version&quot;: &quot;1.0.0&quot;,</span>
<span class="term-fg32">+  &quot;lockfileVersion&quot;: 3,</span>
<span class="term-fg32">+  &quot;requires&quot;: true,</span>
<span class="term-fg32">+  &quot;packages&quot;: {</span>
<span class="term-fg32">+    &quot;&quot;: {</span>
<span class="term-fg32">+      &quot;name&quot;: &quot;js-tests&quot;,</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.0.0&quot;,</span>
<span class="term-fg32">+      &quot;license&quot;: &quot;MIT&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;chai&quot;: &quot;^5.0.0&quot;,</span>
<span class="term-fg32">+        &quot;ethers&quot;: &quot;^6.10.0&quot;,</span>
<span class="term-fg32">+        &quot;mocha&quot;: &quot;^10.2.0&quot;,</span>
<span class="term-fg32">+        &quot;viem&quot;: &quot;^2.9.6&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;@adraffy&#47;ens-normalize&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.10.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;@adraffy&#47;ens-normalize&#47;-&#47;ens-normalize-1.10.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-nA9XHtlAkYfJxY7bce8DcN7eKxWWCWkU+1GR9d+U6MbNpfwQp8TI7vqOsBsMcHoT4mBu2kypKoSKnghEzOOq5Q==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;@noble&#47;curves&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.2.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;@noble&#47;curves&#47;-&#47;curves-1.2.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-oYclrNgRaM9SsBUBVbb8M6DTV7ZHRTKugureoYEncY5c65HOmRzvSiTE3y5CYaPYJA&#47;GVkrhXEoF0M3Ya9PMnw==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;@noble&#47;hashes&quot;: &quot;1.3.2&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;paulmillr.com&#47;funding&#47;&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;@noble&#47;hashes&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.3.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;@noble&#47;hashes&#47;-&#47;hashes-1.3.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-MVC8EAQp7MvEcm30KWENFjgR+Mkmf+D189XJTkFIlwohU5hcBbn1ZkKq7KVTi2Hme3PMGF390DaL52beVrIihQ==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;= 16&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;paulmillr.com&#47;funding&#47;&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;@scure&#47;base&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.1.5&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;@scure&#47;base&#47;-&#47;base-1.1.5.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-Brj9FiG2W1MRQSTB212YVPRrcbjkv48FoZi&#47;u4l&#47;zds&#47;ieRrqsh7aUf6CLwkAq61oKXr&#47;ZlTzlY66gLIj3TFTQ==&quot;,</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;paulmillr.com&#47;funding&#47;&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;@scure&#47;bip32&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.3.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;@scure&#47;bip32&#47;-&#47;bip32-1.3.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-N1ZhksgwD3OBlwTv3R6KFEcPojl&#47;W4ElJOeCZdi+vuI5QmTFwLq3OFf2zd2ROpKvxFdgZ6hUpb0dx9bVNEwYCA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;@noble&#47;curves&quot;: &quot;~1.2.0&quot;,</span>
<span class="term-fg32">+        &quot;@noble&#47;hashes&quot;: &quot;~1.3.2&quot;,</span>
<span class="term-fg32">+        &quot;@scure&#47;base&quot;: &quot;~1.1.2&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;paulmillr.com&#47;funding&#47;&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;@scure&#47;bip39&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.2.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;@scure&#47;bip39&#47;-&#47;bip39-1.2.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-Z3&#47;Fsz1yr904dduJD0NpiyRHhRYHdcnyh73FZWiV+&#47;qhWi83wNJ3NWolYqCEN+ZWsUz2TWwajJggcRE9r1zUYg==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;@noble&#47;hashes&quot;: &quot;~1.3.0&quot;,</span>
<span class="term-fg32">+        &quot;@scure&#47;base&quot;: &quot;~1.1.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;paulmillr.com&#47;funding&#47;&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;@types&#47;node&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;18.15.13&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;@types&#47;node&#47;-&#47;node-18.15.13.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-N+0kuo9KgrUQ1Sn&#47;ifDXsvg0TTleP7rIy4zOBGECxAljqvqfqpTfzx0Q1NUedOixRMBfe2Whhb056a42cWs26Q==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;abitype&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;abitype&#47;-&#47;abitype-1.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-NMeMah&#47;&#47;6bJ56H5XRj8QCV4AwuW6hB6zqz2LnhhLdcWVQOsXki6&#47;Pn3APeqxCma62nXIcmZWdu1DlHWS74umVQ==&quot;,</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;wevm&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependencies&quot;: {</span>
<span class="term-fg32">+        &quot;typescript&quot;: &quot;&gt;=5.0.4&quot;,</span>
<span class="term-fg32">+        &quot;zod&quot;: &quot;^3 &gt;=3.22.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependenciesMeta&quot;: {</span>
<span class="term-fg32">+        &quot;typescript&quot;: {</span>
<span class="term-fg32">+          &quot;optional&quot;: true</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        &quot;zod&quot;: {</span>
<span class="term-fg32">+          &quot;optional&quot;: true</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;aes-js&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.0.0-beta.5&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;aes-js&#47;-&#47;aes-js-4.0.0-beta.5.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-G965FqalsNyrPqgEGON7nIx1e&#47;OVENSgiEIzyC63haUMuvNnwIgIjMs52hlTCKhkBny7A2ORNlfY9Zu+jmGk1Q==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;ansi-colors&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.1.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;ansi-colors&#47;-&#47;ansi-colors-4.1.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-JoX0apGbHaUJBNl6yF+p6JAFYZ666&#47;hhCGKN5t9QFjbJQKUU&#47;g8MNbFDbvfrgKXvI1QpZplPOnwIo99lX&#47;AAmA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=6&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;ansi-regex&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;ansi-regex&#47;-&#47;ansi-regex-5.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-quJQXlTSUGL2LH9SUXo8VwsY4soanhgo6LNSm84E1LBcE8s3O0wpdiRzyR9z&#47;ZZJMlMWv37qOOb9pdJlMUEKFQ==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;ansi-styles&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.3.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;ansi-styles&#47;-&#47;ansi-styles-4.3.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-zbB9rCJAT1rbjiVDb2hqKFHNYLxgtk8NURxZ3IZwD3F6NtxbXZQCnnSi1Lkx+IDohdPlFp222wVALIheZJQSEg==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;color-convert&quot;: &quot;^2.0.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;chalk&#47;ansi-styles?sponsor=1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;anymatch&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.1.3&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;anymatch&#47;-&#47;anymatch-3.1.3.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-KMReFUr0B4t+D+OBkjR3KYqvocp2XaSzO55UcB6mgQMd3KbcE+mWTyvVV7D&#47;zsdEbNnV6acZUutkiHQXvTr1Rw==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;normalize-path&quot;: &quot;^3.0.0&quot;,</span>
<span class="term-fg32">+        &quot;picomatch&quot;: &quot;^2.0.4&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;= 8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;argparse&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;argparse&#47;-&#47;argparse-2.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-8+9WqebbFzpX9OR+Wa6O29asIogeRMzcGtAINdpMHHyAg10f05aSFVBbcEqGf&#47;PXw1EjAZ+q2&#47;bEBg3DvurK3Q==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;assertion-error&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;assertion-error&#47;-&#47;assertion-error-2.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-Izi8RQcffqCeNVgFigKli1ssklIbpHnCYc6AknXGYoB6grJqyeby7jv12JUQgmTAnIDnbck1uxksT4dzN3PWBA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=12&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;balanced-match&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.0.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;balanced-match&#47;-&#47;balanced-match-1.0.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-3oSeUO0TMV67hN1AmbXsK4yaqU7tjiHlbxRDZOpH0KW9+CeX4bRAaX0Anxt0tx2MrpRpWwQaPwIlISEJhYU5Pw==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;binary-extensions&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.2.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;binary-extensions&#47;-&#47;binary-extensions-2.2.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-jDctJ&#47;IVQbZoJykoeHbhXpOlNBqGNcwXJKJog42E5HDPUwQTSdjCHdihjj0DlnheQ7blbT6dHOafNAiS8ooQKA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;brace-expansion&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;brace-expansion&#47;-&#47;brace-expansion-2.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-XnAIvQ8eM+kC6aULx6wuQiwVsnzsi9d3WxzV3FpWTGA19F621kwdbsAcFKXgKUHZWsy+mY6iL1sHTxWEFCytDA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;balanced-match&quot;: &quot;^1.0.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;braces&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.0.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;braces&#47;-&#47;braces-3.0.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-b8um+L1RzM3WDSzvhm6gIz1yfTbBt6YTlcEKAvsmqCZZFw46z626lVj9j1yEPW33H5H+lBQpZMP1k8l+78Ha0A==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;fill-range&quot;: &quot;^7.0.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;browser-stdout&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.3.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;browser-stdout&#47;-&#47;browser-stdout-1.3.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-qhAVI1+Av2X7qelOfAIYwXONood6XlZE&#47;fXaBSmW&#47;T5SzLAmCgzi+eiWE7fUvbHaeNBQH13UftjpXxsfLkMpgw==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;camelcase&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;6.3.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;camelcase&#47;-&#47;camelcase-6.3.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-Gmy6FhYlCY7uOElZUSbxo2UCDH8owEk996gkbrpsgGtrJLM3J7jGxl9Ic7Qwwj4ivOE5AWZWRMecDdF7hqGjFA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;chai&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;chai&#47;-&#47;chai-5.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-HO5p0oEKd5M6HEcwOkNAThAE3j960vIZvVcc0t2tI06Dd0ATu69cEnMB2wOhC5&#47;ZyQ6m67w3ePjU&#47;HzXsSsdBA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;assertion-error&quot;: &quot;^2.0.1&quot;,</span>
<span class="term-fg32">+        &quot;check-error&quot;: &quot;^2.0.0&quot;,</span>
<span class="term-fg32">+        &quot;deep-eql&quot;: &quot;^5.0.1&quot;,</span>
<span class="term-fg32">+        &quot;loupe&quot;: &quot;^3.0.0&quot;,</span>
<span class="term-fg32">+        &quot;pathval&quot;: &quot;^2.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=12&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;chalk&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.1.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;chalk&#47;-&#47;chalk-4.1.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-oKnbhFyRIXpUuez8iBMmyEa4nbj4IOQyuhc&#47;wy9kY7&#47;WVPcwIO9VA668Pu8RkO7+0G76SLROeyw9CpQ061i4mA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;ansi-styles&quot;: &quot;^4.1.0&quot;,</span>
<span class="term-fg32">+        &quot;supports-color&quot;: &quot;^7.1.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;chalk&#47;chalk?sponsor=1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;chalk&#47;node_modules&#47;supports-color&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;7.2.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;supports-color&#47;-&#47;supports-color-7.2.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-qpCAvRl9stuOHveKsn7HncJRvv501qIacKzQlO&#47;+Lwxc9+0q2wLyv4Dfvt80&#47;DPn2pqOBsJdDiogXGR9+OvwRw==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;has-flag&quot;: &quot;^4.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;check-error&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;check-error&#47;-&#47;check-error-2.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-tjLAOBHKVxtPoHe&#47;SA7kNOMvhCRdCJ3vETdeY0RuAc9popf+hyaSV6ZEg9hr4cpWF7jmo&#47;JSWEnLDrnijS9Tog==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;= 16&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;chokidar&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.5.3&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;chokidar&#47;-&#47;chokidar-3.5.3.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-Dr3sfKRP6oTcjf2JmUmFJfeVMvXBdegxB0iVQ5eb2V10uFJUCAS8OByZdVAyVb8xXNz3GjjTgj9kLWsZTqE6kw==&quot;,</span>
<span class="term-fg32">+      &quot;funding&quot;: [</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;type&quot;: &quot;individual&quot;,</span>
<span class="term-fg32">+          &quot;url&quot;: &quot;https:&#47;&#47;paulmillr.com&#47;funding&#47;&quot;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      ],</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;anymatch&quot;: &quot;~3.1.2&quot;,</span>
<span class="term-fg32">+        &quot;braces&quot;: &quot;~3.0.2&quot;,</span>
<span class="term-fg32">+        &quot;glob-parent&quot;: &quot;~5.1.2&quot;,</span>
<span class="term-fg32">+        &quot;is-binary-path&quot;: &quot;~2.1.0&quot;,</span>
<span class="term-fg32">+        &quot;is-glob&quot;: &quot;~4.0.1&quot;,</span>
<span class="term-fg32">+        &quot;normalize-path&quot;: &quot;~3.0.0&quot;,</span>
<span class="term-fg32">+        &quot;readdirp&quot;: &quot;~3.6.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;= 8.10.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;optionalDependencies&quot;: {</span>
<span class="term-fg32">+        &quot;fsevents&quot;: &quot;~2.3.2&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;cliui&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;7.0.4&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;cliui&#47;-&#47;cliui-7.0.4.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-OcRE68cOsVMXp1Yvonl&#47;fzkQOyjLSu&#47;8bhPDfQt0e0&#47;Eb283TKP20Fs2MqoPsr9SwA595rRCA+QMzYc9nBP+JQ==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;string-width&quot;: &quot;^4.2.0&quot;,</span>
<span class="term-fg32">+        &quot;strip-ansi&quot;: &quot;^6.0.0&quot;,</span>
<span class="term-fg32">+        &quot;wrap-ansi&quot;: &quot;^7.0.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;color-convert&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;color-convert&#47;-&#47;color-convert-2.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-RRECPsj7iu&#47;xb5oKYcsFHSppFNnsj&#47;52OVTRKb4zP5onXwVF3zVmmToNcOfGC+CRDpfK&#47;U584fMg38ZHCaElKQ==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;color-name&quot;: &quot;~1.1.4&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=7.0.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;color-name&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.1.4&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;color-name&#47;-&#47;color-name-1.1.4.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-dOy+3AuW3a2wNbZHIuMZpTcgjGuLU&#47;uBL&#47;ubcZF9OXbDo8ff4O8yVp5Bf0efS8uEoYo5q4Fx7dY9OgQGXgAsQA==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;concat-map&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;0.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;concat-map&#47;-&#47;concat-map-0.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-&#47;Srv4dswyQNBfohGpz9o6Yb3Gz3SrUDqBH5rTuhGR7ahtlbYKnVxw2bCFMRljaA7EXHaXZ8wsHdodFvbkhKmqg==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;debug&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.3.4&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;debug&#47;-&#47;debug-4.3.4.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-PRWFHuSU3eDtQJPvnNY7Jcket1j0t5OuOsFzPPzsekD52Zl8qUfFIPEiswXqIvHWGVHOgX+7G&#47;vCNNhehwxfkQ==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;ms&quot;: &quot;2.1.2&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=6.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependenciesMeta&quot;: {</span>
<span class="term-fg32">+        &quot;supports-color&quot;: {</span>
<span class="term-fg32">+          &quot;optional&quot;: true</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;debug&#47;node_modules&#47;ms&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.1.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;ms&#47;-&#47;ms-2.1.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-sGkPx+VjMtmA6MX27oA4FBFELFCZZ4S4XqeGOXCv68tT+jb3vk&#47;RyaKWP0PTKyWtmLSM0b+adUTEvbs1PEaH2w==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;decamelize&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;decamelize&#47;-&#47;decamelize-4.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-9iE1PgSik9HeIIw2JO94IidnE3eBoQrFJ3w7sFuzSX4DpmZ3v5sZpUiV5Swcf6mQEF+Y0ru8Neo+p+nyh2J+hQ==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;deep-eql&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;deep-eql&#47;-&#47;deep-eql-5.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-nwQCf6ne2gez3o1MxWifqkciwt0zhl0LO1&#47;UwVu4uMBuPmflWM4oQ70XMqHqnBJA+nhzncaqL9HVL6KkHJ28lw==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=6&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;diff&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;diff&#47;-&#47;diff-5.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-&#47;VTCrvm5Z0JGty&#47;BWHljh+BAiw3IK+2j87NGMu8Nwc&#47;f48WoDAC395uomO9ZD117ZOBaHmkX1oyLvkVM&#47;aIT3w==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=0.3.1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;emoji-regex&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;8.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;emoji-regex&#47;-&#47;emoji-regex-8.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-MSjYzcWNOA0ewAHpz0MxpYFvwg6yjy1NG3xteoqz644VCo&#47;RPgnr1&#47;GGt+ic3iJTzQ8Eu3TdM14SawnVUmGE6A==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;escalade&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.1.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;escalade&#47;-&#47;escalade-3.1.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-k0er2gUkLf8O0zKJiAhmkTnJlTvINGv7ygDNPbeIsX&#47;TJjGJZHuh9B2UxbsaEkmlEo9MfhrSzmhIlhRlI2GXnw==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=6&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;escape-string-regexp&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;escape-string-regexp&#47;-&#47;escape-string-regexp-4.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-TtpcNJ3XAzx3Gq8sWRzJaVajRs0uVxA2YAkdb1jm2YkPz4G6egUFAyA3n5vtEIZefPk5Wa4UXbKuS5fKkJWdgA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;ethers&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;6.10.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;ethers&#47;-&#47;ethers-6.10.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-nMNwYHzs6V1FR3Y4cdfxSQmNgZsRj1RiTU25JwvnJLmyzw9z3SKxNc2XKDuiXXo&#47;v9ds5Mp9m6HBabgYQQ26tA==&quot;,</span>
<span class="term-fg32">+      &quot;funding&quot;: [</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;type&quot;: &quot;individual&quot;,</span>
<span class="term-fg32">+          &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;ethers-io&#47;&quot;</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;type&quot;: &quot;individual&quot;,</span>
<span class="term-fg32">+          &quot;url&quot;: &quot;https:&#47;&#47;www.buymeacoffee.com&#47;ricmoo&quot;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      ],</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;@adraffy&#47;ens-normalize&quot;: &quot;1.10.0&quot;,</span>
<span class="term-fg32">+        &quot;@noble&#47;curves&quot;: &quot;1.2.0&quot;,</span>
<span class="term-fg32">+        &quot;@noble&#47;hashes&quot;: &quot;1.3.2&quot;,</span>
<span class="term-fg32">+        &quot;@types&#47;node&quot;: &quot;18.15.13&quot;,</span>
<span class="term-fg32">+        &quot;aes-js&quot;: &quot;4.0.0-beta.5&quot;,</span>
<span class="term-fg32">+        &quot;tslib&quot;: &quot;2.4.0&quot;,</span>
<span class="term-fg32">+        &quot;ws&quot;: &quot;8.5.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=14.0.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;fill-range&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;7.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;fill-range&#47;-&#47;fill-range-7.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-qOo9F+dMUmC2Lcb4BbVvnKJxTPjCm+RRpe4gDuGrzkL7mEVl&#47;djYSu2OdQ2Pa302N4oqkSg9ir6jaLWJ2USVpQ==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;to-regex-range&quot;: &quot;^5.0.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;find-up&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;find-up&#47;-&#47;find-up-5.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-78&#47;PXT1wlLLDgTzDs7sjq9hzz0vXD+zn+7wypEe4fXQxCmdmqfGsEPQxmiCSQI3ajFV91bVSsvNtrJRiW6nGng==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;locate-path&quot;: &quot;^6.0.0&quot;,</span>
<span class="term-fg32">+        &quot;path-exists&quot;: &quot;^4.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;flat&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;flat&#47;-&#47;flat-5.0.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-b6suED+5&#47;3rTpUBdG1gupIl8MPFCAMA0QXwmljLhvCUKcUvdE4gWky9zpuGCcXHOsz4J9wPGNWq6OKpmIzz3hQ==&quot;,</span>
<span class="term-fg32">+      &quot;bin&quot;: {</span>
<span class="term-fg32">+        &quot;flat&quot;: &quot;cli.js&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;fs.realpath&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;fs.realpath&#47;-&#47;fs.realpath-1.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-OO0pH2lK6a0hZnAdau5ItzHPI6pUlvI7jMVnxUQRtw4owF2wk8lOSabtGDCTP4Ggrg2MbGnWO9X8K1t4+fGMDw==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;fsevents&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.3.3&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;fsevents&#47;-&#47;fsevents-2.3.3.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-5xoDfX+fL7faATnagmWPpbFtwh&#47;R77WmMMqqHGS65C3vvB0YHrgF+B1YmZ3441tMj5n63k0212XNoJwzlhffQw==&quot;,</span>
<span class="term-fg32">+      &quot;hasInstallScript&quot;: true,</span>
<span class="term-fg32">+      &quot;optional&quot;: true,</span>
<span class="term-fg32">+      &quot;os&quot;: [</span>
<span class="term-fg32">+        &quot;darwin&quot;</span>
<span class="term-fg32">+      ],</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;^8.16.0 || ^10.6.0 || &gt;=11.0.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;get-caller-file&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.5&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;get-caller-file&#47;-&#47;get-caller-file-2.0.5.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-DyFP3BM&#47;3YHTQOCUL&#47;w0OZHR0lpKeGrxotcHWcqNEdnltqFwXVfhEBQ94eIo34AfQpo0rGki4cyIiftY06h2Fg==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;6.* || 8.* || &gt;= 10.*&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;get-func-name&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;get-func-name&#47;-&#47;get-func-name-2.0.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-8vXOvuE167CtIc3OyItco7N&#47;dpRtBbYOsPsXCz7X&#47;PMnlGjYjSGuZJgM1Y7mmew7BKf9BqvLX2tnOVy1BBUsxQ==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;*&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;glob&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;7.2.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;glob&#47;-&#47;glob-7.2.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-lmLf6gtyrPq8tTjSmrO94wBeQbFR3HbLHbuyD69wuyQkImp2hWqMGB47OX65FBkPffO641IP9jWa1z4ivqG26Q==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;fs.realpath&quot;: &quot;^1.0.0&quot;,</span>
<span class="term-fg32">+        &quot;inflight&quot;: &quot;^1.0.4&quot;,</span>
<span class="term-fg32">+        &quot;inherits&quot;: &quot;2&quot;,</span>
<span class="term-fg32">+        &quot;minimatch&quot;: &quot;^3.0.4&quot;,</span>
<span class="term-fg32">+        &quot;once&quot;: &quot;^1.3.0&quot;,</span>
<span class="term-fg32">+        &quot;path-is-absolute&quot;: &quot;^1.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;*&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;isaacs&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;glob-parent&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.1.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;glob-parent&#47;-&#47;glob-parent-5.1.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-AOIgSQCepiJYwP3ARnGx+5VnTu2HBYdzbGP45eLw1vr3zB3vZLeyed1sC9hnbcOc9&#47;SrMyM5RPQrkGz4aS9Zow==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;is-glob&quot;: &quot;^4.0.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;= 6&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;glob&#47;node_modules&#47;brace-expansion&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.1.11&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;brace-expansion&#47;-&#47;brace-expansion-1.1.11.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-iCuPHDFgrHX7H2vEI&#47;5xpz07zSHB00TpugqhmYtVmMO6518mCuRMoOYFldEBl0g187ufozdaHgWKcYFb61qGiA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;balanced-match&quot;: &quot;^1.0.0&quot;,</span>
<span class="term-fg32">+        &quot;concat-map&quot;: &quot;0.0.1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;glob&#47;node_modules&#47;minimatch&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.1.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;minimatch&#47;-&#47;minimatch-3.1.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-J7p63hRiAjw1NDEww1W7i37+ByIrOWO5XQQAzZ3VOcL0PNybwpfmV&#47;N05zFAzwQ9USyEcX6t3UO+K5aqBQOIHw==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;brace-expansion&quot;: &quot;^1.1.7&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;*&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;has-flag&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;has-flag&#47;-&#47;has-flag-4.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-EykJT&#47;Q1KjTWctppgIAgfSO0tKVuZUjhgMr17kqTumMl6Afv3EISleU7qZUzoXDFTAHTDC4NOoG&#47;ZxU3EvlMPQ==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;he&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.2.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;he&#47;-&#47;he-1.2.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-F&#47;1DnUGPopORZi0ni+CvrCgHQ5FyEAHRLSApuYWMmrbSwoN2Mn&#47;7k+Gl38gJnR7yyDZk6WLXwiGod1JOWNDKGw==&quot;,</span>
<span class="term-fg32">+      &quot;bin&quot;: {</span>
<span class="term-fg32">+        &quot;he&quot;: &quot;bin&#47;he&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;inflight&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.0.6&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;inflight&#47;-&#47;inflight-1.0.6.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-k92I&#47;b08q4wvFscXCLvqfsHCrjrF7yiXsQuIVvVE7N82W3+aqpzuUdBbfhWcy&#47;FZR3&#47;4IgflMgKLOsvPDrGCJA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;once&quot;: &quot;^1.3.0&quot;,</span>
<span class="term-fg32">+        &quot;wrappy&quot;: &quot;1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;inherits&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.4&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;inherits&#47;-&#47;inherits-2.0.4.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-k&#47;vGaX4&#47;Yla3WzyMCvTQOXYeIHvqOKtnqBduzTHpzpQZzAskKMhZ2K+EnBiSM9zGSoIFeMpXKxa4dYeZIQqewQ==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;is-binary-path&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;is-binary-path&#47;-&#47;is-binary-path-2.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-ZMERYes6pDydyuGidse7OsHxtbI7WVeUEozgR&#47;g7rd0xUimYNlvZRE&#47;K2MgZTjWy725IfelLeVcEM97mmtRGXw==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;binary-extensions&quot;: &quot;^2.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;is-extglob&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.1.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;is-extglob&#47;-&#47;is-extglob-2.1.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-SbKbANkN603Vi4jEZv49LeVJMn4yGwsbzZworEoyEiutsN3nJYdbO36zfhGJ6QEDpOZIFkDtnq5JRxmvl3jsoQ==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=0.10.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;is-fullwidth-code-point&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;is-fullwidth-code-point&#47;-&#47;is-fullwidth-code-point-3.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-zymm5+u+sCsSWyD9qNaejV3DFvhCKclKdizYaJUuHA83RLjb7nSuGnddCHGv0hk+KY7BMAlsWeK4Ueg6EV6XQg==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;is-glob&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.0.3&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;is-glob&#47;-&#47;is-glob-4.0.3.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-xelSayHH36ZgE7ZWhli7pW34hNbNl8Ojv5KVmkJD4hBdD3th8Tfk9vYasLM+mXWOZhFkgZfxhLSnrwRr4elSSg==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;is-extglob&quot;: &quot;^2.1.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=0.10.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;is-number&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;7.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;is-number&#47;-&#47;is-number-7.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-41Cifkg6e8TylSpdtTpeLVMqvSBEVzTttHvERD741+pnZ8ANv0004MRL43QKPDlK9cGvNp6NZWZUBlbGXYxxng==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=0.12.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;is-plain-obj&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;is-plain-obj&#47;-&#47;is-plain-obj-2.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-YWnfyRwxL&#47;+SsrWYfOpUtz5b3YD+nyfkHvjbcanzk8zgyO4ASD67uVMRt8k5bM4lLMDnXfriRhOpemw+NfT1eA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;is-unicode-supported&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;0.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;is-unicode-supported&#47;-&#47;is-unicode-supported-0.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-knxG2q4UC3u8stRGyAVJCOdxFmv5DZiRcdlIaAQXAbSfJya+OhopNotLQrstBhququ4ZpuKbDc&#47;8S6mgXgPFPw==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;isows&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.0.3&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;isows&#47;-&#47;isows-1.0.3.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-2cKei4vlmg2cxEjm3wVSqn8pcoRF&#47;LX&#47;wpifuuNquFO4SQmPwarClT+SUCA2lt+l581tTeZIPIZuIDo2jWN1fg==&quot;,</span>
<span class="term-fg32">+      &quot;funding&quot;: [</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;type&quot;: &quot;github&quot;,</span>
<span class="term-fg32">+          &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;wagmi-dev&quot;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      ],</span>
<span class="term-fg32">+      &quot;peerDependencies&quot;: {</span>
<span class="term-fg32">+        &quot;ws&quot;: &quot;*&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;js-yaml&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;js-yaml&#47;-&#47;js-yaml-4.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-wpxZs9NoxZaJESJGIZTyDEaYpl0FKSA+FB9aJiyemKhMwkxQg63h4T1KJgUGHpTqPDNRcmmYLugrRjJlBtWvRA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;argparse&quot;: &quot;^2.0.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;bin&quot;: {</span>
<span class="term-fg32">+        &quot;js-yaml&quot;: &quot;bin&#47;js-yaml.js&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;locate-path&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;6.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;locate-path&#47;-&#47;locate-path-6.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-iPZK6eYjbxRu3uB4&#47;WZ3EsEIMJFMqAoopl3R+zuq0UjcAm&#47;MO6KCweDgPfP3elTztoKP3KtnVHxTn2NHBSDVUw==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;p-locate&quot;: &quot;^5.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;log-symbols&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;log-symbols&#47;-&#47;log-symbols-4.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-8XPvpAA8uyhfteu8pIvQxpJZ7SYYdpUivZpGy6sFsBuKRY&#47;7rQGavedeB8aK+Zkyq6upMFVL&#47;9AW6vOYzfRyLg==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;chalk&quot;: &quot;^4.1.0&quot;,</span>
<span class="term-fg32">+        &quot;is-unicode-supported&quot;: &quot;^0.1.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;loupe&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;loupe&#47;-&#47;loupe-3.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-qKl+FrLXUhFuHUoDJG7f8P8gEMHq9NFS0c6ghXG1J0rldmZFQZoNVv&#47;vyirE9qwCIhWZDsvEFd1sbFu3GvRQFg==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;get-func-name&quot;: &quot;^2.0.1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;minimatch&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;minimatch&#47;-&#47;minimatch-5.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-nLDxIFRyhDblz3qMuq+SoRZED4+miJ&#47;G+tdDrjkkkRnjAsBexeGpgjLEQ0blJy7rHhR2b93rhQY4SvyWu9v03g==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;brace-expansion&quot;: &quot;^2.0.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;mocha&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;10.2.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;mocha&#47;-&#47;mocha-10.2.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-IDY7fl&#47;BecMwFHzoqF2sg&#47;SHHANeBoMMXFlS9r0OXKDssYE1M5O43wUY&#47;9BVPeIvfH2zmEbBfseqN9gBQZzXkg==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;ansi-colors&quot;: &quot;4.1.1&quot;,</span>
<span class="term-fg32">+        &quot;browser-stdout&quot;: &quot;1.3.1&quot;,</span>
<span class="term-fg32">+        &quot;chokidar&quot;: &quot;3.5.3&quot;,</span>
<span class="term-fg32">+        &quot;debug&quot;: &quot;4.3.4&quot;,</span>
<span class="term-fg32">+        &quot;diff&quot;: &quot;5.0.0&quot;,</span>
<span class="term-fg32">+        &quot;escape-string-regexp&quot;: &quot;4.0.0&quot;,</span>
<span class="term-fg32">+        &quot;find-up&quot;: &quot;5.0.0&quot;,</span>
<span class="term-fg32">+        &quot;glob&quot;: &quot;7.2.0&quot;,</span>
<span class="term-fg32">+        &quot;he&quot;: &quot;1.2.0&quot;,</span>
<span class="term-fg32">+        &quot;js-yaml&quot;: &quot;4.1.0&quot;,</span>
<span class="term-fg32">+        &quot;log-symbols&quot;: &quot;4.1.0&quot;,</span>
<span class="term-fg32">+        &quot;minimatch&quot;: &quot;5.0.1&quot;,</span>
<span class="term-fg32">+        &quot;ms&quot;: &quot;2.1.3&quot;,</span>
<span class="term-fg32">+        &quot;nanoid&quot;: &quot;3.3.3&quot;,</span>
<span class="term-fg32">+        &quot;serialize-javascript&quot;: &quot;6.0.0&quot;,</span>
<span class="term-fg32">+        &quot;strip-json-comments&quot;: &quot;3.1.1&quot;,</span>
<span class="term-fg32">+        &quot;supports-color&quot;: &quot;8.1.1&quot;,</span>
<span class="term-fg32">+        &quot;workerpool&quot;: &quot;6.2.1&quot;,</span>
<span class="term-fg32">+        &quot;yargs&quot;: &quot;16.2.0&quot;,</span>
<span class="term-fg32">+        &quot;yargs-parser&quot;: &quot;20.2.4&quot;,</span>
<span class="term-fg32">+        &quot;yargs-unparser&quot;: &quot;2.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;bin&quot;: {</span>
<span class="term-fg32">+        &quot;_mocha&quot;: &quot;bin&#47;_mocha&quot;,</span>
<span class="term-fg32">+        &quot;mocha&quot;: &quot;bin&#47;mocha.js&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;= 14.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;opencollective&quot;,</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;opencollective.com&#47;mochajs&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;ms&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.1.3&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;ms&#47;-&#47;ms-2.1.3.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-6FlzubTLZG3J2a&#47;NVCAleEhjzq5oxgHyaCU9yYXvcLsvoVaHJq&#47;s5xXI6&#47;XXP6tz7R9xAOtHnSO&#47;tXtF3WRTlA==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;nanoid&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.3.3&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;nanoid&#47;-&#47;nanoid-3.3.3.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-p1sjXuopFs0xg+fPASzQ28agW1oHD7xDsd9Xkf3T15H3c&#47;cifrFHVwrh74PdoklAPi+i7MdRsE47vm2r6JoB+w==&quot;,</span>
<span class="term-fg32">+      &quot;bin&quot;: {</span>
<span class="term-fg32">+        &quot;nanoid&quot;: &quot;bin&#47;nanoid.cjs&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;^10 || ^12 || ^13.7 || ^14 || &gt;=15.0.1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;normalize-path&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;normalize-path&#47;-&#47;normalize-path-3.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-6eZs5Ls3WtCisHWp9S2GUy8dqkpGi4BVSz3GaqiE6ezub0512ESztXUwUB6C6IKbQkY2Pnb&#47;mD4WYojCRwcwLA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=0.10.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;once&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.4.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;once&#47;-&#47;once-1.4.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-lNaJgI+2Q5URQBkccEKHTQOPaXdUxnZZElQTZY0MFUAuaEqe1E+Nyvgdz&#47;aIyNi6Z9MzO5dv1H8n58&#47;GELp3+w==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;wrappy&quot;: &quot;1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;p-limit&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;p-limit&#47;-&#47;p-limit-3.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-TYOanM3wGwNGsZN2cVTYPArw454xnXj5qmWF1bEoAc4+cU&#47;ol7GVh7odevjp1FNHduHc3KZMcFduxU5Xc6uJRQ==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;yocto-queue&quot;: &quot;^0.1.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;p-locate&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;p-locate&#47;-&#47;p-locate-5.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-LaNjtRWUBY++zB5nE&#47;NwcaoMylSPk+S+ZHNB1TzdbMJMny6dynpAGt7X&#47;tl&#47;QYq3TIeE6nxHppbo2LGymrG5Pw==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;p-limit&quot;: &quot;^3.0.2&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;path-exists&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;path-exists&#47;-&#47;path-exists-4.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-ak9Qy5Q7jYb2Wwcey5Fpvg2KoAc&#47;ZIhLSLOSBmRmygPsGwkVVt0fZa0qrtMz+m6tJTAHfZQ8FnmB4MG4LWy7&#47;w==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;path-is-absolute&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;path-is-absolute&#47;-&#47;path-is-absolute-1.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-AVbw3UJ2e9bq64vSaS9Am0fje1Pa8pbGqTTsmXfaIiMpnr5DlDhfJOuLj9Sf95ZPVDAUerDfEk88MPmPe7UCQg==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=0.10.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;pathval&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;pathval&#47;-&#47;pathval-2.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-vE7JKRyES09KiunauX7nd2Q9&#47;L7lhok4smP9RZTDeD4MVs72Dp2qNFVz39Nz5a0FVEW0BJR6C0DYrq6unoziZA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;= 14.16&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;picomatch&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.3.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;picomatch&#47;-&#47;picomatch-2.3.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-JU3teHTNjmE2VCGFzuY8EXzCDVwEqB2a8fsIvwaStHhAWJEeVd1o1QD80CU6+ZdEXXSLbSsuLwJjkCBWqRQUVA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8.6&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;jonschlinkert&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;randombytes&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;randombytes&#47;-&#47;randombytes-2.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-vYl3iOX+4CKUWuxGi9Ukhie6fsqXqS9FE2Zaic4tNFD2N2QQaXOMFbuKK4QmDHC0JO6B1Zp41J0LpT0oR68amQ==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;safe-buffer&quot;: &quot;^5.1.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;readdirp&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.6.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;readdirp&#47;-&#47;readdirp-3.6.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-hOS089on8RduqdbhvQ5Z37A0ESjsqz6qnRcffsMU3495FuTdqSm+7bhJ29JvIOsBDEEnan5DPu9t3To9VRlMzA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;picomatch&quot;: &quot;^2.2.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8.10.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;require-directory&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.1.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;require-directory&#47;-&#47;require-directory-2.1.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-fGxEI7+wsG9xrvdjsrlmL22OMTTiHRwAMroiEeMgq8gzoLC&#47;PQr7RsRDSTLUg&#47;bZAZtF+TVIkHc6&#47;4RIKrui+Q==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=0.10.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;safe-buffer&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.2.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;safe-buffer&#47;-&#47;safe-buffer-5.2.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-rp3So07KcdmmKbGvgaNxQSJr7bGVSVk5S9Eq1F+ppbRo70+YeaDxkw5Dd8NPN+GD6bjnYm2VuPuCXmpuYvmCXQ==&quot;,</span>
<span class="term-fg32">+      &quot;funding&quot;: [</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;type&quot;: &quot;github&quot;,</span>
<span class="term-fg32">+          &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;feross&quot;</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;type&quot;: &quot;patreon&quot;,</span>
<span class="term-fg32">+          &quot;url&quot;: &quot;https:&#47;&#47;www.patreon.com&#47;feross&quot;</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;type&quot;: &quot;consulting&quot;,</span>
<span class="term-fg32">+          &quot;url&quot;: &quot;https:&#47;&#47;feross.org&#47;support&quot;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      ]</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;serialize-javascript&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;6.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;serialize-javascript&#47;-&#47;serialize-javascript-6.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-Qr3TosvguFt8ePWqsvRfrKyQXIiW+nGbYpy8XK24NQHE83caxWt+mIymTT19DGFbNWNLfEwsrkSmN64lVWB9ag==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;randombytes&quot;: &quot;^2.1.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;string-width&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;4.2.3&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;string-width&#47;-&#47;string-width-4.2.3.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-wKyQRQpjJ0sIp62ErSZdGsjMJWsap5oRNihHhu6G7JVO&#47;9jIB6UyevL+tXuOqrng8j&#47;cxKTWyWUwvSTriiZz&#47;g==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;emoji-regex&quot;: &quot;^8.0.0&quot;,</span>
<span class="term-fg32">+        &quot;is-fullwidth-code-point&quot;: &quot;^3.0.0&quot;,</span>
<span class="term-fg32">+        &quot;strip-ansi&quot;: &quot;^6.0.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;strip-ansi&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;6.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;strip-ansi&#47;-&#47;strip-ansi-6.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-Y38VPSHcqkFrCpFnQ9vuSXmquuv5oXOKpGeT6aGrr3o3Gc9AlVa6JBfUSOCnbxGGZF+&#47;0ooI7KrPuUSztUdU5A==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;ansi-regex&quot;: &quot;^5.0.1&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;strip-json-comments&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;3.1.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;strip-json-comments&#47;-&#47;strip-json-comments-3.1.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-6fPc+R4ihwqP6N&#47;aIv2f1gMH8lOVtWQHoqC4yK6oSDVVocumAsfCqjkXnqiYMhmMwS&#47;mEHLp7Vehlt3ql6lEig==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;supports-color&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;8.1.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;supports-color&#47;-&#47;supports-color-8.1.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-MpUEN2OodtUzxvKQl72cUF7RQ5EiHsGvSsVG0ia9c5RbWGL2CI4C7EpPS8UTBIplnlzZiNuV56w+FuNxy3ty2Q==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;has-flag&quot;: &quot;^4.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;chalk&#47;supports-color?sponsor=1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;to-regex-range&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;to-regex-range&#47;-&#47;to-regex-range-5.0.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-65P7iz6X5yEr1cwcgvQxbbIw7Uk3gOy5dIdtZ4rDveLqhrdJP+Li&#47;Hx6tyK0NEb+2GCyneCMJiGqrADCSNk8sQ==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;is-number&quot;: &quot;^7.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=8.0&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;tslib&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.4.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;tslib&#47;-&#47;tslib-2.4.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-d6xOpEDfsi2CZVlPQzGeux8XMwLT9hssAsaPYExaQMuYskwb+x1x7J371tWlbBdWHroy99KnVB6qIkUbs5X3UQ==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;viem&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.9.15&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;viem&#47;-&#47;viem-2.9.15.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-7kcmHqybc3JhpjL8gKY7YxBYpZt1&#47;&#47;qhoTZIU5Ez9JdyRCnYMMnJu20s7wd7Gv6a3zPbq8jV8dCp94a&#47;NLJJcA==&quot;,</span>
<span class="term-fg32">+      &quot;funding&quot;: [</span>
<span class="term-fg32">+        {</span>
<span class="term-fg32">+          &quot;type&quot;: &quot;github&quot;,</span>
<span class="term-fg32">+          &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;wevm&quot;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      ],</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;@adraffy&#47;ens-normalize&quot;: &quot;1.10.0&quot;,</span>
<span class="term-fg32">+        &quot;@noble&#47;curves&quot;: &quot;1.2.0&quot;,</span>
<span class="term-fg32">+        &quot;@noble&#47;hashes&quot;: &quot;1.3.2&quot;,</span>
<span class="term-fg32">+        &quot;@scure&#47;bip32&quot;: &quot;1.3.2&quot;,</span>
<span class="term-fg32">+        &quot;@scure&#47;bip39&quot;: &quot;1.2.1&quot;,</span>
<span class="term-fg32">+        &quot;abitype&quot;: &quot;1.0.0&quot;,</span>
<span class="term-fg32">+        &quot;isows&quot;: &quot;1.0.3&quot;,</span>
<span class="term-fg32">+        &quot;ws&quot;: &quot;8.13.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependencies&quot;: {</span>
<span class="term-fg32">+        &quot;typescript&quot;: &quot;&gt;=5.0.4&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependenciesMeta&quot;: {</span>
<span class="term-fg32">+        &quot;typescript&quot;: {</span>
<span class="term-fg32">+          &quot;optional&quot;: true</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;viem&#47;node_modules&#47;ws&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;8.13.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;ws&#47;-&#47;ws-8.13.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-x9vcZYTrFPC7aSIbj7sRCYo7L&#47;Xb8Iy+pW0ng0wt2vCJv7M9HOMy0UoN3rr+IFC7hb7vXoqS+P9ktyLLLhO+LA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependencies&quot;: {</span>
<span class="term-fg32">+        &quot;bufferutil&quot;: &quot;^4.0.1&quot;,</span>
<span class="term-fg32">+        &quot;utf-8-validate&quot;: &quot;&gt;=5.0.2&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependenciesMeta&quot;: {</span>
<span class="term-fg32">+        &quot;bufferutil&quot;: {</span>
<span class="term-fg32">+          &quot;optional&quot;: true</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        &quot;utf-8-validate&quot;: {</span>
<span class="term-fg32">+          &quot;optional&quot;: true</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;workerpool&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;6.2.1&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;workerpool&#47;-&#47;workerpool-6.2.1.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-ILEIE97kDZvF9Wb9f6h5aXK4swSlKGUcOEGiIYb2OOu&#47;IrDU9iwj0fD&#47;&#47;SsA6E5ibwJxpEvhullJY4Sl4GcpAw==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;wrap-ansi&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;7.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;wrap-ansi&#47;-&#47;wrap-ansi-7.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-YVGIj2kamLSTxw6NsZjoBxfSwsn0ycdesmc4p+Q21c5zPuZ1pl+NfxVdxPtdHvmNVOQ6XSYG4AUtyt&#47;Fi7D16Q==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;ansi-styles&quot;: &quot;^4.0.0&quot;,</span>
<span class="term-fg32">+        &quot;string-width&quot;: &quot;^4.1.0&quot;,</span>
<span class="term-fg32">+        &quot;strip-ansi&quot;: &quot;^6.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;chalk&#47;wrap-ansi?sponsor=1&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;wrappy&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;1.0.2&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;wrappy&#47;-&#47;wrappy-1.0.2.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-l4Sp&#47;DRseor9wL6EvV2+TuQn63dMkPjZ&#47;sp9XkghTEbV9KlPS1xUsZ3u7&#47;IQO4wxtcFB4bgpQPRcR3QCvezPcQ==&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;ws&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;8.5.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;ws&#47;-&#47;ws-8.5.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-BWX0SWVgLPzYwF8lTzEy1egjhS4S4OEAHfsO8o65WOVsrnSRGaSiUaa9e0ggGlkMTtBlmOpEXiie9RUcBO86qg==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10.0.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependencies&quot;: {</span>
<span class="term-fg32">+        &quot;bufferutil&quot;: &quot;^4.0.1&quot;,</span>
<span class="term-fg32">+        &quot;utf-8-validate&quot;: &quot;^5.0.2&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;peerDependenciesMeta&quot;: {</span>
<span class="term-fg32">+        &quot;bufferutil&quot;: {</span>
<span class="term-fg32">+          &quot;optional&quot;: true</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        &quot;utf-8-validate&quot;: {</span>
<span class="term-fg32">+          &quot;optional&quot;: true</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;y18n&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;5.0.8&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;y18n&#47;-&#47;y18n-5.0.8.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-0pfFzegeDWJHJIAmTLRP2DwHjdF5s7jo9tuztdQxAhINCdvS+3nGINqPd00AphqJR&#47;0LhANUS6&#47;+7SCb98YOfA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;yargs&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;16.2.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;yargs&#47;-&#47;yargs-16.2.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-D1mvvtDG0L5ft&#47;jGWkLpG1+m0eQxOfaBvTNELraWj22wSVUMWxZUvYgJYcKh6jGGIkJFhH4IZPQhR4TKpc8mBw==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;cliui&quot;: &quot;^7.0.2&quot;,</span>
<span class="term-fg32">+        &quot;escalade&quot;: &quot;^3.1.1&quot;,</span>
<span class="term-fg32">+        &quot;get-caller-file&quot;: &quot;^2.0.5&quot;,</span>
<span class="term-fg32">+        &quot;require-directory&quot;: &quot;^2.1.1&quot;,</span>
<span class="term-fg32">+        &quot;string-width&quot;: &quot;^4.2.0&quot;,</span>
<span class="term-fg32">+        &quot;y18n&quot;: &quot;^5.0.5&quot;,</span>
<span class="term-fg32">+        &quot;yargs-parser&quot;: &quot;^20.2.2&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;yargs-parser&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;20.2.4&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;yargs-parser&#47;-&#47;yargs-parser-20.2.4.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-WOkpgNhPTlE73h4VFAFsOnomJVaovO8VqLDzy5saChRBFQFBoMYirowyW+Q9HB4HFF4Z7VZTiG3iSzJJA29yRA==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;yargs-unparser&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;2.0.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;yargs-unparser&#47;-&#47;yargs-unparser-2.0.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-7pRTIA9Qc1caZ0bZ6RYRGbHJthJWuakf+WmHK0rVeLkNrrGhfoabBNdue6kdINI6r4if7ocq9aD&#47;n7xwKOdzOA==&quot;,</span>
<span class="term-fg32">+      &quot;dependencies&quot;: {</span>
<span class="term-fg32">+        &quot;camelcase&quot;: &quot;^6.0.0&quot;,</span>
<span class="term-fg32">+        &quot;decamelize&quot;: &quot;^4.0.0&quot;,</span>
<span class="term-fg32">+        &quot;flat&quot;: &quot;^5.0.2&quot;,</span>
<span class="term-fg32">+        &quot;is-plain-obj&quot;: &quot;^2.1.0&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;node_modules&#47;yocto-queue&quot;: {</span>
<span class="term-fg32">+      &quot;version&quot;: &quot;0.1.0&quot;,</span>
<span class="term-fg32">+      &quot;resolved&quot;: &quot;https:&#47;&#47;registry.npmjs.org&#47;yocto-queue&#47;-&#47;yocto-queue-0.1.0.tgz&quot;,</span>
<span class="term-fg32">+      &quot;integrity&quot;: &quot;sha512-rVksvsnNCdJ&#47;ohGc6xgPwyN8eheCxsiLM8mxuE&#47;t&#47;mOVqJewPuO1miLpTHQiRgTKCLexL4MeAFVagts7HmNZ2Q==&quot;,</span>
<span class="term-fg32">+      &quot;engines&quot;: {</span>
<span class="term-fg32">+        &quot;node&quot;: &quot;&gt;=10&quot;</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+      &quot;funding&quot;: {</span>
<span class="term-fg32">+        &quot;url&quot;: &quot;https:&#47;&#47;github.com&#47;sponsors&#47;sindresorhus&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+  }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3a9e1516c8d686798c68648f" role="button"
                       aria-expanded="false" aria-controls="id-3a9e1516c8d686798c68648f">
                        <code>e2e_test/js-tests/package.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/js-tests/package.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3a9e1516c8d686798c68648f"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;js-tests&#47;package.json CELO&#47;e2e_test&#47;js-tests&#47;package.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1867f08694bdc7ec40af0ef8bfecd71c19dd45da</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;js-tests&#47;package.json</span>
<span class="term-fg36">@@ -0,0 +1,17 @@</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+	&quot;name&quot;: &quot;js-tests&quot;,</span>
<span class="term-fg32">+	&quot;version&quot;: &quot;1.0.0&quot;,</span>
<span class="term-fg32">+	&quot;description&quot;: &quot;&quot;,</span>
<span class="term-fg32">+	&quot;main&quot;: &quot;index.js&quot;,</span>
<span class="term-fg32">+	&quot;scripts&quot;: {</span>
<span class="term-fg32">+		&quot;test&quot;: &quot;echo \&quot;Error: no test specified\&quot; &amp;&amp; exit 1&quot;</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+	&quot;author&quot;: &quot;&quot;,</span>
<span class="term-fg32">+	&quot;license&quot;: &quot;MIT&quot;,</span>
<span class="term-fg32">+	&quot;dependencies&quot;: {</span>
<span class="term-fg32">+		&quot;chai&quot;: &quot;^5.0.0&quot;,</span>
<span class="term-fg32">+		&quot;ethers&quot;: &quot;^6.10.0&quot;,</span>
<span class="term-fg32">+		&quot;mocha&quot;: &quot;^10.2.0&quot;,</span>
<span class="term-fg32">+		&quot;viem&quot;: &quot;^2.9.6&quot;</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c59e6561241fdf3a91bb6c06" role="button"
                       aria-expanded="false" aria-controls="id-c59e6561241fdf3a91bb6c06">
                        <code>e2e_test/js-tests/send_tx.mjs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/js-tests/send_tx.mjs" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+44</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c59e6561241fdf3a91bb6c06"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;js-tests&#47;send_tx.mjs CELO&#47;e2e_test&#47;js-tests&#47;send_tx.mjs</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5a9b46950271fa7d8f0e38c2cccfd68e5a2c3696</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;js-tests&#47;send_tx.mjs</span>
<span class="term-fg36">@@ -0,0 +1,44 @@</span>
<span class="term-fg32">+#!&#47;usr&#47;bin&#47;env node</span>
<span class="term-fg32">+import {</span>
<span class="term-fg32">+	createPublicClient,</span>
<span class="term-fg32">+	createWalletClient,</span>
<span class="term-fg32">+	http,</span>
<span class="term-fg32">+	defineChain,</span>
<span class="term-fg32">+} from &quot;viem&quot;;</span>
<span class="term-fg32">+import { celoAlfajores } from &quot;viem&#47;chains&quot;;</span>
<span class="term-fg32">+import { privateKeyToAccount } from &quot;viem&#47;accounts&quot;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const [chainId, privateKey, feeCurrency] = process.argv.slice(2);</span>
<span class="term-fg32">+const devChain = defineChain({</span>
<span class="term-fg32">+	...celoAlfajores,</span>
<span class="term-fg32">+	id: parseInt(chainId, 10),</span>
<span class="term-fg32">+	name: &quot;local dev chain&quot;,</span>
<span class="term-fg32">+	network: &quot;dev&quot;,</span>
<span class="term-fg32">+	rpcUrls: {</span>
<span class="term-fg32">+		default: {</span>
<span class="term-fg32">+			http: [&quot;http:&#47;&#47;127.0.0.1:8545&quot;],</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const account = privateKeyToAccount(privateKey);</span>
<span class="term-fg32">+const walletClient = createWalletClient({</span>
<span class="term-fg32">+	account,</span>
<span class="term-fg32">+	chain: devChain,</span>
<span class="term-fg32">+	transport: http(),</span>
<span class="term-fg32">+});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const request = await walletClient.prepareTransactionRequest({</span>
<span class="term-fg32">+	account,</span>
<span class="term-fg32">+	to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+	value: 2,</span>
<span class="term-fg32">+	gas: 90000,</span>
<span class="term-fg32">+	feeCurrency,</span>
<span class="term-fg32">+	maxFeePerGas: 2000000000n,</span>
<span class="term-fg32">+	maxPriorityFeePerGas: 0n,</span>
<span class="term-fg32">+});</span>
<span class="term-fg32">+const signature = await walletClient.signTransaction(request);</span>
<span class="term-fg32">+const hash = await walletClient.sendRawTransaction({</span>
<span class="term-fg32">+	serializedTransaction: signature,</span>
<span class="term-fg32">+});</span>
<span class="term-fg32">+console.log(hash);</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e1ac1c7961cdd696594f7ea5" role="button"
                       aria-expanded="false" aria-controls="id-e1ac1c7961cdd696594f7ea5">
                        <code>e2e_test/js-tests/test_ethers_tx.mjs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/js-tests/test_ethers_tx.mjs" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+52</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e1ac1c7961cdd696594f7ea5"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;js-tests&#47;test_ethers_tx.mjs CELO&#47;e2e_test&#47;js-tests&#47;test_ethers_tx.mjs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3faf2d9cdf29fd0ca19d44803c77e0bd4e0895d1</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;js-tests&#47;test_ethers_tx.mjs</span>
<span class="term-fg36">@@ -0,0 +1,52 @@</span>
<span class="term-fg32">+import { assert } from &quot;chai&quot;;</span>
<span class="term-fg32">+import &quot;mocha&quot;;</span>
<span class="term-fg32">+import { ethers } from &quot;ethers&quot;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const provider = new ethers.JsonRpcProvider(process.env.ETH_RPC_URL);</span>
<span class="term-fg32">+const signer = new ethers.Wallet(process.env.ACC_PRIVKEY, provider);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+describe(&quot;ethers.js send tx&quot;, () =&gt; {</span>
<span class="term-fg32">+	it(&quot;send basic tx and check receipt&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const tx = await signer.sendTransaction({</span>
<span class="term-fg32">+			to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+			value: 1,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const receipt = await tx.wait();</span>
<span class="term-fg32">+	}).timeout(10_000);</span>
<span class="term-fg32">+});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+describe(&quot;ethers.js compatibility tests with state&quot;, () =&gt; {</span>
<span class="term-fg32">+	it(&quot;provider.getBlock works (block has gasLimit set)&quot;, async () =&gt; {</span>
<span class="term-fg32">+		let block = await provider.getBlock();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; These assertions trigger on undefined or null</span>
<span class="term-fg32">+		assert.notEqual(block, null);</span>
<span class="term-fg32">+		assert.notEqual(block.gasLimit, null);</span>
<span class="term-fg32">+	});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;EIP-1559 transactions supported (can get feeData)&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const feeData = await provider.getFeeData();</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; These assertions trigger on undefined or null</span>
<span class="term-fg32">+		assert.notEqual(feeData, null);</span>
<span class="term-fg32">+		assert.notEqual(feeData.maxFeePerGas, null);</span>
<span class="term-fg32">+		assert.notEqual(feeData.maxPriorityFeePerGas, null);</span>
<span class="term-fg32">+		assert.notEqual(feeData.gasPrice, null);</span>
<span class="term-fg32">+	});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;block has gasLimit&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const fullBlock = await provider.send(&quot;eth_getBlockByNumber&quot;, [</span>
<span class="term-fg32">+			&quot;latest&quot;,</span>
<span class="term-fg32">+			true,</span>
<span class="term-fg32">+		]);</span>
<span class="term-fg32">+		assert.isTrue(fullBlock.hasOwnProperty(&quot;gasLimit&quot;));</span>
<span class="term-fg32">+	});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;block has baseFeePerGas&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const fullBlock = await provider.send(&quot;eth_getBlockByNumber&quot;, [</span>
<span class="term-fg32">+			&quot;latest&quot;,</span>
<span class="term-fg32">+			true,</span>
<span class="term-fg32">+		]);</span>
<span class="term-fg32">+		assert.isTrue(fullBlock.hasOwnProperty(&quot;baseFeePerGas&quot;));</span>
<span class="term-fg32">+	});</span>
<span class="term-fg32">+});</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-44805dca18c9301edcd4c60a" role="button"
                       aria-expanded="false" aria-controls="id-44805dca18c9301edcd4c60a">
                        <code>e2e_test/js-tests/test_viem_tx.mjs</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/js-tests/test_viem_tx.mjs" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+273</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-44805dca18c9301edcd4c60a"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;js-tests&#47;test_viem_tx.mjs CELO&#47;e2e_test&#47;js-tests&#47;test_viem_tx.mjs</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0fe54d427cb80eb12f130b1eba152b2c6448b1ed</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;js-tests&#47;test_viem_tx.mjs</span>
<span class="term-fg36">@@ -0,0 +1,273 @@</span>
<span class="term-fg32">+import { assert } from &quot;chai&quot;;</span>
<span class="term-fg32">+import &quot;mocha&quot;;</span>
<span class="term-fg32">+import {</span>
<span class="term-fg32">+	createPublicClient,</span>
<span class="term-fg32">+	createWalletClient,</span>
<span class="term-fg32">+	http,</span>
<span class="term-fg32">+	defineChain,</span>
<span class="term-fg32">+} from &quot;viem&quot;;</span>
<span class="term-fg32">+import { celoAlfajores } from &quot;viem&#47;chains&quot;;</span>
<span class="term-fg32">+import { privateKeyToAccount } from &quot;viem&#47;accounts&quot;;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Setup up chain</span>
<span class="term-fg32">+const devChain = defineChain({</span>
<span class="term-fg32">+	...celoAlfajores,</span>
<span class="term-fg32">+	id: 1337,</span>
<span class="term-fg32">+	name: &quot;local dev chain&quot;,</span>
<span class="term-fg32">+	network: &quot;dev&quot;,</span>
<span class="term-fg32">+	rpcUrls: {</span>
<span class="term-fg32">+		default: {</span>
<span class="term-fg32">+			http: [process.env.ETH_RPC_URL],</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Set up clients&#47;wallet</span>
<span class="term-fg32">+const publicClient = createPublicClient({</span>
<span class="term-fg32">+	chain: devChain,</span>
<span class="term-fg32">+	transport: http(),</span>
<span class="term-fg32">+});</span>
<span class="term-fg32">+const account = privateKeyToAccount(process.env.ACC_PRIVKEY);</span>
<span class="term-fg32">+const walletClient = createWalletClient({</span>
<span class="term-fg32">+	account,</span>
<span class="term-fg32">+	chain: devChain,</span>
<span class="term-fg32">+	transport: http(),</span>
<span class="term-fg32">+});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const testNonceBump = async (</span>
<span class="term-fg32">+	firstCap,</span>
<span class="term-fg32">+	firstCurrency,</span>
<span class="term-fg32">+	secondCap,</span>
<span class="term-fg32">+	secondCurrency,</span>
<span class="term-fg32">+	shouldReplace,</span>
<span class="term-fg32">+) =&gt; {</span>
<span class="term-fg32">+	const syncBarrierRequest = await walletClient.prepareTransactionRequest({</span>
<span class="term-fg32">+		account,</span>
<span class="term-fg32">+		to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+		value: 2,</span>
<span class="term-fg32">+		gas: 22000,</span>
<span class="term-fg32">+	});</span>
<span class="term-fg32">+	const firstTxHash = await walletClient.sendTransaction({</span>
<span class="term-fg32">+		account,</span>
<span class="term-fg32">+		to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+		value: 2,</span>
<span class="term-fg32">+		gas: 90000,</span>
<span class="term-fg32">+		maxFeePerGas: firstCap,</span>
<span class="term-fg32">+		maxPriorityFeePerGas: firstCap,</span>
<span class="term-fg32">+		nonce: syncBarrierRequest.nonce + 1,</span>
<span class="term-fg32">+		feeCurrency: firstCurrency,</span>
<span class="term-fg32">+	});</span>
<span class="term-fg32">+	var secondTxHash;</span>
<span class="term-fg32">+	try {</span>
<span class="term-fg32">+		secondTxHash = await walletClient.sendTransaction({</span>
<span class="term-fg32">+			account,</span>
<span class="term-fg32">+			to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+			value: 3,</span>
<span class="term-fg32">+			gas: 90000,</span>
<span class="term-fg32">+			maxFeePerGas: secondCap,</span>
<span class="term-fg32">+			maxPriorityFeePerGas: secondCap,</span>
<span class="term-fg32">+			nonce: syncBarrierRequest.nonce + 1,</span>
<span class="term-fg32">+			feeCurrency: secondCurrency,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+	} catch (err) {</span>
<span class="term-fg32">+		&#47;&#47; If shouldReplace, no error should be thrown</span>
<span class="term-fg32">+		&#47;&#47; If shouldReplace == false, exactly the underpriced error should be thrown</span>
<span class="term-fg32">+		if (</span>
<span class="term-fg32">+			err.cause.details != &quot;replacement transaction underpriced&quot; ||</span>
<span class="term-fg32">+			shouldReplace</span>
<span class="term-fg32">+		) {</span>
<span class="term-fg32">+			throw err; &#47;&#47; Only throw if unexpected error.</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	const syncBarrierSignature =</span>
<span class="term-fg32">+		await walletClient.signTransaction(syncBarrierRequest);</span>
<span class="term-fg32">+	const barrierTxHash = await walletClient.sendRawTransaction({</span>
<span class="term-fg32">+		serializedTransaction: syncBarrierSignature,</span>
<span class="term-fg32">+	});</span>
<span class="term-fg32">+	await publicClient.waitForTransactionReceipt({ hash: barrierTxHash });</span>
<span class="term-fg32">+	if (shouldReplace) {</span>
<span class="term-fg32">+		&#47;&#47; The new transaction was included.</span>
<span class="term-fg32">+		await publicClient.waitForTransactionReceipt({ hash: secondTxHash });</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		&#47;&#47; The original transaction was not replaced.</span>
<span class="term-fg32">+		await publicClient.waitForTransactionReceipt({ hash: firstTxHash });</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+};</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+describe(&quot;viem send tx&quot;, () =&gt; {</span>
<span class="term-fg32">+	it(&quot;send basic tx and check receipt&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const request = await walletClient.prepareTransactionRequest({</span>
<span class="term-fg32">+			account,</span>
<span class="term-fg32">+			to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+			value: 1,</span>
<span class="term-fg32">+			gas: 21000,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const signature = await walletClient.signTransaction(request);</span>
<span class="term-fg32">+		const hash = await walletClient.sendRawTransaction({</span>
<span class="term-fg32">+			serializedTransaction: signature,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const receipt = await publicClient.waitForTransactionReceipt({ hash });</span>
<span class="term-fg32">+		assert.equal(receipt.status, &quot;success&quot;, &quot;receipt status &#39;failure&#39;&quot;);</span>
<span class="term-fg32">+	}).timeout(10_000);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;send tx with gas estimation and check receipt&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const request = await walletClient.prepareTransactionRequest({</span>
<span class="term-fg32">+			account,</span>
<span class="term-fg32">+			to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+			value: 1,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const signature = await walletClient.signTransaction(request);</span>
<span class="term-fg32">+		const hash = await walletClient.sendRawTransaction({</span>
<span class="term-fg32">+			serializedTransaction: signature,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const receipt = await publicClient.waitForTransactionReceipt({ hash });</span>
<span class="term-fg32">+		assert.equal(receipt.status, &quot;success&quot;, &quot;receipt status &#39;failure&#39;&quot;);</span>
<span class="term-fg32">+	}).timeout(10_000);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;send fee currency tx and check receipt&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const request = await walletClient.prepareTransactionRequest({</span>
<span class="term-fg32">+			account,</span>
<span class="term-fg32">+			to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+			value: 2,</span>
<span class="term-fg32">+			gas: 90000,</span>
<span class="term-fg32">+			feeCurrency: process.env.FEE_CURRENCY,</span>
<span class="term-fg32">+			maxFeePerGas: 2000000000n,</span>
<span class="term-fg32">+			maxPriorityFeePerGas: 0n,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const signature = await walletClient.signTransaction(request);</span>
<span class="term-fg32">+		const hash = await walletClient.sendRawTransaction({</span>
<span class="term-fg32">+			serializedTransaction: signature,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const receipt = await publicClient.waitForTransactionReceipt({ hash });</span>
<span class="term-fg32">+		assert.equal(receipt.status, &quot;success&quot;, &quot;receipt status &#39;failure&#39;&quot;);</span>
<span class="term-fg32">+	}).timeout(10_000);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;test gas price difference for fee currency&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const request = await walletClient.prepareTransactionRequest({</span>
<span class="term-fg32">+			account,</span>
<span class="term-fg32">+			to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+			value: 2,</span>
<span class="term-fg32">+			gas: 90000,</span>
<span class="term-fg32">+			feeCurrency: process.env.FEE_CURRENCY,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		const gasPriceNative = await publicClient.getGasPrice({});</span>
<span class="term-fg32">+		var maxPriorityFeePerGasNative =</span>
<span class="term-fg32">+			await publicClient.estimateMaxPriorityFeePerGas({});</span>
<span class="term-fg32">+		const block = await publicClient.getBlock({});</span>
<span class="term-fg32">+		assert.equal(</span>
<span class="term-fg32">+			BigInt(block.baseFeePerGas) + maxPriorityFeePerGasNative,</span>
<span class="term-fg32">+			gasPriceNative,</span>
<span class="term-fg32">+		);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; viem&#39;s getGasPrice does not expose additional request parameters,</span>
<span class="term-fg32">+		&#47;&#47; but Celo&#39;s override &#39;chain.fees.estimateFeesPerGas&#39; action does.</span>
<span class="term-fg32">+		&#47;&#47; this will call the eth_gasPrice and eth_maxPriorityFeePerGas methods</span>
<span class="term-fg32">+		&#47;&#47; with the additional feeCurrency parameter internally</span>
<span class="term-fg32">+		var fees = await publicClient.estimateFeesPerGas({</span>
<span class="term-fg32">+			type: &quot;eip1559&quot;,</span>
<span class="term-fg32">+			request: {</span>
<span class="term-fg32">+				feeCurrency: process.env.FEE_CURRENCY,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		&#47;&#47; first check that the fee currency denominated gas price</span>
<span class="term-fg32">+		&#47;&#47; converts properly to the native gas price</span>
<span class="term-fg32">+		assert.equal(fees.maxFeePerGas, gasPriceNative * 2n);</span>
<span class="term-fg32">+		assert.equal(fees.maxPriorityFeePerGas, maxPriorityFeePerGasNative * 2n);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; check that the prepared transaction request uses the</span>
<span class="term-fg32">+		&#47;&#47; converted gas price internally</span>
<span class="term-fg32">+		assert.equal(request.maxFeePerGas, fees.maxFeePerGas);</span>
<span class="term-fg32">+		assert.equal(request.maxPriorityFeePerGas, fees.maxPriorityFeePerGas);</span>
<span class="term-fg32">+	}).timeout(10_000);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;send fee currency with gas estimation tx and check receipt&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const request = await walletClient.prepareTransactionRequest({</span>
<span class="term-fg32">+			account,</span>
<span class="term-fg32">+			to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+			value: 2,</span>
<span class="term-fg32">+			feeCurrency: process.env.FEE_CURRENCY,</span>
<span class="term-fg32">+			maxFeePerGas: 2000000000n,</span>
<span class="term-fg32">+			maxPriorityFeePerGas: 0n,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const signature = await walletClient.signTransaction(request);</span>
<span class="term-fg32">+		const hash = await walletClient.sendRawTransaction({</span>
<span class="term-fg32">+			serializedTransaction: signature,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const receipt = await publicClient.waitForTransactionReceipt({ hash });</span>
<span class="term-fg32">+		assert.equal(receipt.status, &quot;success&quot;, &quot;receipt status &#39;failure&#39;&quot;);</span>
<span class="term-fg32">+	}).timeout(10_000);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;send overlapping nonce tx in different currencies&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const priceBump = 1.1;</span>
<span class="term-fg32">+		const rate = 2;</span>
<span class="term-fg32">+		&#47;&#47; Native to FEE_CURRENCY</span>
<span class="term-fg32">+		const nativeCap = 30_000_000_000;</span>
<span class="term-fg32">+		const bumpCurrencyCap = BigInt(Math.round(nativeCap * rate * priceBump));</span>
<span class="term-fg32">+		const failToBumpCurrencyCap = BigInt(</span>
<span class="term-fg32">+			Math.round(nativeCap * rate * priceBump) - 1,</span>
<span class="term-fg32">+		);</span>
<span class="term-fg32">+		&#47;&#47; FEE_CURRENCY to Native</span>
<span class="term-fg32">+		const currencyCap = 60_000_000_000;</span>
<span class="term-fg32">+		const bumpNativeCap = BigInt(Math.round((currencyCap * priceBump) &#47; rate));</span>
<span class="term-fg32">+		const failToBumpNativeCap = BigInt(</span>
<span class="term-fg32">+			Math.round((currencyCap * priceBump) &#47; rate) - 1,</span>
<span class="term-fg32">+		);</span>
<span class="term-fg32">+		const tokenCurrency = process.env.FEE_CURRENCY;</span>
<span class="term-fg32">+		const nativeCurrency = null;</span>
<span class="term-fg32">+		await testNonceBump(</span>
<span class="term-fg32">+			nativeCap,</span>
<span class="term-fg32">+			nativeCurrency,</span>
<span class="term-fg32">+			bumpCurrencyCap,</span>
<span class="term-fg32">+			tokenCurrency,</span>
<span class="term-fg32">+			true,</span>
<span class="term-fg32">+		);</span>
<span class="term-fg32">+		await testNonceBump(</span>
<span class="term-fg32">+			nativeCap,</span>
<span class="term-fg32">+			nativeCurrency,</span>
<span class="term-fg32">+			failToBumpCurrencyCap,</span>
<span class="term-fg32">+			tokenCurrency,</span>
<span class="term-fg32">+			false,</span>
<span class="term-fg32">+		);</span>
<span class="term-fg32">+		await testNonceBump(</span>
<span class="term-fg32">+			currencyCap,</span>
<span class="term-fg32">+			tokenCurrency,</span>
<span class="term-fg32">+			bumpNativeCap,</span>
<span class="term-fg32">+			nativeCurrency,</span>
<span class="term-fg32">+			true,</span>
<span class="term-fg32">+		);</span>
<span class="term-fg32">+		await testNonceBump(</span>
<span class="term-fg32">+			currencyCap,</span>
<span class="term-fg32">+			tokenCurrency,</span>
<span class="term-fg32">+			failToBumpNativeCap,</span>
<span class="term-fg32">+			nativeCurrency,</span>
<span class="term-fg32">+			false,</span>
<span class="term-fg32">+		);</span>
<span class="term-fg32">+	}).timeout(10_000);</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	it(&quot;send tx with unregistered fee currency&quot;, async () =&gt; {</span>
<span class="term-fg32">+		const request = await walletClient.prepareTransactionRequest({</span>
<span class="term-fg32">+			account,</span>
<span class="term-fg32">+			to: &quot;0x00000000000000000000000000000000DeaDBeef&quot;,</span>
<span class="term-fg32">+			value: 2,</span>
<span class="term-fg32">+			gas: 90000,</span>
<span class="term-fg32">+			feeCurrency: &quot;0x000000000000000000000000000000000badc310&quot;,</span>
<span class="term-fg32">+			maxFeePerGas: 1000000000n,</span>
<span class="term-fg32">+			maxPriorityFeePerGas: 0n,</span>
<span class="term-fg32">+		});</span>
<span class="term-fg32">+		const signature = await walletClient.signTransaction(request);</span>
<span class="term-fg32">+		try {</span>
<span class="term-fg32">+			await walletClient.sendRawTransaction({</span>
<span class="term-fg32">+				serializedTransaction: signature,</span>
<span class="term-fg32">+			});</span>
<span class="term-fg32">+			assert.fail(&quot;Failed to filter unregistered feeCurrency&quot;);</span>
<span class="term-fg32">+		} catch (err) {</span>
<span class="term-fg32">+			&#47;&#47; TODO: find a better way to check the error type</span>
<span class="term-fg32">+			if (err.cause.details == &quot;unregistered fee-currency address&quot;) {</span>
<span class="term-fg32">+				&#47;&#47; Test success</span>
<span class="term-fg32">+			} else {</span>
<span class="term-fg32">+				throw err;</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}).timeout(10_000);</span>
<span class="term-fg32">+});</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c847fc2b006e677caafaaa15" role="button"
                       aria-expanded="false" aria-controls="id-c847fc2b006e677caafaaa15">
                        <code>e2e_test/run_all_tests.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/run_all_tests.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+62</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c847fc2b006e677caafaaa15"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;run_all_tests.sh CELO&#47;e2e_test&#47;run_all_tests.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..1a87baa83a86191be612b0415c7e5a023e6e981e</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;run_all_tests.sh</span>
<span class="term-fg36">@@ -0,0 +1,62 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+set -eo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+SCRIPT_DIR=$(readlink -f &quot;$(dirname &quot;$0&quot;)&quot;)</span>
<span class="term-fg32">+TEST_GLOB=$1</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## Start geth</span>
<span class="term-fg32">+cd &quot;$SCRIPT_DIR&#47;..&quot; || exit 1</span>
<span class="term-fg32">+make geth</span>
<span class="term-fg32">+trap &#39;kill %%&#39; EXIT  # kill bg job at exit</span>
<span class="term-fg32">+build&#47;bin&#47;geth --dev --http --http.api eth,web3,net &amp;&gt; &quot;$SCRIPT_DIR&#47;geth.log&quot; &amp;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# Wait for geth to be ready</span>
<span class="term-fg32">+for _ in {1..10}</span>
<span class="term-fg32">+do</span>
<span class="term-fg32">+	if cast block &amp;&gt; &#47;dev&#47;null</span>
<span class="term-fg32">+	then</span>
<span class="term-fg32">+		break</span>
<span class="term-fg32">+	fi</span>
<span class="term-fg32">+	sleep 0.2</span>
<span class="term-fg32">+done</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## Run tests</span>
<span class="term-fg32">+echo Geth ready, start tests</span>
<span class="term-fg32">+cd &quot;$SCRIPT_DIR&quot; || exit 1</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# There&#39;s a problem with geth return errors on the first transaction sent.</span>
<span class="term-fg32">+# See https:&#47;&#47;github.com&#47;ethereum&#47;web3.py&#47;issues&#47;3212</span>
<span class="term-fg32">+# To work around this, send a transaction before running tests</span>
<span class="term-fg32">+source .&#47;shared.sh</span>
<span class="term-fg32">+cast send --json --private-key $ACC_PRIVKEY $TOKEN_ADDR &#39;transfer(address to, uint256 value) returns (bool)&#39; 0x000000000000000000000000000000000000dEaD 100 --async</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+failures=0</span>
<span class="term-fg32">+tests=0</span>
<span class="term-fg32">+for f in test_*&quot;$TEST_GLOB&quot;*</span>
<span class="term-fg32">+do</span>
<span class="term-fg32">+	echo -e &quot;\nRun $f&quot;</span>
<span class="term-fg32">+	if &quot;.&#47;$f&quot;</span>
<span class="term-fg32">+	then</span>
<span class="term-fg32">+		tput setaf 2 || true</span>
<span class="term-fg32">+		echo &quot;PASS $f&quot;</span>
<span class="term-fg32">+	else</span>
<span class="term-fg32">+		tput setaf 1 || true</span>
<span class="term-fg32">+		echo &quot;FAIL $f ❌&quot;</span>
<span class="term-fg32">+		((failures++)) || true</span>
<span class="term-fg32">+	fi</span>
<span class="term-fg32">+	tput sgr0 || true</span>
<span class="term-fg32">+	((tests++)) || true</span>
<span class="term-fg32">+done</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+## Final summary</span>
<span class="term-fg32">+echo</span>
<span class="term-fg32">+if [[ $failures -eq 0 ]] </span>
<span class="term-fg32">+then</span>
<span class="term-fg32">+	tput setaf 2 || true</span>
<span class="term-fg32">+	echo All $tests tests succeeded!</span>
<span class="term-fg32">+else</span>
<span class="term-fg32">+	tput setaf 1 || true</span>
<span class="term-fg32">+	echo $failures&#47;$tests failed.</span>
<span class="term-fg32">+fi</span>
<span class="term-fg32">+tput sgr0 || true</span>
<span class="term-fg32">+exit $failures</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8fe601c96cc0f2d280bcc3dd" role="button"
                       aria-expanded="false" aria-controls="id-8fe601c96cc0f2d280bcc3dd">
                        <code>e2e_test/shared.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/shared.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+20</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8fe601c96cc0f2d280bcc3dd"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;shared.sh CELO&#47;e2e_test&#47;shared.sh</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..87d85dc24d690cf7bb1cd35d298befd74c9bf55e</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;shared.sh</span>
<span class="term-fg36">@@ -0,0 +1,20 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+#shellcheck disable=SC2034  # unused vars make sense in a shared file</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+export ETH_RPC_URL=http:&#47;&#47;127.0.0.1:8545</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+export ACC_ADDR=0x42cf1bbc38BaAA3c4898ce8790e21eD2738c6A4a</span>
<span class="term-fg32">+export ACC_PRIVKEY=0x2771aff413cac48d9f8c114fabddd9195a2129f3c2c436caa07e27bb7f58ead5</span>
<span class="term-fg32">+export REGISTRY_ADDR=0x000000000000000000000000000000000000ce10</span>
<span class="term-fg32">+export TOKEN_ADDR=0x471ece3750da237f93b8e339c536989b8978a438</span>
<span class="term-fg32">+export FEE_CURRENCY_DIRECTORY_ADDR=0x71ffbd48e34bdd5a87c3c683e866dc63b8b2a685</span>
<span class="term-fg32">+export FEE_CURRENCY=0x000000000000000000000000000000000000ce16</span>
<span class="term-fg32">+export FEE_HANDLER=0xcd437749e43a154c07f3553504c68fbfd56b8778</span>
<span class="term-fg32">+export ORACLE3=0xbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb0003</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+export FIXIDITY_1=1000000000000000000000000</span>
<span class="term-fg32">+export ZERO_ADDRESS=0x0000000000000000000000000000000000000000</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+prepare_node () {</span>
<span class="term-fg32">+  (cd js-tests || exit 1; [[ -d node_modules ]] || npm install)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c95cbac02784568d454f8a8a" role="button"
                       aria-expanded="false" aria-controls="id-c95cbac02784568d454f8a8a">
                        <code>e2e_test/test_base_fee_recipient.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/test_base_fee_recipient.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+17</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c95cbac02784568d454f8a8a"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;test_base_fee_recipient.sh CELO&#47;e2e_test&#47;test_base_fee_recipient.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ec22198f88fbd9c83b9fd475bfacb09a3a6fe92d</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;test_base_fee_recipient.sh</span>
<span class="term-fg36">@@ -0,0 +1,17 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+#shellcheck disable=SC2086</span>
<span class="term-fg32">+set -eo pipefail</span>
<span class="term-fg32">+set -x</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+source shared.sh</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# Send token and check balance</span>
<span class="term-fg32">+balance_before=$(cast balance $FEE_HANDLER)</span>
<span class="term-fg32">+tx_json=$(cast send --json --private-key $ACC_PRIVKEY $TOKEN_ADDR &#39;transfer(address to, uint256 value) returns (bool)&#39; 0x000000000000000000000000000000000000dEaD 100)</span>
<span class="term-fg32">+gas_used=$(echo $tx_json | jq -r &#39;.gasUsed&#39;)</span>
<span class="term-fg32">+block_number=$(echo $tx_json | jq -r &#39;.blockNumber&#39; | cast to-dec)</span>
<span class="term-fg32">+base_fee=$(cast base-fee $block_number)</span>
<span class="term-fg32">+expected_balance_change=$((base_fee * gas_used))</span>
<span class="term-fg32">+balance_after=$(cast balance $FEE_HANDLER)</span>
<span class="term-fg32">+echo &quot;Balance change: $balance_before -&gt; $balance_after&quot;</span>
<span class="term-fg32">+[[ $((balance_before + expected_balance_change)) -eq $balance_after ]] || (echo &quot;Balance did not change as expected&quot;; exit 1)</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b9d99f214102f304fce84ef2" role="button"
                       aria-expanded="false" aria-controls="id-b9d99f214102f304fce84ef2">
                        <code>e2e_test/test_ethers_tx.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/test_ethers_tx.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b9d99f214102f304fce84ef2"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;test_ethers_tx.sh CELO&#47;e2e_test&#47;test_ethers_tx.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..8c94521b73ab4e314f2b965fa9896b4f39d538cd</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;test_ethers_tx.sh</span>
<span class="term-fg36">@@ -0,0 +1,7 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+set -eo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+source shared.sh</span>
<span class="term-fg32">+prepare_node</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+cd js-tests &amp;&amp; .&#47;node_modules&#47;mocha&#47;bin&#47;mocha.js test_ethers_tx.mjs</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a40bcb56031ce61377960c2b" role="button"
                       aria-expanded="false" aria-controls="id-a40bcb56031ce61377960c2b">
                        <code>e2e_test/test_fee_currency_fails_intrinsic.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/test_fee_currency_fails_intrinsic.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a40bcb56031ce61377960c2b"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;test_fee_currency_fails_intrinsic.sh CELO&#47;e2e_test&#47;test_fee_currency_fails_intrinsic.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..68213b5b7db6c3f69dd3eb84b6606f17411fb780</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;test_fee_currency_fails_intrinsic.sh</span>
<span class="term-fg36">@@ -0,0 +1,13 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+#shellcheck disable=SC2086</span>
<span class="term-fg32">+set -eo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+source shared.sh</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# Expect that the creditGasFees failed and is logged by geth</span>
<span class="term-fg32">+tail -f -n0 geth.log &gt;debug-fee-currency&#47;geth.intrinsic.log &amp; # start log capture</span>
<span class="term-fg32">+(cd debug-fee-currency &amp;&amp; .&#47;deploy_and_send_tx.sh false false true)</span>
<span class="term-fg32">+sleep 0.5</span>
<span class="term-fg32">+kill %1 # stop log capture</span>
<span class="term-fg32">+grep &quot;error crediting fee-currency: surpassed maximum allowed intrinsic gas for fee currency: out of gas&quot; debug-fee-currency&#47;geth.intrinsic.log</span>
<span class="term-fg32">+# echo $(grep &quot;send_tx hash:&quot; debug-fee-currency&#47;send_tx.intrinsic.log)</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4fe0909b655733e97e64e37a" role="button"
                       aria-expanded="false" aria-controls="id-4fe0909b655733e97e64e37a">
                        <code>e2e_test/test_fee_currency_fails_on_credit.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/test_fee_currency_fails_on_credit.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4fe0909b655733e97e64e37a"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;test_fee_currency_fails_on_credit.sh CELO&#47;e2e_test&#47;test_fee_currency_fails_on_credit.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..dbf16dfa2d804cea9642a7f6da9aa38b53f10fdc</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;test_fee_currency_fails_on_credit.sh</span>
<span class="term-fg36">@@ -0,0 +1,12 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+#shellcheck disable=SC2086</span>
<span class="term-fg32">+set -eo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+source shared.sh</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# Expect that the creditGasFees failed and is logged by geth</span>
<span class="term-fg32">+tail -f -n0 geth.log &gt;debug-fee-currency&#47;geth.partial.log &amp; # start log capture</span>
<span class="term-fg32">+(cd debug-fee-currency &amp;&amp; .&#47;deploy_and_send_tx.sh false true false)</span>
<span class="term-fg32">+sleep 0.5</span>
<span class="term-fg32">+kill %1 # stop log capture</span>
<span class="term-fg32">+grep &quot;This DebugFeeCurrency always fails in (old) creditGasFees!&quot; debug-fee-currency&#47;geth.partial.log</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1cbdd50ab5da2bd62b2eba42" role="button"
                       aria-expanded="false" aria-controls="id-1cbdd50ab5da2bd62b2eba42">
                        <code>e2e_test/test_fee_currency_fails_on_debit.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/test_fee_currency_fails_on_debit.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+10</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1cbdd50ab5da2bd62b2eba42"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;test_fee_currency_fails_on_debit.sh CELO&#47;e2e_test&#47;test_fee_currency_fails_on_debit.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..105c448e36b7cab22f0b232373b8a18bfb2d0560</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;test_fee_currency_fails_on_debit.sh</span>
<span class="term-fg36">@@ -0,0 +1,10 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+#shellcheck disable=SC2086</span>
<span class="term-fg32">+set -eo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+source shared.sh</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# Expect that the debitGasFees fails during tx submission</span>
<span class="term-fg32">+(cd debug-fee-currency &amp;&amp; .&#47;deploy_and_send_tx.sh true false false) &amp;&gt;debug-fee-currency&#47;send_tx.log || true</span>
<span class="term-fg32">+grep &quot;debitGasFees reverted: This DebugFeeCurrency always fails in debitGasFees!&quot; debug-fee-currency&#47;send_tx.log ||</span>
<span class="term-fg32">+  (cat debug-fee-currency&#47;send_tx.log &amp;&amp; false)</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9dc95edb45c16620ba06d48a" role="button"
                       aria-expanded="false" aria-controls="id-9dc95edb45c16620ba06d48a">
                        <code>e2e_test/test_token_duality.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/test_token_duality.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+12</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9dc95edb45c16620ba06d48a"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;test_token_duality.sh CELO&#47;e2e_test&#47;test_token_duality.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..355afef8c7ca71f39454d1e452c60d2046b6ebf8</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;test_token_duality.sh</span>
<span class="term-fg36">@@ -0,0 +1,12 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+#shellcheck disable=SC2086</span>
<span class="term-fg32">+set -eo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+source shared.sh</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+# Send token and check balance</span>
<span class="term-fg32">+balance_before=$(cast balance 0x000000000000000000000000000000000000dEaD)</span>
<span class="term-fg32">+cast send --private-key $ACC_PRIVKEY $TOKEN_ADDR &#39;transfer(address to, uint256 value) returns (bool)&#39; 0x000000000000000000000000000000000000dEaD 100</span>
<span class="term-fg32">+balance_after=$(cast balance 0x000000000000000000000000000000000000dEaD)</span>
<span class="term-fg32">+echo &quot;Balance change: $balance_before -&gt; $balance_after&quot;</span>
<span class="term-fg32">+[[ $((balance_before + 100)) -eq $balance_after ]] || (echo &quot;Balance did not change as expected&quot;; exit 1)</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bf55ce284008d698895b0792" role="button"
                       aria-expanded="false" aria-controls="id-bf55ce284008d698895b0792">
                        <code>e2e_test/test_viem_tx.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/e2e_test/test_viem_tx.sh" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bf55ce284008d698895b0792"><span class="term-fg1">diff --git op-geth&#47;e2e_test&#47;test_viem_tx.sh CELO&#47;e2e_test&#47;test_viem_tx.sh</span>
<span class="term-fg1">new file mode 100755</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0e4d001eda411d32e1bbca49ed3e98fbe72dc23d</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;e2e_test&#47;test_viem_tx.sh</span>
<span class="term-fg36">@@ -0,0 +1,7 @@</span>
<span class="term-fg32">+#!&#47;bin&#47;bash</span>
<span class="term-fg32">+set -eo pipefail</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+source shared.sh</span>
<span class="term-fg32">+prepare_node</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+cd js-tests &amp;&amp; .&#47;node_modules&#47;mocha&#47;bin&#47;mocha.js test_viem_tx.mjs --exit</span></div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

            
                <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-628ded04d752069dd3a63725"role="button" aria-expanded="false" aria-controls="id-628ded04d752069dd3a63725">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h2>Other changes</h2></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                    <div class="text-end"><span class="text-success">+4163</span></div>
                    <div class="text-start"><span class="text-danger">-302</span></div>
                
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-628ded04d752069dd3a63725">
        <div></div>
        <div>
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-56a026c049cea749a5e3a638" role="button"
                       aria-expanded="false" aria-controls="id-56a026c049cea749a5e3a638">
                        <code>.gitignore</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/.gitignore" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/.gitignore" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-56a026c049cea749a5e3a638"><span class="term-fg1">diff --git op-geth&#47;.gitignore CELO&#47;.gitignore</span>
<span class="term-fg1">index 3f27cdc00f0746c28f7e79285a50425f435bd0ef..3196c8484819fab224b735ea82e44396c4d3d0a8 100644</span>
<span class="term-fg1">--- op-geth&#47;.gitignore</span>
<span class="term-fg1">+++ CELO&#47;.gitignore</span>
<span class="term-fg36">@@ -14,6 +14,7 @@</span> .ethtest
 *&#47;**&#47;*tx_database*
 *&#47;**&#47;*dapps*
 build&#47;_vendor&#47;pkg
<span class="term-fg32">+node_modules</span>
&nbsp;
 #*
 .#*
<span class="term-fg36">@@ -50,3 +51,4 @@</span> **&#47;yarn-error.log
 logs&#47;
&nbsp;
 tests&#47;spec-tests&#47;
<span class="term-fg32">+e2e_test&#47;debug-fee-currency&#47;*.log</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-628f0f60a9470f92cfa587dc" role="button"
                       aria-expanded="false" aria-controls="id-628f0f60a9470f92cfa587dc">
                        <code>accounts/external/backend.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/accounts/external/backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/accounts/external/backend.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-628f0f60a9470f92cfa587dc"><span class="term-fg1">diff --git op-geth&#47;accounts&#47;external&#47;backend.go CELO&#47;accounts&#47;external&#47;backend.go</span>
<span class="term-fg1">index 6f1581f9b806deacf12a5667c24feaff003ed2f6..28c6dccabbf834ef22425ac7d368f461caf108e7 100644</span>
<span class="term-fg1">--- op-geth&#47;accounts&#47;external&#47;backend.go</span>
<span class="term-fg1">+++ CELO&#47;accounts&#47;external&#47;backend.go</span>
<span class="term-fg36">@@ -215,7 +215,7 @@</span> 	}
 	switch tx.Type() {
 	case types.LegacyTxType, types.AccessListTxType:
 		args.GasPrice = (*hexutil.Big)(tx.GasPrice())
<span class="term-fg31">-	case types.DynamicFeeTxType:</span>
<span class="term-fg32">+	case types.DynamicFeeTxType, types.CeloDynamicFeeTxV2Type, types.CeloDenominatedTxType:</span>
 		args.MaxFeePerGas = (*hexutil.Big)(tx.GasFeeCap())
 		args.MaxPriorityFeePerGas = (*hexutil.Big)(tx.GasTipCap())
 	default:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-13236655b2b99829e4c55374" role="button"
                       aria-expanded="false" aria-controls="id-13236655b2b99829e4c55374">
                        <code>accounts/keystore/account_cache_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/accounts/keystore/account_cache_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/accounts/keystore/account_cache_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-13236655b2b99829e4c55374"><span class="term-fg1">diff --git op-geth&#47;accounts&#47;keystore&#47;account_cache_test.go CELO&#47;accounts&#47;keystore&#47;account_cache_test.go</span>
<span class="term-fg1">index 48a238048fec9171334c79576286de688a6050d4..ff0daba5c441ad82cbbd2e3938323f1802da3c28 100644</span>
<span class="term-fg1">--- op-geth&#47;accounts&#47;keystore&#47;account_cache_test.go</span>
<span class="term-fg1">+++ CELO&#47;accounts&#47;keystore&#47;account_cache_test.go</span>
<span class="term-fg36">@@ -326,6 +326,11 @@</span> 	t.Parallel()
&nbsp;
 	&#47;&#47; Create a temporary keystore to test with
 	dir := filepath.Join(os.TempDir(), fmt.Sprintf(&quot;eth-keystore-updatedkeyfilecontents-test-%d-%d&quot;, os.Getpid(), rand.Int()))
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Create the directory</span>
<span class="term-fg32">+	os.MkdirAll(dir, 0700)</span>
<span class="term-fg32">+	defer os.RemoveAll(dir)</span>
<span class="term-fg32">+</span>
 	ks := NewKeyStore(dir, LightScryptN, LightScryptP)
&nbsp;
 	list := ks.Accounts()
<span class="term-fg36">@@ -335,9 +340,7 @@</span> 	}
 	if !waitWatcherStart(ks) {
 		t.Fatal(&quot;keystore watcher didn&#39;t start in time&quot;)
 	}
<span class="term-fg31">-	&#47;&#47; Create the directory and copy a key file into it.</span>
<span class="term-fg31">-	os.MkdirAll(dir, 0700)</span>
<span class="term-fg31">-	defer os.RemoveAll(dir)</span>
<span class="term-fg32">+	&#47;&#47; Copy a key file into it</span>
 	file := filepath.Join(dir, &quot;aaa&quot;)
&nbsp;
 	&#47;&#47; Place one of our testfiles in there</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-81ad58193a09849e369dc6ea" role="button"
                       aria-expanded="false" aria-controls="id-81ad58193a09849e369dc6ea">
                        <code>cmd/celotool/main.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/cmd/celotool/main.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+41</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-81ad58193a09849e369dc6ea"><span class="term-fg1">diff --git op-geth&#47;cmd&#47;celotool&#47;main.go CELO&#47;cmd&#47;celotool&#47;main.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4397c43551e884832434982e167167471b38e384</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;cmd&#47;celotool&#47;main.go</span>
<span class="term-fg36">@@ -0,0 +1,41 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2024 The celo Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of go-ethereum.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; go-ethereum is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; go-ethereum is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU General Public License</span>
<span class="term-fg32">+&#47;&#47; along with go-ethereum. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package main</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;os&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;flags&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;urfave&#47;cli&#47;v2&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var app *cli.App</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func init() {</span>
<span class="term-fg32">+	app = flags.NewApp(&quot;Celo tool&quot;)</span>
<span class="term-fg32">+	app.Commands = []*cli.Command{</span>
<span class="term-fg32">+		commandSend,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func main() {</span>
<span class="term-fg32">+	if err := app.Run(os.Args); err != nil {</span>
<span class="term-fg32">+		fmt.Fprintln(os.Stderr, err)</span>
<span class="term-fg32">+		os.Exit(1)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-262ffdf87e32778333056990" role="button"
                       aria-expanded="false" aria-controls="id-262ffdf87e32778333056990">
                        <code>cmd/celotool/send-tx.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/cmd/celotool/send-tx.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+141</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-262ffdf87e32778333056990"><span class="term-fg1">diff --git op-geth&#47;cmd&#47;celotool&#47;send-tx.go CELO&#47;cmd&#47;celotool&#47;send-tx.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7560aee30291a2045b8edb1dfa8d5d4be2b1aeb5</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;cmd&#47;celotool&#47;send-tx.go</span>
<span class="term-fg36">@@ -0,0 +1,141 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2024 The celo Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of go-ethereum.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; go-ethereum is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; go-ethereum is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU General Public License</span>
<span class="term-fg32">+&#47;&#47; along with go-ethereum. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package main</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;context&quot;</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;ethclient&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;urfave&#47;cli&#47;v2&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	rpcUrlFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:        &quot;rpc-url&quot;,</span>
<span class="term-fg32">+		Aliases:     []string{&quot;r&quot;},</span>
<span class="term-fg32">+		DefaultText: &quot;http:&#47;&#47;localhost:8545&quot;,</span>
<span class="term-fg32">+		Usage:       &quot;The rpc endpoint&quot;,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	privKeyFlag = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;private-key&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Use the provided private key&quot;,</span>
<span class="term-fg32">+		Required: true,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	valueFlag = &amp;cli.Int64Flag{</span>
<span class="term-fg32">+		Name:        &quot;value&quot;,</span>
<span class="term-fg32">+		DefaultText: &quot;0&quot;,</span>
<span class="term-fg32">+		Usage:       &quot;The value to send, in wei&quot;,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var commandSend = &amp;cli.Command{</span>
<span class="term-fg32">+	Name:      &quot;send&quot;,</span>
<span class="term-fg32">+	Usage:     &quot;send celo tx (cip-64)&quot;,</span>
<span class="term-fg32">+	ArgsUsage: &quot;[to] [feeCurrency]&quot;,</span>
<span class="term-fg32">+	Description: `</span>
<span class="term-fg32">+Send a CIP-64 transaction.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+- to: the address to send the transaction to, in hex format</span>
<span class="term-fg32">+- feeCurrency: the fee currency address, in hex format</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+Example:</span>
<span class="term-fg32">+$ celotool send --rpc-url $RPC_URL --private-key $PRIVATE_KEY $TO $FEECURRENCY --value 1</span>
<span class="term-fg32">+`,</span>
<span class="term-fg32">+	Flags: []cli.Flag{</span>
<span class="term-fg32">+		rpcUrlFlag,</span>
<span class="term-fg32">+		privKeyFlag,</span>
<span class="term-fg32">+		valueFlag,</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+	Action: func(ctx *cli.Context) error {</span>
<span class="term-fg32">+		privKeyRaw := ctx.String(&quot;private-key&quot;)</span>
<span class="term-fg32">+		if len(privKeyRaw) &gt;= 2 &amp;&amp; privKeyRaw[0] == &#39;0&#39; &amp;&amp; (privKeyRaw[1] == &#39;x&#39; || privKeyRaw[1] == &#39;X&#39;) {</span>
<span class="term-fg32">+			privKeyRaw = privKeyRaw[2:]</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		privateKey, err := crypto.HexToECDSA(privKeyRaw)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		to := ctx.Args().Get(0)</span>
<span class="term-fg32">+		if to == &quot;&quot; {</span>
<span class="term-fg32">+			fmt.Println(&quot;missing &#39;to&#39; address&quot;)</span>
<span class="term-fg32">+			return nil</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		toAddress := common.HexToAddress(to)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		feeCurrency := ctx.Args().Get(1)</span>
<span class="term-fg32">+		if feeCurrency == &quot;&quot; {</span>
<span class="term-fg32">+			fmt.Println(&quot;missing &#39;feeCurrency&#39; address&quot;)</span>
<span class="term-fg32">+			return nil</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		feeCurrencyAddress := common.HexToAddress(feeCurrency)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		value := big.NewInt(ctx.Int64(&quot;value&quot;))</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		rpcUrl := ctx.String(&quot;rpc-url&quot;)</span>
<span class="term-fg32">+		client, err := ethclient.Dial(rpcUrl)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		chainId, err := client.ChainID(context.Background())</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		nonce, err := client.PendingNonceAt(context.Background(), crypto.PubkeyToAddress(privateKey.PublicKey))</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		feeCap, err := client.SuggestGasPriceForCurrency(context.Background(), &amp;feeCurrencyAddress)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		txdata := &amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+			ChainID:     chainId,</span>
<span class="term-fg32">+			Nonce:       nonce,</span>
<span class="term-fg32">+			To:          &amp;toAddress,</span>
<span class="term-fg32">+			Gas:         100_000,</span>
<span class="term-fg32">+			GasFeeCap:   feeCap,</span>
<span class="term-fg32">+			GasTipCap:   big.NewInt(2),</span>
<span class="term-fg32">+			FeeCurrency: &amp;feeCurrencyAddress,</span>
<span class="term-fg32">+			Value:       value,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		signer := types.LatestSignerForChainID(chainId)</span>
<span class="term-fg32">+		tx, err := types.SignNewTx(privateKey, signer, txdata)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		err = client.SendTransaction(context.Background(), tx)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		fmt.Printf(&quot;tx sent: %s\n&quot;, tx.Hash().Hex())</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-14bd2fac74eb272ec2d4487b" role="button"
                       aria-expanded="false" aria-controls="id-14bd2fac74eb272ec2d4487b">
                        <code>cmd/evm/internal/t8ntool/execution.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/cmd/evm/internal/t8ntool/execution.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/cmd/evm/internal/t8ntool/execution.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-14bd2fac74eb272ec2d4487b"><span class="term-fg1">diff --git op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go CELO&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg1">index cb975054c1b284a91baeced4af7c7eeecea568f3..aa464f9c89cf1c20381d995bbd65ad4ffb5e01da 100644</span>
<span class="term-fg1">--- op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg1">+++ CELO&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;execution.go</span>
<span class="term-fg36">@@ -206,7 +206,12 @@</span> 			log.Warn(&quot;rejected tx&quot;, &quot;index&quot;, i, &quot;hash&quot;, tx.Hash(), &quot;error&quot;, errMsg)
 			rejectedTxs = append(rejectedTxs, &amp;rejectedTx{i, errMsg})
 			continue
 		}
<span class="term-fg31">-		msg, err := core.TransactionToMessage(tx, signer, pre.Env.BaseFee)</span>
<span class="term-fg32">+		&#47;&#47; NOTE: we can&#39;t provide exchange rates</span>
<span class="term-fg32">+		&#47;&#47; for fee-currencies here, since those are dynamically changing</span>
<span class="term-fg32">+		&#47;&#47; based on the oracle&#39;s exchange rates.</span>
<span class="term-fg32">+		&#47;&#47; When a Celo transaction with specified fee-currency is validated with this tool,</span>
<span class="term-fg32">+		&#47;&#47; this will thus result in a ErrUnregisteredFeeCurrency error for now.</span>
<span class="term-fg32">+		msg, err := core.TransactionToMessage(tx, signer, pre.Env.BaseFee, vmContext.FeeCurrencyContext.ExchangeRates)</span>
 		if err != nil {
 			log.Warn(&quot;rejected tx&quot;, &quot;index&quot;, i, &quot;hash&quot;, tx.Hash(), &quot;error&quot;, err)
 			rejectedTxs = append(rejectedTxs, &amp;rejectedTx{i, err.Error()})</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-be21730b35c64dbe252df946" role="button"
                       aria-expanded="false" aria-controls="id-be21730b35c64dbe252df946">
                        <code>cmd/evm/internal/t8ntool/transaction.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/cmd/evm/internal/t8ntool/transaction.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/cmd/evm/internal/t8ntool/transaction.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-be21730b35c64dbe252df946"><span class="term-fg1">diff --git op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;transaction.go CELO&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;transaction.go</span>
<span class="term-fg1">index 8533b78637696ccc1461e6177e937ca1f6be69a1..b1998b546580e375e0d649e55b37ece23817cbfd 100644</span>
<span class="term-fg1">--- op-geth&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;transaction.go</span>
<span class="term-fg1">+++ CELO&#47;cmd&#47;evm&#47;internal&#47;t8ntool&#47;transaction.go</span>
<span class="term-fg36">@@ -133,8 +133,14 @@</span> 		} else {
 			r.Address = sender
 		}
 		&#47;&#47; Check intrinsic gas
<span class="term-fg32">+		&#47;&#47; NOTE: we can&#39;t provide specific intrinsic gas costs</span>
<span class="term-fg32">+		&#47;&#47; for fee-currencies here, since those are written to the</span>
<span class="term-fg32">+		&#47;&#47; FeeCurrencyDirectory contract and are chain-specific.</span>
<span class="term-fg32">+		&#47;&#47; When a Celo transaction with specified fee-currency is validated with this tool,</span>
<span class="term-fg32">+		&#47;&#47; this will thus result in a ErrUnregisteredFeeCurrency error for now.</span>
<span class="term-fg32">+		var feeIntrinsic common.IntrinsicGasCosts</span>
 		if gas, err := core.IntrinsicGas(tx.Data(), tx.AccessList(), tx.To() == nil,
<span class="term-fg31">-			chainConfig.IsHomestead(new(big.Int)), chainConfig.IsIstanbul(new(big.Int)), chainConfig.IsShanghai(new(big.Int), 0)); err != nil {</span>
<span class="term-fg32">+			chainConfig.IsHomestead(new(big.Int)), chainConfig.IsIstanbul(new(big.Int)), chainConfig.IsShanghai(new(big.Int), 0), tx.FeeCurrency(), feeIntrinsic); err != nil {</span>
 			r.Error = err
 			results = append(results, r)
 			continue</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-589a50299dd66de71f3f3d45" role="button"
                       aria-expanded="false" aria-controls="id-589a50299dd66de71f3f3d45">
                        <code>cmd/geth/config.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/cmd/geth/config.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/cmd/geth/config.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-589a50299dd66de71f3f3d45"><span class="term-fg1">diff --git op-geth&#47;cmd&#47;geth&#47;config.go CELO&#47;cmd&#47;geth&#47;config.go</span>
<span class="term-fg1">index 6a4dbc2c2e6b0b77910d17a6c453c64fd454a02f..cd6ba95013b3c3bfd52835c8e993a5f29b4a84ec 100644</span>
<span class="term-fg1">--- op-geth&#47;cmd&#47;geth&#47;config.go</span>
<span class="term-fg1">+++ CELO&#47;cmd&#47;geth&#47;config.go</span>
<span class="term-fg36">@@ -199,6 +199,11 @@</span> 		v := ctx.Uint64(utils.OverrideVerkle.Name)
 		cfg.Eth.OverrideVerkle = &amp;v
 	}
&nbsp;
<span class="term-fg32">+	if ctx.IsSet(utils.OverrideOptimismCel2.Name) {</span>
<span class="term-fg32">+		v := ctx.Uint64(utils.OverrideOptimismCel2.Name)</span>
<span class="term-fg32">+		cfg.Eth.OverrideOptimismCel2 = &amp;v</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	backend, eth := utils.RegisterEthService(stack, &amp;cfg.Eth)
&nbsp;
 	&#47;&#47; Create gauge with geth system and build information</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c4908a7726054aa8459cab46" role="button"
                       aria-expanded="false" aria-controls="id-c4908a7726054aa8459cab46">
                        <code>cmd/geth/main.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/cmd/geth/main.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/cmd/geth/main.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c4908a7726054aa8459cab46"><span class="term-fg1">diff --git op-geth&#47;cmd&#47;geth&#47;main.go CELO&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg1">index d987364ca16887d5cea85d88a3e07e3080d82390..e91ca41a21aeb7c1a7a9a1dc4b237488059a9f9e 100644</span>
<span class="term-fg1">--- op-geth&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg1">+++ CELO&#47;cmd&#47;geth&#47;main.go</span>
<span class="term-fg36">@@ -71,6 +71,7 @@</span> 		utils.OverrideOptimismCanyon,
 		utils.OverrideOptimismEcotone,
 		utils.OverrideOptimismFjord,
 		utils.OverrideOptimismInterop,
<span class="term-fg32">+		utils.OverrideOptimismCel2,</span>
 		utils.EnablePersonal,
 		utils.TxPoolLocalsFlag,
 		utils.TxPoolNoLocalsFlag,
<span class="term-fg36">@@ -129,6 +130,8 @@</span> 		utils.MinerEtherbaseFlag,
 		utils.MinerExtraDataFlag,
 		utils.MinerRecommitIntervalFlag,
 		utils.MinerNewPayloadTimeout,
<span class="term-fg32">+		utils.CeloFeeCurrencyDefault,</span>
<span class="term-fg32">+		utils.CeloFeeCurrencyLimits,</span>
 		utils.NATFlag,
 		utils.NoDiscoverFlag,
 		utils.DiscoveryV4Flag,</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e26853a2bb324431bb9a29a8" role="button"
                       aria-expanded="false" aria-controls="id-e26853a2bb324431bb9a29a8">
                        <code>cmd/utils/flags.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/cmd/utils/flags.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/cmd/utils/flags.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+51</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e26853a2bb324431bb9a29a8"><span class="term-fg1">diff --git op-geth&#47;cmd&#47;utils&#47;flags.go CELO&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg1">index f4ecd35287b786583f4330f146ac6ff5c9fd50de..960f598bf7cba85a20a7423c9e8cf2171e2fc8f7 100644</span>
<span class="term-fg1">--- op-geth&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg1">+++ CELO&#47;cmd&#47;utils&#47;flags.go</span>
<span class="term-fg36">@@ -281,6 +281,11 @@</span> 		Name:     &quot;override.interop&quot;,
 		Usage:    &quot;Manually specify the Optimsim Interop feature-set fork timestamp, overriding the bundled setting&quot;,
 		Category: flags.EthCategory,
 	}
<span class="term-fg32">+	OverrideOptimismCel2 = &amp;flags.BigFlag{</span>
<span class="term-fg32">+		Name:     &quot;override.cel2&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Manually specify the OptimismCel2 fork timestamp, overriding the bundled setting&quot;,</span>
<span class="term-fg32">+		Category: flags.EthCategory,</span>
<span class="term-fg32">+	}</span>
 	SyncModeFlag = &amp;flags.TextMarshalerFlag{
 		Name:     &quot;syncmode&quot;,
 		Usage:    `Blockchain sync mode (&quot;snap&quot; or &quot;full&quot;)`,
<span class="term-fg36">@@ -502,6 +507,17 @@</span> 	MinerNewPayloadTimeout = &amp;cli.DurationFlag{
 		Name:     &quot;miner.newpayload-timeout&quot;,
 		Usage:    &quot;Specify the maximum time allowance for creating a new payload&quot;,
 		Value:    ethconfig.Defaults.Miner.NewPayloadTimeout,
<span class="term-fg32">+		Category: flags.MinerCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	CeloFeeCurrencyDefault = &amp;cli.Float64Flag{</span>
<span class="term-fg32">+		Name:     &quot;celo.feecurrency.default&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Default fraction of block gas limit available for TXs paid with a whitelisted alternative currency&quot;,</span>
<span class="term-fg32">+		Value:    ethconfig.Defaults.Miner.FeeCurrencyDefault,</span>
<span class="term-fg32">+		Category: flags.MinerCategory,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	CeloFeeCurrencyLimits = &amp;cli.StringFlag{</span>
<span class="term-fg32">+		Name:     &quot;celo.feecurrency.limits&quot;,</span>
<span class="term-fg32">+		Usage:    &quot;Comma separated currency address-to-block percentage mappings (&lt;address&gt;=&lt;fraction&gt;)&quot;,</span>
 		Category: flags.MinerCategory,
 	}
&nbsp;
<span class="term-fg36">@@ -1637,6 +1653,39 @@</span> 		cfg.RollupComputePendingBlock = ctx.Bool(RollupComputePendingBlock.Name)
 	}
 }
&nbsp;
<span class="term-fg32">+func setCeloMiner(ctx *cli.Context, cfg *miner.Config, networkId uint64) {</span>
<span class="term-fg32">+	cfg.FeeCurrencyDefault = ctx.Float64(CeloFeeCurrencyDefault.Name)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	defaultLimits, ok := miner.DefaultFeeCurrencyLimits[networkId]</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		defaultLimits = make(map[common.Address]float64)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	cfg.FeeCurrencyLimits = defaultLimits</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if ctx.IsSet(CeloFeeCurrencyLimits.Name) {</span>
<span class="term-fg32">+		feeCurrencyLimits := ctx.String(CeloFeeCurrencyLimits.Name)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		for _, entry := range strings.Split(feeCurrencyLimits, &quot;,&quot;) {</span>
<span class="term-fg32">+			parts := strings.Split(entry, &quot;=&quot;)</span>
<span class="term-fg32">+			if len(parts) != 2 {</span>
<span class="term-fg32">+				Fatalf(&quot;Invalid fee currency limits entry: %s&quot;, entry)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			var address common.Address</span>
<span class="term-fg32">+			if err := address.UnmarshalText([]byte(parts[0])); err != nil {</span>
<span class="term-fg32">+				Fatalf(&quot;Invalid fee currency address hash %s: %v&quot;, parts[0], err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			fraction, err := strconv.ParseFloat(parts[1], 64)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				Fatalf(&quot;Invalid block limit fraction %s: %v&quot;, parts[1], err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			cfg.FeeCurrencyLimits[address] = fraction</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 func setRequiredBlocks(ctx *cli.Context, cfg *ethconfig.Config) {
 	requiredBlocks := ctx.String(EthRequiredBlocksFlag.Name)
 	if requiredBlocks == &quot;&quot; {
<span class="term-fg36">@@ -1986,6 +2035,8 @@</span> 	log.Info(&quot;Initializing the KZG library&quot;, &quot;backend&quot;, ctx.String(CryptoKZGFlag.Name))
 	if err := kzg4844.UseCKZG(ctx.String(CryptoKZGFlag.Name) == &quot;ckzg&quot;); err != nil {
 		Fatalf(&quot;Failed to set KZG library implementation to %s: %v&quot;, ctx.String(CryptoKZGFlag.Name), err)
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	setCeloMiner(ctx, &amp;cfg.Miner, cfg.NetworkId)</span>
 }
&nbsp;
 &#47;&#47; SetDNSDiscoveryDefaults configures DNS discovery with the given URL if</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7038c6653aa52cf5b338ca95" role="button"
                       aria-expanded="false" aria-controls="id-7038c6653aa52cf5b338ca95">
                        <code>common/celo_types.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/common/celo_types.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+75</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7038c6653aa52cf5b338ca95"><span class="term-fg1">diff --git op-geth&#47;common&#47;celo_types.go CELO&#47;common&#47;celo_types.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..390cc13138748f26f98d18494f474cdb41ffac76</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;common&#47;celo_types.go</span>
<span class="term-fg36">@@ -0,0 +1,75 @@</span>
<span class="term-fg32">+package common</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	ZeroAddress = BytesToAddress([]byte{})</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type ExchangeRates = map[Address]*big.Rat</span>
<span class="term-fg32">+type IntrinsicGasCosts = map[Address]uint64</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type FeeCurrencyContext struct {</span>
<span class="term-fg32">+	ExchangeRates     ExchangeRates</span>
<span class="term-fg32">+	IntrinsicGasCosts IntrinsicGasCosts</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func MaxAllowedIntrinsicGasCost(i IntrinsicGasCosts, feeCurrency *Address) (uint64, bool) {</span>
<span class="term-fg32">+	intrinsicGas, ok := CurrencyIntrinsicGasCost(i, feeCurrency)</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		return 0, false</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Allow the contract to overshoot 2 times the deducted intrinsic gas</span>
<span class="term-fg32">+	&#47;&#47; during execution.</span>
<span class="term-fg32">+	&#47;&#47; If the feeCurrency is nil, then the max allowed intrinsic gas cost</span>
<span class="term-fg32">+	&#47;&#47; is 0 (i.e. not allowed) for a fee-currency specific EVM call within the STF.</span>
<span class="term-fg32">+	return intrinsicGas * 3, true</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func CurrencyIntrinsicGasCost(i IntrinsicGasCosts, feeCurrency *Address) (uint64, bool) {</span>
<span class="term-fg32">+	&#47;&#47; the additional intrinsic gas cost for a non fee-currency</span>
<span class="term-fg32">+	&#47;&#47; transaction is 0</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		return 0, true</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	gasCost, ok := i[*feeCurrency]</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		return 0, false</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return gasCost, true</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func CurrencyAllowlist(exchangeRates ExchangeRates) []Address {</span>
<span class="term-fg32">+	addrs := make([]Address, len(exchangeRates))</span>
<span class="term-fg32">+	i := 0</span>
<span class="term-fg32">+	for k := range exchangeRates {</span>
<span class="term-fg32">+		addrs[i] = k</span>
<span class="term-fg32">+		i++</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return addrs</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func IsCurrencyAllowed(exchangeRates ExchangeRates, feeCurrency *Address) bool {</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		return true</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Check if fee currency is registered</span>
<span class="term-fg32">+	_, ok := exchangeRates[*feeCurrency]</span>
<span class="term-fg32">+	return ok</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func AreSameAddress(a, b *Address) bool {</span>
<span class="term-fg32">+	&#47;&#47; both are nil or point to the same address</span>
<span class="term-fg32">+	if a == b {</span>
<span class="term-fg32">+		return true</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; if only one is nil</span>
<span class="term-fg32">+	if a == nil || b == nil {</span>
<span class="term-fg32">+		return false</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; if they point to the same</span>
<span class="term-fg32">+	return *a == *b</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-df43d8c0b50d9ca46e7861e2" role="button"
                       aria-expanded="false" aria-controls="id-df43d8c0b50d9ca46e7861e2">
                        <code>common/celo_types_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/common/celo_types_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+47</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-df43d8c0b50d9ca46e7861e2"><span class="term-fg1">diff --git op-geth&#47;common&#47;celo_types_test.go CELO&#47;common&#47;celo_types_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..4db38cdf1461834fe78e34a867749662b0ccaf58</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;common&#47;celo_types_test.go</span>
<span class="term-fg36">@@ -0,0 +1,47 @@</span>
<span class="term-fg32">+package common</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	currA         = HexToAddress(&quot;0xA&quot;)</span>
<span class="term-fg32">+	currB         = HexToAddress(&quot;0xB&quot;)</span>
<span class="term-fg32">+	currX         = HexToAddress(&quot;0xF&quot;)</span>
<span class="term-fg32">+	exchangeRates = ExchangeRates{</span>
<span class="term-fg32">+		currA: big.NewRat(47, 100),</span>
<span class="term-fg32">+		currB: big.NewRat(45, 100),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestIsCurrencyAllowed(t *testing.T) {</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		name        string</span>
<span class="term-fg32">+		feeCurrency *Address</span>
<span class="term-fg32">+		want        bool</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:        &quot;no fee currency&quot;,</span>
<span class="term-fg32">+			feeCurrency: nil,</span>
<span class="term-fg32">+			want:        true,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:        &quot;valid fee currency&quot;,</span>
<span class="term-fg32">+			feeCurrency: &amp;currA,</span>
<span class="term-fg32">+			want:        true,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:        &quot;invalid fee currency&quot;,</span>
<span class="term-fg32">+			feeCurrency: &amp;currX,</span>
<span class="term-fg32">+			want:        false,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for _, tt := range tests {</span>
<span class="term-fg32">+		t.Run(tt.name, func(t *testing.T) {</span>
<span class="term-fg32">+			if got := IsCurrencyAllowed(exchangeRates, tt.feeCurrency); got != tt.want {</span>
<span class="term-fg32">+				t.Errorf(&quot;IsCurrencyAllowed() = %v, want %v&quot;, got, tt.want)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ba45e29bf9c58b40ce8377ef" role="button"
                       aria-expanded="false" aria-controls="id-ba45e29bf9c58b40ce8377ef">
                        <code>common/exchange/rates.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/common/exchange/rates.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+162</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ba45e29bf9c58b40ce8377ef"><span class="term-fg1">diff --git op-geth&#47;common&#47;exchange&#47;rates.go CELO&#47;common&#47;exchange&#47;rates.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..86f966a64fde53ceaba61c8f6f797692a69a28be</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;common&#47;exchange&#47;rates.go</span>
<span class="term-fg36">@@ -0,0 +1,162 @@</span>
<span class="term-fg32">+package exchange</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;errors&quot;</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	unitRate = big.NewRat(1, 1)</span>
<span class="term-fg32">+	&#47;&#47; ErrUnregisteredFeeCurrency is returned if the currency specified to use for the fees</span>
<span class="term-fg32">+	&#47;&#47; isn&#39;t one of the currencies whitelisted for that purpose.</span>
<span class="term-fg32">+	ErrUnregisteredFeeCurrency = errors.New(&quot;unregistered fee-currency address&quot;)</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; ConvertCurrency does an exchange conversion from currencyFrom to currencyTo of the value given.</span>
<span class="term-fg32">+func ConvertCurrency(exchangeRates common.ExchangeRates, val1 *big.Int, currencyFrom *common.Address, currencyTo *common.Address) *big.Int {</span>
<span class="term-fg32">+	celoAmount, err := ConvertCurrencyToCelo(exchangeRates, val1, currencyFrom)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		log.Error(&quot;Error trying to convert from currency to CELO.&quot;, &quot;value&quot;, val1, &quot;fromCurrency&quot;, currencyFrom.Hex())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	toAmount, err := ConvertCeloToCurrency(exchangeRates, currencyTo, celoAmount)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		log.Error(&quot;Error trying to convert from CELO to currency.&quot;, &quot;value&quot;, celoAmount, &quot;toCurrency&quot;, currencyTo.Hex())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return toAmount</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func ConvertCurrencyToCelo(exchangeRates common.ExchangeRates, currencyAmount *big.Int, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		return currencyAmount, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	exchangeRate, ok := exchangeRates[*feeCurrency]</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;could not convert from fee currency to native (fee-currency=%s): %w &quot;, feeCurrency, ErrUnregisteredFeeCurrency)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return new(big.Int).Div(new(big.Int).Mul(currencyAmount, exchangeRate.Denom()), exchangeRate.Num()), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func ConvertCeloToCurrency(exchangeRates common.ExchangeRates, feeCurrency *common.Address, celoAmount *big.Int) (*big.Int, error) {</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		return celoAmount, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	exchangeRate, ok := exchangeRates[*feeCurrency]</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;could not convert from native to fee currency (fee-currency=%s): %w &quot;, feeCurrency, ErrUnregisteredFeeCurrency)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return new(big.Int).Div(new(big.Int).Mul(celoAmount, exchangeRate.Num()), exchangeRate.Denom()), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func getRate(exchangeRates common.ExchangeRates, feeCurrency *common.Address) (*big.Rat, error) {</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		return unitRate, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	rate, ok := exchangeRates[*feeCurrency]</span>
<span class="term-fg32">+	if !ok {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;fee currency not registered: %s&quot;, feeCurrency.Hex())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return rate, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CompareValue compares values in different currencies (nil currency is native currency)</span>
<span class="term-fg32">+&#47;&#47; returns -1 0 or 1 depending if val1 &lt; val2, val1 == val2, or val1 &gt; val2 respectively.</span>
<span class="term-fg32">+func CompareValue(exchangeRates common.ExchangeRates, val1 *big.Int, feeCurrency1 *common.Address, val2 *big.Int, feeCurrency2 *common.Address) (int, error) {</span>
<span class="term-fg32">+	&#47;&#47; Short circuit if the fee currency is the same.</span>
<span class="term-fg32">+	if feeCurrency1 == feeCurrency2 {</span>
<span class="term-fg32">+		return val1.Cmp(val2), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	exchangeRate1, err := getRate(exchangeRates, feeCurrency1)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return 0, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	exchangeRate2, err := getRate(exchangeRates, feeCurrency2)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return 0, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Below code block is basically evaluating this comparison:</span>
<span class="term-fg32">+	&#47;&#47; val1 * exchangeRate1.denominator &#47; exchangeRate1.numerator &lt; val2 * exchangeRate2.denominator &#47; exchangeRate2.numerator</span>
<span class="term-fg32">+	&#47;&#47; It will transform that comparison to this, to remove having to deal with fractional values.</span>
<span class="term-fg32">+	&#47;&#47; val1 * exchangeRate1.denominator * exchangeRate2.numerator &lt; val2 * exchangeRate2.denominator * exchangeRate1.numerator</span>
<span class="term-fg32">+	leftSide := new(big.Int).Mul(</span>
<span class="term-fg32">+		val1,</span>
<span class="term-fg32">+		new(big.Int).Mul(</span>
<span class="term-fg32">+			exchangeRate1.Denom(),</span>
<span class="term-fg32">+			exchangeRate2.Num(),</span>
<span class="term-fg32">+		),</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	rightSide := new(big.Int).Mul(</span>
<span class="term-fg32">+		val2,</span>
<span class="term-fg32">+		new(big.Int).Mul(</span>
<span class="term-fg32">+			exchangeRate2.Denom(),</span>
<span class="term-fg32">+			exchangeRate1.Num(),</span>
<span class="term-fg32">+		),</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return leftSide.Cmp(rightSide), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; RatesAndFees holds exchange rates and the basefees expressed in the rates currencies.</span>
<span class="term-fg32">+type RatesAndFees struct {</span>
<span class="term-fg32">+	Rates common.ExchangeRates</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	nativeBaseFee    *big.Int</span>
<span class="term-fg32">+	currencyBaseFees map[common.Address]*big.Int</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewRatesAndFees creates a new empty RatesAndFees object.</span>
<span class="term-fg32">+func NewRatesAndFees(rates common.ExchangeRates, nativeBaseFee *big.Int) *RatesAndFees {</span>
<span class="term-fg32">+	&#47;&#47; While it could be made so that currency basefees are calculated on demand,</span>
<span class="term-fg32">+	&#47;&#47; the low amount of these (usually N &lt; 20)</span>
<span class="term-fg32">+	return &amp;RatesAndFees{</span>
<span class="term-fg32">+		Rates:            rates,</span>
<span class="term-fg32">+		nativeBaseFee:    nativeBaseFee,</span>
<span class="term-fg32">+		currencyBaseFees: make(map[common.Address]*big.Int, len(rates)),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; HasBaseFee returns if the basefee is set.</span>
<span class="term-fg32">+func (rf *RatesAndFees) HasBaseFee() bool {</span>
<span class="term-fg32">+	return rf.nativeBaseFee != nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetNativeBaseFee returns the basefee in celo currency.</span>
<span class="term-fg32">+func (rf *RatesAndFees) GetNativeBaseFee() *big.Int {</span>
<span class="term-fg32">+	return rf.nativeBaseFee</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetBaseFeeIn returns the basefee expressed in the specified currency. Returns nil</span>
<span class="term-fg32">+&#47;&#47; if the currency is not allowlisted.</span>
<span class="term-fg32">+func (rf *RatesAndFees) GetBaseFeeIn(currency *common.Address) *big.Int {</span>
<span class="term-fg32">+	&#47;&#47; If native currency is being requested, return it</span>
<span class="term-fg32">+	if currency == nil {</span>
<span class="term-fg32">+		return rf.nativeBaseFee</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; If a non-native currency is being requested, but it is nil,</span>
<span class="term-fg32">+	&#47;&#47; it means there is no baseFee in this context. Return nil as well.</span>
<span class="term-fg32">+	if rf.nativeBaseFee == nil {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Check the cache</span>
<span class="term-fg32">+	baseFee, ok := rf.currencyBaseFees[*currency]</span>
<span class="term-fg32">+	if ok {</span>
<span class="term-fg32">+		return baseFee</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Not found, calculate</span>
<span class="term-fg32">+	calculatedBaseFee, err := ConvertCeloToCurrency(rf.Rates, currency, rf.nativeBaseFee)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		&#47;&#47; Should never happen: error lvl log line</span>
<span class="term-fg32">+		log.Error(&quot;BaseFee requested for unregistered currency&quot;,</span>
<span class="term-fg32">+			&quot;currency&quot;, currency.Hex(),</span>
<span class="term-fg32">+			&quot;exchangeRates&quot;, rf.Rates,</span>
<span class="term-fg32">+			&quot;cause&quot;, err)</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	rf.currencyBaseFees[*currency] = calculatedBaseFee</span>
<span class="term-fg32">+	return calculatedBaseFee</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f7342b6591255df5afb79e73" role="button"
                       aria-expanded="false" aria-controls="id-f7342b6591255df5afb79e73">
                        <code>common/exchange/rates_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/common/exchange/rates_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+171</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f7342b6591255df5afb79e73"><span class="term-fg1">diff --git op-geth&#47;common&#47;exchange&#47;rates_test.go CELO&#47;common&#47;exchange&#47;rates_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..3cda8eb530ff2a9df75aebad4619d76c52aab558</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;common&#47;exchange&#47;rates_test.go</span>
<span class="term-fg36">@@ -0,0 +1,171 @@</span>
<span class="term-fg32">+package exchange</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	currA         = common.HexToAddress(&quot;0xA&quot;)</span>
<span class="term-fg32">+	currB         = common.HexToAddress(&quot;0xB&quot;)</span>
<span class="term-fg32">+	currX         = common.HexToAddress(&quot;0xF&quot;)</span>
<span class="term-fg32">+	exchangeRates = common.ExchangeRates{</span>
<span class="term-fg32">+		currA: big.NewRat(47, 100),</span>
<span class="term-fg32">+		currB: big.NewRat(45, 100),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCompareFees(t *testing.T) {</span>
<span class="term-fg32">+	type args struct {</span>
<span class="term-fg32">+		val1         *big.Int</span>
<span class="term-fg32">+		feeCurrency1 *common.Address</span>
<span class="term-fg32">+		val2         *big.Int</span>
<span class="term-fg32">+		feeCurrency2 *common.Address</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	tests := []struct {</span>
<span class="term-fg32">+		name       string</span>
<span class="term-fg32">+		args       args</span>
<span class="term-fg32">+		wantResult int</span>
<span class="term-fg32">+		wantErr    bool</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		&#47;&#47; Native currency</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Same amount of native currency&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency1: nil,</span>
<span class="term-fg32">+				val2:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency2: nil,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: 0,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of native currency 1&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(2),</span>
<span class="term-fg32">+				feeCurrency1: nil,</span>
<span class="term-fg32">+				val2:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency2: nil,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: 1,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of native currency 2&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency1: nil,</span>
<span class="term-fg32">+				val2:         big.NewInt(5),</span>
<span class="term-fg32">+				feeCurrency2: nil,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: -1,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Mixed currency</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Same amount of mixed currency&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency1: nil,</span>
<span class="term-fg32">+				val2:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currA,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: -1,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of mixed currency 1&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(100),</span>
<span class="term-fg32">+				feeCurrency1: nil,</span>
<span class="term-fg32">+				val2:         big.NewInt(47),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currA,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: 0,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of mixed currency 2&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(45),</span>
<span class="term-fg32">+				feeCurrency1: &amp;currB,</span>
<span class="term-fg32">+				val2:         big.NewInt(100),</span>
<span class="term-fg32">+				feeCurrency2: nil,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: 0,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Two fee currencies</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Same amount of same currency&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency1: &amp;currA,</span>
<span class="term-fg32">+				val2:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currA,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: 0,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of same currency 1&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(3),</span>
<span class="term-fg32">+				feeCurrency1: &amp;currA,</span>
<span class="term-fg32">+				val2:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currA,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: 1,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of same currency 2&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency1: &amp;currA,</span>
<span class="term-fg32">+				val2:         big.NewInt(7),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currA,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: -1,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of different currencies 1&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(47),</span>
<span class="term-fg32">+				feeCurrency1: &amp;currA,</span>
<span class="term-fg32">+				val2:         big.NewInt(45),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currB,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: 0,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of different currencies 2&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(48),</span>
<span class="term-fg32">+				feeCurrency1: &amp;currA,</span>
<span class="term-fg32">+				val2:         big.NewInt(45),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currB,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: 1,</span>
<span class="term-fg32">+		}, {</span>
<span class="term-fg32">+			name: &quot;Different amounts of different currencies 3&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(47),</span>
<span class="term-fg32">+				feeCurrency1: &amp;currA,</span>
<span class="term-fg32">+				val2:         big.NewInt(46),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currB,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantResult: -1,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; Unregistered fee currency</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name: &quot;Different amounts of different currencies&quot;,</span>
<span class="term-fg32">+			args: args{</span>
<span class="term-fg32">+				val1:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency1: &amp;currA,</span>
<span class="term-fg32">+				val2:         big.NewInt(1),</span>
<span class="term-fg32">+				feeCurrency2: &amp;currX,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			wantErr: true,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	for _, tt := range tests {</span>
<span class="term-fg32">+		t.Run(tt.name, func(t *testing.T) {</span>
<span class="term-fg32">+			got, err := CompareValue(exchangeRates, tt.args.val1, tt.args.feeCurrency1, tt.args.val2, tt.args.feeCurrency2)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			if tt.wantErr &amp;&amp; err == nil {</span>
<span class="term-fg32">+				t.Error(&quot;Expected error in CompareValue()&quot;)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if got != tt.wantResult {</span>
<span class="term-fg32">+				t.Errorf(&quot;CompareValue() = %v, want %v&quot;, got, tt.wantResult)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-49d99b3b712fcc6b1d87ba07" role="button"
                       aria-expanded="false" aria-controls="id-49d99b3b712fcc6b1d87ba07">
                        <code>consensus/misc/eip1559/eip1559.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/consensus/misc/eip1559/eip1559.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/consensus/misc/eip1559/eip1559.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-49d99b3b712fcc6b1d87ba07"><span class="term-fg1">diff --git op-geth&#47;consensus&#47;misc&#47;eip1559&#47;eip1559.go CELO&#47;consensus&#47;misc&#47;eip1559&#47;eip1559.go</span>
<span class="term-fg1">index a66298af692fbb7bb477847452aff5937af55c83..d21e41654dd453ea226d0999a4bf97fc19d4b5d8 100644</span>
<span class="term-fg1">--- op-geth&#47;consensus&#47;misc&#47;eip1559&#47;eip1559.go</span>
<span class="term-fg1">+++ CELO&#47;consensus&#47;misc&#47;eip1559&#47;eip1559.go</span>
<span class="term-fg36">@@ -58,6 +58,12 @@</span>
 &#47;&#47; CalcBaseFee calculates the basefee of the header.
 &#47;&#47; The time belongs to the new block to check if Canyon is activted or not
 func CalcBaseFee(config *params.ChainConfig, parent *types.Header, time uint64) *big.Int {
<span class="term-fg32">+	&#47;&#47; If this is the cel2 transition block and the parent block has a base fee</span>
<span class="term-fg32">+	&#47;&#47; then use that.</span>
<span class="term-fg32">+	if config.Cel2Time != nil &amp;&amp; *config.Cel2Time == time &amp;&amp; parent.BaseFee != nil {</span>
<span class="term-fg32">+		return parent.BaseFee</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	&#47;&#47; If the current block is the first EIP-1559 block, return the InitialBaseFee.
 	if !config.IsLondon(parent.Number) {
 		return new(big.Int).SetUint64(params.InitialBaseFee)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-001e8e8eedef040fe94c77a4" role="button"
                       aria-expanded="false" aria-controls="id-001e8e8eedef040fe94c77a4">
                        <code>consensus/misc/eip1559/eip1559_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/consensus/misc/eip1559/eip1559_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/consensus/misc/eip1559/eip1559_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-001e8e8eedef040fe94c77a4"><span class="term-fg1">diff --git op-geth&#47;consensus&#47;misc&#47;eip1559&#47;eip1559_test.go CELO&#47;consensus&#47;misc&#47;eip1559&#47;eip1559_test.go</span>
<span class="term-fg1">index d34da8fd8bbb21a6a649384435c3926a6735083d..39766b57cc18f9e1e433495cff8183cd7e0984b4 100644</span>
<span class="term-fg1">--- op-geth&#47;consensus&#47;misc&#47;eip1559&#47;eip1559_test.go</span>
<span class="term-fg1">+++ CELO&#47;consensus&#47;misc&#47;eip1559&#47;eip1559_test.go</span>
<span class="term-fg36">@@ -59,11 +59,12 @@</span> func opConfig() *params.ChainConfig {
 	config := copyConfig(params.TestChainConfig)
 	config.LondonBlock = big.NewInt(5)
 	ct := uint64(10)
<span class="term-fg32">+	eip1559DenominatorCanyon := uint64(250)</span>
 	config.CanyonTime = &amp;ct
 	config.Optimism = &amp;params.OptimismConfig{
 		EIP1559Elasticity:        6,
 		EIP1559Denominator:       50,
<span class="term-fg31">-		EIP1559DenominatorCanyon: 250,</span>
<span class="term-fg32">+		EIP1559DenominatorCanyon: &amp;eip1559DenominatorCanyon,</span>
 	}
 	return config
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9385525d9c0761a5b93ee0a0" role="button"
                       aria-expanded="false" aria-controls="id-9385525d9c0761a5b93ee0a0">
                        <code>contracts/addresses/addresses.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/addresses/addresses.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+14</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9385525d9c0761a5b93ee0a0"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;addresses&#47;addresses.go CELO&#47;contracts&#47;addresses&#47;addresses.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9bc556252df9c615c6b2aa512ba49d6dae6f0d7e</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;addresses&#47;addresses.go</span>
<span class="term-fg36">@@ -0,0 +1,14 @@</span>
<span class="term-fg32">+package addresses</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import &quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	CeloTokenAddress            = common.HexToAddress(&quot;0x471ece3750da237f93b8e339c536989b8978a438&quot;)</span>
<span class="term-fg32">+	FeeHandlerAddress           = common.HexToAddress(&quot;0xcd437749e43a154c07f3553504c68fbfd56b8778&quot;)</span>
<span class="term-fg32">+	FeeCurrencyDirectoryAddress = common.HexToAddress(&quot;0x71ffbd48e34bdd5a87c3c683e866dc63b8b2a685&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	CeloTokenAlfajoresAddress  = common.HexToAddress(&quot;0xF194afDf50B03e69Bd7D057c1Aa9e10c9954E4C9&quot;)</span>
<span class="term-fg32">+	FeeHandlerAlfajoresAddress = common.HexToAddress(&quot;0xEAaFf71AB67B5d0eF34ba62Ea06Ac3d3E2dAAA38&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	AlfajoresChainID uint64 = 44787</span>
<span class="term-fg32">+)</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3e787532a6fa70f9469a7920" role="button"
                       aria-expanded="false" aria-controls="id-3e787532a6fa70f9469a7920">
                        <code>contracts/celo_backend.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/contracts/celo_backend.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+80</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3e787532a6fa70f9469a7920"><span class="term-fg1">diff --git op-geth&#47;contracts&#47;celo_backend.go CELO&#47;contracts&#47;celo_backend.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..86c8cf78eeed58d49273d3874bdc2a7b03086e3a</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;contracts&#47;celo_backend.go</span>
<span class="term-fg36">@@ -0,0 +1,80 @@</span>
<span class="term-fg32">+package contracts</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;context&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;vm&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CeloBackend provide a partial ContractBackend implementation, so that we can</span>
<span class="term-fg32">+&#47;&#47; access core contracts during block processing.</span>
<span class="term-fg32">+type CeloBackend struct {</span>
<span class="term-fg32">+	ChainConfig *params.ChainConfig</span>
<span class="term-fg32">+	State       vm.StateDB</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; ContractCaller implementation</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *CeloBackend) CodeAt(ctx context.Context, contract common.Address, blockNumber *big.Int) ([]byte, error) {</span>
<span class="term-fg32">+	return b.State.GetCode(contract), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *CeloBackend) CallContract(ctx context.Context, call ethereum.CallMsg, blockNumber *big.Int) ([]byte, error) {</span>
<span class="term-fg32">+	&#47;&#47; Ensure message is initialized properly.</span>
<span class="term-fg32">+	if call.Gas == 0 {</span>
<span class="term-fg32">+		&#47;&#47; Chosen to be the same as ethconfig.Defaults.RPCGasCap</span>
<span class="term-fg32">+		call.Gas = 50000000</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if call.Value == nil {</span>
<span class="term-fg32">+		call.Value = new(big.Int)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Minimal initialization, might need to be extended when CeloBackend</span>
<span class="term-fg32">+	&#47;&#47; is used in more places. Also initializing blockNumber and time with</span>
<span class="term-fg32">+	&#47;&#47; 0 works now, but will break once we add hardforks at a later time.</span>
<span class="term-fg32">+	if blockNumber == nil {</span>
<span class="term-fg32">+		blockNumber = common.Big0</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	blockCtx := vm.BlockContext{</span>
<span class="term-fg32">+		BlockNumber: blockNumber,</span>
<span class="term-fg32">+		Time:        0,</span>
<span class="term-fg32">+		Random:      &amp;common.Hash{}, &#47;&#47; Setting this is important since it is used to set IsMerge</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	txCtx := vm.TxContext{}</span>
<span class="term-fg32">+	vmConfig := vm.Config{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; While StaticCall does not actually change state, it changes the</span>
<span class="term-fg32">+	&#47;&#47; access lists. We don&#39;t want this to add any access list changes, so</span>
<span class="term-fg32">+	&#47;&#47; we do a snapshot+revert.</span>
<span class="term-fg32">+	snapshot := b.State.Snapshot()</span>
<span class="term-fg32">+	evm := vm.NewEVM(blockCtx, txCtx, b.State, b.ChainConfig, vmConfig)</span>
<span class="term-fg32">+	ret, _, err := evm.StaticCall(vm.AccountRef(evm.Origin), *call.To, call.Data, call.Gas)</span>
<span class="term-fg32">+	b.State.RevertToSnapshot(snapshot)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return ret, err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Get a vm.EVM object of you can&#39;t use the abi wrapper via the ContractCaller interface</span>
<span class="term-fg32">+&#47;&#47; This is usually the case when executing functions that modify state.</span>
<span class="term-fg32">+func (b *CeloBackend) NewEVM(feeCurrencyContext *common.FeeCurrencyContext) *vm.EVM {</span>
<span class="term-fg32">+	blockCtx := vm.BlockContext{</span>
<span class="term-fg32">+		BlockNumber: new(big.Int),</span>
<span class="term-fg32">+		Time:        0,</span>
<span class="term-fg32">+		Transfer: func(state vm.StateDB, from common.Address, to common.Address, value *uint256.Int) {</span>
<span class="term-fg32">+			if value.Cmp(common.U2560) != 0 {</span>
<span class="term-fg32">+				panic(&quot;Non-zero transfers not implemented, yet.&quot;)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if feeCurrencyContext != nil {</span>
<span class="term-fg32">+		blockCtx.FeeCurrencyContext = *feeCurrencyContext</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	txCtx := vm.TxContext{}</span>
<span class="term-fg32">+	vmConfig := vm.Config{}</span>
<span class="term-fg32">+	return vm.NewEVM(blockCtx, txCtx, b.State, b.ChainConfig, vmConfig)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e610f79fab5e86c79ec221b6" role="button"
                       aria-expanded="false" aria-controls="id-e610f79fab5e86c79ec221b6">
                        <code>core/bench_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/bench_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/bench_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e610f79fab5e86c79ec221b6"><span class="term-fg1">diff --git op-geth&#47;core&#47;bench_test.go CELO&#47;core&#47;bench_test.go</span>
<span class="term-fg1">index 97713868a5473b49cc7b8d7a5fb5937d69e7d4b7..233287f7c8ef4c3ef3c23c49a55c4e0b395131a3 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;bench_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;bench_test.go</span>
<span class="term-fg36">@@ -83,7 +83,7 @@</span> func genValueTx(nbytes int) func(int, *BlockGen) {
 	return func(i int, gen *BlockGen) {
 		toaddr := common.Address{}
 		data := make([]byte, nbytes)
<span class="term-fg31">-		gas, _ := IntrinsicGas(data, nil, false, false, false, false)</span>
<span class="term-fg32">+		gas, _ := IntrinsicGas(data, nil, false, false, false, false, nil, common.IntrinsicGasCosts{})</span>
 		signer := gen.Signer()
 		gasPrice := big.NewInt(0)
 		if gen.header.BaseFee != nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-012ff72e5ae5b0c0b6d813dd" role="button"
                       aria-expanded="false" aria-controls="id-012ff72e5ae5b0c0b6d813dd">
                        <code>core/celo_multi_gaspool.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/celo_multi_gaspool.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+71</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-012ff72e5ae5b0c0b6d813dd"><span class="term-fg1">diff --git op-geth&#47;core&#47;celo_multi_gaspool.go CELO&#47;core&#47;celo_multi_gaspool.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9b128afb5d89de160c12f8b3e93438756cd69439</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;celo_multi_gaspool.go</span>
<span class="term-fg36">@@ -0,0 +1,71 @@</span>
<span class="term-fg32">+package core</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type FeeCurrency = common.Address</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; MultiGasPool tracks the amount of gas available during execution</span>
<span class="term-fg32">+&#47;&#47; of the transactions in a block per fee currency. The zero value is a pool</span>
<span class="term-fg32">+&#47;&#47; with zero gas available.</span>
<span class="term-fg32">+type MultiGasPool struct {</span>
<span class="term-fg32">+	pools       map[FeeCurrency]*GasPool</span>
<span class="term-fg32">+	defaultPool *GasPool</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type FeeCurrencyLimitMapping = map[FeeCurrency]float64</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; NewMultiGasPool creates a multi-fee currency gas pool and a default fallback</span>
<span class="term-fg32">+&#47;&#47; pool for CELO</span>
<span class="term-fg32">+func NewMultiGasPool(</span>
<span class="term-fg32">+	blockGasLimit uint64,</span>
<span class="term-fg32">+	allowlist []FeeCurrency,</span>
<span class="term-fg32">+	defaultLimit float64,</span>
<span class="term-fg32">+	limitsMapping FeeCurrencyLimitMapping,</span>
<span class="term-fg32">+) *MultiGasPool {</span>
<span class="term-fg32">+	pools := make(map[FeeCurrency]*GasPool, len(allowlist))</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for i := range allowlist {</span>
<span class="term-fg32">+		currency := allowlist[i]</span>
<span class="term-fg32">+		fraction, ok := limitsMapping[currency]</span>
<span class="term-fg32">+		if !ok {</span>
<span class="term-fg32">+			fraction = defaultLimit</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		pools[currency] = new(GasPool).AddGas(</span>
<span class="term-fg32">+			uint64(float64(blockGasLimit) * fraction),</span>
<span class="term-fg32">+		)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; A special case for CELO which doesn&#39;t have a limit</span>
<span class="term-fg32">+	celoPool := new(GasPool).AddGas(blockGasLimit)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return &amp;MultiGasPool{</span>
<span class="term-fg32">+		pools:       pools,</span>
<span class="term-fg32">+		defaultPool: celoPool,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; PoolFor returns a configured pool for the given fee currency or the default</span>
<span class="term-fg32">+&#47;&#47; one otherwise</span>
<span class="term-fg32">+func (mgp MultiGasPool) PoolFor(feeCurrency *FeeCurrency) *GasPool {</span>
<span class="term-fg32">+	if feeCurrency == nil || mgp.pools[*feeCurrency] == nil {</span>
<span class="term-fg32">+		return mgp.defaultPool</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return mgp.pools[*feeCurrency]</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (mgp MultiGasPool) Copy() *MultiGasPool {</span>
<span class="term-fg32">+	pools := make(map[FeeCurrency]*GasPool, len(mgp.pools))</span>
<span class="term-fg32">+	for fc, gp := range mgp.pools {</span>
<span class="term-fg32">+		gpCpy := *gp</span>
<span class="term-fg32">+		pools[fc] = &amp;gpCpy</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	gpCpy := *mgp.defaultPool</span>
<span class="term-fg32">+	return &amp;MultiGasPool{</span>
<span class="term-fg32">+		pools:       pools,</span>
<span class="term-fg32">+		defaultPool: &amp;gpCpy,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-173f99822941b110c09420db" role="button"
                       aria-expanded="false" aria-controls="id-173f99822941b110c09420db">
                        <code>core/celo_multi_gaspool_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/celo_multi_gaspool_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+138</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-173f99822941b110c09420db"><span class="term-fg1">diff --git op-geth&#47;core&#47;celo_multi_gaspool_test.go CELO&#47;core&#47;celo_multi_gaspool_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..70f60573a5e7cafe7666fe6af06b209d761c0377</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;celo_multi_gaspool_test.go</span>
<span class="term-fg36">@@ -0,0 +1,138 @@</span>
<span class="term-fg32">+package core</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestMultiCurrencyGasPool(t *testing.T) {</span>
<span class="term-fg32">+	blockGasLimit := uint64(1_000)</span>
<span class="term-fg32">+	subGasAmount := 100</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	cUSDToken := common.HexToAddress(&quot;0x765DE816845861e75A25fCA122bb6898B8B1282a&quot;)</span>
<span class="term-fg32">+	cEURToken := common.HexToAddress(&quot;0xD8763CBa276a3738E6DE85b4b3bF5FDed6D6cA73&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	testCases := []struct {</span>
<span class="term-fg32">+		name                string</span>
<span class="term-fg32">+		feeCurrency         *FeeCurrency</span>
<span class="term-fg32">+		allowlist           []FeeCurrency</span>
<span class="term-fg32">+		defaultLimit        float64</span>
<span class="term-fg32">+		limits              FeeCurrencyLimitMapping</span>
<span class="term-fg32">+		defaultPoolExpected bool</span>
<span class="term-fg32">+		expectedValue       uint64</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:                &quot;Empty allowlist, empty mapping, CELO uses default pool&quot;,</span>
<span class="term-fg32">+			feeCurrency:         nil,</span>
<span class="term-fg32">+			allowlist:           []FeeCurrency{},</span>
<span class="term-fg32">+			defaultLimit:        0.9,</span>
<span class="term-fg32">+			limits:              map[FeeCurrency]float64{},</span>
<span class="term-fg32">+			defaultPoolExpected: true,</span>
<span class="term-fg32">+			expectedValue:       900, &#47;&#47; blockGasLimit - subGasAmount</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:        &quot;Non-empty allowlist, non-empty mapping, CELO uses default pool&quot;,</span>
<span class="term-fg32">+			feeCurrency: nil,</span>
<span class="term-fg32">+			allowlist: []FeeCurrency{</span>
<span class="term-fg32">+				cUSDToken,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultLimit: 0.9,</span>
<span class="term-fg32">+			limits: map[FeeCurrency]float64{</span>
<span class="term-fg32">+				cUSDToken: 0.5,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultPoolExpected: true,</span>
<span class="term-fg32">+			expectedValue:       900, &#47;&#47; blockGasLimit - subGasAmount</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:                &quot;Empty allowlist, empty mapping, non-registered currency fallbacks to the default pool&quot;,</span>
<span class="term-fg32">+			feeCurrency:         &amp;cUSDToken,</span>
<span class="term-fg32">+			allowlist:           []FeeCurrency{},</span>
<span class="term-fg32">+			defaultLimit:        0.9,</span>
<span class="term-fg32">+			limits:              map[FeeCurrency]float64{},</span>
<span class="term-fg32">+			defaultPoolExpected: true,</span>
<span class="term-fg32">+			expectedValue:       900, &#47;&#47; blockGasLimit - subGasAmount</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:        &quot;Non-empty allowlist, non-empty mapping, non-registered currency uses default pool&quot;,</span>
<span class="term-fg32">+			feeCurrency: &amp;cEURToken,</span>
<span class="term-fg32">+			allowlist: []FeeCurrency{</span>
<span class="term-fg32">+				cUSDToken,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultLimit: 0.9,</span>
<span class="term-fg32">+			limits: map[FeeCurrency]float64{</span>
<span class="term-fg32">+				cUSDToken: 0.5,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultPoolExpected: true,</span>
<span class="term-fg32">+			expectedValue:       900, &#47;&#47; blockGasLimit - subGasAmount</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:        &quot;Non-empty allowlist, empty mapping, registered currency uses default limit&quot;,</span>
<span class="term-fg32">+			feeCurrency: &amp;cUSDToken,</span>
<span class="term-fg32">+			allowlist: []FeeCurrency{</span>
<span class="term-fg32">+				cUSDToken,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultLimit:        0.9,</span>
<span class="term-fg32">+			limits:              map[FeeCurrency]float64{},</span>
<span class="term-fg32">+			defaultPoolExpected: false,</span>
<span class="term-fg32">+			expectedValue:       800, &#47;&#47; blockGasLimit * defaultLimit - subGasAmount</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:        &quot;Non-empty allowlist, non-empty mapping, configured registered currency uses configured limits&quot;,</span>
<span class="term-fg32">+			feeCurrency: &amp;cUSDToken,</span>
<span class="term-fg32">+			allowlist: []FeeCurrency{</span>
<span class="term-fg32">+				cUSDToken,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultLimit: 0.9,</span>
<span class="term-fg32">+			limits: map[FeeCurrency]float64{</span>
<span class="term-fg32">+				cUSDToken: 0.5,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultPoolExpected: false,</span>
<span class="term-fg32">+			expectedValue:       400, &#47;&#47; blockGasLimit * 0.5 - subGasAmount</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:        &quot;Non-empty allowlist, non-empty mapping, unconfigured registered currency uses default limit&quot;,</span>
<span class="term-fg32">+			feeCurrency: &amp;cEURToken,</span>
<span class="term-fg32">+			allowlist: []FeeCurrency{</span>
<span class="term-fg32">+				cUSDToken,</span>
<span class="term-fg32">+				cEURToken,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultLimit: 0.9,</span>
<span class="term-fg32">+			limits: map[FeeCurrency]float64{</span>
<span class="term-fg32">+				cUSDToken: 0.5,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			defaultPoolExpected: false,</span>
<span class="term-fg32">+			expectedValue:       800, &#47;&#47; blockGasLimit * 0.5 - subGasAmount</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	for _, c := range testCases {</span>
<span class="term-fg32">+		t.Run(c.name, func(t *testing.T) {</span>
<span class="term-fg32">+			mgp := NewMultiGasPool(</span>
<span class="term-fg32">+				blockGasLimit,</span>
<span class="term-fg32">+				c.allowlist,</span>
<span class="term-fg32">+				c.defaultLimit,</span>
<span class="term-fg32">+				c.limits,</span>
<span class="term-fg32">+			)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			pool := mgp.PoolFor(c.feeCurrency)</span>
<span class="term-fg32">+			pool.SubGas(uint64(subGasAmount))</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			if c.defaultPoolExpected {</span>
<span class="term-fg32">+				result := mgp.PoolFor(nil).Gas()</span>
<span class="term-fg32">+				if result != c.expectedValue {</span>
<span class="term-fg32">+					t.Error(&quot;Default pool expected&quot;, c.expectedValue, &quot;got&quot;, result)</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			} else {</span>
<span class="term-fg32">+				result := mgp.PoolFor(c.feeCurrency).Gas()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				if result != c.expectedValue {</span>
<span class="term-fg32">+					t.Error(</span>
<span class="term-fg32">+						&quot;Expected pool&quot;, c.feeCurrency, &quot;value&quot;, c.expectedValue,</span>
<span class="term-fg32">+						&quot;got&quot;, result,</span>
<span class="term-fg32">+					)</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f63507b6058efb400982c1a0" role="button"
                       aria-expanded="false" aria-controls="id-f63507b6058efb400982c1a0">
                        <code>core/error.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/error.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/error.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f63507b6058efb400982c1a0"><span class="term-fg1">diff --git op-geth&#47;core&#47;error.go CELO&#47;core&#47;error.go</span>
<span class="term-fg1">index 8c691b17ff761c541093a5de23db70edba74e5d7..49a644cc509409a2fe48c4f0934048d843681de0 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;error.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;error.go</span>
<span class="term-fg36">@@ -113,4 +113,7 @@</span> 	ErrBlobTxCreate = errors.New(&quot;blob transaction of type create&quot;)
&nbsp;
 	&#47;&#47; ErrSystemTxNotSupported is returned for any deposit tx with IsSystemTx=true after the Regolith fork
 	ErrSystemTxNotSupported = errors.New(&quot;system tx not supported&quot;)
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; ErrCel2NotEnabled is returned if a feature requires the Cel2 fork, but that is not enabled.</span>
<span class="term-fg32">+	ErrCel2NotEnabled = errors.New(&quot;required cel2 fork not enabled&quot;)</span>
 )</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e72f8ac5dd12239558a43bb0" role="button"
                       aria-expanded="false" aria-controls="id-e72f8ac5dd12239558a43bb0">
                        <code>core/gen_genesis.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/gen_genesis.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/gen_genesis.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+35</span></div>
                            <div class="text-start"><span class="text-danger">-37</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e72f8ac5dd12239558a43bb0"><span class="term-fg1">diff --git op-geth&#47;core&#47;gen_genesis.go CELO&#47;core&#47;gen_genesis.go</span>
<span class="term-fg1">index 3a57ec65e8c35e151f4fe3b792a2d5b7290744a4..f4aec12026c290a42e50059db4afda1c62cc85d0 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;gen_genesis.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;gen_genesis.go</span>
<span class="term-fg36">@@ -19,22 +19,22 @@</span>
 &#47;&#47; MarshalJSON marshals as JSON.
 func (g Genesis) MarshalJSON() ([]byte, error) {
 	type Genesis struct {
<span class="term-fg31">-		Config        *params.ChainConfig                               `json:&quot;config&quot;`</span>
<span class="term-fg31">-		Nonce         math.HexOrDecimal64                               `json:&quot;nonce&quot;`</span>
<span class="term-fg31">-		Timestamp     math.HexOrDecimal64                               `json:&quot;timestamp&quot;`</span>
<span class="term-fg31">-		ExtraData     hexutil.Bytes                                     `json:&quot;extraData&quot;`</span>
<span class="term-fg31">-		GasLimit      math.HexOrDecimal64                               `json:&quot;gasLimit&quot;   gencodec:&quot;required&quot;`</span>
<span class="term-fg31">-		Difficulty    *math.HexOrDecimal256                             `json:&quot;difficulty&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg31">-		Mixhash       common.Hash                                       `json:&quot;mixHash&quot;`</span>
<span class="term-fg31">-		Coinbase      common.Address                                    `json:&quot;coinbase&quot;`</span>
<span class="term-fg32">+		Config        *params.ChainConfig                        `json:&quot;config&quot;`</span>
<span class="term-fg32">+		Nonce         math.HexOrDecimal64                        `json:&quot;nonce&quot;`</span>
<span class="term-fg32">+		Timestamp     math.HexOrDecimal64                        `json:&quot;timestamp&quot;`</span>
<span class="term-fg32">+		ExtraData     hexutil.Bytes                              `json:&quot;extraData&quot;`</span>
<span class="term-fg32">+		GasLimit      math.HexOrDecimal64                        `json:&quot;gasLimit&quot;`</span>
<span class="term-fg32">+		Difficulty    *math.HexOrDecimal256                      `json:&quot;difficulty&quot;`</span>
<span class="term-fg32">+		Mixhash       common.Hash                                `json:&quot;mixHash&quot;`</span>
<span class="term-fg32">+		Coinbase      common.Address                             `json:&quot;coinbase&quot;`</span>
 		Alloc         map[common.UnprefixedAddress]types.Account `json:&quot;alloc&quot;      gencodec:&quot;required&quot;`
<span class="term-fg31">-		Number        math.HexOrDecimal64                               `json:&quot;number&quot;`</span>
<span class="term-fg31">-		GasUsed       math.HexOrDecimal64                               `json:&quot;gasUsed&quot;`</span>
<span class="term-fg31">-		ParentHash    common.Hash                                       `json:&quot;parentHash&quot;`</span>
<span class="term-fg31">-		BaseFee       *math.HexOrDecimal256                             `json:&quot;baseFeePerGas&quot;`</span>
<span class="term-fg31">-		ExcessBlobGas *math.HexOrDecimal64                              `json:&quot;excessBlobGas&quot;`</span>
<span class="term-fg31">-		BlobGasUsed   *math.HexOrDecimal64                              `json:&quot;blobGasUsed&quot;`</span>
<span class="term-fg31">-		StateHash     *common.Hash                                `json:&quot;stateHash,omitempty&quot;`</span>
<span class="term-fg32">+		Number        math.HexOrDecimal64                        `json:&quot;number&quot;`</span>
<span class="term-fg32">+		GasUsed       math.HexOrDecimal64                        `json:&quot;gasUsed&quot;`</span>
<span class="term-fg32">+		ParentHash    common.Hash                                `json:&quot;parentHash&quot;`</span>
<span class="term-fg32">+		BaseFee       *math.HexOrDecimal256                      `json:&quot;baseFeePerGas&quot;`</span>
<span class="term-fg32">+		ExcessBlobGas *math.HexOrDecimal64                       `json:&quot;excessBlobGas&quot;`</span>
<span class="term-fg32">+		BlobGasUsed   *math.HexOrDecimal64                       `json:&quot;blobGasUsed&quot;`</span>
<span class="term-fg32">+		StateHash     *common.Hash                               `json:&quot;stateHash,omitempty&quot;`</span>
 	}
 	var enc Genesis
 	enc.Config = g.Config
<span class="term-fg36">@@ -64,22 +64,22 @@</span>
 &#47;&#47; UnmarshalJSON unmarshals from JSON.
 func (g *Genesis) UnmarshalJSON(input []byte) error {
 	type Genesis struct {
<span class="term-fg31">-		Config        *params.ChainConfig                         `json:&quot;config&quot;`</span>
<span class="term-fg31">-		Nonce         *math.HexOrDecimal64                        `json:&quot;nonce&quot;`</span>
<span class="term-fg31">-		Timestamp     *math.HexOrDecimal64                        `json:&quot;timestamp&quot;`</span>
<span class="term-fg31">-		ExtraData     *hexutil.Bytes                              `json:&quot;extraData&quot;`</span>
<span class="term-fg31">-		GasLimit      *math.HexOrDecimal64                        `json:&quot;gasLimit&quot;   gencodec:&quot;required&quot;`</span>
<span class="term-fg31">-		Difficulty    *math.HexOrDecimal256                       `json:&quot;difficulty&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg31">-		Mixhash       *common.Hash                                `json:&quot;mixHash&quot;`</span>
<span class="term-fg31">-		Coinbase      *common.Address                             `json:&quot;coinbase&quot;`</span>
<span class="term-fg31">-		Alloc         map[common.UnprefixedAddress]GenesisAccount `json:&quot;alloc&quot;      gencodec:&quot;required&quot;`</span>
<span class="term-fg31">-		Number        *math.HexOrDecimal64                        `json:&quot;number&quot;`</span>
<span class="term-fg31">-		GasUsed       *math.HexOrDecimal64                        `json:&quot;gasUsed&quot;`</span>
<span class="term-fg31">-		ParentHash    *common.Hash                                `json:&quot;parentHash&quot;`</span>
<span class="term-fg31">-		BaseFee       *math.HexOrDecimal256                       `json:&quot;baseFeePerGas&quot;`</span>
<span class="term-fg31">-		ExcessBlobGas *math.HexOrDecimal64                        `json:&quot;excessBlobGas&quot;`</span>
<span class="term-fg31">-		BlobGasUsed   *math.HexOrDecimal64                        `json:&quot;blobGasUsed&quot;`</span>
<span class="term-fg31">-		StateHash     *common.Hash                                `json:&quot;stateHash,omitempty&quot;`</span>
<span class="term-fg32">+		Config        *params.ChainConfig                        `json:&quot;config&quot;`</span>
<span class="term-fg32">+		Nonce         *math.HexOrDecimal64                       `json:&quot;nonce&quot;`</span>
<span class="term-fg32">+		Timestamp     *math.HexOrDecimal64                       `json:&quot;timestamp&quot;`</span>
<span class="term-fg32">+		ExtraData     *hexutil.Bytes                             `json:&quot;extraData&quot;`</span>
<span class="term-fg32">+		GasLimit      *math.HexOrDecimal64                       `json:&quot;gasLimit&quot;`</span>
<span class="term-fg32">+		Difficulty    *math.HexOrDecimal256                      `json:&quot;difficulty&quot;`</span>
<span class="term-fg32">+		Mixhash       *common.Hash                               `json:&quot;mixHash&quot;`</span>
<span class="term-fg32">+		Coinbase      *common.Address                            `json:&quot;coinbase&quot;`</span>
<span class="term-fg32">+		Alloc         map[common.UnprefixedAddress]types.Account `json:&quot;alloc&quot;      gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+		Number        *math.HexOrDecimal64                       `json:&quot;number&quot;`</span>
<span class="term-fg32">+		GasUsed       *math.HexOrDecimal64                       `json:&quot;gasUsed&quot;`</span>
<span class="term-fg32">+		ParentHash    *common.Hash                               `json:&quot;parentHash&quot;`</span>
<span class="term-fg32">+		BaseFee       *math.HexOrDecimal256                      `json:&quot;baseFeePerGas&quot;`</span>
<span class="term-fg32">+		ExcessBlobGas *math.HexOrDecimal64                       `json:&quot;excessBlobGas&quot;`</span>
<span class="term-fg32">+		BlobGasUsed   *math.HexOrDecimal64                       `json:&quot;blobGasUsed&quot;`</span>
<span class="term-fg32">+		StateHash     *common.Hash                               `json:&quot;stateHash,omitempty&quot;`</span>
 	}
 	var dec Genesis
 	if err := json.Unmarshal(input, &amp;dec); err != nil {
<span class="term-fg36">@@ -97,14 +97,12 @@</span> 	}
 	if dec.ExtraData != nil {
 		g.ExtraData = *dec.ExtraData
 	}
<span class="term-fg31">-	if dec.GasLimit == nil {</span>
<span class="term-fg31">-		return errors.New(&quot;missing required field &#39;gasLimit&#39; for Genesis&quot;)</span>
<span class="term-fg32">+	if dec.GasLimit != nil {</span>
<span class="term-fg32">+		g.GasLimit = uint64(*dec.GasLimit)</span>
 	}
<span class="term-fg31">-	g.GasLimit = uint64(*dec.GasLimit)</span>
<span class="term-fg31">-	if dec.Difficulty == nil {</span>
<span class="term-fg31">-		return errors.New(&quot;missing required field &#39;difficulty&#39; for Genesis&quot;)</span>
<span class="term-fg32">+	if dec.Difficulty != nil {</span>
<span class="term-fg32">+		g.Difficulty = (*big.Int)(dec.Difficulty)</span>
 	}
<span class="term-fg31">-	g.Difficulty = (*big.Int)(dec.Difficulty)</span>
 	if dec.Mixhash != nil {
 		g.Mixhash = *dec.Mixhash
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a7440dceea186d7ae9c7201c" role="button"
                       aria-expanded="false" aria-controls="id-a7440dceea186d7ae9c7201c">
                        <code>core/state/statedb.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/state/statedb.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/state/statedb.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a7440dceea186d7ae9c7201c"><span class="term-fg1">diff --git op-geth&#47;core&#47;state&#47;statedb.go CELO&#47;core&#47;state&#47;statedb.go</span>
<span class="term-fg1">index 9fc529b86b3be8dbdaf4509c97f12540fc835a53..fd4dbb65ba52315d1d82d4c75f8ff987cb03a1d0 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;state&#47;statedb.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;state&#47;statedb.go</span>
<span class="term-fg36">@@ -1412,3 +1412,16 @@</span> 		}
 	}
 	return copied
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func (s *StateDB) MoveAccount(from, to common.Address) error {</span>
<span class="term-fg32">+	fromObj := s.getStateObject(from)</span>
<span class="term-fg32">+	if fromObj == nil {</span>
<span class="term-fg32">+		return fmt.Errorf(&quot;account %s not found&quot;, from.Hex())</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	fromObj.address = to</span>
<span class="term-fg32">+	fromObj.addrHash = crypto.Keccak256Hash(to[:])</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	s.setStateObject(fromObj)</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6b2adabc22df2043ae49409f" role="button"
                       aria-expanded="false" aria-controls="id-6b2adabc22df2043ae49409f">
                        <code>core/state/statedb_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/state/statedb_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/state/statedb_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+37</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6b2adabc22df2043ae49409f"><span class="term-fg1">diff --git op-geth&#47;core&#47;state&#47;statedb_test.go CELO&#47;core&#47;state&#47;statedb_test.go</span>
<span class="term-fg1">index cd86a7f4b67faa6f6bb393d9e7550be8e8effa6f..03c0ea82f61d91a80adffe317ef5b01e9b89b3d7 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;state&#47;statedb_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;state&#47;statedb_test.go</span>
<span class="term-fg36">@@ -41,6 +41,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;triedb&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;triedb&#47;hashdb&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;triedb&#47;pathdb&quot;
 	&quot;github.com&#47;holiman&#47;uint256&quot;
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
 )
&nbsp;
 &#47;&#47; Tests that updating a state trie does not leak any database writes prior to
<span class="term-fg36">@@ -1189,3 +1190,39 @@</span> 	if slowRes != fastRes {
 		t.Fatalf(&quot;difference found:\nfast: %v\nslow: %v\n&quot;, fastRes, slowRes)
 	}
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestMoveStorage(t *testing.T) {</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		disk     = rawdb.NewMemoryDatabase()</span>
<span class="term-fg32">+		tdb      = triedb.NewDatabase(disk, nil)</span>
<span class="term-fg32">+		db       = NewDatabaseWithNodeDB(disk, tdb)</span>
<span class="term-fg32">+		snaps, _ = snapshot.New(snapshot.Config{CacheSize: 10}, disk, tdb, types.EmptyRootHash)</span>
<span class="term-fg32">+		state, _ = New(types.EmptyRootHash, db, snaps)</span>
<span class="term-fg32">+		from     = common.HexToAddress(&quot;0x1&quot;)</span>
<span class="term-fg32">+		to       = common.HexToAddress(&quot;0x2&quot;)</span>
<span class="term-fg32">+		slotA    = common.HexToHash(&quot;0x11&quot;)</span>
<span class="term-fg32">+		valueA   = common.HexToHash(&quot;0x111&quot;)</span>
<span class="term-fg32">+		slotB    = common.HexToHash(&quot;0x22&quot;)</span>
<span class="term-fg32">+		valueB   = common.HexToHash(&quot;0x222&quot;)</span>
<span class="term-fg32">+		balance  = uint256.NewInt(123)</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	state.SetBalance(from, balance)</span>
<span class="term-fg32">+	state.SetState(from, slotA, valueA)</span>
<span class="term-fg32">+	state.SetState(from, slotB, valueB)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	root, _ := state.Commit(0, true)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	require.True(t, state.Empty(to))</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	err := state.MoveAccount(from, to)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	require.False(t, state.Empty(to))</span>
<span class="term-fg32">+	require.Equal(t, balance, state.GetBalance(to))</span>
<span class="term-fg32">+	require.Equal(t, valueA, state.GetState(to, slotA))</span>
<span class="term-fg32">+	require.Equal(t, valueB, state.GetState(to, slotB))</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	root2, _ := state.Commit(1, true)</span>
<span class="term-fg32">+	require.NotEqual(t, root, root2)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-824e4859d56a33a35ab51403" role="button"
                       aria-expanded="false" aria-controls="id-824e4859d56a33a35ab51403">
                        <code>core/state_prefetcher.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/state_prefetcher.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/state_prefetcher.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-824e4859d56a33a35ab51403"><span class="term-fg1">diff --git op-geth&#47;core&#47;state_prefetcher.go CELO&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg1">index bb6835202b9758e49611f8da677ddee3edc346f1..b769dbb6e860446a7a80d34a10e53adc08e4d7fb 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;state_prefetcher.go</span>
<span class="term-fg36">@@ -63,7 +63,7 @@</span> 		if interrupt != nil &amp;&amp; interrupt.Load() {
 			return
 		}
 		&#47;&#47; Convert the transaction into an executable message and pre-cache its sender
<span class="term-fg31">-		msg, err := TransactionToMessage(tx, signer, header.BaseFee)</span>
<span class="term-fg32">+		msg, err := TransactionToMessage(tx, signer, header.BaseFee, blockContext.FeeCurrencyContext.ExchangeRates)</span>
 		if err != nil {
 			return &#47;&#47; Also invalid block, bail out
 		}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-63c30277d40009a02746246e" role="button"
                       aria-expanded="false" aria-controls="id-63c30277d40009a02746246e">
                        <code>core/state_processor_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/state_processor_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/state_processor_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-8</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-63c30277d40009a02746246e"><span class="term-fg1">diff --git op-geth&#47;core&#47;state_processor_test.go CELO&#47;core&#47;state_processor_test.go</span>
<span class="term-fg1">index 77efaede5886e8cc3e92e78be5739e784fd099c0..12a978b616a80dce94de4a836a52d9f8234b9abf 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;state_processor_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;state_processor_test.go</span>
<span class="term-fg36">@@ -128,8 +128,8 @@</span> 						Nonce:   math.MaxUint64,
 					},
 				},
 			}
<span class="term-fg31">-			blockchain, _  = NewBlockChain(db, nil, gspec, nil, beacon.New(ethash.NewFaker()), vm.Config{}, nil, nil)</span>
<span class="term-fg31">-			tooBigInitCode = [params.MaxInitCodeSize + 1]byte{}</span>
<span class="term-fg32">+			blockchain, _ = NewBlockChain(db, nil, gspec, nil, beacon.New(ethash.NewFaker()), vm.Config{}, nil, nil)</span>
<span class="term-fg32">+			&#47;&#47;tooBigInitCode = [params.MaxInitCodeSize + 1]byte{}</span>
 		)
&nbsp;
 		defer blockchain.Stop()
<span class="term-fg36">@@ -234,12 +234,13 @@</span> 					mkDynamicTx(0, common.Address{}, params.TxGas, bigNumber, bigNumber),
 				},
 				want: &quot;could not apply tx 0 [0xd82a0c2519acfeac9a948258c47e784acd20651d9d80f9a1c67b4137651c3a24]: insufficient funds for gas * price + value: address 0x71562b71999873DB5b286dF957af199Ec94617F7 required balance exceeds 256 bits&quot;,
 			},
<span class="term-fg31">-			{ &#47;&#47; ErrMaxInitCodeSizeExceeded</span>
<span class="term-fg31">-				txs: []*types.Transaction{</span>
<span class="term-fg31">-					mkDynamicCreationTx(0, 500000, common.Big0, big.NewInt(params.InitialBaseFee), tooBigInitCode[:]),</span>
<span class="term-fg31">-				},</span>
<span class="term-fg31">-				want: &quot;could not apply tx 0 [0xd491405f06c92d118dd3208376fcee18a57c54bc52063ee4a26b1cf296857c25]: max initcode size exceeded: code size 49153 limit 49152&quot;,</span>
<span class="term-fg31">-			},</span>
<span class="term-fg32">+			&#47;&#47; Disabled due to Celo MaxCodeSize change</span>
<span class="term-fg32">+			&#47;&#47; { &#47;&#47; ErrMaxInitCodeSizeExceeded</span>
<span class="term-fg32">+			&#47;&#47; 	txs: []*types.Transaction{</span>
<span class="term-fg32">+			&#47;&#47; 		mkDynamicCreationTx(0, 500000, common.Big0, big.NewInt(params.InitialBaseFee), tooBigInitCode[:]),</span>
<span class="term-fg32">+			&#47;&#47; 	},</span>
<span class="term-fg32">+			&#47;&#47; 	want: &quot;could not apply tx 0 [0xd491405f06c92d118dd3208376fcee18a57c54bc52063ee4a26b1cf296857c25]: max initcode size exceeded: code size 49153 limit 49152&quot;,</span>
<span class="term-fg32">+			&#47;&#47; },</span>
 			{ &#47;&#47; ErrIntrinsicGas: Not enough gas to cover init code
 				txs: []*types.Transaction{
 					mkDynamicCreationTx(0, 54299, common.Big0, big.NewInt(params.InitialBaseFee), make([]byte, 320)),</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6504b86fe67769abcfb59889" role="button"
                       aria-expanded="false" aria-controls="id-6504b86fe67769abcfb59889">
                        <code>core/superchain_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/superchain_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/superchain_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+75</span></div>
                            <div class="text-start"><span class="text-danger">-27</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6504b86fe67769abcfb59889"><span class="term-fg1">diff --git op-geth&#47;core&#47;superchain_test.go CELO&#47;core&#47;superchain_test.go</span>
<span class="term-fg1">index 4f7ea71ac5a773afb25ea8d67f0cade27f641cdc..6ed8d8ad33933a52357ff5df6b35c4c9c01957c6 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;superchain_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;superchain_test.go</span>
<span class="term-fg36">@@ -19,35 +19,83 @@</span> 	}
 }
&nbsp;
 func TestRegistryChainConfigOverride(t *testing.T) {
<span class="term-fg31">-	db := rawdb.NewMemoryDatabase()</span>
<span class="term-fg31">-	genesis, err := LoadOPStackGenesis(10)</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		t.Fatal(err)</span>
<span class="term-fg32">+	var tests = []struct {</span>
<span class="term-fg32">+		name                 string</span>
<span class="term-fg32">+		overrides            *ChainOverrides</span>
<span class="term-fg32">+		setDenominator       *uint64</span>
<span class="term-fg32">+		expectedDenominator  uint64</span>
<span class="term-fg32">+		expectedRegolithTime *uint64</span>
<span class="term-fg32">+	}{</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:                 &quot;ApplySuperchainUpgrades&quot;,</span>
<span class="term-fg32">+			overrides:            &amp;ChainOverrides{ApplySuperchainUpgrades: true},</span>
<span class="term-fg32">+			setDenominator:       uint64ptr(50),</span>
<span class="term-fg32">+			expectedDenominator:  250,</span>
<span class="term-fg32">+			expectedRegolithTime: uint64ptr(0),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:                 &quot;OverrideOptimismCanyon_denom_nil&quot;,</span>
<span class="term-fg32">+			overrides:            &amp;ChainOverrides{OverrideOptimismCanyon: uint64ptr(1)},</span>
<span class="term-fg32">+			setDenominator:       nil,</span>
<span class="term-fg32">+			expectedDenominator:  250,</span>
<span class="term-fg32">+			expectedRegolithTime: nil,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:                 &quot;OverrideOptimismCanyon_denom_0&quot;,</span>
<span class="term-fg32">+			overrides:            &amp;ChainOverrides{OverrideOptimismCanyon: uint64ptr(1)},</span>
<span class="term-fg32">+			setDenominator:       uint64ptr(0),</span>
<span class="term-fg32">+			expectedDenominator:  250,</span>
<span class="term-fg32">+			expectedRegolithTime: nil,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			name:                 &quot;OverrideOptimismCanyon_ignore_override&quot;,</span>
<span class="term-fg32">+			overrides:            &amp;ChainOverrides{OverrideOptimismCanyon: uint64ptr(1)},</span>
<span class="term-fg32">+			setDenominator:       uint64ptr(100),</span>
<span class="term-fg32">+			expectedDenominator:  100,</span>
<span class="term-fg32">+			expectedRegolithTime: nil,</span>
<span class="term-fg32">+		},</span>
 	}
<span class="term-fg31">-	if genesis.Config.RegolithTime == nil {</span>
<span class="term-fg31">-		t.Fatal(&quot;expected non-nil regolith time&quot;)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	expectedRegolithTime := *genesis.Config.RegolithTime</span>
<span class="term-fg31">-	genesis.Config.RegolithTime = nil</span>
&nbsp;
<span class="term-fg31">-	&#47;&#47; initialize the DB</span>
<span class="term-fg31">-	tdb := triedb.NewDatabase(db, newDbConfig(rawdb.PathScheme))</span>
<span class="term-fg31">-	genesis.MustCommit(db, tdb)</span>
<span class="term-fg31">-	bl := genesis.ToBlock()</span>
<span class="term-fg31">-	rawdb.WriteCanonicalHash(db, bl.Hash(), 0)</span>
<span class="term-fg31">-	rawdb.WriteBlock(db, bl)</span>
<span class="term-fg32">+	for _, tt := range tests {</span>
<span class="term-fg32">+		tt := tt</span>
<span class="term-fg32">+		t.Run(tt.name, func(t *testing.T) {</span>
<span class="term-fg32">+			t.Parallel()</span>
<span class="term-fg32">+			db := rawdb.NewMemoryDatabase()</span>
<span class="term-fg32">+			genesis, err := LoadOPStackGenesis(10)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				t.Fatal(err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			if genesis.Config.RegolithTime == nil {</span>
<span class="term-fg32">+				t.Fatal(&quot;expected non-nil regolith time&quot;)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			genesis.Config.RegolithTime = nil</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			&#47;&#47; initialize the DB</span>
<span class="term-fg32">+			tdb := triedb.NewDatabase(db, newDbConfig(rawdb.PathScheme))</span>
<span class="term-fg32">+			genesis.MustCommit(db, tdb)</span>
<span class="term-fg32">+			bl := genesis.ToBlock()</span>
<span class="term-fg32">+			rawdb.WriteCanonicalHash(db, bl.Hash(), 0)</span>
<span class="term-fg32">+			rawdb.WriteBlock(db, bl)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			genesis.Config.Optimism.EIP1559DenominatorCanyon = tt.setDenominator</span>
<span class="term-fg32">+			&#47;&#47; create chain config, even with incomplete genesis input: the chain config should be corrected</span>
<span class="term-fg32">+			chainConfig, _, err := SetupGenesisBlockWithOverride(db, tdb, genesis, tt.overrides)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				t.Fatal(err)</span>
<span class="term-fg32">+			}</span>
&nbsp;
<span class="term-fg31">-	&#47;&#47; create chain config, even with incomplete genesis input: the chain config should be corrected</span>
<span class="term-fg31">-	chainConfig, _, err := SetupGenesisBlockWithOverride(db, tdb, genesis, &amp;ChainOverrides{</span>
<span class="term-fg31">-		ApplySuperchainUpgrades: true,</span>
<span class="term-fg31">-	})</span>
<span class="term-fg31">-	if err != nil {</span>
<span class="term-fg31">-		t.Fatal(err)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	&#47;&#47; check if we have a corrected chain config</span>
<span class="term-fg31">-	if chainConfig.RegolithTime == nil {</span>
<span class="term-fg31">-		t.Fatal(&quot;expected regolith time to be corrected, but time is still nil&quot;)</span>
<span class="term-fg31">-	} else if *chainConfig.RegolithTime != expectedRegolithTime {</span>
<span class="term-fg31">-		t.Fatalf(&quot;expected regolith time to be %d, but got %d&quot;, expectedRegolithTime, *chainConfig.RegolithTime)</span>
<span class="term-fg32">+			&#47;&#47; check if we have a corrected chain config</span>
<span class="term-fg32">+			if tt.expectedRegolithTime == nil {</span>
<span class="term-fg32">+				if chainConfig.RegolithTime != nil {</span>
<span class="term-fg32">+					t.Fatal(&quot;expected regolith time to be nil&quot;)</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			} else if *chainConfig.RegolithTime != *tt.expectedRegolithTime {</span>
<span class="term-fg32">+				t.Fatalf(&quot;expected regolith time to be %d, but got %d&quot;, *tt.expectedRegolithTime, *chainConfig.RegolithTime)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			if *chainConfig.Optimism.EIP1559DenominatorCanyon != tt.expectedDenominator {</span>
<span class="term-fg32">+				t.Fatalf(&quot;expected EIP1559DenominatorCanyon to be %d, but got %d&quot;, tt.expectedDenominator, *chainConfig.Optimism.EIP1559DenominatorCanyon)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		})</span>
 	}
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a8202c49e097d59b29faf0c7" role="button"
                       aria-expanded="false" aria-controls="id-a8202c49e097d59b29faf0c7">
                        <code>core/types/celo_block.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_block.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+161</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a8202c49e097d59b29faf0c7"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_block.go CELO&#47;core&#47;types&#47;celo_block.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..075c856087147209a568fd24e4ce647eadc115c5</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_block.go</span>
<span class="term-fg36">@@ -0,0 +1,161 @@</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;io&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type IstanbulExtra rlp.RawValue</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type beforeGingerbreadHeader struct {</span>
<span class="term-fg32">+	ParentHash  common.Hash    `json:&quot;parentHash&quot;       gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	Coinbase    common.Address `json:&quot;miner&quot;            gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	Root        common.Hash    `json:&quot;stateRoot&quot;        gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	TxHash      common.Hash    `json:&quot;transactionsRoot&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	ReceiptHash common.Hash    `json:&quot;receiptsRoot&quot;     gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	Bloom       Bloom          `json:&quot;logsBloom&quot;        gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	Number      *big.Int       `json:&quot;number&quot;           gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	GasUsed     uint64         `json:&quot;gasUsed&quot;          gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	Time        uint64         `json:&quot;timestamp&quot;        gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	Extra       []byte         `json:&quot;extraData&quot;        gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This type is required to avoid an infinite loop when decoding</span>
<span class="term-fg32">+type afterGingerbreadHeader Header</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (h *Header) DecodeRLP(s *rlp.Stream) error {</span>
<span class="term-fg32">+	var raw rlp.RawValue</span>
<span class="term-fg32">+	err := s.Decode(&amp;raw)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	preGingerbread, err := isPreGingerbreadHeader(raw)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	if preGingerbread { &#47;&#47; Address</span>
<span class="term-fg32">+		&#47;&#47; Before gingerbread</span>
<span class="term-fg32">+		decodedHeader := beforeGingerbreadHeader{}</span>
<span class="term-fg32">+		err = rlp.DecodeBytes(raw, &amp;decodedHeader)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		h.ParentHash = decodedHeader.ParentHash</span>
<span class="term-fg32">+		h.Coinbase = decodedHeader.Coinbase</span>
<span class="term-fg32">+		h.Root = decodedHeader.Root</span>
<span class="term-fg32">+		h.TxHash = decodedHeader.TxHash</span>
<span class="term-fg32">+		h.ReceiptHash = decodedHeader.ReceiptHash</span>
<span class="term-fg32">+		h.Bloom = decodedHeader.Bloom</span>
<span class="term-fg32">+		h.Number = decodedHeader.Number</span>
<span class="term-fg32">+		h.GasUsed = decodedHeader.GasUsed</span>
<span class="term-fg32">+		h.Time = decodedHeader.Time</span>
<span class="term-fg32">+		h.Extra = decodedHeader.Extra</span>
<span class="term-fg32">+		h.Difficulty = new(big.Int)</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		&#47;&#47; After gingerbread</span>
<span class="term-fg32">+		decodedHeader := afterGingerbreadHeader{}</span>
<span class="term-fg32">+		err = rlp.DecodeBytes(raw, &amp;decodedHeader)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		h.ParentHash = decodedHeader.ParentHash</span>
<span class="term-fg32">+		h.UncleHash = decodedHeader.UncleHash</span>
<span class="term-fg32">+		h.Coinbase = decodedHeader.Coinbase</span>
<span class="term-fg32">+		h.Root = decodedHeader.Root</span>
<span class="term-fg32">+		h.TxHash = decodedHeader.TxHash</span>
<span class="term-fg32">+		h.ReceiptHash = decodedHeader.ReceiptHash</span>
<span class="term-fg32">+		h.Bloom = decodedHeader.Bloom</span>
<span class="term-fg32">+		h.Difficulty = decodedHeader.Difficulty</span>
<span class="term-fg32">+		h.Number = decodedHeader.Number</span>
<span class="term-fg32">+		h.GasLimit = decodedHeader.GasLimit</span>
<span class="term-fg32">+		h.GasUsed = decodedHeader.GasUsed</span>
<span class="term-fg32">+		h.Time = decodedHeader.Time</span>
<span class="term-fg32">+		h.Extra = decodedHeader.Extra</span>
<span class="term-fg32">+		h.MixDigest = decodedHeader.MixDigest</span>
<span class="term-fg32">+		h.Nonce = decodedHeader.Nonce</span>
<span class="term-fg32">+		h.BaseFee = decodedHeader.BaseFee</span>
<span class="term-fg32">+		h.WithdrawalsHash = decodedHeader.WithdrawalsHash</span>
<span class="term-fg32">+		h.BlobGasUsed = decodedHeader.BlobGasUsed</span>
<span class="term-fg32">+		h.ExcessBlobGas = decodedHeader.ExcessBlobGas</span>
<span class="term-fg32">+		h.ParentBeaconRoot = decodedHeader.ParentBeaconRoot</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; EncodeRLP implements encodes the Header to an RLP data stream.</span>
<span class="term-fg32">+func (h *Header) EncodeRLP(w io.Writer) error {</span>
<span class="term-fg32">+	if h.IsPreGingerbread() {</span>
<span class="term-fg32">+		&#47;&#47; Encode the header</span>
<span class="term-fg32">+		encodedHeader := beforeGingerbreadHeader{</span>
<span class="term-fg32">+			ParentHash:  h.ParentHash,</span>
<span class="term-fg32">+			Coinbase:    h.Coinbase,</span>
<span class="term-fg32">+			Root:        h.Root,</span>
<span class="term-fg32">+			TxHash:      h.TxHash,</span>
<span class="term-fg32">+			ReceiptHash: h.ReceiptHash,</span>
<span class="term-fg32">+			Bloom:       h.Bloom,</span>
<span class="term-fg32">+			Number:      h.Number,</span>
<span class="term-fg32">+			GasUsed:     h.GasUsed,</span>
<span class="term-fg32">+			Time:        h.Time,</span>
<span class="term-fg32">+			Extra:       h.Extra,</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		return rlp.Encode(w, &amp;encodedHeader)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; After gingerbread</span>
<span class="term-fg32">+	encodedHeader := afterGingerbreadHeader{</span>
<span class="term-fg32">+		ParentHash:       h.ParentHash,</span>
<span class="term-fg32">+		UncleHash:        h.UncleHash,</span>
<span class="term-fg32">+		Coinbase:         h.Coinbase,</span>
<span class="term-fg32">+		Root:             h.Root,</span>
<span class="term-fg32">+		TxHash:           h.TxHash,</span>
<span class="term-fg32">+		ReceiptHash:      h.ReceiptHash,</span>
<span class="term-fg32">+		Bloom:            h.Bloom,</span>
<span class="term-fg32">+		Difficulty:       h.Difficulty,</span>
<span class="term-fg32">+		Number:           h.Number,</span>
<span class="term-fg32">+		GasLimit:         h.GasLimit,</span>
<span class="term-fg32">+		GasUsed:          h.GasUsed,</span>
<span class="term-fg32">+		Time:             h.Time,</span>
<span class="term-fg32">+		Extra:            h.Extra,</span>
<span class="term-fg32">+		MixDigest:        h.MixDigest,</span>
<span class="term-fg32">+		Nonce:            h.Nonce,</span>
<span class="term-fg32">+		BaseFee:          h.BaseFee,</span>
<span class="term-fg32">+		WithdrawalsHash:  h.WithdrawalsHash,</span>
<span class="term-fg32">+		BlobGasUsed:      h.BlobGasUsed,</span>
<span class="term-fg32">+		ExcessBlobGas:    h.ExcessBlobGas,</span>
<span class="term-fg32">+		ParentBeaconRoot: h.ParentBeaconRoot,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return rlp.Encode(w, &amp;encodedHeader)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; isPreGingerbreadHeader introspects the header rlp to check the length of the</span>
<span class="term-fg32">+&#47;&#47; second element of the list (the first element describes the list). Pre</span>
<span class="term-fg32">+&#47;&#47; gingerbread the second element of a header is an address which is 20 bytes</span>
<span class="term-fg32">+&#47;&#47; long, post gingerbread the second element is a hash which is 32 bytes long.</span>
<span class="term-fg32">+func isPreGingerbreadHeader(buf []byte) (bool, error) {</span>
<span class="term-fg32">+	var contentSize uint64</span>
<span class="term-fg32">+	var err error</span>
<span class="term-fg32">+	for i := 0; i &lt; 3; i++ {</span>
<span class="term-fg32">+		buf, _, _, contentSize, err = rlp.ReadNext(buf)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return false, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return contentSize == common.AddressLength, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Returns if the header is a gingerbread header by looking at the gas limit.</span>
<span class="term-fg32">+func (h *Header) IsPreGingerbread() bool {</span>
<span class="term-fg32">+	&#47;&#47; We check for a pre gingerbread header by looking for (GasLimit == 0)</span>
<span class="term-fg32">+	&#47;&#47; here. We don&#39;t use Difficulty because we ensure that headers have a zero</span>
<span class="term-fg32">+	&#47;&#47; difficulty, even if it&#39;s not set in the rlp encoded form (we do this</span>
<span class="term-fg32">+	&#47;&#47; because the go ethereum codebase assumed non nil difficulties) and post</span>
<span class="term-fg32">+	&#47;&#47; gingerbread difficulty is hardcoded to zero. Also testing for base fee</span>
<span class="term-fg32">+	&#47;&#47; is not reliable because some older eth blocks had no base fee and they</span>
<span class="term-fg32">+	&#47;&#47; are used in some tests.</span>
<span class="term-fg32">+	return h.GasLimit == 0</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-fef1513cf2b88b5007fa5abc" role="button"
                       aria-expanded="false" aria-controls="id-fef1513cf2b88b5007fa5abc">
                        <code>core/types/celo_denominated_tx.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_denominated_tx.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+119</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-fef1513cf2b88b5007fa5abc"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_denominated_tx.go CELO&#47;core&#47;types&#47;celo_denominated_tx.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..21ed9da5564d7ab1cebd75ca5ef1e5f94617d7dd</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_denominated_tx.go</span>
<span class="term-fg36">@@ -0,0 +1,119 @@</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;bytes&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const CeloDenominatedTxType = 0x7a</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type CeloDenominatedTx struct {</span>
<span class="term-fg32">+	ChainID    *big.Int</span>
<span class="term-fg32">+	Nonce      uint64</span>
<span class="term-fg32">+	GasTipCap  *big.Int</span>
<span class="term-fg32">+	GasFeeCap  *big.Int</span>
<span class="term-fg32">+	Gas        uint64</span>
<span class="term-fg32">+	To         *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means contract creation</span>
<span class="term-fg32">+	Value      *big.Int</span>
<span class="term-fg32">+	Data       []byte</span>
<span class="term-fg32">+	AccessList AccessList</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	FeeCurrency         *common.Address</span>
<span class="term-fg32">+	MaxFeeInFeeCurrency *big.Int</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Signature values</span>
<span class="term-fg32">+	V *big.Int `json:&quot;v&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	R *big.Int `json:&quot;r&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	S *big.Int `json:&quot;s&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; copy creates a deep copy of the transaction data and initializes all fields.</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) copy() TxData {</span>
<span class="term-fg32">+	cpy := &amp;CeloDenominatedTx{</span>
<span class="term-fg32">+		Nonce:       tx.Nonce,</span>
<span class="term-fg32">+		To:          copyAddressPtr(tx.To),</span>
<span class="term-fg32">+		Data:        common.CopyBytes(tx.Data),</span>
<span class="term-fg32">+		Gas:         tx.Gas,</span>
<span class="term-fg32">+		FeeCurrency: copyAddressPtr(tx.FeeCurrency),</span>
<span class="term-fg32">+		&#47;&#47; These are copied below.</span>
<span class="term-fg32">+		MaxFeeInFeeCurrency: new(big.Int),</span>
<span class="term-fg32">+		AccessList:          make(AccessList, len(tx.AccessList)),</span>
<span class="term-fg32">+		Value:               new(big.Int),</span>
<span class="term-fg32">+		ChainID:             new(big.Int),</span>
<span class="term-fg32">+		GasTipCap:           new(big.Int),</span>
<span class="term-fg32">+		GasFeeCap:           new(big.Int),</span>
<span class="term-fg32">+		V:                   new(big.Int),</span>
<span class="term-fg32">+		R:                   new(big.Int),</span>
<span class="term-fg32">+		S:                   new(big.Int),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.MaxFeeInFeeCurrency != nil {</span>
<span class="term-fg32">+		cpy.MaxFeeInFeeCurrency.Set(tx.MaxFeeInFeeCurrency)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	copy(cpy.AccessList, tx.AccessList)</span>
<span class="term-fg32">+	if tx.Value != nil {</span>
<span class="term-fg32">+		cpy.Value.Set(tx.Value)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.ChainID != nil {</span>
<span class="term-fg32">+		cpy.ChainID.Set(tx.ChainID)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.GasTipCap != nil {</span>
<span class="term-fg32">+		cpy.GasTipCap.Set(tx.GasTipCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.GasFeeCap != nil {</span>
<span class="term-fg32">+		cpy.GasFeeCap.Set(tx.GasFeeCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.V != nil {</span>
<span class="term-fg32">+		cpy.V.Set(tx.V)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.R != nil {</span>
<span class="term-fg32">+		cpy.R.Set(tx.R)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.S != nil {</span>
<span class="term-fg32">+		cpy.S.Set(tx.S)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return cpy</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; accessors for innerTx.</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) txType() byte           { return CeloDenominatedTxType }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) chainID() *big.Int      { return tx.ChainID }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) accessList() AccessList { return tx.AccessList }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) data() []byte           { return tx.Data }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) gas() uint64            { return tx.Gas }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) gasFeeCap() *big.Int    { return tx.GasFeeCap }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) gasTipCap() *big.Int    { return tx.GasTipCap }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) gasPrice() *big.Int     { return tx.GasFeeCap }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) value() *big.Int        { return tx.Value }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) nonce() uint64          { return tx.Nonce }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) to() *common.Address    { return tx.To }</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) isSystemTx() bool       { return false }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) effectiveGasPrice(dst *big.Int, baseFee *big.Int) *big.Int {</span>
<span class="term-fg32">+	if baseFee == nil {</span>
<span class="term-fg32">+		return dst.Set(tx.GasFeeCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	tip := dst.Sub(tx.GasFeeCap, baseFee)</span>
<span class="term-fg32">+	if tip.Cmp(tx.GasTipCap) &gt; 0 {</span>
<span class="term-fg32">+		tip.Set(tx.GasTipCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return tip.Add(tip, baseFee)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) rawSignatureValues() (v, r, s *big.Int) {</span>
<span class="term-fg32">+	return tx.V, tx.R, tx.S</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) setSignatureValues(chainID, v, r, s *big.Int) {</span>
<span class="term-fg32">+	tx.ChainID, tx.V, tx.R, tx.S = chainID, v, r, s</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) encode(b *bytes.Buffer) error {</span>
<span class="term-fg32">+	return rlp.Encode(b, tx)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDenominatedTx) decode(input []byte) error {</span>
<span class="term-fg32">+	return rlp.DecodeBytes(input, tx)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3628f54453314464f51b20c2" role="button"
                       aria-expanded="false" aria-controls="id-3628f54453314464f51b20c2">
                        <code>core/types/celo_dynamic_fee_tx_v2.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_dynamic_fee_tx_v2.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+131</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3628f54453314464f51b20c2"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_dynamic_fee_tx_v2.go CELO&#47;core&#47;types&#47;celo_dynamic_fee_tx_v2.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..45f83a5b70b97ce68f22c77400d81d74ba083703</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_dynamic_fee_tx_v2.go</span>
<span class="term-fg36">@@ -0,0 +1,131 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2024 The Celo Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the celo library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the celo library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;bytes&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const CeloDynamicFeeTxV2Type = 0x7b</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CeloDynamicFeeTxV2 represents a CIP-64 transaction.</span>
<span class="term-fg32">+type CeloDynamicFeeTxV2 struct {</span>
<span class="term-fg32">+	ChainID    *big.Int</span>
<span class="term-fg32">+	Nonce      uint64</span>
<span class="term-fg32">+	GasTipCap  *big.Int</span>
<span class="term-fg32">+	GasFeeCap  *big.Int</span>
<span class="term-fg32">+	Gas        uint64</span>
<span class="term-fg32">+	To         *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means contract creation</span>
<span class="term-fg32">+	Value      *big.Int</span>
<span class="term-fg32">+	Data       []byte</span>
<span class="term-fg32">+	AccessList AccessList</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	FeeCurrency *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means native currency</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Signature values</span>
<span class="term-fg32">+	V *big.Int `json:&quot;v&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	R *big.Int `json:&quot;r&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+	S *big.Int `json:&quot;s&quot; gencodec:&quot;required&quot;`</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; copy creates a deep copy of the transaction data and initializes all fields.</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) copy() TxData {</span>
<span class="term-fg32">+	cpy := &amp;CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+		Nonce:       tx.Nonce,</span>
<span class="term-fg32">+		To:          copyAddressPtr(tx.To),</span>
<span class="term-fg32">+		Data:        common.CopyBytes(tx.Data),</span>
<span class="term-fg32">+		Gas:         tx.Gas,</span>
<span class="term-fg32">+		FeeCurrency: copyAddressPtr(tx.FeeCurrency),</span>
<span class="term-fg32">+		&#47;&#47; These are copied below.</span>
<span class="term-fg32">+		AccessList: make(AccessList, len(tx.AccessList)),</span>
<span class="term-fg32">+		Value:      new(big.Int),</span>
<span class="term-fg32">+		ChainID:    new(big.Int),</span>
<span class="term-fg32">+		GasTipCap:  new(big.Int),</span>
<span class="term-fg32">+		GasFeeCap:  new(big.Int),</span>
<span class="term-fg32">+		V:          new(big.Int),</span>
<span class="term-fg32">+		R:          new(big.Int),</span>
<span class="term-fg32">+		S:          new(big.Int),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	copy(cpy.AccessList, tx.AccessList)</span>
<span class="term-fg32">+	if tx.Value != nil {</span>
<span class="term-fg32">+		cpy.Value.Set(tx.Value)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.ChainID != nil {</span>
<span class="term-fg32">+		cpy.ChainID.Set(tx.ChainID)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.GasTipCap != nil {</span>
<span class="term-fg32">+		cpy.GasTipCap.Set(tx.GasTipCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.GasFeeCap != nil {</span>
<span class="term-fg32">+		cpy.GasFeeCap.Set(tx.GasFeeCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.V != nil {</span>
<span class="term-fg32">+		cpy.V.Set(tx.V)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.R != nil {</span>
<span class="term-fg32">+		cpy.R.Set(tx.R)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if tx.S != nil {</span>
<span class="term-fg32">+		cpy.S.Set(tx.S)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return cpy</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; accessors for innerTx.</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) txType() byte           { return CeloDynamicFeeTxV2Type }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) chainID() *big.Int      { return tx.ChainID }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) accessList() AccessList { return tx.AccessList }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) data() []byte           { return tx.Data }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) gas() uint64            { return tx.Gas }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) gasFeeCap() *big.Int    { return tx.GasFeeCap }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) gasTipCap() *big.Int    { return tx.GasTipCap }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) gasPrice() *big.Int     { return tx.GasFeeCap }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) value() *big.Int        { return tx.Value }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) nonce() uint64          { return tx.Nonce }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) to() *common.Address    { return tx.To }</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) isSystemTx() bool       { return false }</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) effectiveGasPrice(dst *big.Int, baseFee *big.Int) *big.Int {</span>
<span class="term-fg32">+	if baseFee == nil {</span>
<span class="term-fg32">+		return dst.Set(tx.GasFeeCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	tip := dst.Sub(tx.GasFeeCap, baseFee)</span>
<span class="term-fg32">+	if tip.Cmp(tx.GasTipCap) &gt; 0 {</span>
<span class="term-fg32">+		tip.Set(tx.GasTipCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return tip.Add(tip, baseFee)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) rawSignatureValues() (v, r, s *big.Int) {</span>
<span class="term-fg32">+	return tx.V, tx.R, tx.S</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) setSignatureValues(chainID, v, r, s *big.Int) {</span>
<span class="term-fg32">+	tx.ChainID, tx.V, tx.R, tx.S = chainID, v, r, s</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) encode(b *bytes.Buffer) error {</span>
<span class="term-fg32">+	return rlp.Encode(b, tx)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (tx *CeloDynamicFeeTxV2) decode(input []byte) error {</span>
<span class="term-fg32">+	return rlp.DecodeBytes(input, tx)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-12e2ed74c0b77ae28f7ee00f" role="button"
                       aria-expanded="false" aria-controls="id-12e2ed74c0b77ae28f7ee00f">
                        <code>core/types/celo_receipt_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_receipt_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+103</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-12e2ed74c0b77ae28f7ee00f"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_receipt_test.go CELO&#47;core&#47;types&#47;celo_receipt_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..297e8504ae269ce5ef8c6ab599019583c265db21</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_receipt_test.go</span>
<span class="term-fg36">@@ -0,0 +1,103 @@</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;bytes&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCeloDynamicFeeTxReceiptEncodeDecode(t *testing.T) {</span>
<span class="term-fg32">+	checkEncodeDecodeConsistency(createTypedReceipt(CeloDynamicFeeTxType), t)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCeloDynamicFeeTxV2ReceiptEncodeDecode(t *testing.T) {</span>
<span class="term-fg32">+	t.Run(&quot;NoBaseFee&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		checkEncodeDecodeConsistency(createTypedReceipt(CeloDynamicFeeTxV2Type), t)</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	t.Run(&quot;WithBaseFee&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		r := createTypedReceipt(CeloDynamicFeeTxV2Type)</span>
<span class="term-fg32">+		r.BaseFee = big.NewInt(1000)</span>
<span class="term-fg32">+		checkEncodeDecodeConsistency(r, t)</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func createTypedReceipt(receiptType uint8) *Receipt {</span>
<span class="term-fg32">+	&#47;&#47; Note this receipt and logs lack lots of fields, those fields are derived from the</span>
<span class="term-fg32">+	&#47;&#47; block and transaction and so are not part of encoding&#47;decoding.</span>
<span class="term-fg32">+	r := &amp;Receipt{</span>
<span class="term-fg32">+		Type:              receiptType,</span>
<span class="term-fg32">+		PostState:         common.Hash{3}.Bytes(),</span>
<span class="term-fg32">+		CumulativeGasUsed: 6,</span>
<span class="term-fg32">+		Logs: []*Log{</span>
<span class="term-fg32">+			{</span>
<span class="term-fg32">+				Address: common.BytesToAddress([]byte{0x33}),</span>
<span class="term-fg32">+				Topics:  []common.Hash{common.HexToHash(&quot;dead&quot;)},</span>
<span class="term-fg32">+				Data:    []byte{0x01, 0x02, 0x03},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			{</span>
<span class="term-fg32">+				Address: common.BytesToAddress([]byte{0x03, 0x33}),</span>
<span class="term-fg32">+				Topics:  []common.Hash{common.HexToHash(&quot;dead&quot;), common.HexToHash(&quot;beef&quot;)},</span>
<span class="term-fg32">+				Data:    []byte{0x01, 0x02},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r.Bloom = CreateBloom(Receipts{r})</span>
<span class="term-fg32">+	return r</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; checkEncodeDecodeConsistency checks both RLP and binary encoding&#47;decoding consistency.</span>
<span class="term-fg32">+func checkEncodeDecodeConsistency(r *Receipt, t *testing.T) {</span>
<span class="term-fg32">+	checkRLPEncodeDecodeConsistency(r, t)</span>
<span class="term-fg32">+	checkStorageRLPEncodeDecodeConsistency((*ReceiptForStorage)(r), t)</span>
<span class="term-fg32">+	checkBinaryEncodeDecodeConsistency(r, t)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; checkRLPEncodeDecodeConsistency encodes and decodes the receipt and checks that they are equal.</span>
<span class="term-fg32">+func checkRLPEncodeDecodeConsistency(r *Receipt, t *testing.T) {</span>
<span class="term-fg32">+	buf := new(bytes.Buffer)</span>
<span class="term-fg32">+	err := rlp.Encode(buf, r)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var r2 Receipt</span>
<span class="term-fg32">+	err = rlp.Decode(buf, &amp;r2)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	require.EqualValues(t, r, &amp;r2)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; checkRLPEncodeDecodeConsistency encodes and decodes the receipt and checks that they are equal.</span>
<span class="term-fg32">+func checkBinaryEncodeDecodeConsistency(r *Receipt, t *testing.T) {</span>
<span class="term-fg32">+	bytes, err := r.MarshalBinary()</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	r2 := &amp;Receipt{}</span>
<span class="term-fg32">+	err = r2.UnmarshalBinary(bytes)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	require.EqualValues(t, r, r2)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; checkStorageRLPEncodeDecodeConsistency encodes and decodes the receipt and checks that they are equal.</span>
<span class="term-fg32">+func checkStorageRLPEncodeDecodeConsistency(r *ReceiptForStorage, t *testing.T) {</span>
<span class="term-fg32">+	buf := new(bytes.Buffer)</span>
<span class="term-fg32">+	err := rlp.Encode(buf, r)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Stored receipts do not encode the type, (although they do require it to be set during encoding)</span>
<span class="term-fg32">+	&#47;&#47; since it is derived from the associated transaction. So for the sake of the comparison we set it</span>
<span class="term-fg32">+	&#47;&#47; to 0 and restore it after the comparison.</span>
<span class="term-fg32">+	receiptType := r.Type</span>
<span class="term-fg32">+	defer func() { r.Type = receiptType }()</span>
<span class="term-fg32">+	r.Type = 0</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var r2 ReceiptForStorage</span>
<span class="term-fg32">+	err = rlp.Decode(buf, &amp;r2)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	require.EqualValues(t, r, &amp;r2)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e67b6c180afc758330332eeb" role="button"
                       aria-expanded="false" aria-controls="id-e67b6c180afc758330332eeb">
                        <code>core/types/celo_transaction.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_transaction.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+127</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e67b6c180afc758330332eeb"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_transaction.go CELO&#47;core&#47;types&#47;celo_transaction.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a5f9e14282daf464f8881f44c04640aba720aa71</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_transaction.go</span>
<span class="term-fg36">@@ -0,0 +1,127 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2024 The Celo Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the celo library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the celo library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsCeloLegacy returns true if the transaction is a legacy celo transaction.</span>
<span class="term-fg32">+&#47;&#47; I.E. it has the fields feeCurrency, gatewayFee and gatewayFeeRecipient.</span>
<span class="term-fg32">+func (tx *Transaction) IsCeloLegacy() bool {</span>
<span class="term-fg32">+	switch t := tx.inner.(type) {</span>
<span class="term-fg32">+	case *LegacyTx:</span>
<span class="term-fg32">+		return t.CeloLegacy</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return false</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; FeeCurrency returns the fee currency of the transaction if there is one.</span>
<span class="term-fg32">+func (tx *Transaction) FeeCurrency() *common.Address {</span>
<span class="term-fg32">+	var feeCurrency *common.Address</span>
<span class="term-fg32">+	switch t := tx.inner.(type) {</span>
<span class="term-fg32">+	case *CeloDynamicFeeTx:</span>
<span class="term-fg32">+		feeCurrency = t.FeeCurrency</span>
<span class="term-fg32">+	case *CeloDynamicFeeTxV2:</span>
<span class="term-fg32">+		feeCurrency = t.FeeCurrency</span>
<span class="term-fg32">+	case *CeloDenominatedTx:</span>
<span class="term-fg32">+		feeCurrency = t.FeeCurrency</span>
<span class="term-fg32">+	case *LegacyTx:</span>
<span class="term-fg32">+		feeCurrency = t.FeeCurrency</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return feeCurrency</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GatewayFee returns the gateway fee of the transaction if there is one.</span>
<span class="term-fg32">+&#47;&#47; Note: this is here to support serving legacy transactions over the RPC, it should not be used in new code.</span>
<span class="term-fg32">+func (tx *Transaction) GatewayFee() *big.Int {</span>
<span class="term-fg32">+	var gatewayFee *big.Int</span>
<span class="term-fg32">+	switch t := tx.inner.(type) {</span>
<span class="term-fg32">+	case *CeloDynamicFeeTx:</span>
<span class="term-fg32">+		gatewayFee = t.GatewayFee</span>
<span class="term-fg32">+	case *LegacyTx:</span>
<span class="term-fg32">+		gatewayFee = t.GatewayFee</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return gatewayFee</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GatewayFeeRecipient returns the gateway fee recipient of the transaction if there is one.</span>
<span class="term-fg32">+&#47;&#47; Note: this is here to support serving legacy transactions over the RPC, it should not be used in new code.</span>
<span class="term-fg32">+func (tx *Transaction) GatewayFeeRecipient() *common.Address {</span>
<span class="term-fg32">+	var gatewayFeeRecipient *common.Address</span>
<span class="term-fg32">+	switch t := tx.inner.(type) {</span>
<span class="term-fg32">+	case *CeloDynamicFeeTx:</span>
<span class="term-fg32">+		gatewayFeeRecipient = t.GatewayFeeRecipient</span>
<span class="term-fg32">+	case *LegacyTx:</span>
<span class="term-fg32">+		gatewayFeeRecipient = t.GatewayFeeRecipient</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return gatewayFeeRecipient</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; MaxFeeInFeeCurrency returns the maximum fee in the fee currency of the transaction if there is one.</span>
<span class="term-fg32">+func (tx *Transaction) MaxFeeInFeeCurrency() *big.Int {</span>
<span class="term-fg32">+	var maxFeeInFeeCurrency *big.Int</span>
<span class="term-fg32">+	switch t := tx.inner.(type) {</span>
<span class="term-fg32">+	case *CeloDenominatedTx:</span>
<span class="term-fg32">+		maxFeeInFeeCurrency = t.MaxFeeInFeeCurrency</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return maxFeeInFeeCurrency</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CompareWithRates compares the effective gas price of two transactions according to the exchange rates and</span>
<span class="term-fg32">+&#47;&#47; the base fees in the transactions currencies.</span>
<span class="term-fg32">+func CompareWithRates(a, b *Transaction, ratesAndFees *exchange.RatesAndFees) int {</span>
<span class="term-fg32">+	if ratesAndFees == nil {</span>
<span class="term-fg32">+		&#47;&#47; During node startup the ratesAndFees might not be yet setup, compare nominally</span>
<span class="term-fg32">+		feeCapCmp := a.GasFeeCapCmp(b)</span>
<span class="term-fg32">+		if feeCapCmp != 0 {</span>
<span class="term-fg32">+			return feeCapCmp</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return a.GasTipCapCmp(b)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	rates := ratesAndFees.Rates</span>
<span class="term-fg32">+	if ratesAndFees.HasBaseFee() {</span>
<span class="term-fg32">+		tipA := a.EffectiveGasTipValue(ratesAndFees.GetBaseFeeIn(a.FeeCurrency()))</span>
<span class="term-fg32">+		tipB := b.EffectiveGasTipValue(ratesAndFees.GetBaseFeeIn(b.FeeCurrency()))</span>
<span class="term-fg32">+		c, _ := exchange.CompareValue(rates, tipA, a.FeeCurrency(), tipB, b.FeeCurrency())</span>
<span class="term-fg32">+		return c</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Compare fee caps if baseFee is not specified or effective tips are equal</span>
<span class="term-fg32">+	feeA := a.inner.gasFeeCap()</span>
<span class="term-fg32">+	feeB := b.inner.gasFeeCap()</span>
<span class="term-fg32">+	c, _ := exchange.CompareValue(rates, feeA, a.FeeCurrency(), feeB, b.FeeCurrency())</span>
<span class="term-fg32">+	if c != 0 {</span>
<span class="term-fg32">+		return c</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Compare tips if effective tips and fee caps are equal</span>
<span class="term-fg32">+	tipCapA := a.inner.gasTipCap()</span>
<span class="term-fg32">+	tipCapB := b.inner.gasTipCap()</span>
<span class="term-fg32">+	c, _ = exchange.CompareValue(rates, tipCapA, a.FeeCurrency(), tipCapB, b.FeeCurrency())</span>
<span class="term-fg32">+	return c</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func copyBigInt(b *big.Int) *big.Int {</span>
<span class="term-fg32">+	if b == nil {</span>
<span class="term-fg32">+		return nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return new(big.Int).Set(b)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4fdd19a9ff40896d92351783" role="button"
                       aria-expanded="false" aria-controls="id-4fdd19a9ff40896d92351783">
                        <code>core/types/celo_transaction_marshalling.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_transaction_marshalling.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+133</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4fdd19a9ff40896d92351783"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_transaction_marshalling.go CELO&#47;core&#47;types&#47;celo_transaction_marshalling.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..109342a3668a7c4bcae80b26ebd47238ba460e6d</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_transaction_marshalling.go</span>
<span class="term-fg36">@@ -0,0 +1,133 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2024 The Celo Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the celo library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the celo library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;encoding&#47;json&quot;</span>
<span class="term-fg32">+	&quot;errors&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func celoTransactionMarshal(tx *Transaction) ([]byte, bool, error) {</span>
<span class="term-fg32">+	var enc txJSON</span>
<span class="term-fg32">+	&#47;&#47; These are set for all tx types.</span>
<span class="term-fg32">+	enc.Hash = tx.Hash()</span>
<span class="term-fg32">+	enc.Type = hexutil.Uint64(tx.Type())</span>
<span class="term-fg32">+	switch itx := tx.inner.(type) {</span>
<span class="term-fg32">+	case *CeloDynamicFeeTxV2:</span>
<span class="term-fg32">+		enc.ChainID = (*hexutil.Big)(itx.ChainID)</span>
<span class="term-fg32">+		enc.Nonce = (*hexutil.Uint64)(&amp;itx.Nonce)</span>
<span class="term-fg32">+		enc.To = tx.To()</span>
<span class="term-fg32">+		enc.Gas = (*hexutil.Uint64)(&amp;itx.Gas)</span>
<span class="term-fg32">+		enc.MaxFeePerGas = (*hexutil.Big)(itx.GasFeeCap)</span>
<span class="term-fg32">+		enc.MaxPriorityFeePerGas = (*hexutil.Big)(itx.GasTipCap)</span>
<span class="term-fg32">+		enc.FeeCurrency = itx.FeeCurrency</span>
<span class="term-fg32">+		enc.Value = (*hexutil.Big)(itx.Value)</span>
<span class="term-fg32">+		enc.Input = (*hexutil.Bytes)(&amp;itx.Data)</span>
<span class="term-fg32">+		enc.AccessList = &amp;itx.AccessList</span>
<span class="term-fg32">+		enc.V = (*hexutil.Big)(itx.V)</span>
<span class="term-fg32">+		enc.R = (*hexutil.Big)(itx.R)</span>
<span class="term-fg32">+		enc.S = (*hexutil.Big)(itx.S)</span>
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		return nil, false, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	bytes, err := json.Marshal(&amp;enc)</span>
<span class="term-fg32">+	return bytes, true, err</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func celoTransactionUnmarshal(dec txJSON, inner *TxData) (bool, error) {</span>
<span class="term-fg32">+	switch dec.Type {</span>
<span class="term-fg32">+	case CeloDynamicFeeTxV2Type:</span>
<span class="term-fg32">+		var itx CeloDynamicFeeTxV2</span>
<span class="term-fg32">+		*inner = &amp;itx</span>
<span class="term-fg32">+		if dec.ChainID == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;chainId&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.ChainID = (*big.Int)(dec.ChainID)</span>
<span class="term-fg32">+		if dec.Nonce == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;nonce&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Nonce = uint64(*dec.Nonce)</span>
<span class="term-fg32">+		if dec.To != nil {</span>
<span class="term-fg32">+			itx.To = dec.To</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if dec.Gas == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;gas&#39; for txdata&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Gas = uint64(*dec.Gas)</span>
<span class="term-fg32">+		if dec.MaxPriorityFeePerGas == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;maxPriorityFeePerGas&#39; for txdata&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.GasTipCap = (*big.Int)(dec.MaxPriorityFeePerGas)</span>
<span class="term-fg32">+		if dec.MaxFeePerGas == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;maxFeePerGas&#39; for txdata&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.GasFeeCap = (*big.Int)(dec.MaxFeePerGas)</span>
<span class="term-fg32">+		if dec.Value == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;value&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.FeeCurrency = dec.FeeCurrency</span>
<span class="term-fg32">+		itx.Value = (*big.Int)(dec.Value)</span>
<span class="term-fg32">+		if dec.Input == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;input&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.Data = *dec.Input</span>
<span class="term-fg32">+		if dec.V == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;v&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if dec.AccessList != nil {</span>
<span class="term-fg32">+			itx.AccessList = *dec.AccessList</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.V = (*big.Int)(dec.V)</span>
<span class="term-fg32">+		if dec.R == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;r&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.R = (*big.Int)(dec.R)</span>
<span class="term-fg32">+		if dec.S == nil {</span>
<span class="term-fg32">+			return true, errors.New(&quot;missing required field &#39;s&#39; in transaction&quot;)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		itx.S = (*big.Int)(dec.S)</span>
<span class="term-fg32">+		withSignature := itx.V.Sign() != 0 || itx.R.Sign() != 0 || itx.S.Sign() != 0</span>
<span class="term-fg32">+		if withSignature {</span>
<span class="term-fg32">+			if err := sanityCheckSignature(itx.V, itx.R, itx.S, false); err != nil {</span>
<span class="term-fg32">+				return true, err</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		return false, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return true, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func celoDecodeTyped(b []byte) (TxData, bool, error) {</span>
<span class="term-fg32">+	var inner TxData</span>
<span class="term-fg32">+	switch b[0] {</span>
<span class="term-fg32">+	case CeloDenominatedTxType:</span>
<span class="term-fg32">+		inner = new(CeloDenominatedTx)</span>
<span class="term-fg32">+	case CeloDynamicFeeTxV2Type:</span>
<span class="term-fg32">+		inner = new(CeloDynamicFeeTxV2)</span>
<span class="term-fg32">+	case CeloDynamicFeeTxType:</span>
<span class="term-fg32">+		inner = new(CeloDynamicFeeTx)</span>
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		return nil, false, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	err := inner.decode(b[1:])</span>
<span class="term-fg32">+	return inner, true, err</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-6a9452f314c92bbb76f98f5c" role="button"
                       aria-expanded="false" aria-controls="id-6a9452f314c92bbb76f98f5c">
                        <code>core/types/celo_transaction_signing_forks.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_transaction_signing_forks.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+112</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-6a9452f314c92bbb76f98f5c"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_transaction_signing_forks.go CELO&#47;core&#47;types&#47;celo_transaction_signing_forks.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..9e33bb46310c773777c5311ddc594adcb50d7ad5</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_transaction_signing_forks.go</span>
<span class="term-fg36">@@ -0,0 +1,112 @@</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import &quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	&#47;&#47; celoForks is the list of celo forks that are supported by the</span>
<span class="term-fg32">+	&#47;&#47; celoSigner. This list is ordered with more recent forks appearing</span>
<span class="term-fg32">+	&#47;&#47; earlier. It is assumed that if a more recent fork is active then all</span>
<span class="term-fg32">+	&#47;&#47; previous forks are also active.</span>
<span class="term-fg32">+	celoForks = forks{&amp;cel2{}, &amp;celoLegacy{}}</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type forks []fork</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; activeForks returns the active forks for the given block time and chain config.</span>
<span class="term-fg32">+func (f forks) activeForks(blockTime uint64, config *params.ChainConfig) []fork {</span>
<span class="term-fg32">+	for i, fork := range f {</span>
<span class="term-fg32">+		if fork.active(blockTime, config) {</span>
<span class="term-fg32">+			return f[i:]</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; findTxFuncs returns the txFuncs for the given tx if there is a fork that supports it.</span>
<span class="term-fg32">+func (f forks) findTxFuncs(tx *Transaction) *txFuncs {</span>
<span class="term-fg32">+	for _, fork := range f {</span>
<span class="term-fg32">+		if funcs := fork.txFuncs(tx); funcs != nil {</span>
<span class="term-fg32">+			return funcs</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; fork contains functionality to determine if it is active for a given block</span>
<span class="term-fg32">+&#47;&#47; time and chain config. It also acts as a container for functionality related</span>
<span class="term-fg32">+&#47;&#47; to transactions enabled or deprecated in that fork.</span>
<span class="term-fg32">+type fork interface {</span>
<span class="term-fg32">+	&#47;&#47; active returns true if the fork is active at the given block time.</span>
<span class="term-fg32">+	active(blockTime uint64, config *params.ChainConfig) bool</span>
<span class="term-fg32">+	&#47;&#47; equal returns true if the given fork is the same underlying type as this fork.</span>
<span class="term-fg32">+	equal(fork) bool</span>
<span class="term-fg32">+	&#47;&#47; txFuncs returns the txFuncs for the given tx if it is supported by the</span>
<span class="term-fg32">+	&#47;&#47; fork. If a fork deprecates a tx type then this function should return</span>
<span class="term-fg32">+	&#47;&#47; deprecatedTxFuncs for that tx type.</span>
<span class="term-fg32">+	txFuncs(tx *Transaction) *txFuncs</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Cel2 is the fork marking the transition point from an L1 to an L2.</span>
<span class="term-fg32">+&#47;&#47; It deprecates CeloDynamicFeeTxType and LegacyTxTypes with CeloLegacy set to true.</span>
<span class="term-fg32">+type cel2 struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *cel2) active(blockTime uint64, config *params.ChainConfig) bool {</span>
<span class="term-fg32">+	return config.IsCel2(blockTime)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *cel2) equal(other fork) bool {</span>
<span class="term-fg32">+	_, ok := other.(*cel2)</span>
<span class="term-fg32">+	return ok</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *cel2) txFuncs(tx *Transaction) *txFuncs {</span>
<span class="term-fg32">+	t := tx.Type()</span>
<span class="term-fg32">+	switch {</span>
<span class="term-fg32">+	case t == LegacyTxType &amp;&amp; tx.IsCeloLegacy():</span>
<span class="term-fg32">+		return deprecatedTxFuncs</span>
<span class="term-fg32">+	case t == CeloDynamicFeeTxType:</span>
<span class="term-fg32">+		return deprecatedTxFuncs</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; celoLegacy isn&#39;t actually a fork, but a placeholder for all historical celo</span>
<span class="term-fg32">+&#47;&#47; related forks occurring on the celo L1. We don&#39;t need to construct the full</span>
<span class="term-fg32">+&#47;&#47; signer chain from the celo legacy project because we won&#39;t support</span>
<span class="term-fg32">+&#47;&#47; historical transaction execution, so we just need to be able to derive the</span>
<span class="term-fg32">+&#47;&#47; senders for historical transactions and since we assume that the historical</span>
<span class="term-fg32">+&#47;&#47; data is correct we just need one blanket signer that can cover all legacy</span>
<span class="term-fg32">+&#47;&#47; celo transactions, before the L2 transition point.</span>
<span class="term-fg32">+type celoLegacy struct{}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoLegacy) active(blockTime uint64, config *params.ChainConfig) bool {</span>
<span class="term-fg32">+	&#47;&#47; The celo legacy fork is always active in a celo context</span>
<span class="term-fg32">+	return config.Cel2Time != nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoLegacy) equal(other fork) bool {</span>
<span class="term-fg32">+	_, ok := other.(*cel2)</span>
<span class="term-fg32">+	return ok</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoLegacy) txFuncs(tx *Transaction) *txFuncs {</span>
<span class="term-fg32">+	t := tx.Type()</span>
<span class="term-fg32">+	switch {</span>
<span class="term-fg32">+	case t == uint8(LegacyTxType) &amp;&amp; tx.IsCeloLegacy():</span>
<span class="term-fg32">+		return celoLegacyTxFuncs</span>
<span class="term-fg32">+	case t == DynamicFeeTxType:</span>
<span class="term-fg32">+		&#47;&#47; We handle the dynamic fee tx type here because we need to handle</span>
<span class="term-fg32">+		&#47;&#47; migrated dynamic fee txs. These were enabeled in celo in the Espresso</span>
<span class="term-fg32">+		&#47;&#47; hardfork, which doesn&#39;t have any analogue in op-geth. Even though</span>
<span class="term-fg32">+		&#47;&#47; op-geth does enable support for dynamic fee txs in the London</span>
<span class="term-fg32">+		&#47;&#47; hardfork (which we set to the cel2 block) that fork contains a lot of</span>
<span class="term-fg32">+		&#47;&#47; changes that were not part of Espresso. So instead we ned to handle</span>
<span class="term-fg32">+		&#47;&#47; DynamicFeeTxTypes here.</span>
<span class="term-fg32">+		return dynamicFeeTxFuncs</span>
<span class="term-fg32">+	case t == CeloDynamicFeeTxV2Type:</span>
<span class="term-fg32">+		return celoDynamicFeeTxV2Funcs</span>
<span class="term-fg32">+	case t == CeloDynamicFeeTxType:</span>
<span class="term-fg32">+		return celoDynamicFeeTxFuncs</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a820e4af68b4a0d0541cf2ab" role="button"
                       aria-expanded="false" aria-controls="id-a820e4af68b4a0d0541cf2ab">
                        <code>core/types/celo_transaction_signing_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_transaction_signing_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+124</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a820e4af68b4a0d0541cf2ab"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_transaction_signing_test.go CELO&#47;core&#47;types&#47;celo_transaction_signing_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..ac1a8852e243612970e6b1459edf74573fc8da08</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_transaction_signing_test.go</span>
<span class="term-fg36">@@ -0,0 +1,124 @@</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;crypto&#47;rand&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Tests that by default the celo legacy signer will sign transactions in a protected manner.</span>
<span class="term-fg32">+func TestProtectedCeloLegacyTxSigning(t *testing.T) {</span>
<span class="term-fg32">+	tx := newCeloTx(t)</span>
<span class="term-fg32">+	&#47;&#47; Configure config and block time to enable the celoLegacy signer, legacy</span>
<span class="term-fg32">+	&#47;&#47; transactions are deprecated after cel2</span>
<span class="term-fg32">+	cel2Time := uint64(2000)</span>
<span class="term-fg32">+	config := &amp;params.ChainConfig{</span>
<span class="term-fg32">+		ChainID:  big.NewInt(10000),</span>
<span class="term-fg32">+		Cel2Time: &amp;cel2Time,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	number := new(big.Int).SetUint64(100)</span>
<span class="term-fg32">+	blockTime := uint64(1000)</span>
<span class="term-fg32">+	s := MakeSigner(config, number, blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	senderKey, err := crypto.GenerateKey()</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	signed, err := SignTx(tx, s, senderKey)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Check the sender just to be sure that the signing worked correctly</span>
<span class="term-fg32">+	actualSender, err := Sender(s, signed)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	require.Equal(t, crypto.PubkeyToAddress(senderKey.PublicKey), actualSender)</span>
<span class="term-fg32">+	&#47;&#47; Validate that the transaction is protected</span>
<span class="term-fg32">+	require.True(t, signed.Protected())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Tests that the celo legacy signer can still derive the sender of an unprotected transaction.</span>
<span class="term-fg32">+func TestUnprotectedCeloLegacyTxSenderDerivation(t *testing.T) {</span>
<span class="term-fg32">+	tx := newCeloTx(t)</span>
<span class="term-fg32">+	&#47;&#47; Configure config and block time to enable the celoLegacy signer, legacy</span>
<span class="term-fg32">+	&#47;&#47; transactions are deprecated after cel2</span>
<span class="term-fg32">+	cel2Time := uint64(2000)</span>
<span class="term-fg32">+	config := &amp;params.ChainConfig{</span>
<span class="term-fg32">+		ChainID:  big.NewInt(10000),</span>
<span class="term-fg32">+		Cel2Time: &amp;cel2Time,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	number := new(big.Int).SetUint64(100)</span>
<span class="term-fg32">+	blockTime := uint64(1000)</span>
<span class="term-fg32">+	s := MakeSigner(config, number, blockTime)</span>
<span class="term-fg32">+	u := &amp;unprotectedSigner{config.ChainID}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	senderKey, err := crypto.GenerateKey()</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	&#47;&#47; Sign unprotected</span>
<span class="term-fg32">+	signed, err := SignTx(tx, u, senderKey)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Check that the sender can be derived with the signer from MakeSigner</span>
<span class="term-fg32">+	actualSender, err := Sender(s, signed)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	require.Equal(t, crypto.PubkeyToAddress(senderKey.PublicKey), actualSender)</span>
<span class="term-fg32">+	&#47;&#47; Validate that the transaction is not protected</span>
<span class="term-fg32">+	require.False(t, signed.Protected())</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func newCeloTx(t *testing.T) *Transaction {</span>
<span class="term-fg32">+	return NewTx(&amp;LegacyTx{</span>
<span class="term-fg32">+		Nonce:    1,</span>
<span class="term-fg32">+		GasPrice: new(big.Int).SetUint64(10000),</span>
<span class="term-fg32">+		Gas:      100000,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		FeeCurrency:         randomAddress(t),</span>
<span class="term-fg32">+		GatewayFee:          new(big.Int).SetUint64(100),</span>
<span class="term-fg32">+		GatewayFeeRecipient: randomAddress(t),</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		To:    randomAddress(t),</span>
<span class="term-fg32">+		Value: new(big.Int).SetUint64(1000),</span>
<span class="term-fg32">+		Data:  []byte{},</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		CeloLegacy: true,</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func randomAddress(t *testing.T) *common.Address {</span>
<span class="term-fg32">+	addr := common.Address{}</span>
<span class="term-fg32">+	_, err := rand.Read(addr[:])</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	return &amp;addr</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; This signer mimics Homestead signing but for Celo transactions</span>
<span class="term-fg32">+type unprotectedSigner struct {</span>
<span class="term-fg32">+	chainID *big.Int</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; ChainID implements Signer.</span>
<span class="term-fg32">+func (u *unprotectedSigner) ChainID() *big.Int {</span>
<span class="term-fg32">+	return u.chainID</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Equal implements Signer.</span>
<span class="term-fg32">+func (u *unprotectedSigner) Equal(Signer) bool {</span>
<span class="term-fg32">+	panic(&quot;unimplemented&quot;)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Hash implements Signer.</span>
<span class="term-fg32">+func (u *unprotectedSigner) Hash(tx *Transaction) common.Hash {</span>
<span class="term-fg32">+	return rlpHash(baseCeloLegacyTxSigningFields(tx))</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Sender implements Signer.</span>
<span class="term-fg32">+func (u *unprotectedSigner) Sender(tx *Transaction) (common.Address, error) {</span>
<span class="term-fg32">+	panic(&quot;unimplemented&quot;)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; SignatureValues implements Signer.</span>
<span class="term-fg32">+func (u *unprotectedSigner) SignatureValues(tx *Transaction, sig []byte) (r *big.Int, s *big.Int, v *big.Int, err error) {</span>
<span class="term-fg32">+	r, s, v = decodeSignature(sig)</span>
<span class="term-fg32">+	return r, s, v, nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-05b3ad541be9c29bd77b9bd3" role="button"
                       aria-expanded="false" aria-controls="id-05b3ad541be9c29bd77b9bd3">
                        <code>core/types/celo_transaction_signing_tx_funcs.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_transaction_signing_tx_funcs.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+190</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-05b3ad541be9c29bd77b9bd3"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_transaction_signing_tx_funcs.go CELO&#47;core&#47;types&#47;celo_transaction_signing_tx_funcs.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..5d0bbd1bc89f2a716a75b35a59ee97c3970e2c14</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_transaction_signing_tx_funcs.go</span>
<span class="term-fg36">@@ -0,0 +1,190 @@</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; deprecatedTxFuncs should be returned by forks that have deprecated support for a tx type.</span>
<span class="term-fg32">+	deprecatedTxFuncs = &amp;txFuncs{</span>
<span class="term-fg32">+		hash: func(tx *Transaction, chainID *big.Int) common.Hash {</span>
<span class="term-fg32">+			return tx.Hash()</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		signatureValues: func(tx *Transaction, sig []byte, signerChainID *big.Int) (r *big.Int, s *big.Int, v *big.Int, err error) {</span>
<span class="term-fg32">+			return nil, nil, nil, fmt.Errorf(&quot;%w %v&quot;, ErrDeprecatedTxType, tx.Type())</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		sender: func(tx *Transaction, hashFunc func(tx *Transaction, chainID *big.Int) common.Hash, signerChainID *big.Int) (common.Address, error) {</span>
<span class="term-fg32">+			return common.Address{}, fmt.Errorf(&quot;%w %v&quot;, ErrDeprecatedTxType, tx.Type())</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Although celo allowed unprotected transactions it never supported signing</span>
<span class="term-fg32">+	&#47;&#47; them with signers retrieved by MakeSigner or LatestSigner (if you wanted</span>
<span class="term-fg32">+	&#47;&#47; to make an unprotected transaction you needed to use the HomesteadSigner</span>
<span class="term-fg32">+	&#47;&#47; directly), so both hash and signatureValues functions here provide</span>
<span class="term-fg32">+	&#47;&#47; protected values, but sender can accept unprotected transactions. See</span>
<span class="term-fg32">+	&#47;&#47; https:&#47;&#47;github.com&#47;celo-org&#47;celo-blockchain&#47;pull&#47;1748&#47;files and</span>
<span class="term-fg32">+	&#47;&#47; https:&#47;&#47;github.com&#47;celo-org&#47;celo-blockchain&#47;issues&#47;1734 and</span>
<span class="term-fg32">+	&#47;&#47; https:&#47;&#47;github.com&#47;celo-org&#47;celo-proposals&#47;blob&#47;master&#47;CIPs&#47;cip-0050.md</span>
<span class="term-fg32">+	celoLegacyTxFuncs = &amp;txFuncs{</span>
<span class="term-fg32">+		hash: func(tx *Transaction, chainID *big.Int) common.Hash {</span>
<span class="term-fg32">+			return rlpHash(append(baseCeloLegacyTxSigningFields(tx), chainID, uint(0), uint(0)))</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		signatureValues: func(tx *Transaction, sig []byte, signerChainID *big.Int) (r *big.Int, s *big.Int, v *big.Int, err error) {</span>
<span class="term-fg32">+			r, s, v = decodeSignature(sig)</span>
<span class="term-fg32">+			if signerChainID.Sign() != 0 {</span>
<span class="term-fg32">+				v = big.NewInt(int64(sig[64] + 35))</span>
<span class="term-fg32">+				signerChainMul := new(big.Int).Mul(signerChainID, big.NewInt(2))</span>
<span class="term-fg32">+				v.Add(v, signerChainMul)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			return r, s, v, nil</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		sender: func(tx *Transaction, hashFunc func(tx *Transaction, chainID *big.Int) common.Hash, signerChainID *big.Int) (common.Address, error) {</span>
<span class="term-fg32">+			if tx.Protected() {</span>
<span class="term-fg32">+				if tx.ChainId().Cmp(signerChainID) != 0 {</span>
<span class="term-fg32">+					return common.Address{}, fmt.Errorf(&quot;%w: have %d want %d&quot;, ErrInvalidChainId, tx.ChainId(), signerChainID)</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+				v, r, s := tx.RawSignatureValues()</span>
<span class="term-fg32">+				signerChainMul := new(big.Int).Mul(signerChainID, big.NewInt(2))</span>
<span class="term-fg32">+				v = new(big.Int).Sub(v, signerChainMul)</span>
<span class="term-fg32">+				v.Sub(v, big8)</span>
<span class="term-fg32">+				return recoverPlain(hashFunc(tx, signerChainID), r, s, v, true)</span>
<span class="term-fg32">+			} else {</span>
<span class="term-fg32">+				v, r, s := tx.RawSignatureValues()</span>
<span class="term-fg32">+				return recoverPlain(rlpHash(baseCeloLegacyTxSigningFields(tx)), r, s, v, true)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	dynamicFeeTxFuncs = &amp;txFuncs{</span>
<span class="term-fg32">+		hash: func(tx *Transaction, chainID *big.Int) common.Hash {</span>
<span class="term-fg32">+			return NewLondonSigner(chainID).Hash(tx)</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		signatureValues: func(tx *Transaction, sig []byte, signerChainID *big.Int) (r *big.Int, s *big.Int, v *big.Int, err error) {</span>
<span class="term-fg32">+			return NewLondonSigner(signerChainID).SignatureValues(tx, sig)</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		sender: func(tx *Transaction, hashFunc func(tx *Transaction, chainID *big.Int) common.Hash, signerChainID *big.Int) (common.Address, error) {</span>
<span class="term-fg32">+			return NewLondonSigner(signerChainID).Sender(tx)</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	celoDynamicFeeTxFuncs = &amp;txFuncs{</span>
<span class="term-fg32">+		hash: func(tx *Transaction, chainID *big.Int) common.Hash {</span>
<span class="term-fg32">+			return prefixedRlpHash(</span>
<span class="term-fg32">+				tx.Type(),</span>
<span class="term-fg32">+				[]interface{}{</span>
<span class="term-fg32">+					chainID,</span>
<span class="term-fg32">+					tx.Nonce(),</span>
<span class="term-fg32">+					tx.GasTipCap(),</span>
<span class="term-fg32">+					tx.GasFeeCap(),</span>
<span class="term-fg32">+					tx.Gas(),</span>
<span class="term-fg32">+					tx.FeeCurrency(),</span>
<span class="term-fg32">+					tx.GatewayFeeRecipient(),</span>
<span class="term-fg32">+					tx.GatewayFee(),</span>
<span class="term-fg32">+					tx.To(),</span>
<span class="term-fg32">+					tx.Value(),</span>
<span class="term-fg32">+					tx.Data(),</span>
<span class="term-fg32">+					tx.AccessList(),</span>
<span class="term-fg32">+				})</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		signatureValues: dynamicAndDenominatedTxSigValues,</span>
<span class="term-fg32">+		sender:          dynamicAndDenominatedTxSender,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Custom signing functionality for CeloDynamicFeeTxV2 txs.</span>
<span class="term-fg32">+	celoDynamicFeeTxV2Funcs = &amp;txFuncs{</span>
<span class="term-fg32">+		hash: func(tx *Transaction, chainID *big.Int) common.Hash {</span>
<span class="term-fg32">+			return prefixedRlpHash(tx.Type(), baseDynomicatedTxSigningFields(tx, chainID))</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		signatureValues: dynamicAndDenominatedTxSigValues,</span>
<span class="term-fg32">+		sender:          dynamicAndDenominatedTxSender,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Custom signing functionality for CeloDenominatedTx txs.</span>
<span class="term-fg32">+	&#47;&#47;</span>
<span class="term-fg32">+	&#47;&#47; TODO remove this nolint directive when we do enable support for cip66 transactions.</span>
<span class="term-fg32">+	&#47;&#47;nolint:unused</span>
<span class="term-fg32">+	celoDenominatedTxFuncs = &amp;txFuncs{</span>
<span class="term-fg32">+		hash: func(tx *Transaction, chainID *big.Int) common.Hash {</span>
<span class="term-fg32">+			return prefixedRlpHash(tx.Type(), append(baseDynomicatedTxSigningFields(tx, chainID), tx.MaxFeeInFeeCurrency()))</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		signatureValues: dynamicAndDenominatedTxSigValues,</span>
<span class="term-fg32">+		sender:          dynamicAndDenominatedTxSender,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; txFuncs serves as a container to hold custom signing functionality for a transaction.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; TODO consider changing this to an interface, it might make things easier</span>
<span class="term-fg32">+&#47;&#47; because then I could store custom bits of data relevant to each tx type &#47;</span>
<span class="term-fg32">+&#47;&#47; signer such as the signerChainMul. It would also solve the problem of having</span>
<span class="term-fg32">+&#47;&#47; to pass the hash function into the sender function.</span>
<span class="term-fg32">+type txFuncs struct {</span>
<span class="term-fg32">+	hash            func(tx *Transaction, chainID *big.Int) common.Hash</span>
<span class="term-fg32">+	signatureValues func(tx *Transaction, sig []byte, signerChainID *big.Int) (r *big.Int, s *big.Int, v *big.Int, err error)</span>
<span class="term-fg32">+	sender          func(tx *Transaction, hashFunc func(tx *Transaction, chainID *big.Int) common.Hash, signerChainID *big.Int) (common.Address, error)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Returns the signature values for CeloDynamicFeeTxV2 and CeloDenominatedTx</span>
<span class="term-fg32">+&#47;&#47; transactions.</span>
<span class="term-fg32">+func dynamicAndDenominatedTxSigValues(tx *Transaction, sig []byte, signerChainID *big.Int) (r *big.Int, s *big.Int, v *big.Int, err error) {</span>
<span class="term-fg32">+	&#47;&#47; Check that chain ID of tx matches the signer. We also accept ID zero here,</span>
<span class="term-fg32">+	&#47;&#47; because it indicates that the chain ID was not specified in the tx.</span>
<span class="term-fg32">+	chainID := tx.inner.chainID()</span>
<span class="term-fg32">+	if chainID.Sign() != 0 &amp;&amp; chainID.Cmp(signerChainID) != 0 {</span>
<span class="term-fg32">+		return nil, nil, nil, ErrInvalidChainId</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	r, s, _ = decodeSignature(sig)</span>
<span class="term-fg32">+	v = big.NewInt(int64(sig[64]))</span>
<span class="term-fg32">+	return r, s, v, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Returns the sender for CeloDynamicFeeTxV2 and CeloDenominatedTx</span>
<span class="term-fg32">+&#47;&#47; transactions.</span>
<span class="term-fg32">+func dynamicAndDenominatedTxSender(tx *Transaction, hashFunc func(tx *Transaction, chainID *big.Int) common.Hash, signerChainID *big.Int) (common.Address, error) {</span>
<span class="term-fg32">+	if tx.ChainId().Cmp(signerChainID) != 0 {</span>
<span class="term-fg32">+		return common.Address{}, ErrInvalidChainId</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	V, R, S := tx.RawSignatureValues()</span>
<span class="term-fg32">+	&#47;&#47; DynamicFee txs are defined to use 0 and 1 as their recovery</span>
<span class="term-fg32">+	&#47;&#47; id, add 27 to become equivalent to unprotected Homestead signatures.</span>
<span class="term-fg32">+	V = new(big.Int).Add(V, big.NewInt(27))</span>
<span class="term-fg32">+	return recoverPlain(hashFunc(tx, signerChainID), R, S, V, true)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Extracts the common signing fields for CeloLegacy and CeloDynamicFeeTx</span>
<span class="term-fg32">+&#47;&#47; transactions.</span>
<span class="term-fg32">+func baseCeloLegacyTxSigningFields(tx *Transaction) []interface{} {</span>
<span class="term-fg32">+	return []interface{}{</span>
<span class="term-fg32">+		tx.Nonce(),</span>
<span class="term-fg32">+		tx.GasPrice(),</span>
<span class="term-fg32">+		tx.Gas(),</span>
<span class="term-fg32">+		tx.FeeCurrency(),</span>
<span class="term-fg32">+		tx.GatewayFeeRecipient(),</span>
<span class="term-fg32">+		tx.GatewayFee(),</span>
<span class="term-fg32">+		tx.To(),</span>
<span class="term-fg32">+		tx.Value(),</span>
<span class="term-fg32">+		tx.Data(),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Extracts the common signing fields for CeloDynamicFeeTxV2 and</span>
<span class="term-fg32">+&#47;&#47; CeloDenominatedTx transactions.</span>
<span class="term-fg32">+func baseDynomicatedTxSigningFields(tx *Transaction, chainID *big.Int) []interface{} {</span>
<span class="term-fg32">+	return []interface{}{</span>
<span class="term-fg32">+		chainID,</span>
<span class="term-fg32">+		tx.Nonce(),</span>
<span class="term-fg32">+		tx.GasTipCap(),</span>
<span class="term-fg32">+		tx.GasFeeCap(),</span>
<span class="term-fg32">+		tx.Gas(),</span>
<span class="term-fg32">+		tx.To(),</span>
<span class="term-fg32">+		tx.Value(),</span>
<span class="term-fg32">+		tx.Data(),</span>
<span class="term-fg32">+		tx.AccessList(),</span>
<span class="term-fg32">+		tx.FeeCurrency(),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-982338f3ed079825800f64e5" role="button"
                       aria-expanded="false" aria-controls="id-982338f3ed079825800f64e5">
                        <code>core/types/celo_tx_legacy.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/celo_tx_legacy.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+162</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-982338f3ed079825800f64e5"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;celo_tx_legacy.go CELO&#47;core&#47;types&#47;celo_tx_legacy.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..8de6127523b2abe7f355f636aae65afbc63d21ec</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;celo_tx_legacy.go</span>
<span class="term-fg36">@@ -0,0 +1,162 @@</span>
<span class="term-fg32">+&#47;&#47; Copyright 2024 The Celo Authors</span>
<span class="term-fg32">+&#47;&#47; This file is part of the celo library.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is free software: you can redistribute it and&#47;or modify</span>
<span class="term-fg32">+&#47;&#47; it under the terms of the GNU Lesser General Public License as published by</span>
<span class="term-fg32">+&#47;&#47; the Free Software Foundation, either version 3 of the License, or</span>
<span class="term-fg32">+&#47;&#47; (at your option) any later version.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; The celo library is distributed in the hope that it will be useful,</span>
<span class="term-fg32">+&#47;&#47; but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
<span class="term-fg32">+&#47;&#47; MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the</span>
<span class="term-fg32">+&#47;&#47; GNU Lesser General Public License for more details.</span>
<span class="term-fg32">+&#47;&#47;</span>
<span class="term-fg32">+&#47;&#47; You should have received a copy of the GNU Lesser General Public License</span>
<span class="term-fg32">+&#47;&#47; along with the celo library. If not, see &lt;http:&#47;&#47;www.gnu.org&#47;licenses&#47;&gt;.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+package types</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;io&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var ethCompatibleTxNumFields = 9</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; ethCompatibleTxRlpList is used for RLP encoding&#47;decoding of eth-compatible transactions.</span>
<span class="term-fg32">+&#47;&#47; As such, it:</span>
<span class="term-fg32">+&#47;&#47; (a) excludes the Celo-only fields,</span>
<span class="term-fg32">+&#47;&#47; (b) doesn&#39;t need the Hash or EthCompatible fields, and</span>
<span class="term-fg32">+&#47;&#47; (c) doesn&#39;t need the `json` or `gencodec` tags</span>
<span class="term-fg32">+type ethCompatibleTxRlpList struct {</span>
<span class="term-fg32">+	Nonce    uint64          &#47;&#47; nonce of sender account</span>
<span class="term-fg32">+	GasPrice *big.Int        &#47;&#47; wei per gas</span>
<span class="term-fg32">+	Gas      uint64          &#47;&#47; gas limit</span>
<span class="term-fg32">+	To       *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means contract creation</span>
<span class="term-fg32">+	Value    *big.Int        &#47;&#47; wei amount</span>
<span class="term-fg32">+	Data     []byte          &#47;&#47; contract invocation input data</span>
<span class="term-fg32">+	V, R, S  *big.Int        &#47;&#47; signature values</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; celoTxRlpList is used for RLP encoding&#47;decoding of celo transactions.</span>
<span class="term-fg32">+type celoTxRlpList struct {</span>
<span class="term-fg32">+	Nonce               uint64          &#47;&#47; nonce of sender account</span>
<span class="term-fg32">+	GasPrice            *big.Int        &#47;&#47; wei per gas</span>
<span class="term-fg32">+	Gas                 uint64          &#47;&#47; gas limit</span>
<span class="term-fg32">+	FeeCurrency         *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means native currency</span>
<span class="term-fg32">+	GatewayFeeRecipient *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means no gateway fee is paid</span>
<span class="term-fg32">+	GatewayFee          *big.Int        `rlp:&quot;nil&quot;`</span>
<span class="term-fg32">+	To                  *common.Address `rlp:&quot;nil&quot;` &#47;&#47; nil means contract creation</span>
<span class="term-fg32">+	Value               *big.Int        &#47;&#47; wei amount</span>
<span class="term-fg32">+	Data                []byte          &#47;&#47; contract invocation input data</span>
<span class="term-fg32">+	V, R, S             *big.Int        &#47;&#47; signature values</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func toEthCompatibleRlpList(tx LegacyTx) ethCompatibleTxRlpList {</span>
<span class="term-fg32">+	return ethCompatibleTxRlpList{</span>
<span class="term-fg32">+		Nonce:    tx.Nonce,</span>
<span class="term-fg32">+		GasPrice: tx.GasPrice,</span>
<span class="term-fg32">+		Gas:      tx.Gas,</span>
<span class="term-fg32">+		To:       tx.To,</span>
<span class="term-fg32">+		Value:    tx.Value,</span>
<span class="term-fg32">+		Data:     tx.Data,</span>
<span class="term-fg32">+		V:        tx.V,</span>
<span class="term-fg32">+		R:        tx.R,</span>
<span class="term-fg32">+		S:        tx.S,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func toCeloRlpList(tx LegacyTx) celoTxRlpList {</span>
<span class="term-fg32">+	return celoTxRlpList{</span>
<span class="term-fg32">+		Nonce:    tx.Nonce,</span>
<span class="term-fg32">+		GasPrice: tx.GasPrice,</span>
<span class="term-fg32">+		Gas:      tx.Gas,</span>
<span class="term-fg32">+		To:       tx.To,</span>
<span class="term-fg32">+		Value:    tx.Value,</span>
<span class="term-fg32">+		Data:     tx.Data,</span>
<span class="term-fg32">+		V:        tx.V,</span>
<span class="term-fg32">+		R:        tx.R,</span>
<span class="term-fg32">+		S:        tx.S,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; Celo specific fields</span>
<span class="term-fg32">+		FeeCurrency:         tx.FeeCurrency,</span>
<span class="term-fg32">+		GatewayFeeRecipient: tx.GatewayFeeRecipient,</span>
<span class="term-fg32">+		GatewayFee:          tx.GatewayFee,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func setTxFromEthCompatibleRlpList(tx *LegacyTx, rlplist ethCompatibleTxRlpList) {</span>
<span class="term-fg32">+	tx.Nonce = rlplist.Nonce</span>
<span class="term-fg32">+	tx.GasPrice = rlplist.GasPrice</span>
<span class="term-fg32">+	tx.Gas = rlplist.Gas</span>
<span class="term-fg32">+	tx.To = rlplist.To</span>
<span class="term-fg32">+	tx.Value = rlplist.Value</span>
<span class="term-fg32">+	tx.Data = rlplist.Data</span>
<span class="term-fg32">+	tx.V = rlplist.V</span>
<span class="term-fg32">+	tx.R = rlplist.R</span>
<span class="term-fg32">+	tx.S = rlplist.S</span>
<span class="term-fg32">+	tx.Hash = nil &#47;&#47; txdata.Hash is calculated and saved inside tx.Hash()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific fields</span>
<span class="term-fg32">+	tx.FeeCurrency = nil</span>
<span class="term-fg32">+	tx.GatewayFeeRecipient = nil</span>
<span class="term-fg32">+	tx.GatewayFee = nil</span>
<span class="term-fg32">+	tx.CeloLegacy = false</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func setTxFromCeloRlpList(tx *LegacyTx, rlplist celoTxRlpList) {</span>
<span class="term-fg32">+	tx.Nonce = rlplist.Nonce</span>
<span class="term-fg32">+	tx.GasPrice = rlplist.GasPrice</span>
<span class="term-fg32">+	tx.Gas = rlplist.Gas</span>
<span class="term-fg32">+	tx.To = rlplist.To</span>
<span class="term-fg32">+	tx.Value = rlplist.Value</span>
<span class="term-fg32">+	tx.Data = rlplist.Data</span>
<span class="term-fg32">+	tx.V = rlplist.V</span>
<span class="term-fg32">+	tx.R = rlplist.R</span>
<span class="term-fg32">+	tx.S = rlplist.S</span>
<span class="term-fg32">+	tx.Hash = nil &#47;&#47; txdata.Hash is calculated and saved inside tx.Hash()</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific fields</span>
<span class="term-fg32">+	tx.FeeCurrency = rlplist.FeeCurrency</span>
<span class="term-fg32">+	tx.GatewayFeeRecipient = rlplist.GatewayFeeRecipient</span>
<span class="term-fg32">+	tx.GatewayFee = rlplist.GatewayFee</span>
<span class="term-fg32">+	tx.CeloLegacy = true</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; EncodeRLP implements rlp.Encoder</span>
<span class="term-fg32">+func (tx *LegacyTx) EncodeRLP(w io.Writer) error {</span>
<span class="term-fg32">+	if tx.CeloLegacy {</span>
<span class="term-fg32">+		return rlp.Encode(w, toCeloRlpList(*tx))</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		return rlp.Encode(w, toEthCompatibleRlpList(*tx))</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; DecodeRLP implements rlp.Decoder</span>
<span class="term-fg32">+func (tx *LegacyTx) DecodeRLP(s *rlp.Stream) (err error) {</span>
<span class="term-fg32">+	_, size, _ := s.Kind()</span>
<span class="term-fg32">+	var raw rlp.RawValue</span>
<span class="term-fg32">+	err = s.Decode(&amp;raw)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	headerSize := len(raw) - int(size)</span>
<span class="term-fg32">+	numElems, err := rlp.CountValues(raw[headerSize:])</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if numElems == ethCompatibleTxNumFields {</span>
<span class="term-fg32">+		rlpList := ethCompatibleTxRlpList{}</span>
<span class="term-fg32">+		err = rlp.DecodeBytes(raw, &amp;rlpList)</span>
<span class="term-fg32">+		setTxFromEthCompatibleRlpList(tx, rlpList)</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		var rlpList celoTxRlpList</span>
<span class="term-fg32">+		err = rlp.DecodeBytes(raw, &amp;rlpList)</span>
<span class="term-fg32">+		setTxFromCeloRlpList(tx, rlpList)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return err</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bcadcc3ae5a06c6e0f133bc0" role="button"
                       aria-expanded="false" aria-controls="id-bcadcc3ae5a06c6e0f133bc0">
                        <code>core/types/gen_header_rlp.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/types/gen_header_rlp.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <span class="text-muted">(deleted)</span>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+0</span></div>
                            <div class="text-start"><span class="text-danger">-85</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bcadcc3ae5a06c6e0f133bc0"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;gen_header_rlp.go CELO&#47;core&#47;types&#47;gen_header_rlp.go</span>
<span class="term-fg1">deleted file mode 100644</span>
<span class="term-fg1">index ed6a1a002cdbaab59d8261746fd512fb90888c44..0000000000000000000000000000000000000000</span>
<span class="term-fg1">--- op-geth&#47;core&#47;types&#47;gen_header_rlp.go</span>
<span class="term-fg1">+++ &#47;dev&#47;null</span>
<span class="term-fg36">@@ -1,85 +0,0 @@</span>
<span class="term-fg31">-&#47;&#47; Code generated by rlpgen. DO NOT EDIT.</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-package types</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-import &quot;github.com&#47;ethereum&#47;go-ethereum&#47;rlp&quot;</span>
<span class="term-fg31">-import &quot;io&quot;</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-func (obj *Header) EncodeRLP(_w io.Writer) error {</span>
<span class="term-fg31">-	w := rlp.NewEncoderBuffer(_w)</span>
<span class="term-fg31">-	_tmp0 := w.List()</span>
<span class="term-fg31">-	w.WriteBytes(obj.ParentHash[:])</span>
<span class="term-fg31">-	w.WriteBytes(obj.UncleHash[:])</span>
<span class="term-fg31">-	w.WriteBytes(obj.Coinbase[:])</span>
<span class="term-fg31">-	w.WriteBytes(obj.Root[:])</span>
<span class="term-fg31">-	w.WriteBytes(obj.TxHash[:])</span>
<span class="term-fg31">-	w.WriteBytes(obj.ReceiptHash[:])</span>
<span class="term-fg31">-	w.WriteBytes(obj.Bloom[:])</span>
<span class="term-fg31">-	if obj.Difficulty == nil {</span>
<span class="term-fg31">-		w.Write(rlp.EmptyString)</span>
<span class="term-fg31">-	} else {</span>
<span class="term-fg31">-		if obj.Difficulty.Sign() == -1 {</span>
<span class="term-fg31">-			return rlp.ErrNegativeBigInt</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		w.WriteBigInt(obj.Difficulty)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if obj.Number == nil {</span>
<span class="term-fg31">-		w.Write(rlp.EmptyString)</span>
<span class="term-fg31">-	} else {</span>
<span class="term-fg31">-		if obj.Number.Sign() == -1 {</span>
<span class="term-fg31">-			return rlp.ErrNegativeBigInt</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-		w.WriteBigInt(obj.Number)</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	w.WriteUint64(obj.GasLimit)</span>
<span class="term-fg31">-	w.WriteUint64(obj.GasUsed)</span>
<span class="term-fg31">-	w.WriteUint64(obj.Time)</span>
<span class="term-fg31">-	w.WriteBytes(obj.Extra)</span>
<span class="term-fg31">-	w.WriteBytes(obj.MixDigest[:])</span>
<span class="term-fg31">-	w.WriteBytes(obj.Nonce[:])</span>
<span class="term-fg31">-	_tmp1 := obj.BaseFee != nil</span>
<span class="term-fg31">-	_tmp2 := obj.WithdrawalsHash != nil</span>
<span class="term-fg31">-	_tmp3 := obj.BlobGasUsed != nil</span>
<span class="term-fg31">-	_tmp4 := obj.ExcessBlobGas != nil</span>
<span class="term-fg31">-	_tmp5 := obj.ParentBeaconRoot != nil</span>
<span class="term-fg31">-	if _tmp1 || _tmp2 || _tmp3 || _tmp4 || _tmp5 {</span>
<span class="term-fg31">-		if obj.BaseFee == nil {</span>
<span class="term-fg31">-			w.Write(rlp.EmptyString)</span>
<span class="term-fg31">-		} else {</span>
<span class="term-fg31">-			if obj.BaseFee.Sign() == -1 {</span>
<span class="term-fg31">-				return rlp.ErrNegativeBigInt</span>
<span class="term-fg31">-			}</span>
<span class="term-fg31">-			w.WriteBigInt(obj.BaseFee)</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if _tmp2 || _tmp3 || _tmp4 || _tmp5 {</span>
<span class="term-fg31">-		if obj.WithdrawalsHash == nil {</span>
<span class="term-fg31">-			w.Write([]byte{0x80})</span>
<span class="term-fg31">-		} else {</span>
<span class="term-fg31">-			w.WriteBytes(obj.WithdrawalsHash[:])</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if _tmp3 || _tmp4 || _tmp5 {</span>
<span class="term-fg31">-		if obj.BlobGasUsed == nil {</span>
<span class="term-fg31">-			w.Write([]byte{0x80})</span>
<span class="term-fg31">-		} else {</span>
<span class="term-fg31">-			w.WriteUint64((*obj.BlobGasUsed))</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if _tmp4 || _tmp5 {</span>
<span class="term-fg31">-		if obj.ExcessBlobGas == nil {</span>
<span class="term-fg31">-			w.Write([]byte{0x80})</span>
<span class="term-fg31">-		} else {</span>
<span class="term-fg31">-			w.WriteUint64((*obj.ExcessBlobGas))</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	if _tmp5 {</span>
<span class="term-fg31">-		if obj.ParentBeaconRoot == nil {</span>
<span class="term-fg31">-			w.Write([]byte{0x80})</span>
<span class="term-fg31">-		} else {</span>
<span class="term-fg31">-			w.WriteBytes(obj.ParentBeaconRoot[:])</span>
<span class="term-fg31">-		}</span>
<span class="term-fg31">-	}</span>
<span class="term-fg31">-	w.ListEnd(_tmp0)</span>
<span class="term-fg31">-	return w.Flush()</span>
<span class="term-fg31">-}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-1e8b292cf4ead166ba9c25e3" role="button"
                       aria-expanded="false" aria-controls="id-1e8b292cf4ead166ba9c25e3">
                        <code>core/types/rollup_cost.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/types/rollup_cost.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/types/rollup_cost.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-1e8b292cf4ead166ba9c25e3"><span class="term-fg1">diff --git op-geth&#47;core&#47;types&#47;rollup_cost.go CELO&#47;core&#47;types&#47;rollup_cost.go</span>
<span class="term-fg1">index e0bc26d92f0e6c747787bfdd8b2e632af7ad4a1e..a74ff103edc7e8ef9cdbdd3a85b83a5bdc6883c0 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;types&#47;rollup_cost.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;types&#47;rollup_cost.go</span>
<span class="term-fg36">@@ -124,6 +124,9 @@</span> 	}
 	forBlock := ^uint64(0)
 	var cachedFunc l1CostFunc
 	selectFunc := func(blockTime uint64) l1CostFunc {
<span class="term-fg32">+		if config.IsCel2(blockTime) {</span>
<span class="term-fg32">+			return func(rcd RollupCostData) (fee, gasUsed *big.Int) { return nil, nil }</span>
<span class="term-fg32">+		}</span>
 		if !config.IsOptimismEcotone(blockTime) {
 			return newL1CostFuncBedrock(config, statedb, blockTime)
 		}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7a57b64cb8ee8006519b795f" role="button"
                       aria-expanded="false" aria-controls="id-7a57b64cb8ee8006519b795f">
                        <code>core/vm/celo_errors.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/celo_errors.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7a57b64cb8ee8006519b795f"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;celo_errors.go CELO&#47;core&#47;vm&#47;celo_errors.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..03d230c43358aeb01d00a57a51d863eade9a0e55</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;celo_errors.go</span>
<span class="term-fg36">@@ -0,0 +1,9 @@</span>
<span class="term-fg32">+package vm</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;errors&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	ErrInputLength = errors.New(&quot;invalid input length&quot;)</span>
<span class="term-fg32">+)</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b095698d6ecdbe07a77e9e0e" role="button"
                       aria-expanded="false" aria-controls="id-b095698d6ecdbe07a77e9e0e">
                        <code>core/vm/celo_evm.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/celo_evm.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+30</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b095698d6ecdbe07a77e9e0e"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;celo_evm.go CELO&#47;core&#47;vm&#47;celo_evm.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..93ecb05ceb0756e039319acdd3abcf381d21d8ed</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;celo_evm.go</span>
<span class="term-fg36">@@ -0,0 +1,30 @@</span>
<span class="term-fg32">+package vm</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;accounts&#47;abi&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;holiman&#47;uint256&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Call function from ABI and check revert message after call.</span>
<span class="term-fg32">+&#47;&#47; ABIs can be found at contracts&#47;celo&#47;abigen, e.g. abigen.FeeCurrencyMetaData.GetAbi().</span>
<span class="term-fg32">+&#47;&#47; args are passed through to the EVM function.</span>
<span class="term-fg32">+func (evm *EVM) CallWithABI(contractABI *abi.ABI, funcName string, addr common.Address, gas uint64, args ...interface{}) (leftOverGas uint64, err error) {</span>
<span class="term-fg32">+	caller := AccountRef(common.ZeroAddress)</span>
<span class="term-fg32">+	input, err := contractABI.Pack(funcName, args...)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return 0, fmt.Errorf(&quot;pack %s: %w&quot;, funcName, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	ret, leftOverGas, err := evm.Call(caller, addr, input, gas, new(uint256.Int))</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		revertReason, err2 := abi.UnpackRevert(ret)</span>
<span class="term-fg32">+		if err2 == nil {</span>
<span class="term-fg32">+			return 0, fmt.Errorf(&quot;%s reverted: %s&quot;, funcName, revertReason)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	return leftOverGas, err</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f8c4cbd4017043026db2098e" role="button"
                       aria-expanded="false" aria-controls="id-f8c4cbd4017043026db2098e">
                        <code>core/vm/gas_table_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/core/vm/gas_table_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/core/vm/gas_table_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f8c4cbd4017043026db2098e"><span class="term-fg1">diff --git op-geth&#47;core&#47;vm&#47;gas_table_test.go CELO&#47;core&#47;vm&#47;gas_table_test.go</span>
<span class="term-fg1">index 1ee9d691dfd15382bfd7e6f887be449408156896..196c62b5152a57e1e37845afec55eb55a2d767e3 100644</span>
<span class="term-fg1">--- op-geth&#47;core&#47;vm&#47;gas_table_test.go</span>
<span class="term-fg1">+++ CELO&#47;core&#47;vm&#47;gas_table_test.go</span>
<span class="term-fg36">@@ -123,13 +123,13 @@</span> 	{&quot;0x61C00060006000f0&quot; + &quot;600052&quot; + &quot;60206000F3&quot;, true, 44309, 44309},
 	&#47;&#47; create2(0, 0, 0xc001, 0) without 3860
 	{&quot;0x600061C00160006000f5&quot; + &quot;600052&quot; + &quot;60206000F3&quot;, false, 50471, 50471},
 	&#47;&#47; create2(0, 0, 0xc001, 0) (too large), with 3860
<span class="term-fg31">-	{&quot;0x600061C00160006000f5&quot; + &quot;600052&quot; + &quot;60206000F3&quot;, true, 32012, 100_000},</span>
<span class="term-fg32">+	&#47;&#47;{&quot;0x600061C00160006000f5&quot; + &quot;600052&quot; + &quot;60206000F3&quot;, true, 32012, 100_000},  &#47;&#47; Disabled due to Celo MaxCodeSize change</span>
 	&#47;&#47; create2(0, 0, 0xc000, 0)
 	&#47;&#47; This case is trying to deploy code at (within) the limit
 	{&quot;0x600061C00060006000f5&quot; + &quot;600052&quot; + &quot;60206000F3&quot;, true, 53528, 53528},
 	&#47;&#47; create2(0, 0, 0xc001, 0)
 	&#47;&#47; This case is trying to deploy code exceeding the limit
<span class="term-fg31">-	{&quot;0x600061C00160006000f5&quot; + &quot;600052&quot; + &quot;60206000F3&quot;, true, 32024, 100000},</span>
<span class="term-fg32">+	&#47;&#47;{&quot;0x600061C00160006000f5&quot; + &quot;600052&quot; + &quot;60206000F3&quot;, true, 32024, 100000},  &#47;&#47; Disabled due to Celo MaxCodeSize change</span>
 }
&nbsp;
 func TestCreateGas(t *testing.T) {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-75baa0bdaa400787ac6bb3c7" role="button"
                       aria-expanded="false" aria-controls="id-75baa0bdaa400787ac6bb3c7">
                        <code>eth/backend.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/backend.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+13</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-75baa0bdaa400787ac6bb3c7"><span class="term-fg1">diff --git op-geth&#47;eth&#47;backend.go CELO&#47;eth&#47;backend.go</span>
<span class="term-fg1">index aedbd01634cefd9d8877e94d59f7d451cd2deaf5..80c0e9970bd07b26efe7ff2e7d601edbc9ffc6aa 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;backend.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;backend.go</span>
<span class="term-fg36">@@ -48,6 +48,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;protocols&#47;eth&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;protocols&#47;snap&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;ethdb&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;event&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;celoapi&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;ethapi&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;shutdowncheck&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;log&quot;
<span class="term-fg36">@@ -233,6 +234,9 @@</span> 	if config.OverrideOptimismInterop != nil {
 		overrides.OverrideOptimismInterop = config.OverrideOptimismInterop
 	}
 	overrides.ApplySuperchainUpgrades = config.ApplySuperchainUpgrades
<span class="term-fg32">+	if config.OverrideOptimismCel2 != nil {</span>
<span class="term-fg32">+		overrides.OverrideOptimismCel2 = config.OverrideOptimismCel2</span>
<span class="term-fg32">+	}</span>
 	eth.blockchain, err = core.NewBlockChain(chainDb, cacheConfig, config.Genesis, &amp;overrides, eth.engine, vmConfig, eth.shouldPreserve, &amp;config.TransactionHistory)
 	if err != nil {
 		return nil, err
<span class="term-fg36">@@ -362,7 +366,8 @@</span>
 &#47;&#47; APIs return the collection of RPC services the ethereum package offers.
 &#47;&#47; NOTE, some of these services probably need to be moved to somewhere else.
 func (s *Ethereum) APIs() []rpc.API {
<span class="term-fg31">-	apis := ethapi.GetAPIs(s.APIBackend)</span>
<span class="term-fg32">+	celoBackend := celoapi.NewCeloAPIBackend(s.APIBackend)</span>
<span class="term-fg32">+	apis := ethapi.GetAPIs(celoBackend)</span>
&nbsp;
 	&#47;&#47; Append any APIs exposed explicitly by the consensus engine
 	apis = append(apis, s.engine.APIs(s.BlockChain())...)
<span class="term-fg36">@@ -387,6 +392,13 @@</span> 			Service:   NewDebugAPI(s),
 		}, {
 			Namespace: &quot;net&quot;,
 			Service:   s.netRPCService,
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; CELO specific API backend.</span>
<span class="term-fg32">+		&#47;&#47; For methods in the backend that are already defined (match by name)</span>
<span class="term-fg32">+		&#47;&#47; on the eth namespace, this will overwrite the original procedures.</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			Namespace: &quot;eth&quot;,</span>
<span class="term-fg32">+			Service:   celoapi.NewCeloAPI(s, celoBackend),</span>
 		},
 	}...)
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e5701628f7f704da81b98bec" role="button"
                       aria-expanded="false" aria-controls="id-e5701628f7f704da81b98bec">
                        <code>eth/catalyst/api.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/catalyst/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/catalyst/api.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e5701628f7f704da81b98bec"><span class="term-fg1">diff --git op-geth&#47;eth&#47;catalyst&#47;api.go CELO&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg1">index 18862bad630f2d98536e7ac1cc3059aa996c0029..0ab2e817220f44b025b230d182e3708b3ea533eb 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;catalyst&#47;api.go</span>
<span class="term-fg36">@@ -627,7 +627,7 @@</span> 		api.remoteBlocks.put(block.Hash(), block.Header())
 		log.Warn(&quot;State not available, ignoring new payload&quot;)
 		return engine.PayloadStatusV1{Status: engine.ACCEPTED}, nil
 	}
<span class="term-fg31">-	log.Trace(&quot;Inserting block without sethead&quot;, &quot;hash&quot;, block.Hash(), &quot;number&quot;, block.Number)</span>
<span class="term-fg32">+	log.Trace(&quot;Inserting block without sethead&quot;, &quot;hash&quot;, block.Hash(), &quot;number&quot;, block.Number())</span>
 	if err := api.eth.BlockChain().InsertBlockWithoutSetHead(block); err != nil {
 		log.Warn(&quot;NewPayloadV1: inserting block failed&quot;, &quot;error&quot;, err)
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8ca43a85fa22f01f6a19d342" role="button"
                       aria-expanded="false" aria-controls="id-8ca43a85fa22f01f6a19d342">
                        <code>eth/downloader/queue.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/downloader/queue.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/downloader/queue.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8ca43a85fa22f01f6a19d342"><span class="term-fg1">diff --git op-geth&#47;eth&#47;downloader&#47;queue.go CELO&#47;eth&#47;downloader&#47;queue.go</span>
<span class="term-fg1">index 6ff858d7553e9a749d6bd072669737388ef9ebee..06005d96e6ca61c49bbd8d185ba47e424c678543 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;downloader&#47;queue.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;downloader&#47;queue.go</span>
<span class="term-fg36">@@ -782,7 +782,8 @@</span> 	validate := func(index int, header *types.Header) error {
 		if txListHashes[index] != header.TxHash {
 			return errInvalidBody
 		}
<span class="term-fg31">-		if uncleListHashes[index] != header.UncleHash {</span>
<span class="term-fg32">+		&#47;&#47; Pre gingerbread headers do not have a valid uncle hash.</span>
<span class="term-fg32">+		if !header.IsPreGingerbread() &amp;&amp; uncleListHashes[index] != header.UncleHash {</span>
 			return errInvalidBody
 		}
 		if header.WithdrawalsHash == nil {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ad1ccaf57985d3799ca3ca36" role="button"
                       aria-expanded="false" aria-controls="id-ad1ccaf57985d3799ca3ca36">
                        <code>eth/ethconfig/config.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/ethconfig/config.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/ethconfig/config.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ad1ccaf57985d3799ca3ca36"><span class="term-fg1">diff --git op-geth&#47;eth&#47;ethconfig&#47;config.go CELO&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg1">index fa1bfd4642c07d874e3dc4b7c1d28bb29aee4106..0959ca00a30e8b0e54d88af7b3075b0132116e6c 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;ethconfig&#47;config.go</span>
<span class="term-fg36">@@ -162,6 +162,7 @@</span> 	&#47;&#47; OverrideVerkle (TODO: remove after the fork)
 	OverrideVerkle *uint64 `toml:&quot;,omitempty&quot;`
&nbsp;
 	OverrideOptimismCanyon *uint64 `toml:&quot;,omitempty&quot;`
<span class="term-fg32">+	OverrideOptimismCel2   *uint64 `toml:&quot;,omitempty&quot;`</span>
&nbsp;
 	OverrideOptimismEcotone *uint64 `toml:&quot;,omitempty&quot;`
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-089948967ec19f2aafc6420f" role="button"
                       aria-expanded="false" aria-controls="id-089948967ec19f2aafc6420f">
                        <code>eth/filters/filter.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/filters/filter.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/filters/filter.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-089948967ec19f2aafc6420f"><span class="term-fg1">diff --git op-geth&#47;eth&#47;filters&#47;filter.go CELO&#47;eth&#47;filters&#47;filter.go</span>
<span class="term-fg1">index 83e3284a2b5b8465943d6f2574451f403afcb304..664df4cf0347aee9e9badba404049cced44a7fb3 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;filters&#47;filter.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;filters&#47;filter.go</span>
<span class="term-fg36">@@ -325,7 +325,13 @@</span> 	}
 	for i, log := range logs {
 		&#47;&#47; Copy log not to modify cache elements
 		logcopy := *log
<span class="term-fg31">-		logcopy.TxHash = body.Transactions[logcopy.TxIndex].Hash()</span>
<span class="term-fg32">+		&#47;&#47; Block receipts reference a non existent transaction ocurring after the last transaction.</span>
<span class="term-fg32">+		&#47;&#47; We use the block hash in place of the transaction hash for the block receipt.</span>
<span class="term-fg32">+		if logcopy.TxIndex == uint(len(body.Transactions)) {</span>
<span class="term-fg32">+			logcopy.TxHash = logcopy.BlockHash</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			logcopy.TxHash = body.Transactions[logcopy.TxIndex].Hash()</span>
<span class="term-fg32">+		}</span>
 		logs[i] = &amp;logcopy
 	}
 	return logs, nil</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-91ab50824fb6f8e9a5187c2c" role="button"
                       aria-expanded="false" aria-controls="id-91ab50824fb6f8e9a5187c2c">
                        <code>eth/filters/filter_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/filters/filter_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/filters/filter_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-91ab50824fb6f8e9a5187c2c"><span class="term-fg1">diff --git op-geth&#47;eth&#47;filters&#47;filter_test.go CELO&#47;eth&#47;filters&#47;filter_test.go</span>
<span class="term-fg1">index 659ca5ce197da6511cb03f3b7ac3089c99b18751..6c3ac393119106add0268ed7d69ea3cbec4d51e1 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;filters&#47;filter_test.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;filters&#47;filter_test.go</span>
<span class="term-fg36">@@ -164,8 +164,8 @@</span> 		hash4 = common.BytesToHash([]byte(&quot;topic4&quot;))
 		hash5 = common.BytesToHash([]byte(&quot;topic5&quot;))
&nbsp;
 		gspec = &amp;core.Genesis{
<span class="term-fg31">-			Config: params.TestChainConfig,</span>
<span class="term-fg31">-			Alloc: types.GenesisAlloc{</span>
<span class="term-fg32">+			Config: params.TestChainConfigNoCel2,</span>
<span class="term-fg32">+			Alloc: core.GenesisAlloc{</span>
 				addr:      {Balance: big.NewInt(0).Mul(big.NewInt(100), big.NewInt(params.Ether))},
 				contract:  {Balance: big.NewInt(0), Code: bytecode},
 				contract2: {Balance: big.NewInt(0), Code: bytecode},</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a3c406fd81a729196d03ddf6" role="button"
                       aria-expanded="false" aria-controls="id-a3c406fd81a729196d03ddf6">
                        <code>eth/gasestimator/gasestimator.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/gasestimator/gasestimator.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/gasestimator/gasestimator.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+27</span></div>
                            <div class="text-start"><span class="text-danger">-9</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a3c406fd81a729196d03ddf6"><span class="term-fg1">diff --git op-geth&#47;eth&#47;gasestimator&#47;gasestimator.go CELO&#47;eth&#47;gasestimator&#47;gasestimator.go</span>
<span class="term-fg1">index a6c9d635d8d87d1b5abedf9fb99c32d236ddcb68..06a596bfa4cb82730138c58b1531129d12cdadc1 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;gasestimator&#47;gasestimator.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;gasestimator&#47;gasestimator.go</span>
<span class="term-fg36">@@ -20,10 +20,11 @@</span> import (
 	&quot;context&quot;
 	&quot;errors&quot;
 	&quot;fmt&quot;
<span class="term-fg31">-	&quot;math&quot;</span>
 	&quot;math&#47;big&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;state&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;
<span class="term-fg36">@@ -49,7 +50,7 @@</span>
 &#47;&#47; Estimate returns the lowest possible gas limit that allows the transaction to
 &#47;&#47; run successfully with the provided context options. It returns an error if the
 &#47;&#47; transaction would always revert, or if there are unexpected failures.
<span class="term-fg31">-func Estimate(ctx context.Context, call *core.Message, opts *Options, gasCap uint64) (uint64, []byte, error) {</span>
<span class="term-fg32">+func Estimate(ctx context.Context, call *core.Message, opts *Options, gasCap uint64, exchangeRates common.ExchangeRates, balance *big.Int) (uint64, []byte, error) {</span>
 	&#47;&#47; Binary search the gas limit, as it may need to be higher than the amount used
 	var (
 		lo uint64 &#47;&#47; lowest-known gas limit where tx execution fails
<span class="term-fg36">@@ -71,14 +72,29 @@</span> 		feeCap = common.Big0
 	}
 	&#47;&#47; Recap the highest gas limit with account&#39;s available balance.
 	if feeCap.BitLen() != 0 {
<span class="term-fg31">-		balance := opts.State.GetBalance(call.From).ToBig()</span>
<span class="term-fg31">-</span>
 		available := balance
<span class="term-fg31">-		if call.Value != nil {</span>
<span class="term-fg31">-			if call.Value.Cmp(available) &gt;= 0 {</span>
<span class="term-fg31">-				return 0, nil, core.ErrInsufficientFundsForTransfer</span>
<span class="term-fg32">+		if call.FeeCurrency != nil {</span>
<span class="term-fg32">+			if !call.IsFeeCurrencyDenominated() {</span>
<span class="term-fg32">+				&#47;&#47; CIP-66, prices are given in native token.</span>
<span class="term-fg32">+				&#47;&#47; We need to check the allowance in the converted feeCurrency</span>
<span class="term-fg32">+				var err error</span>
<span class="term-fg32">+				feeCap, err = exchange.ConvertCeloToCurrency(exchangeRates, call.FeeCurrency, feeCap)</span>
<span class="term-fg32">+				if err != nil {</span>
<span class="term-fg32">+					return 0, nil, err</span>
<span class="term-fg32">+				}</span>
 			}
<span class="term-fg31">-			available.Sub(available, call.Value)</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			if call.Value != nil {</span>
<span class="term-fg32">+				if call.Value.Cmp(available) &gt;= 0 {</span>
<span class="term-fg32">+					return 0, nil, core.ErrInsufficientFundsForTransfer</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+				available.Sub(available, call.Value)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; cap the available by the maxFeeInFeeCurrency</span>
<span class="term-fg32">+		if call.MaxFeeInFeeCurrency != nil {</span>
<span class="term-fg32">+			available = math.BigMin(available, call.MaxFeeInFeeCurrency)</span>
 		}
 		allowance := new(big.Int).Div(available, feeCap)
&nbsp;
<span class="term-fg36">@@ -89,7 +105,9 @@</span> 			if transfer == nil {
 				transfer = new(big.Int)
 			}
 			log.Debug(&quot;Gas estimation capped by limited funds&quot;, &quot;original&quot;, hi, &quot;balance&quot;, balance,
<span class="term-fg31">-				&quot;sent&quot;, transfer, &quot;maxFeePerGas&quot;, feeCap, &quot;fundable&quot;, allowance)</span>
<span class="term-fg32">+				&quot;sent&quot;, transfer, &quot;maxFeePerGas&quot;, feeCap, &quot;fundable&quot;, allowance,</span>
<span class="term-fg32">+				&quot;feeCurrency&quot;, call.FeeCurrency, &quot;maxFeeInFeeCurrency&quot;, call.MaxFeeInFeeCurrency,</span>
<span class="term-fg32">+			)</span>
 			hi = allowance.Uint64()
 		}
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4be0f71d25ecf2efeb798cfd" role="button"
                       aria-expanded="false" aria-controls="id-4be0f71d25ecf2efeb798cfd">
                        <code>eth/handler_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/handler_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/handler_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4be0f71d25ecf2efeb798cfd"><span class="term-fg1">diff --git op-geth&#47;eth&#47;handler_test.go CELO&#47;eth&#47;handler_test.go</span>
<span class="term-fg1">index 58353f6b6452f7b2bf2497f64cbd17770bd19672..8c1ba1ef5fc6f90a1676da85ff400a2928322097 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;handler_test.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;handler_test.go</span>
<span class="term-fg36">@@ -109,13 +109,14 @@</span> 	pending := make(map[common.Address][]*txpool.LazyTransaction)
 	for addr, batch := range batches {
 		for _, tx := range batch {
 			pending[addr] = append(pending[addr], &amp;txpool.LazyTransaction{
<span class="term-fg31">-				Hash:      tx.Hash(),</span>
<span class="term-fg31">-				Tx:        tx,</span>
<span class="term-fg31">-				Time:      tx.Time(),</span>
<span class="term-fg31">-				GasFeeCap: uint256.MustFromBig(tx.GasFeeCap()),</span>
<span class="term-fg31">-				GasTipCap: uint256.MustFromBig(tx.GasTipCap()),</span>
<span class="term-fg31">-				Gas:       tx.Gas(),</span>
<span class="term-fg31">-				BlobGas:   tx.BlobGas(),</span>
<span class="term-fg32">+				Hash:        tx.Hash(),</span>
<span class="term-fg32">+				Tx:          tx,</span>
<span class="term-fg32">+				Time:        tx.Time(),</span>
<span class="term-fg32">+				GasFeeCap:   uint256.MustFromBig(tx.GasFeeCap()),</span>
<span class="term-fg32">+				GasTipCap:   uint256.MustFromBig(tx.GasTipCap()),</span>
<span class="term-fg32">+				Gas:         tx.Gas(),</span>
<span class="term-fg32">+				BlobGas:     tx.BlobGas(),</span>
<span class="term-fg32">+				FeeCurrency: tx.FeeCurrency(),</span>
 			})
 		}
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0cbbc08ead876e46202330d4" role="button"
                       aria-expanded="false" aria-controls="id-0cbbc08ead876e46202330d4">
                        <code>eth/state_accessor.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/state_accessor.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/state_accessor.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0cbbc08ead876e46202330d4"><span class="term-fg1">diff --git op-geth&#47;eth&#47;state_accessor.go CELO&#47;eth&#47;state_accessor.go</span>
<span class="term-fg1">index cd7198c64d2923b1643fda29df399830f7d250ab..2857e50d4625557072d12db776d7528c2ee8d0d5 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;state_accessor.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;state_accessor.go</span>
<span class="term-fg36">@@ -239,10 +239,10 @@</span> 	}
 	&#47;&#47; Recompute transactions up to the target index.
 	signer := types.MakeSigner(eth.blockchain.Config(), block.Number(), block.Time())
 	for idx, tx := range block.Transactions() {
<span class="term-fg32">+		context := core.NewEVMBlockContext(block.Header(), eth.blockchain, nil, eth.blockchain.Config(), statedb)</span>
 		&#47;&#47; Assemble the transaction call message and return if the requested offset
<span class="term-fg31">-		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee())</span>
<span class="term-fg32">+		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee(), context.FeeCurrencyContext.ExchangeRates)</span>
 		txContext := core.NewEVMTxContext(msg)
<span class="term-fg31">-		context := core.NewEVMBlockContext(block.Header(), eth.blockchain, nil, eth.blockchain.Config(), statedb)</span>
 		if idx == txIndex {
 			return msg, context, statedb, release, nil
 		}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5ade88efc58ec8d7d22ce5b3" role="button"
                       aria-expanded="false" aria-controls="id-5ade88efc58ec8d7d22ce5b3">
                        <code>eth/tracers/api.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/tracers/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/api.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+7</span></div>
                            <div class="text-start"><span class="text-danger">-7</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5ade88efc58ec8d7d22ce5b3"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;api.go CELO&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg1">index 164626af67f8227d9a57a9bda231684ea32f2163..10528aed6e178f548908e949da7a71cd201f3c30 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;api.go</span>
<span class="term-fg36">@@ -271,7 +271,7 @@</span> 					blockCtx = core.NewEVMBlockContext(task.block.Header(), api.chainContext(ctx), nil, api.backend.ChainConfig(), task.statedb)
 				)
 				&#47;&#47; Trace all the transactions contained within
 				for i, tx := range task.block.Transactions() {
<span class="term-fg31">-					msg, _ := core.TransactionToMessage(tx, signer, task.block.BaseFee())</span>
<span class="term-fg32">+					msg, _ := core.TransactionToMessage(tx, signer, task.block.BaseFee(), blockCtx.FeeCurrencyContext.ExchangeRates)</span>
 					txctx := &amp;Context{
 						BlockHash:   task.block.Hash(),
 						BlockNumber: task.block.Number(),
<span class="term-fg36">@@ -561,7 +561,7 @@</span> 		if err := ctx.Err(); err != nil {
 			return nil, err
 		}
 		var (
<span class="term-fg31">-			msg, _    = core.TransactionToMessage(tx, signer, block.BaseFee())</span>
<span class="term-fg32">+			msg, _    = core.TransactionToMessage(tx, signer, block.BaseFee(), vmctx.FeeCurrencyContext.ExchangeRates)</span>
 			txContext = core.NewEVMTxContext(msg)
 			vmenv     = vm.NewEVM(vmctx, txContext, statedb, chainConfig, vm.Config{})
 		)
<span class="term-fg36">@@ -635,7 +635,7 @@</span> 		results   = make([]*txTraceResult, len(txs))
 	)
 	for i, tx := range txs {
 		&#47;&#47; Generate the next state snapshot fast without tracing
<span class="term-fg31">-		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee())</span>
<span class="term-fg32">+		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee(), blockCtx.FeeCurrencyContext.ExchangeRates)</span>
 		txctx := &amp;Context{
 			BlockHash:   blockHash,
 			BlockNumber: block.Number(),
<span class="term-fg36">@@ -678,7 +678,7 @@</span> 			defer pend.Done()
 			&#47;&#47; Fetch and execute the next transaction trace tasks
 			for task := range jobs {
 				blockCtx := core.NewEVMBlockContext(block.Header(), api.chainContext(ctx), nil, api.backend.ChainConfig(), task.statedb)
<span class="term-fg31">-				msg, _ := core.TransactionToMessage(txs[task.index], signer, block.BaseFee())</span>
<span class="term-fg32">+				msg, _ := core.TransactionToMessage(txs[task.index], signer, block.BaseFee(), blockCtx.FeeCurrencyContext.ExchangeRates)</span>
 				txctx := &amp;Context{
 					BlockHash:   blockHash,
 					BlockNumber: block.Number(),
<span class="term-fg36">@@ -710,7 +710,7 @@</span> 		case jobs &lt;- task:
 		}
&nbsp;
 		&#47;&#47; Generate the next state snapshot fast without tracing
<span class="term-fg31">-		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee())</span>
<span class="term-fg32">+		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee(), blockCtx.FeeCurrencyContext.ExchangeRates)</span>
 		statedb.SetTxContext(tx.Hash(), i)
 		vmenv := vm.NewEVM(blockCtx, core.NewEVMTxContext(msg), statedb, api.backend.ChainConfig(), vm.Config{})
 		if _, err := core.ApplyMessage(vmenv, msg, new(core.GasPool).AddGas(msg.GasLimit)); err != nil {
<span class="term-fg36">@@ -790,7 +790,7 @@</span> 	}
 	for i, tx := range block.Transactions() {
 		&#47;&#47; Prepare the transaction for un-traced execution
 		var (
<span class="term-fg31">-			msg, _    = core.TransactionToMessage(tx, signer, block.BaseFee())</span>
<span class="term-fg32">+			msg, _    = core.TransactionToMessage(tx, signer, block.BaseFee(), vmctx.FeeCurrencyContext.ExchangeRates)</span>
 			txContext = core.NewEVMTxContext(msg)
 			vmConf    vm.Config
 			dump      *os.File
<span class="term-fg36">@@ -966,7 +966,7 @@</span> 		}
 		config.BlockOverrides.Apply(&amp;vmctx)
 	}
 	&#47;&#47; Execute the trace
<span class="term-fg31">-	msg, err := args.ToMessage(api.backend.RPCGasCap(), vmctx.BaseFee)</span>
<span class="term-fg32">+	msg, err := args.ToMessage(api.backend.RPCGasCap(), vmctx.BaseFee, vmctx.FeeCurrencyContext.ExchangeRates)</span>
 	if err != nil {
 		return nil, err
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5e699f972d9e1ad4008518d3" role="button"
                       aria-expanded="false" aria-controls="id-5e699f972d9e1ad4008518d3">
                        <code>eth/tracers/api_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/tracers/api_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/api_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5e699f972d9e1ad4008518d3"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;api_test.go CELO&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg1">index 9c3a423f6f8ff6b4b9f02d55b29cfaaa7e1e12bf..8352d9512282c173e59185b9e824b3899177b3b4 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;api_test.go</span>
<span class="term-fg36">@@ -248,9 +248,9 @@</span> 	}
 	&#47;&#47; Recompute transactions up to the target index.
 	signer := types.MakeSigner(b.chainConfig, block.Number(), block.Time())
 	for idx, tx := range block.Transactions() {
<span class="term-fg31">-		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee())</span>
<span class="term-fg31">-		txContext := core.NewEVMTxContext(msg)</span>
 		context := core.NewEVMBlockContext(block.Header(), b.chain, nil, b.chainConfig, statedb)
<span class="term-fg32">+		msg, _ := core.TransactionToMessage(tx, signer, block.BaseFee(), context.FeeCurrencyContext.ExchangeRates)</span>
<span class="term-fg32">+		txContext := core.NewEVMTxContext(msg)</span>
 		if idx == txIndex {
 			return msg, context, statedb, release, nil
 		}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c5516c5f3b42fef3522a5a3e" role="button"
                       aria-expanded="false" aria-controls="id-c5516c5f3b42fef3522a5a3e">
                        <code>eth/tracers/internal/tracetest/calltrace_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/tracers/internal/tracetest/calltrace_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/internal/tracetest/calltrace_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c5516c5f3b42fef3522a5a3e"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;calltrace_test.go CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;calltrace_test.go</span>
<span class="term-fg1">index 6216a16ced9c15360961c15a123add09371f46cc..e3950e5d97aebad94daa27f48971db38a8b53ce9 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;calltrace_test.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;calltrace_test.go</span>
<span class="term-fg36">@@ -141,7 +141,7 @@</span> 			tracer, err := tracers.DefaultDirectory.New(tracerName, new(tracers.Context), test.TracerConfig)
 			if err != nil {
 				t.Fatalf(&quot;failed to create call tracer: %v&quot;, err)
 			}
<span class="term-fg31">-			msg, err := core.TransactionToMessage(tx, signer, context.BaseFee)</span>
<span class="term-fg32">+			msg, err := core.TransactionToMessage(tx, signer, context.BaseFee, context.FeeCurrencyContext.ExchangeRates)</span>
 			if err != nil {
 				t.Fatalf(&quot;failed to prepare transaction for tracing: %v&quot;, err)
 			}
<span class="term-fg36">@@ -231,7 +231,7 @@</span> 		Time:        uint64(test.Context.Time),
 		Difficulty:  (*big.Int)(test.Context.Difficulty),
 		GasLimit:    uint64(test.Context.GasLimit),
 	}
<span class="term-fg31">-	msg, err := core.TransactionToMessage(tx, signer, context.BaseFee)</span>
<span class="term-fg32">+	msg, err := core.TransactionToMessage(tx, signer, context.BaseFee, context.FeeCurrencyContext.ExchangeRates)</span>
 	if err != nil {
 		b.Fatalf(&quot;failed to prepare transaction for tracing: %v&quot;, err)
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-a8d5a4a48a6269295c2da246" role="button"
                       aria-expanded="false" aria-controls="id-a8d5a4a48a6269295c2da246">
                        <code>eth/tracers/internal/tracetest/flat_calltrace_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/tracers/internal/tracetest/flat_calltrace_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/internal/tracetest/flat_calltrace_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-a8d5a4a48a6269295c2da246"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;flat_calltrace_test.go CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;flat_calltrace_test.go</span>
<span class="term-fg1">index b4e596ead16f1be145b35aa74d4df387cbf2673d..88b9bd087ba4997a9f64e6ace1b83e4a4b8002fd 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;flat_calltrace_test.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;flat_calltrace_test.go</span>
<span class="term-fg36">@@ -102,7 +102,7 @@</span> 	tracer, err := tracers.DefaultDirectory.New(tracerName, new(tracers.Context), test.TracerConfig)
 	if err != nil {
 		return fmt.Errorf(&quot;failed to create call tracer: %v&quot;, err)
 	}
<span class="term-fg31">-	msg, err := core.TransactionToMessage(tx, signer, context.BaseFee)</span>
<span class="term-fg32">+	msg, err := core.TransactionToMessage(tx, signer, context.BaseFee, context.FeeCurrencyContext.ExchangeRates)</span>
 	if err != nil {
 		return fmt.Errorf(&quot;failed to prepare transaction for tracing: %v&quot;, err)
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-15e2e3b2ee2e0de446f2e444" role="button"
                       aria-expanded="false" aria-controls="id-15e2e3b2ee2e0de446f2e444">
                        <code>eth/tracers/internal/tracetest/prestate_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/tracers/internal/tracetest/prestate_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/internal/tracetest/prestate_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-15e2e3b2ee2e0de446f2e444"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;prestate_test.go CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;prestate_test.go</span>
<span class="term-fg1">index 8a60123dc2c656f9b39d29f55835648c2f3c65aa..a41c02cfb7a339374f7eaa189f98db0e6e87c028 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;prestate_test.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;prestate_test.go</span>
<span class="term-fg36">@@ -111,7 +111,7 @@</span> 			tracer, err := tracers.DefaultDirectory.New(tracerName, new(tracers.Context), test.TracerConfig)
 			if err != nil {
 				t.Fatalf(&quot;failed to create call tracer: %v&quot;, err)
 			}
<span class="term-fg31">-			msg, err := core.TransactionToMessage(tx, signer, context.BaseFee)</span>
<span class="term-fg32">+			msg, err := core.TransactionToMessage(tx, signer, context.BaseFee, context.FeeCurrencyContext.ExchangeRates)</span>
 			if err != nil {
 				t.Fatalf(&quot;failed to prepare transaction for tracing: %v&quot;, err)
 			}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-03280a735e6c492003a8694a" role="button"
                       aria-expanded="false" aria-controls="id-03280a735e6c492003a8694a">
                        <code>eth/tracers/tracers_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/eth/tracers/tracers_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/tracers_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-03280a735e6c492003a8694a"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;tracers_test.go CELO&#47;eth&#47;tracers&#47;tracers_test.go</span>
<span class="term-fg1">index 6ac266e06d614d6c9de2fdbd0697479e1b607915..7930ee026107e878b7d9ac79647bca547d7f2ba3 100644</span>
<span class="term-fg1">--- op-geth&#47;eth&#47;tracers&#47;tracers_test.go</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;tracers_test.go</span>
<span class="term-fg36">@@ -90,7 +90,7 @@</span> 		&#47;&#47;EnableMemory: false,
 		&#47;&#47;EnableReturnData: false,
 	})
 	evm := vm.NewEVM(context, txContext, state.StateDB, params.AllEthashProtocolChanges, vm.Config{Tracer: tracer})
<span class="term-fg31">-	msg, err := core.TransactionToMessage(tx, signer, context.BaseFee)</span>
<span class="term-fg32">+	msg, err := core.TransactionToMessage(tx, signer, context.BaseFee, context.FeeCurrencyContext.ExchangeRates)</span>
 	if err != nil {
 		b.Fatalf(&quot;failed to prepare transaction for tracing: %v&quot;, err)
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-878a210ef64dee23a2bc7bf9" role="button"
                       aria-expanded="false" aria-controls="id-878a210ef64dee23a2bc7bf9">
                        <code>ethclient/ethclient.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/ethclient/ethclient.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/ethclient/ethclient.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+20</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-878a210ef64dee23a2bc7bf9"><span class="term-fg1">diff --git op-geth&#47;ethclient&#47;ethclient.go CELO&#47;ethclient&#47;ethclient.go</span>
<span class="term-fg1">index 5c3cb79dd65c80d220a2b3c4ff1d5e1a00f10cda..fbecb364c0eb981db5fa0b234128bd3db2ba88f4 100644</span>
<span class="term-fg1">--- op-geth&#47;ethclient&#47;ethclient.go</span>
<span class="term-fg1">+++ CELO&#47;ethclient&#47;ethclient.go</span>
<span class="term-fg36">@@ -557,11 +557,31 @@</span> 	}
 	return (*big.Int)(&amp;hex), nil
 }
&nbsp;
<span class="term-fg32">+&#47;&#47; SuggestGasPriceForCurrency retrieves the currently suggested gas price to allow a timely</span>
<span class="term-fg32">+&#47;&#47; execution of a transaction in the given fee currency.</span>
<span class="term-fg32">+func (ec *Client) SuggestGasPriceForCurrency(ctx context.Context, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	var hex hexutil.Big</span>
<span class="term-fg32">+	if err := ec.c.CallContext(ctx, &amp;hex, &quot;eth_gasPrice&quot;, feeCurrency); err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return (*big.Int)(&amp;hex), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 &#47;&#47; SuggestGasTipCap retrieves the currently suggested gas tip cap after 1559 to
 &#47;&#47; allow a timely execution of a transaction.
 func (ec *Client) SuggestGasTipCap(ctx context.Context) (*big.Int, error) {
 	var hex hexutil.Big
 	if err := ec.c.CallContext(ctx, &amp;hex, &quot;eth_maxPriorityFeePerGas&quot;); err != nil {
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return (*big.Int)(&amp;hex), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; SuggestGasTipCapForCurrency retrieves the currently suggested gas tip cap after 1559 to</span>
<span class="term-fg32">+&#47;&#47; allow a timely execution of a transaction in the given fee currency.</span>
<span class="term-fg32">+func (ec *Client) SuggestGasTipCapForCurrency(ctx context.Context, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	var hex hexutil.Big</span>
<span class="term-fg32">+	if err := ec.c.CallContext(ctx, &amp;hex, &quot;eth_maxPriorityFeePerGas&quot;, feeCurrency); err != nil {</span>
 		return nil, err
 	}
 	return (*big.Int)(&amp;hex), nil</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f21fc570280b1767f74e5471" role="button"
                       aria-expanded="false" aria-controls="id-f21fc570280b1767f74e5471">
                        <code>graphql/graphql.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/graphql/graphql.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/graphql/graphql.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f21fc570280b1767f74e5471"><span class="term-fg1">diff --git op-geth&#47;graphql&#47;graphql.go CELO&#47;graphql&#47;graphql.go</span>
<span class="term-fg1">index c2807131d8bf83dd182ffefb63d05d8ea73a9593..e3802901196775edf81bddea24d406024b6429c6 100644</span>
<span class="term-fg1">--- op-geth&#47;graphql&#47;graphql.go</span>
<span class="term-fg1">+++ CELO&#47;graphql&#47;graphql.go</span>
<span class="term-fg36">@@ -1282,7 +1282,7 @@</span> }
&nbsp;
 &#47;&#47; Resolver is the top-level object in the GraphQL hierarchy.
 type Resolver struct {
<span class="term-fg31">-	backend      ethapi.Backend</span>
<span class="term-fg32">+	backend      ethapi.CeloBackend</span>
 	filterSystem *filters.FilterSystem
 }
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9624f81158c11483b252b54e" role="button"
                       aria-expanded="false" aria-controls="id-9624f81158c11483b252b54e">
                        <code>graphql/graphql_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/graphql/graphql_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/graphql/graphql_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9624f81158c11483b252b54e"><span class="term-fg1">diff --git op-geth&#47;graphql&#47;graphql_test.go CELO&#47;graphql&#47;graphql_test.go</span>
<span class="term-fg1">index 1dda102058229ce52cc81346ffb7e7ea13687071..d6bf4b49a9141818bdf212c19a97476d4ac8a94f 100644</span>
<span class="term-fg1">--- op-geth&#47;graphql&#47;graphql_test.go</span>
<span class="term-fg1">+++ CELO&#47;graphql&#47;graphql_test.go</span>
<span class="term-fg36">@@ -38,6 +38,7 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;ethconfig&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;filters&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;celoapi&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;node&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
&nbsp;
<span class="term-fg36">@@ -477,7 +478,8 @@</span> 		t.Fatalf(&quot;could not create import blocks: %v&quot;, err)
 	}
 	&#47;&#47; Set up handler
 	filterSystem := filters.NewFilterSystem(ethBackend.APIBackend, filters.Config{})
<span class="term-fg31">-	handler, err := newHandler(stack, ethBackend.APIBackend, filterSystem, []string{}, []string{})</span>
<span class="term-fg32">+	celoBackend := celoapi.NewCeloAPIBackend(ethBackend.APIBackend)</span>
<span class="term-fg32">+	handler, err := newHandler(stack, celoBackend, filterSystem, []string{}, []string{})</span>
 	if err != nil {
 		t.Fatalf(&quot;could not create graphql service: %v&quot;, err)
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-f0312eaed3e1bb0d662b0739" role="button"
                       aria-expanded="false" aria-controls="id-f0312eaed3e1bb0d662b0739">
                        <code>graphql/service.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/graphql/service.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/graphql/service.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+4</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-f0312eaed3e1bb0d662b0739"><span class="term-fg1">diff --git op-geth&#47;graphql&#47;service.go CELO&#47;graphql&#47;service.go</span>
<span class="term-fg1">index 584165bdb802e06c09a7994e8349be4b5c8f70f5..43271537e1d05c5c01a144be86886f4bfeaf1341 100644</span>
<span class="term-fg1">--- op-geth&#47;graphql&#47;service.go</span>
<span class="term-fg1">+++ CELO&#47;graphql&#47;service.go</span>
<span class="term-fg36">@@ -25,6 +25,7 @@</span> 	&quot;sync&quot;
 	&quot;time&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;eth&#47;filters&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;celoapi&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;ethapi&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;node&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
<span class="term-fg36">@@ -107,13 +108,14 @@</span> }
&nbsp;
 &#47;&#47; New constructs a new GraphQL service instance.
 func New(stack *node.Node, backend ethapi.Backend, filterSystem *filters.FilterSystem, cors, vhosts []string) error {
<span class="term-fg31">-	_, err := newHandler(stack, backend, filterSystem, cors, vhosts)</span>
<span class="term-fg32">+	celoBackend := celoapi.NewCeloAPIBackend(backend)</span>
<span class="term-fg32">+	_, err := newHandler(stack, celoBackend, filterSystem, cors, vhosts)</span>
 	return err
 }
&nbsp;
 &#47;&#47; newHandler returns a new `http.Handler` that will answer GraphQL queries.
 &#47;&#47; It additionally exports an interactive query browser on the &#47; endpoint.
<span class="term-fg31">-func newHandler(stack *node.Node, backend ethapi.Backend, filterSystem *filters.FilterSystem, cors, vhosts []string) (*handler, error) {</span>
<span class="term-fg32">+func newHandler(stack *node.Node, backend ethapi.CeloBackend, filterSystem *filters.FilterSystem, cors, vhosts []string) (*handler, error) {</span>
 	q := Resolver{backend, filterSystem}
&nbsp;
 	s, err := graphql.ParseSchema(schema, &amp;q)</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-c2a4809cc1e9c43145038dd4" role="button"
                       aria-expanded="false" aria-controls="id-c2a4809cc1e9c43145038dd4">
                        <code>internal/celoapi/api.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/celoapi/api.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+97</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-c2a4809cc1e9c43145038dd4"><span class="term-fg1">diff --git op-geth&#47;internal&#47;celoapi&#47;api.go CELO&#47;internal&#47;celoapi&#47;api.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..73279b98bfc37e3eae12b544a8f8599476f0a918</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;celoapi&#47;api.go</span>
<span class="term-fg36">@@ -0,0 +1,97 @@</span>
<span class="term-fg32">+package celoapi</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;context&quot;</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;ethapi&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type Ethereum interface {</span>
<span class="term-fg32">+	BlockChain() *core.BlockChain</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type CeloAPI struct {</span>
<span class="term-fg32">+	ethAPI *ethapi.EthereumAPI</span>
<span class="term-fg32">+	eth    Ethereum</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func NewCeloAPI(e Ethereum, b ethapi.CeloBackend) *CeloAPI {</span>
<span class="term-fg32">+	return &amp;CeloAPI{</span>
<span class="term-fg32">+		ethAPI: ethapi.NewEthereumAPI(b),</span>
<span class="term-fg32">+		eth:    e,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *CeloAPI) convertedCurrencyValue(v *hexutil.Big, feeCurrency *common.Address) (*hexutil.Big, error) {</span>
<span class="term-fg32">+	if feeCurrency != nil {</span>
<span class="term-fg32">+		convertedTipCap, err := c.convertCeloToCurrency(v.ToInt(), feeCurrency)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, fmt.Errorf(&quot;convert to feeCurrency: %w&quot;, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		v = (*hexutil.Big)(convertedTipCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return v, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *CeloAPI) celoBackendCurrentState() (*contracts.CeloBackend, error) {</span>
<span class="term-fg32">+	state, err := c.eth.BlockChain().State()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;retrieve HEAD blockchain state&#39;: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	cb := &amp;contracts.CeloBackend{</span>
<span class="term-fg32">+		ChainConfig: c.eth.BlockChain().Config(),</span>
<span class="term-fg32">+		State:       state,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return cb, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *CeloAPI) convertCeloToCurrency(nativePrice *big.Int, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	cb, err := c.celoBackendCurrentState()</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	er, err := contracts.GetExchangeRates(cb)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;retrieve exchange rates from current state: %w&quot;, err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return exchange.ConvertCeloToCurrency(er, feeCurrency, nativePrice)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GasPrice wraps the original JSON RPC `eth_gasPrice` and adds an additional</span>
<span class="term-fg32">+&#47;&#47; optional parameter `feeCurrency` for fee-currency conversion.</span>
<span class="term-fg32">+&#47;&#47; When `feeCurrency` is not given, then the original JSON RPC method is called without conversion.</span>
<span class="term-fg32">+func (c *CeloAPI) GasPrice(ctx context.Context, feeCurrency *common.Address) (*hexutil.Big, error) {</span>
<span class="term-fg32">+	tipcap, err := c.ethAPI.GasPrice(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Between the call to `ethapi.GasPrice` and the call to fetch and convert the rates,</span>
<span class="term-fg32">+	&#47;&#47; there is a chance of a state-change. This means that gas-price suggestion is calculated</span>
<span class="term-fg32">+	&#47;&#47; based on state of block x, while the currency conversion could be calculated based on block</span>
<span class="term-fg32">+	&#47;&#47; x+1.</span>
<span class="term-fg32">+	&#47;&#47; However, a similar race condition is present in the `ethapi.GasPrice` method itself.</span>
<span class="term-fg32">+	return c.convertedCurrencyValue(tipcap, feeCurrency)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; MaxPriorityFeePerGas wraps the original JSON RPC `eth_maxPriorityFeePerGas` and adds an additional</span>
<span class="term-fg32">+&#47;&#47; optional parameter `feeCurrency` for fee-currency conversion.</span>
<span class="term-fg32">+&#47;&#47; When `feeCurrency` is not given, then the original JSON RPC method is called without conversion.</span>
<span class="term-fg32">+func (c *CeloAPI) MaxPriorityFeePerGas(ctx context.Context, feeCurrency *common.Address) (*hexutil.Big, error) {</span>
<span class="term-fg32">+	tipcap, err := c.ethAPI.MaxPriorityFeePerGas(ctx)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Between the call to `ethapi.MaxPriorityFeePerGas` and the call to fetch and convert the rates,</span>
<span class="term-fg32">+	&#47;&#47; there is a chance of a state-change. This means that gas-price suggestion is calculated</span>
<span class="term-fg32">+	&#47;&#47; based on state of block x, while the currency conversion could be calculated based on block</span>
<span class="term-fg32">+	&#47;&#47; x+1.</span>
<span class="term-fg32">+	return c.convertedCurrencyValue(tipcap, feeCurrency)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3cf7c72e8260359b54c43136" role="button"
                       aria-expanded="false" aria-controls="id-3cf7c72e8260359b54c43136">
                        <code>internal/celoapi/backend.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/celoapi/backend.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+77</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3cf7c72e8260359b54c43136"><span class="term-fg1">diff --git op-geth&#47;internal&#47;celoapi&#47;backend.go CELO&#47;internal&#47;celoapi&#47;backend.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..327ddd5b703971c998c12888561cd37958001efc</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;celoapi&#47;backend.go</span>
<span class="term-fg36">@@ -0,0 +1,77 @@</span>
<span class="term-fg32">+package celoapi</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;context&quot;</span>
<span class="term-fg32">+	&quot;fmt&quot;</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;contracts&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;internal&#47;ethapi&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func NewCeloAPIBackend(b ethapi.Backend) *CeloAPIBackend {</span>
<span class="term-fg32">+	return &amp;CeloAPIBackend{</span>
<span class="term-fg32">+		Backend: b,</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; CeloAPIBackend is a wrapper for the ethapi.Backend, that provides additional Celo specific</span>
<span class="term-fg32">+&#47;&#47; functionality. CeloAPIBackend is mainly passed to the JSON RPC services and provides</span>
<span class="term-fg32">+&#47;&#47; an easy way to make extra functionality available in the service internal methods without</span>
<span class="term-fg32">+&#47;&#47; having to change their call signature significantly.</span>
<span class="term-fg32">+type CeloAPIBackend struct {</span>
<span class="term-fg32">+	ethapi.Backend</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *CeloAPIBackend) getContractCaller(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash) (*contracts.CeloBackend, error) {</span>
<span class="term-fg32">+	state, _, err := b.Backend.StateAndHeaderByNumberOrHash(</span>
<span class="term-fg32">+		ctx,</span>
<span class="term-fg32">+		blockNumOrHash,</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, fmt.Errorf(&quot;retrieve state for block hash %s: %w&quot;, blockNumOrHash.String(), err)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return &amp;contracts.CeloBackend{</span>
<span class="term-fg32">+		ChainConfig: b.Backend.ChainConfig(),</span>
<span class="term-fg32">+		State:       state,</span>
<span class="term-fg32">+	}, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *CeloAPIBackend) GetFeeBalance(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, account common.Address, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	cb, err := b.getContractCaller(ctx, blockNumOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return contracts.GetFeeBalance(cb, account, feeCurrency), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *CeloAPIBackend) GetExchangeRates(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash) (common.ExchangeRates, error) {</span>
<span class="term-fg32">+	contractBackend, err := b.getContractCaller(ctx, blockNumOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	er, err := contracts.GetExchangeRates(contractBackend)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return er, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *CeloAPIBackend) ConvertToCurrency(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, celoAmount *big.Int, toFeeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	er, err := b.GetExchangeRates(ctx, blockNumOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return exchange.ConvertCeloToCurrency(er, toFeeCurrency, celoAmount)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (b *CeloAPIBackend) ConvertToCelo(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, currencyAmount *big.Int, fromFeeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	er, err := b.GetExchangeRates(ctx, blockNumOrHash)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return exchange.ConvertCurrencyToCelo(er, currencyAmount, fromFeeCurrency)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-4af08b132912268e83d11df8" role="button"
                       aria-expanded="false" aria-controls="id-4af08b132912268e83d11df8">
                        <code>internal/ethapi/api.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/api.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/api.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+117</span></div>
                            <div class="text-start"><span class="text-danger">-30</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4af08b132912268e83d11df8"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;api.go CELO&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg1">index a0b64c86e3bdc5b65d47ddd23ea1dc0365dfe6b7..22aa997e83e01569444abdf01fe3815cfef2e7cc 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;api.go</span>
<span class="term-fg36">@@ -57,6 +57,7 @@</span> &#47;&#47; allowed to produce in order to speed up calculations.
 const estimateGasErrorRatio = 0.015
&nbsp;
 var errBlobTxNotSupported = errors.New(&quot;signing blob transactions not supported&quot;)
<span class="term-fg32">+var emptyExchangeRates = make(common.ExchangeRates)</span>
&nbsp;
 &#47;&#47; EthereumAPI provides an API to access Ethereum related information.
 type EthereumAPI struct {
<span class="term-fg36">@@ -286,11 +287,11 @@</span> &#47;&#47; passwords and are therefore considered private by default.
 type PersonalAccountAPI struct {
 	am        *accounts.Manager
 	nonceLock *AddrLocker
<span class="term-fg31">-	b         Backend</span>
<span class="term-fg32">+	b         CeloBackend</span>
 }
&nbsp;
 &#47;&#47; NewPersonalAccountAPI creates a new PersonalAccountAPI.
<span class="term-fg31">-func NewPersonalAccountAPI(b Backend, nonceLock *AddrLocker) *PersonalAccountAPI {</span>
<span class="term-fg32">+func NewPersonalAccountAPI(b CeloBackend, nonceLock *AddrLocker) *PersonalAccountAPI {</span>
 	return &amp;PersonalAccountAPI{
 		am:        b.AccountManager(),
 		nonceLock: nonceLock,
<span class="term-fg36">@@ -620,11 +621,11 @@</span> }
&nbsp;
 &#47;&#47; BlockChainAPI provides an API to access Ethereum blockchain data.
 type BlockChainAPI struct {
<span class="term-fg31">-	b Backend</span>
<span class="term-fg32">+	b CeloBackend</span>
 }
&nbsp;
 &#47;&#47; NewBlockChainAPI creates a new Ethereum blockchain API.
<span class="term-fg31">-func NewBlockChainAPI(b Backend) *BlockChainAPI {</span>
<span class="term-fg32">+func NewBlockChainAPI(b CeloBackend) *BlockChainAPI {</span>
 	return &amp;BlockChainAPI{b}
 }
&nbsp;
<span class="term-fg36">@@ -1014,7 +1015,8 @@</span> 	if err != nil {
 		return nil, err
 	}
 	txs := block.Transactions()
<span class="term-fg31">-	if len(txs) != len(receipts) {</span>
<span class="term-fg32">+	&#47;&#47; Legacy Celo blocks sometimes include an extra block receipt. See https:&#47;&#47;docs.celo.org&#47;developer&#47;migrate&#47;from-ethereum#core-contract-calls</span>
<span class="term-fg32">+	if len(txs) != len(receipts) &amp;&amp; len(txs)+1 != len(receipts) {</span>
 		return nil, fmt.Errorf(&quot;receipts length mismatch: %d vs %d&quot;, len(txs), len(receipts))
 	}
&nbsp;
<span class="term-fg36">@@ -1023,9 +1025,12 @@</span> 	signer := types.MakeSigner(s.b.ChainConfig(), block.Number(), block.Time())
&nbsp;
 	result := make([]map[string]interface{}, len(receipts))
 	for i, receipt := range receipts {
<span class="term-fg31">-		result[i] = marshalReceipt(receipt, block.Hash(), block.NumberU64(), signer, txs[i], i, s.b.ChainConfig())</span>
<span class="term-fg32">+		if i == len(txs) {</span>
<span class="term-fg32">+			result[i] = marshalBlockReceipt(receipt, block.Hash(), block.NumberU64(), i)</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			result[i] = marshalReceipt(receipt, block.Hash(), block.NumberU64(), signer, txs[i], i, s.b.ChainConfig())</span>
<span class="term-fg32">+		}</span>
 	}
<span class="term-fg31">-</span>
 	return result, nil
 }
&nbsp;
<span class="term-fg36">@@ -1182,7 +1187,7 @@</span> 	blockCtx := core.NewEVMBlockContext(header, NewChainContext(ctx, b), nil, b.ChainConfig(), state)
 	if blockOverrides != nil {
 		blockOverrides.Apply(&amp;blockCtx)
 	}
<span class="term-fg31">-	msg, err := args.ToMessage(globalGasCap, blockCtx.BaseFee)</span>
<span class="term-fg32">+	msg, err := args.ToMessage(globalGasCap, blockCtx.BaseFee, blockCtx.FeeCurrencyContext.ExchangeRates)</span>
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg36">@@ -1212,7 +1217,7 @@</span> 	}
 	return result, nil
 }
&nbsp;
<span class="term-fg31">-func DoCall(ctx context.Context, b Backend, args TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, overrides *StateOverride, blockOverrides *BlockOverrides, timeout time.Duration, globalGasCap uint64) (*core.ExecutionResult, error) {</span>
<span class="term-fg32">+func DoCall(ctx context.Context, b CeloBackend, args TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, overrides *StateOverride, blockOverrides *BlockOverrides, timeout time.Duration, globalGasCap uint64) (*core.ExecutionResult, error) {</span>
 	defer func(start time.Time) { log.Debug(&quot;Executing EVM call finished&quot;, &quot;runtime&quot;, time.Since(start)) }(time.Now())
&nbsp;
 	state, header, err := b.StateAndHeaderByNumberOrHash(ctx, blockNrOrHash)
<span class="term-fg36">@@ -1268,7 +1273,7 @@</span> &#47;&#47; DoEstimateGas returns the lowest possible gas limit that allows the transaction to run
 &#47;&#47; successfully at block `blockNrOrHash`. It returns error if the transaction would revert, or if
 &#47;&#47; there are unexpected failures. The gas limit is capped by both `args.Gas` (if non-nil &amp;
 &#47;&#47; non-zero) and `gasCap` (if non-zero).
<span class="term-fg31">-func DoEstimateGas(ctx context.Context, b Backend, args TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, overrides *StateOverride, gasCap uint64) (hexutil.Uint64, error) {</span>
<span class="term-fg32">+func DoEstimateGas(ctx context.Context, b CeloBackend, args TransactionArgs, blockNrOrHash rpc.BlockNumberOrHash, overrides *StateOverride, gasCap uint64) (hexutil.Uint64, error) {</span>
 	&#47;&#47; Retrieve the base state and mutate it with any overrides
 	state, header, err := b.StateAndHeaderByNumberOrHash(ctx, blockNrOrHash)
 	if state == nil || err != nil {
<span class="term-fg36">@@ -1285,12 +1290,28 @@</span> 		Header:     header,
 		State:      state,
 		ErrorRatio: estimateGasErrorRatio,
 	}
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific: get exchange rates if fee currency is specified</span>
<span class="term-fg32">+	exchangeRates := emptyExchangeRates</span>
<span class="term-fg32">+	if args.FeeCurrency != nil {</span>
<span class="term-fg32">+		&#47;&#47; It is debatable whether we should use the block itself or the parent block here.</span>
<span class="term-fg32">+		&#47;&#47; Usually, user would probably like the recent rates after the block, so we use the block itself.</span>
<span class="term-fg32">+		exchangeRates, err = b.GetExchangeRates(ctx, blockNrOrHash)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return 0, fmt.Errorf(&quot;get exchange rates for block: %v err: %w&quot;, header.Hash(), err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Run the gas estimation andwrap any revertals into a custom return
<span class="term-fg31">-	call, err := args.ToMessage(gasCap, header.BaseFee)</span>
<span class="term-fg32">+	call, err := args.ToMessage(gasCap, header.BaseFee, exchangeRates)</span>
 	if err != nil {
 		return 0, err
 	}
<span class="term-fg31">-	estimate, revert, err := gasestimator.Estimate(ctx, call, opts, gasCap)</span>
<span class="term-fg32">+	&#47;&#47; Celo specific: get balance</span>
<span class="term-fg32">+	balance, err := b.GetFeeBalance(ctx, blockNrOrHash, call.From, args.FeeCurrency)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return 0, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	estimate, revert, err := gasestimator.Estimate(ctx, call, opts, gasCap, exchangeRates, balance)</span>
 	if err != nil {
 		if len(revert) &gt; 0 {
 			return 0, newRevertError(revert)
<span class="term-fg36">@@ -1458,6 +1479,13 @@</span> 	Mint       *hexutil.Big `json:&quot;mint,omitempty&quot;`
 	IsSystemTx *bool        `json:&quot;isSystemTx,omitempty&quot;`
 	&#47;&#47; deposit-tx post-Canyon only
 	DepositReceiptVersion *hexutil.Uint64 `json:&quot;depositReceiptVersion,omitempty&quot;`
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo</span>
<span class="term-fg32">+	FeeCurrency         *common.Address `json:&quot;feeCurrency,omitempty&quot;`</span>
<span class="term-fg32">+	MaxFeeInFeeCurrency *hexutil.Big    `json:&quot;maxFeeInFeeCurrency,omitempty&quot;`</span>
<span class="term-fg32">+	EthCompatible       *bool           `json:&quot;ethCompatible,omitempty&quot;`</span>
<span class="term-fg32">+	GatewayFee          *hexutil.Big    `json:&quot;gatewayFee,omitempty&quot;`</span>
<span class="term-fg32">+	GatewayFeeRecipient *common.Address `json:&quot;gatewayFeeRecipient,omitempty&quot;`</span>
 }
&nbsp;
 &#47;&#47; newRPCTransaction returns a transaction that will serialize to the RPC
<span class="term-fg36">@@ -1479,6 +1507,17 @@</span> 		Value:    (*hexutil.Big)(tx.Value()),
 		V:        (*hexutil.Big)(v),
 		R:        (*hexutil.Big)(r),
 		S:        (*hexutil.Big)(s),
<span class="term-fg32">+		&#47;&#47; Celo</span>
<span class="term-fg32">+		FeeCurrency:         tx.FeeCurrency(),</span>
<span class="term-fg32">+		MaxFeeInFeeCurrency: (*hexutil.Big)(tx.MaxFeeInFeeCurrency()),</span>
<span class="term-fg32">+		&#47;&#47; Unfortunately we need to set the gateway fee since this</span>
<span class="term-fg32">+		&#47;&#47; (0x3f33789ee7c52eacfe8b1a2afab8455aaf65f860dfa36f1afa466eb69bfa312e)</span>
<span class="term-fg32">+		&#47;&#47; tx on alfajores actually set it.</span>
<span class="term-fg32">+		GatewayFee: (*hexutil.Big)(tx.GatewayFee()),</span>
<span class="term-fg32">+		&#47;&#47; Unfortunately we need to set the gateway fee recipient since this</span>
<span class="term-fg32">+		&#47;&#47; (0x7a2624134a8c634b38520dbb61f8fe2013e0817d446224f3d866ce3de92f4e98)</span>
<span class="term-fg32">+		&#47;&#47; tx on alfajores actually set it.</span>
<span class="term-fg32">+		GatewayFeeRecipient: tx.GatewayFeeRecipient(),</span>
 	}
 	if blockHash != (common.Hash{}) {
 		result.BlockHash = &amp;blockHash
<span class="term-fg36">@@ -1513,6 +1552,11 @@</span> 		if id := tx.ChainId(); id.Sign() != 0 {
 			result.ChainID = (*hexutil.Big)(id)
 		}
&nbsp;
<span class="term-fg32">+		if tx.IsCeloLegacy() {</span>
<span class="term-fg32">+			&#47;&#47; If this is a celo legacy transaction then set eth compatible to false</span>
<span class="term-fg32">+			result.EthCompatible = new(bool)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
 	case types.AccessListTxType:
 		al := tx.AccessList()
 		yparity := hexutil.Uint64(v.Sign())
<span class="term-fg36">@@ -1520,7 +1564,7 @@</span> 		result.Accesses = &amp;al
 		result.ChainID = (*hexutil.Big)(tx.ChainId())
 		result.YParity = &amp;yparity
&nbsp;
<span class="term-fg31">-	case types.DynamicFeeTxType:</span>
<span class="term-fg32">+	case types.DynamicFeeTxType, types.CeloDynamicFeeTxType, types.CeloDynamicFeeTxV2Type, types.CeloDenominatedTxType:</span>
 		al := tx.AccessList()
 		yparity := hexutil.Uint64(v.Sign())
 		result.Accesses = &amp;al
<span class="term-fg36">@@ -1528,14 +1572,34 @@</span> 		result.ChainID = (*hexutil.Big)(tx.ChainId())
 		result.YParity = &amp;yparity
 		result.GasFeeCap = (*hexutil.Big)(tx.GasFeeCap())
 		result.GasTipCap = (*hexutil.Big)(tx.GasTipCap())
<span class="term-fg31">-		&#47;&#47; if the transaction has been mined, compute the effective gas price</span>
<span class="term-fg31">-		if baseFee != nil &amp;&amp; blockHash != (common.Hash{}) {</span>
<span class="term-fg31">-			&#47;&#47; price = min(gasTipCap + baseFee, gasFeeCap)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; Note that celo denominated txs always have the gas price denominated in celo (the native currency)</span>
<span class="term-fg32">+		isNativeFeeCurrency := tx.FeeCurrency() == nil || tx.Type() == types.CeloDenominatedTxType</span>
<span class="term-fg32">+		isGingerbread := config.IsGingerbread(new(big.Int).SetUint64(blockNumber))</span>
<span class="term-fg32">+		isCel2 := config.IsCel2(blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		if blockHash == (common.Hash{}) {</span>
<span class="term-fg32">+			&#47;&#47; This is a pending transaction, for pending transactions we set the gas price to gas fee cap.</span>
<span class="term-fg32">+			result.GasPrice = (*hexutil.Big)(tx.GasFeeCap())</span>
<span class="term-fg32">+		} else if isGingerbread &amp;&amp; isNativeFeeCurrency {</span>
<span class="term-fg32">+			&#47;&#47; Post gingerbread mined transaction with a native fee currency, we can compute the effective gas price.</span>
 			result.GasPrice = (*hexutil.Big)(effectiveGasPrice(tx, baseFee))
<span class="term-fg32">+		} else if isCel2 &amp;&amp; tx.Type() == types.CeloDynamicFeeTxV2Type {</span>
<span class="term-fg32">+			&#47;&#47; Mined post Cel2 celoDynamicFeeTxV2 transaction, we can get the gas price from the receipt</span>
<span class="term-fg32">+			&#47;&#47; Assert that we should have a receipt</span>
<span class="term-fg32">+			if receipt == nil {</span>
<span class="term-fg32">+				panic(fmt.Sprintf(&quot;no corresponding receipt provided for celoDynamicFeeTxV2 transaction %s&quot;, tx.Hash().Hex()))</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+			result.GasPrice = (*hexutil.Big)(receipt.EffectiveGasPrice)</span>
 		} else {
<span class="term-fg31">-			result.GasPrice = (*hexutil.Big)(tx.GasFeeCap())</span>
<span class="term-fg32">+			&#47;&#47; Otherwise this is either a:</span>
<span class="term-fg32">+			&#47;&#47; -  pre-gingerbread transaction</span>
<span class="term-fg32">+			&#47;&#47; -  post-gingerbread native fee currency transaction but no base fee was provided</span>
<span class="term-fg32">+			&#47;&#47; -  post-gingerbread pre-cel2 transaction with a non-native fee currency</span>
<span class="term-fg32">+			&#47;&#47;</span>
<span class="term-fg32">+			&#47;&#47; In these cases we can&#39;t calculate the gas price.</span>
<span class="term-fg32">+			result.GasPrice = nil</span>
 		}
<span class="term-fg31">-</span>
 	case types.BlobTxType:
 		al := tx.AccessList()
 		yparity := hexutil.Uint64(v.Sign())
<span class="term-fg36">@@ -1590,12 +1654,12 @@</span> 	if index &gt;= uint64(len(txs)) {
 		return nil
 	}
 	tx := txs[index]
<span class="term-fg31">-	rcpt := depositTxReceipt(ctx, b.Hash(), index, backend, tx)</span>
<span class="term-fg32">+	rcpt := txReceipt(ctx, b.Hash(), index, backend, tx)</span>
 	return newRPCTransaction(tx, b.Hash(), b.NumberU64(), b.Time(), index, b.BaseFee(), config, rcpt)
 }
&nbsp;
<span class="term-fg31">-func depositTxReceipt(ctx context.Context, blockHash common.Hash, index uint64, backend Backend, tx *types.Transaction) *types.Receipt {</span>
<span class="term-fg31">-	if tx.Type() != types.DepositTxType {</span>
<span class="term-fg32">+func txReceipt(ctx context.Context, blockHash common.Hash, index uint64, backend Backend, tx *types.Transaction) *types.Receipt {</span>
<span class="term-fg32">+	if tx.Type() != types.DepositTxType &amp;&amp; tx.Type() != types.CeloDynamicFeeTxV2Type {</span>
 		return nil
 	}
 	receipts, err := backend.GetReceipts(ctx, blockHash)
<span class="term-fg36">@@ -1663,7 +1727,7 @@</span>
 &#47;&#47; AccessList creates an access list for the given transaction.
 &#47;&#47; If the accesslist creation fails an error is returned.
 &#47;&#47; If the transaction itself fails, an vmErr is returned.
<span class="term-fg31">-func AccessList(ctx context.Context, b Backend, blockNrOrHash rpc.BlockNumberOrHash, args TransactionArgs) (acl types.AccessList, gasUsed uint64, vmErr error, err error) {</span>
<span class="term-fg32">+func AccessList(ctx context.Context, b CeloBackend, blockNrOrHash rpc.BlockNumberOrHash, args TransactionArgs) (acl types.AccessList, gasUsed uint64, vmErr error, err error) {</span>
 	&#47;&#47; Retrieve the execution context
 	db, header, err := b.StateAndHeaderByNumberOrHash(ctx, blockNrOrHash)
 	if db == nil || err != nil {
<span class="term-fg36">@@ -1698,7 +1762,19 @@</span> 		&#47;&#47; Copy the original db so we don&#39;t modify it
 		statedb := db.Copy()
 		&#47;&#47; Set the accesslist to the last al
 		args.AccessList = &amp;accessList
<span class="term-fg31">-		msg, err := args.ToMessage(b.RPCGasCap(), header.BaseFee)</span>
<span class="term-fg32">+		baseFee := header.BaseFee</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		exchangeRates := emptyExchangeRates</span>
<span class="term-fg32">+		if args.FeeCurrency != nil {</span>
<span class="term-fg32">+			&#47;&#47; Always use the header&#39;s parent here, since we want to create the list at the</span>
<span class="term-fg32">+			&#47;&#47; queried block, but want to use the exchange rates before (at the beginning of)</span>
<span class="term-fg32">+			&#47;&#47; the queried block</span>
<span class="term-fg32">+			exchangeRates, err = b.GetExchangeRates(ctx, rpc.BlockNumberOrHashWithHash(header.ParentHash, false))</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return nil, 0, nil, fmt.Errorf(&quot;get exchange rates for block: %v err: %w&quot;, header.Hash(), err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		msg, err := args.ToMessage(b.RPCGasCap(), baseFee, exchangeRates)</span>
 		if err != nil {
 			return nil, 0, nil, err
 		}
<span class="term-fg36">@@ -1720,13 +1796,13 @@</span> }
&nbsp;
 &#47;&#47; TransactionAPI exposes methods for reading and creating transaction data.
 type TransactionAPI struct {
<span class="term-fg31">-	b         Backend</span>
<span class="term-fg32">+	b         CeloBackend</span>
 	nonceLock *AddrLocker
 	signer    types.Signer
 }
&nbsp;
 &#47;&#47; NewTransactionAPI creates a new RPC service with methods for interacting with transactions.
<span class="term-fg31">-func NewTransactionAPI(b Backend, nonceLock *AddrLocker) *TransactionAPI {</span>
<span class="term-fg32">+func NewTransactionAPI(b CeloBackend, nonceLock *AddrLocker) *TransactionAPI {</span>
 	&#47;&#47; The signer used by the API should always be the &#39;latest&#39; known one because we expect
 	&#47;&#47; signers to be backwards-compatible with old transactions.
 	signer := types.LatestSigner(b.ChainConfig())
<span class="term-fg36">@@ -1839,7 +1915,7 @@</span> 	header, err := s.b.HeaderByHash(ctx, blockHash)
 	if err != nil {
 		return nil, err
 	}
<span class="term-fg31">-	rcpt := depositTxReceipt(ctx, blockHash, index, s.b, tx)</span>
<span class="term-fg32">+	rcpt := txReceipt(ctx, blockHash, index, s.b, tx)</span>
 	return newRPCTransaction(tx, blockHash, blockNumber, header.Time, index, header.BaseFee, s.b.ChainConfig(), rcpt), nil
 }
&nbsp;
<span class="term-fg36">@@ -1903,13 +1979,24 @@</span> 		&quot;contractAddress&quot;:   nil,
 		&quot;logs&quot;:              receipt.Logs,
 		&quot;logsBloom&quot;:         receipt.Bloom,
 		&quot;type&quot;:              hexutil.Uint(tx.Type()),
<span class="term-fg31">-		&quot;effectiveGasPrice&quot;: (*hexutil.Big)(receipt.EffectiveGasPrice),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; omit the effectiveGasPrice when it is nil, for Celo L1 backwards compatibility.</span>
<span class="term-fg32">+	if receipt.EffectiveGasPrice != nil || chainConfig.IsGingerbread(new(big.Int).SetUint64(blockNumber)) {</span>
<span class="term-fg32">+		fields[&quot;effectiveGasPrice&quot;] = (*hexutil.Big)(receipt.EffectiveGasPrice)</span>
 	}
&nbsp;
 	if chainConfig.Optimism != nil &amp;&amp; !tx.IsDepositTx() {
<span class="term-fg31">-		fields[&quot;l1GasPrice&quot;] = (*hexutil.Big)(receipt.L1GasPrice)</span>
<span class="term-fg31">-		fields[&quot;l1GasUsed&quot;] = (*hexutil.Big)(receipt.L1GasUsed)</span>
<span class="term-fg31">-		fields[&quot;l1Fee&quot;] = (*hexutil.Big)(receipt.L1Fee)</span>
<span class="term-fg32">+		&#47;&#47; These three fields are not present receipts migrated from l1 Celo</span>
<span class="term-fg32">+		if receipt.L1GasPrice != nil {</span>
<span class="term-fg32">+			fields[&quot;l1GasPrice&quot;] = (*hexutil.Big)(receipt.L1GasPrice)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if receipt.L1GasUsed != nil {</span>
<span class="term-fg32">+			fields[&quot;l1GasUsed&quot;] = (*hexutil.Big)(receipt.L1GasUsed)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if receipt.L1Fee != nil {</span>
<span class="term-fg32">+			fields[&quot;l1Fee&quot;] = (*hexutil.Big)(receipt.L1Fee)</span>
<span class="term-fg32">+		}</span>
 		&#47;&#47; Fields removed with Ecotone
 		if receipt.FeeScalar != nil {
 			fields[&quot;l1FeeScalar&quot;] = receipt.FeeScalar.String()</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-0603d298e6d3d4a7edfd4c21" role="button"
                       aria-expanded="false" aria-controls="id-0603d298e6d3d4a7edfd4c21">
                        <code>internal/ethapi/api_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/api_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/api_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+145</span></div>
                            <div class="text-start"><span class="text-danger">-16</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-0603d298e6d3d4a7edfd4c21"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;api_test.go CELO&#47;internal&#47;ethapi&#47;api_test.go</span>
<span class="term-fg1">index 313ce1c10e8662808eca54db4748d85157bda782..4dd2d5649d0db2bdd69f774dd5847a26847a32c8 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;api_test.go</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;api_test.go</span>
<span class="term-fg36">@@ -584,6 +584,50 @@</span> 	am.AddBackend(b)
 	return am, acc
 }
&nbsp;
<span class="term-fg32">+var errCeloNotImplemented error = errors.New(&quot;Celo backend test functionality not implemented&quot;)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type celoTestBackend struct {</span>
<span class="term-fg32">+	*testBackend</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoTestBackend) GetFeeBalance(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, account common.Address, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		header, err := c.HeaderByNumberOrHash(ctx, blockNumOrHash)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, fmt.Errorf(&quot;retrieve header by hash in testBackend: %w&quot;, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		state, _, err := c.StateAndHeaderByNumber(ctx, rpc.BlockNumber(header.Number.Int64()))</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			return nil, err</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		return state.GetBalance(account).ToBig(), nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Celo specific backend features are currently not tested</span>
<span class="term-fg32">+	return nil, errCeloNotImplemented</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoTestBackend) GetExchangeRates(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash) (common.ExchangeRates, error) {</span>
<span class="term-fg32">+	var er common.ExchangeRates</span>
<span class="term-fg32">+	return er, nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoTestBackend) ConvertToCurrency(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, value *big.Int, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		return value, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Celo specific backend features are currently not tested</span>
<span class="term-fg32">+	return nil, errCeloNotImplemented</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoTestBackend) ConvertToCelo(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, value *big.Int, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	if feeCurrency == nil {</span>
<span class="term-fg32">+		return value, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	&#47;&#47; Celo specific backend features are currently not tested</span>
<span class="term-fg32">+	return nil, errCeloNotImplemented</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
 type testBackend struct {
 	db      ethdb.Database
 	chain   *core.BlockChain
<span class="term-fg36">@@ -592,7 +636,7 @@</span> 	accman  *accounts.Manager
 	acc     accounts.Account
 }
&nbsp;
<span class="term-fg31">-func newTestBackend(t *testing.T, n int, gspec *core.Genesis, engine consensus.Engine, generator func(i int, b *core.BlockGen)) *testBackend {</span>
<span class="term-fg32">+func newTestBackend(t *testing.T, n int, gspec *core.Genesis, engine consensus.Engine, generator func(i int, b *core.BlockGen)) *celoTestBackend {</span>
 	var (
 		cacheConfig = &amp;core.CacheConfig{
 			TrieCleanLimit:    256,
<span class="term-fg36">@@ -616,7 +660,9 @@</span> 		t.Fatalf(&quot;block %d: failed to insert into chain: %v&quot;, n, err)
 	}
&nbsp;
 	backend := &amp;testBackend{db: db, chain: chain, accman: accman, acc: acc}
<span class="term-fg31">-	return backend</span>
<span class="term-fg32">+	return &amp;celoTestBackend{</span>
<span class="term-fg32">+		testBackend: backend,</span>
<span class="term-fg32">+	}</span>
 }
&nbsp;
 func (b *testBackend) setPendingBlock(block *types.Block) {
<span class="term-fg36">@@ -1513,7 +1559,7 @@</span> 			})
 		}
 		txs = append(txs, tx)
 	}
<span class="term-fg31">-	block := types.NewBlock(&amp;types.Header{Number: big.NewInt(100)}, txs, nil, nil, blocktest.NewHasher())</span>
<span class="term-fg32">+	block := types.NewBlock(&amp;types.Header{Number: big.NewInt(100), GasLimit: 10}, txs, nil, nil, blocktest.NewHasher())</span>
&nbsp;
 	var testSuite = []struct {
 		inclTx bool
<span class="term-fg36">@@ -1527,9 +1573,9 @@</span> 			fullTx: false,
 			want: `{
 				&quot;difficulty&quot;: &quot;0x0&quot;,
 				&quot;extraData&quot;: &quot;0x&quot;,
<span class="term-fg31">-				&quot;gasLimit&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+				&quot;gasLimit&quot;: &quot;0xa&quot;,</span>
 				&quot;gasUsed&quot;: &quot;0x0&quot;,
<span class="term-fg31">-				&quot;hash&quot;: &quot;0x9b73c83b25d0faf7eab854e3684c7e394336d6e135625aafa5c183f27baa8fee&quot;,</span>
<span class="term-fg32">+				&quot;hash&quot;: &quot;0x7117849518bf9484dae1b1e0aeb9f37b4fa81550061e2057614bec1a022e4596&quot;,</span>
 				&quot;logsBloom&quot;: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
 				&quot;miner&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
 				&quot;mixHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,
<span class="term-fg36">@@ -1552,9 +1598,9 @@</span> 			fullTx: false,
 			want: `{
 				&quot;difficulty&quot;: &quot;0x0&quot;,
 				&quot;extraData&quot;: &quot;0x&quot;,
<span class="term-fg31">-				&quot;gasLimit&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+				&quot;gasLimit&quot;: &quot;0xa&quot;,</span>
 				&quot;gasUsed&quot;: &quot;0x0&quot;,
<span class="term-fg31">-				&quot;hash&quot;: &quot;0x9b73c83b25d0faf7eab854e3684c7e394336d6e135625aafa5c183f27baa8fee&quot;,</span>
<span class="term-fg32">+				&quot;hash&quot;: &quot;0x7117849518bf9484dae1b1e0aeb9f37b4fa81550061e2057614bec1a022e4596&quot;,</span>
 				&quot;logsBloom&quot;: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
 				&quot;miner&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
 				&quot;mixHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,
<span class="term-fg36">@@ -1583,9 +1629,9 @@</span> 			fullTx: true,
 			want: `{
 				&quot;difficulty&quot;: &quot;0x0&quot;,
 				&quot;extraData&quot;: &quot;0x&quot;,
<span class="term-fg31">-				&quot;gasLimit&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+				&quot;gasLimit&quot;: &quot;0xa&quot;,</span>
 				&quot;gasUsed&quot;: &quot;0x0&quot;,
<span class="term-fg31">-				&quot;hash&quot;: &quot;0x9b73c83b25d0faf7eab854e3684c7e394336d6e135625aafa5c183f27baa8fee&quot;,</span>
<span class="term-fg32">+				&quot;hash&quot;: &quot;0x7117849518bf9484dae1b1e0aeb9f37b4fa81550061e2057614bec1a022e4596&quot;,</span>
 				&quot;logsBloom&quot;: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
 				&quot;miner&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
 				&quot;mixHash&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,
<span class="term-fg36">@@ -1599,7 +1645,7 @@</span> 				&quot;stateRoot&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,
 				&quot;timestamp&quot;: &quot;0x0&quot;,
 				&quot;transactions&quot;: [
 					{
<span class="term-fg31">-						&quot;blockHash&quot;: &quot;0x9b73c83b25d0faf7eab854e3684c7e394336d6e135625aafa5c183f27baa8fee&quot;,</span>
<span class="term-fg32">+						&quot;blockHash&quot;: &quot;0x7117849518bf9484dae1b1e0aeb9f37b4fa81550061e2057614bec1a022e4596&quot;,</span>
 						&quot;blockNumber&quot;: &quot;0x64&quot;,
 						&quot;from&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
 						&quot;gas&quot;: &quot;0x457&quot;,
<span class="term-fg36">@@ -1619,7 +1665,7 @@</span> 						&quot;s&quot;: &quot;0x0&quot;,
 						&quot;yParity&quot;: &quot;0x0&quot;
 					},
 					{
<span class="term-fg31">-						&quot;blockHash&quot;: &quot;0x9b73c83b25d0faf7eab854e3684c7e394336d6e135625aafa5c183f27baa8fee&quot;,</span>
<span class="term-fg32">+						&quot;blockHash&quot;: &quot;0x7117849518bf9484dae1b1e0aeb9f37b4fa81550061e2057614bec1a022e4596&quot;,</span>
 						&quot;blockNumber&quot;: &quot;0x64&quot;,
 						&quot;from&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
 						&quot;gas&quot;: &quot;0x457&quot;,
<span class="term-fg36">@@ -1637,7 +1683,7 @@</span> 						&quot;r&quot;: &quot;0x0&quot;,
 						&quot;s&quot;: &quot;0x0&quot;
 					},
 					{
<span class="term-fg31">-						&quot;blockHash&quot;: &quot;0x9b73c83b25d0faf7eab854e3684c7e394336d6e135625aafa5c183f27baa8fee&quot;,</span>
<span class="term-fg32">+						&quot;blockHash&quot;: &quot;0x7117849518bf9484dae1b1e0aeb9f37b4fa81550061e2057614bec1a022e4596&quot;,</span>
 						&quot;blockNumber&quot;: &quot;0x64&quot;,
 						&quot;from&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
 						&quot;gas&quot;: &quot;0x457&quot;,
<span class="term-fg36">@@ -1657,7 +1703,7 @@</span> 						&quot;s&quot;: &quot;0x0&quot;,
 						&quot;yParity&quot;: &quot;0x0&quot;
 					},
 					{
<span class="term-fg31">-						&quot;blockHash&quot;: &quot;0x9b73c83b25d0faf7eab854e3684c7e394336d6e135625aafa5c183f27baa8fee&quot;,</span>
<span class="term-fg32">+						&quot;blockHash&quot;: &quot;0x7117849518bf9484dae1b1e0aeb9f37b4fa81550061e2057614bec1a022e4596&quot;,</span>
 						&quot;blockNumber&quot;: &quot;0x64&quot;,
 						&quot;from&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
 						&quot;gas&quot;: &quot;0x457&quot;,
<span class="term-fg36">@@ -1706,7 +1752,10 @@</span> 		acc2Key, _ = crypto.HexToECDSA(&quot;49a7b37aa6f6645917e7b807e9d1c00d4fa71f18343b0d4122a4d2df64dd6fee&quot;)
 		acc1Addr   = crypto.PubkeyToAddress(acc1Key.PublicKey)
 		acc2Addr   = crypto.PubkeyToAddress(acc2Key.PublicKey)
 		genesis    = &amp;core.Genesis{
<span class="term-fg31">-			Config: params.TestChainConfig,</span>
<span class="term-fg32">+			&#47;&#47; Use a config which disables the Cel2 flag</span>
<span class="term-fg32">+			&#47;&#47; This is necessary because Cel2 enables sending of fees to the fee handler,</span>
<span class="term-fg32">+			&#47;&#47; which in turn changes the state tree which leads to changes in hashes.</span>
<span class="term-fg32">+			Config: params.TestChainConfigNoCel2,</span>
 			Alloc: types.GenesisAlloc{
 				acc1Addr: {Balance: big.NewInt(params.Ether)},
 				acc2Addr: {Balance: big.NewInt(params.Ether)},
<span class="term-fg36">@@ -1728,7 +1777,7 @@</span> 			Validator: 1,
 			Address:   common.Address{0x12, 0x34},
 			Amount:    10,
 		}
<span class="term-fg31">-		pending = types.NewBlockWithWithdrawals(&amp;types.Header{Number: big.NewInt(11), Time: 42}, []*types.Transaction{tx}, nil, nil, []*types.Withdrawal{withdrawal}, blocktest.NewHasher())</span>
<span class="term-fg32">+		pending = types.NewBlockWithWithdrawals(&amp;types.Header{Number: big.NewInt(11), Time: 42, GasLimit: 10}, []*types.Transaction{tx}, nil, nil, []*types.Withdrawal{withdrawal}, blocktest.NewHasher())</span>
 	)
 	backend := newTestBackend(t, genBlocks, genesis, ethash.NewFaker(), func(i int, b *core.BlockGen) {
 		&#47;&#47; Transfer from account[0] to account[1]
<span class="term-fg36">@@ -1950,7 +1999,7 @@</span> 		testRPCResponseWithFile(t, i, result, rpc, tt.file)
 	}
 }
&nbsp;
<span class="term-fg31">-func setupReceiptBackend(t *testing.T, genBlocks int) (*testBackend, []common.Hash) {</span>
<span class="term-fg32">+func setupReceiptBackend(t *testing.T, genBlocks int) (*celoTestBackend, []common.Hash) {</span>
 	config := *params.MergedTestChainConfig
 	var (
 		acc1Key, _ = crypto.HexToECDSA(&quot;8a1f9a8f95be41cd7ccb6168179afb4504aefe388d1e14474d32c45c72ce7b7a&quot;)
<span class="term-fg36">@@ -2222,3 +2271,83 @@</span> 		t.Fatalf(&quot;error reading expected test file: %s output: %v&quot;, outputFile, err)
 	}
 	require.JSONEqf(t, string(want), string(data), &quot;test %d: json not match, want: %s, have: %s&quot;, testid, string(want), string(data))
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestCeloTransaction_RoundTripRpcJSON(t *testing.T) {</span>
<span class="term-fg32">+	var (</span>
<span class="term-fg32">+		config = params.TestChainConfig</span>
<span class="term-fg32">+		signer = types.LatestSigner(config)</span>
<span class="term-fg32">+		key, _ = crypto.HexToECDSA(&quot;b71c71a67e1177ad4e901695e1b4b9ee17ae16c6668d313eac2f96dbcda3f291&quot;)</span>
<span class="term-fg32">+		tests  = celoTransactionTypes(common.Address{0xde, 0xad}, config)</span>
<span class="term-fg32">+	)</span>
<span class="term-fg32">+	t.Parallel()</span>
<span class="term-fg32">+	for i, tt := range tests {</span>
<span class="term-fg32">+		tx, err := types.SignNewTx(key, signer, tt)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			t.Fatalf(&quot;test %d: signing failed: %v&quot;, i, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; Regular transaction</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			var tx2 types.Transaction</span>
<span class="term-fg32">+			if data, err := json.Marshal(tx); err != nil {</span>
<span class="term-fg32">+				t.Fatalf(&quot;test %d: marshalling failed; %v&quot;, i, err)</span>
<span class="term-fg32">+			} else if err = tx2.UnmarshalJSON(data); err != nil {</span>
<span class="term-fg32">+				t.Fatalf(&quot;test %d: sunmarshal failed: %v&quot;, i, err)</span>
<span class="term-fg32">+			} else if want, have := tx.Hash(), tx2.Hash(); want != have {</span>
<span class="term-fg32">+				t.Fatalf(&quot;test %d: stx changed, want %x have %x&quot;, i, want, have)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47;  rpcTransaction</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			var tx2 types.Transaction</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(tx, common.Hash{}, 0, 0, 0, nil, config, nil)</span>
<span class="term-fg32">+			if data, err := json.Marshal(rpcTx); err != nil {</span>
<span class="term-fg32">+				t.Fatalf(&quot;test %d: marshalling failed; %v&quot;, i, err)</span>
<span class="term-fg32">+			} else if err = tx2.UnmarshalJSON(data); err != nil {</span>
<span class="term-fg32">+				t.Fatalf(&quot;test %d: unmarshal failed: %v&quot;, i, err)</span>
<span class="term-fg32">+			} else if want, have := tx.Hash(), tx2.Hash(); want != have {</span>
<span class="term-fg32">+				t.Fatalf(&quot;test %d: tx changed, want %x have %x&quot;, i, want, have)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+func celoTransactionTypes(addr common.Address, config *params.ChainConfig) []types.TxData {</span>
<span class="term-fg32">+	return []types.TxData{</span>
<span class="term-fg32">+		&amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+			ChainID:     config.ChainID,</span>
<span class="term-fg32">+			Nonce:       5,</span>
<span class="term-fg32">+			GasTipCap:   big.NewInt(6),</span>
<span class="term-fg32">+			GasFeeCap:   big.NewInt(9),</span>
<span class="term-fg32">+			Gas:         7,</span>
<span class="term-fg32">+			FeeCurrency: nil,</span>
<span class="term-fg32">+			To:          &amp;addr,</span>
<span class="term-fg32">+			Value:       big.NewInt(8),</span>
<span class="term-fg32">+			Data:        []byte{0, 1, 2, 3, 4},</span>
<span class="term-fg32">+			AccessList: types.AccessList{</span>
<span class="term-fg32">+				types.AccessTuple{</span>
<span class="term-fg32">+					Address:     common.Address{0x2},</span>
<span class="term-fg32">+					StorageKeys: []common.Hash{types.EmptyRootHash},</span>
<span class="term-fg32">+				},</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+			V: big.NewInt(32),</span>
<span class="term-fg32">+			R: big.NewInt(10),</span>
<span class="term-fg32">+			S: big.NewInt(11),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+			ChainID:     config.ChainID,</span>
<span class="term-fg32">+			Nonce:       5,</span>
<span class="term-fg32">+			GasTipCap:   big.NewInt(6),</span>
<span class="term-fg32">+			GasFeeCap:   big.NewInt(9),</span>
<span class="term-fg32">+			Gas:         7,</span>
<span class="term-fg32">+			FeeCurrency: &amp;common.Address{0x42},</span>
<span class="term-fg32">+			To:          nil,</span>
<span class="term-fg32">+			Value:       big.NewInt(8),</span>
<span class="term-fg32">+			Data:        []byte{0, 1, 2, 3, 4},</span>
<span class="term-fg32">+			AccessList:  types.AccessList{},</span>
<span class="term-fg32">+			V:           big.NewInt(32),</span>
<span class="term-fg32">+			R:           big.NewInt(10),</span>
<span class="term-fg32">+			S:           big.NewInt(11),</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bbe590beacc8487c8b242a3e" role="button"
                       aria-expanded="false" aria-controls="id-bbe590beacc8487c8b242a3e">
                        <code>internal/ethapi/backend.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/backend.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/backend.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+11</span></div>
                            <div class="text-start"><span class="text-danger">-3</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bbe590beacc8487c8b242a3e"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;backend.go CELO&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg1">index 7c0e655d205c7e7d2faf92a5ef39b8a76d0439c8..d011c4db9571ab75a1444e1e54f672a477c33f40 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;backend.go</span>
<span class="term-fg36">@@ -37,8 +37,16 @@</span> 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;rpc&quot;
 )
&nbsp;
<span class="term-fg31">-&#47;&#47; Backend interface provides the common API services (that are provided by</span>
<span class="term-fg31">-&#47;&#47; both full and light clients) with access to necessary functions.</span>
<span class="term-fg32">+type CeloBackend interface {</span>
<span class="term-fg32">+	Backend</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	GetFeeBalance(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash, account common.Address, feeCurrency *common.Address) (*big.Int, error)</span>
<span class="term-fg32">+	GetExchangeRates(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash) (common.ExchangeRates, error)</span>
<span class="term-fg32">+	ConvertToCurrency(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash, value *big.Int, feeCurrency *common.Address) (*big.Int, error)</span>
<span class="term-fg32">+	ConvertToCelo(ctx context.Context, blockNrOrHash rpc.BlockNumberOrHash, value *big.Int, feeCurrency *common.Address) (*big.Int, error)</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; Backend interface provides the common API services (that are provided by both full and light clients) with access to necessary functions.</span>
 type Backend interface {
 	&#47;&#47; General Ethereum API
 	SyncProgress() ethereum.SyncProgress
<span class="term-fg36">@@ -101,7 +109,7 @@</span> 	BloomStatus() (uint64, uint64)
 	ServiceFilter(ctx context.Context, session *bloombits.MatcherSession)
 }
&nbsp;
<span class="term-fg31">-func GetAPIs(apiBackend Backend) []rpc.API {</span>
<span class="term-fg32">+func GetAPIs(apiBackend CeloBackend) []rpc.API {</span>
 	nonceLock := new(AddrLocker)
 	return []rpc.API{
 		{</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-79eb686f18d3947888d3b4f4" role="button"
                       aria-expanded="false" aria-controls="id-79eb686f18d3947888d3b4f4">
                        <code>internal/ethapi/celo_api_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/celo_api_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+533</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-79eb686f18d3947888d3b4f4"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;celo_api_test.go CELO&#47;internal&#47;ethapi&#47;celo_api_test.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..7cf030547e524540186ffb71d98d69814d128a25</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;celo_api_test.go</span>
<span class="term-fg36">@@ -0,0 +1,533 @@</span>
<span class="term-fg32">+package ethapi</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;math&#47;big&quot;</span>
<span class="term-fg32">+	&quot;testing&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;crypto&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;assert&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;stretchr&#47;testify&#47;require&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	&#47;&#47; tx fields</span>
<span class="term-fg32">+	nonce               uint64 = 1</span>
<span class="term-fg32">+	gasPrice                   = big.NewInt(1000)</span>
<span class="term-fg32">+	gasLimit            uint64 = 100000</span>
<span class="term-fg32">+	feeCurrency                = common.HexToAddress(&quot;0x0000000000000000000000000000000000000bbb&quot;)</span>
<span class="term-fg32">+	gatewayFee                 = big.NewInt(500)</span>
<span class="term-fg32">+	gatewayFeeRecipient        = common.HexToAddress(&quot;0x0000000000000000000000000000000000000ccc&quot;)</span>
<span class="term-fg32">+	to                         = common.HexToAddress(&quot;0x0000000000000000000000000000000000000aaa&quot;)</span>
<span class="term-fg32">+	value                      = big.NewInt(10)</span>
<span class="term-fg32">+	&#47;&#47; block fields</span>
<span class="term-fg32">+	baseFee                 = big.NewInt(100)</span>
<span class="term-fg32">+	transactionIndex uint64 = 15</span>
<span class="term-fg32">+	blockhash               = common.HexToHash(&quot;0x6ba4a8c1bfe2619eb498e5296e81b1c393b13cba0198ed63dea0ee3aa619b073&quot;)</span>
<span class="term-fg32">+	blockNumber      uint64 = 100</span>
<span class="term-fg32">+	blockTime        uint64 = 100</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestNewRPCTransactionLegacy(t *testing.T) {</span>
<span class="term-fg32">+	config := allEnabledChainConfig()</span>
<span class="term-fg32">+	&#47;&#47; Set cel2 time to 2000 so that we don&#39;t activate the cel2 fork.</span>
<span class="term-fg32">+	var cel2Time uint64 = 2000</span>
<span class="term-fg32">+	config.Cel2Time = &amp;cel2Time</span>
<span class="term-fg32">+	s := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber), blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	key, err := crypto.GenerateKey()</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	t.Run(&quot;WithCeloFields&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		tx := types.NewTx(&amp;types.LegacyTx{</span>
<span class="term-fg32">+			Nonce:    nonce,</span>
<span class="term-fg32">+			GasPrice: gasPrice,</span>
<span class="term-fg32">+			Gas:      gasLimit,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			FeeCurrency:         &amp;feeCurrency,</span>
<span class="term-fg32">+			GatewayFee:          gatewayFee,</span>
<span class="term-fg32">+			GatewayFeeRecipient: &amp;gatewayFeeRecipient,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			To:    &amp;to,</span>
<span class="term-fg32">+			Value: value,</span>
<span class="term-fg32">+			Data:  []byte{},</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			CeloLegacy: true,</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+		require.NoError(t, err)</span>
<span class="term-fg32">+		rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+		checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, nil)</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	t.Run(&quot;WithoutCeloFields&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		tx := types.NewTx(&amp;types.LegacyTx{</span>
<span class="term-fg32">+			Nonce:    nonce,</span>
<span class="term-fg32">+			GasPrice: gasPrice,</span>
<span class="term-fg32">+			Gas:      gasLimit,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			To:    &amp;to,</span>
<span class="term-fg32">+			Value: value,</span>
<span class="term-fg32">+			Data:  []byte{},</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+		signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+		require.NoError(t, err)</span>
<span class="term-fg32">+		rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+		checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, nil)</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestNewRPCTransactionDynamicFee(t *testing.T) {</span>
<span class="term-fg32">+	key, err := crypto.GenerateKey()</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+	feeCap := big.NewInt(1000)</span>
<span class="term-fg32">+	tipCap := big.NewInt(100)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	t.Run(&quot;PendingTransactions&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		&#47;&#47; For pending transactions we expect the gas price to be the gas fee cap.</span>
<span class="term-fg32">+		gasFeeCap := func(t *testing.T, tx *types.Transaction, rpcTx *RPCTransaction) {</span>
<span class="term-fg32">+			assert.Equal(t, (*hexutil.Big)(feeCap), rpcTx.GasPrice)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		overrides := map[string]func(*testing.T, *types.Transaction, *RPCTransaction){&quot;gasPrice&quot;: gasFeeCap}</span>
<span class="term-fg32">+		config := allEnabledChainConfig()</span>
<span class="term-fg32">+		s := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber), blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; An empty bockhash signals pending transactions (I.E no mined block)</span>
<span class="term-fg32">+		blockhash := common.Hash{}</span>
<span class="term-fg32">+		t.Run(&quot;DynamicFeeTx&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.DynamicFeeTx{</span>
<span class="term-fg32">+				ChainID:   config.ChainID,</span>
<span class="term-fg32">+				Nonce:     nonce,</span>
<span class="term-fg32">+				Gas:       gasLimit,</span>
<span class="term-fg32">+				GasFeeCap: feeCap,</span>
<span class="term-fg32">+				GasTipCap: tipCap,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;CeloDynamicFeeTxV2&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+				ChainID:     config.ChainID,</span>
<span class="term-fg32">+				Nonce:       nonce,</span>
<span class="term-fg32">+				Gas:         gasLimit,</span>
<span class="term-fg32">+				GasFeeCap:   feeCap,</span>
<span class="term-fg32">+				GasTipCap:   tipCap,</span>
<span class="term-fg32">+				FeeCurrency: &amp;feeCurrency,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	t.Run(&quot;PreGingerbreadMinedDynamicTxs&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		nilGasPrice := func(t *testing.T, tx *types.Transaction, rpcTx *RPCTransaction) {</span>
<span class="term-fg32">+			assert.Nil(t, rpcTx.GasPrice)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		overrides := map[string]func(*testing.T, *types.Transaction, *RPCTransaction){&quot;gasPrice&quot;: nilGasPrice}</span>
<span class="term-fg32">+		&#47;&#47; For a pre gingerbread mined dynamic txs we expect the gas price to be unset, because without the state we</span>
<span class="term-fg32">+		&#47;&#47; cannot retrieve the base fee, and we currently have no implementation in op-geth to handle retrieving the</span>
<span class="term-fg32">+		&#47;&#47; base fee from state.</span>
<span class="term-fg32">+		config := allEnabledChainConfig()</span>
<span class="term-fg32">+		config.GingerbreadBlock = big.NewInt(200) &#47;&#47; Setup config so that gingerbread is not active.</span>
<span class="term-fg32">+		cel2Time := uint64(1000)</span>
<span class="term-fg32">+		config.Cel2Time = &amp;cel2Time &#47;&#47; also deactivate cel2</span>
<span class="term-fg32">+		s := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber), blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;DynamicFeeTx&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.DynamicFeeTx{</span>
<span class="term-fg32">+				ChainID:   config.ChainID,</span>
<span class="term-fg32">+				Nonce:     nonce,</span>
<span class="term-fg32">+				Gas:       gasLimit,</span>
<span class="term-fg32">+				GasFeeCap: feeCap,</span>
<span class="term-fg32">+				GasTipCap: tipCap,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;CeloDynamicFeeTx&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.CeloDynamicFeeTx{</span>
<span class="term-fg32">+				ChainID:             config.ChainID,</span>
<span class="term-fg32">+				Nonce:               nonce,</span>
<span class="term-fg32">+				Gas:                 gasLimit,</span>
<span class="term-fg32">+				GasFeeCap:           feeCap,</span>
<span class="term-fg32">+				GasTipCap:           tipCap,</span>
<span class="term-fg32">+				GatewayFee:          gatewayFee,</span>
<span class="term-fg32">+				GatewayFeeRecipient: &amp;gatewayFeeRecipient,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	t.Run(&quot;PostGingerbreadMinedDynamicTxsWithNativeFeeCurrency&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		&#47;&#47; For a post gingerbread mined dynamic tx with a native fee currency we expect the gas price to be the</span>
<span class="term-fg32">+		&#47;&#47; effective gas price calculated with the base fee available on the block.</span>
<span class="term-fg32">+		effectiveGasPrice := func(t *testing.T, tx *types.Transaction, rpcTx *RPCTransaction) {</span>
<span class="term-fg32">+			assert.Equal(t, (*hexutil.Big)(effectiveGasPrice(tx, baseFee)), rpcTx.GasPrice)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		overrides := map[string]func(*testing.T, *types.Transaction, *RPCTransaction){&quot;gasPrice&quot;: effectiveGasPrice}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		config := allEnabledChainConfig()</span>
<span class="term-fg32">+		s := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber), blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;DynamicFeeTx&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.DynamicFeeTx{</span>
<span class="term-fg32">+				ChainID:   config.ChainID,</span>
<span class="term-fg32">+				Nonce:     nonce,</span>
<span class="term-fg32">+				Gas:       gasLimit,</span>
<span class="term-fg32">+				GasFeeCap: feeCap,</span>
<span class="term-fg32">+				GasTipCap: tipCap,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;CeloDynamicFeeTx&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			&#47;&#47; CeloDynamicFeeTxs are deprecated after cel2 so we need to ensure cel2time is not activated</span>
<span class="term-fg32">+			config := allEnabledChainConfig()</span>
<span class="term-fg32">+			cel2Time := uint64(1000)</span>
<span class="term-fg32">+			config.Cel2Time = &amp;cel2Time</span>
<span class="term-fg32">+			s := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber), blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.CeloDynamicFeeTx{</span>
<span class="term-fg32">+				ChainID:             config.ChainID,</span>
<span class="term-fg32">+				Nonce:               nonce,</span>
<span class="term-fg32">+				Gas:                 gasLimit,</span>
<span class="term-fg32">+				GasFeeCap:           feeCap,</span>
<span class="term-fg32">+				GasTipCap:           tipCap,</span>
<span class="term-fg32">+				GatewayFee:          gatewayFee,</span>
<span class="term-fg32">+				GatewayFeeRecipient: &amp;gatewayFeeRecipient,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;CeloDynamicFeeTxV2&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+				ChainID:   config.ChainID,</span>
<span class="term-fg32">+				Nonce:     nonce,</span>
<span class="term-fg32">+				Gas:       gasLimit,</span>
<span class="term-fg32">+				GasFeeCap: feeCap,</span>
<span class="term-fg32">+				GasTipCap: tipCap,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		&#47;&#47; TODO unskip this when cip 66 txs are enabled currently they are not supporeted in the celo signer.</span>
<span class="term-fg32">+		t.Run(&quot;CeloDenominatedTx&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			t.Skip(&quot;CeloDenominatedTx is currently not supported in the celo signer&quot;)</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.CeloDenominatedTx{</span>
<span class="term-fg32">+				ChainID:             config.ChainID,</span>
<span class="term-fg32">+				Nonce:               nonce,</span>
<span class="term-fg32">+				Gas:                 gasLimit,</span>
<span class="term-fg32">+				GasFeeCap:           feeCap,</span>
<span class="term-fg32">+				GasTipCap:           tipCap,</span>
<span class="term-fg32">+				FeeCurrency:         &amp;feeCurrency,</span>
<span class="term-fg32">+				MaxFeeInFeeCurrency: big.NewInt(100000),</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	t.Run(&quot;PostGingerbreadPreCel2MinedDynamicTxsWithNonNativeFeeCurrency&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		&#47;&#47; For a post gingerbread mined dynamic txs with a non native fee currency we expect the gas price to be unset,</span>
<span class="term-fg32">+		&#47;&#47; because without the state we cannot retrieve the base fee, and we currently have no implementation in op-geth</span>
<span class="term-fg32">+		&#47;&#47; to handle retrieving the base fee from state.</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		nilGasPrice := func(t *testing.T, tx *types.Transaction, rpcTx *RPCTransaction) {</span>
<span class="term-fg32">+			assert.Nil(t, rpcTx.GasPrice)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		overrides := map[string]func(*testing.T, *types.Transaction, *RPCTransaction){&quot;gasPrice&quot;: nilGasPrice}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		config := allEnabledChainConfig()</span>
<span class="term-fg32">+		cel2Time := uint64(1000)</span>
<span class="term-fg32">+		config.Cel2Time = &amp;cel2Time &#47;&#47; Deactivate cel2</span>
<span class="term-fg32">+		s := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber), blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;CeloDynamicFeeTx&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			&#47;&#47; CeloDynamicFeeTxs are deprecated after cel2 so we need to ensure cel2time is not activated</span>
<span class="term-fg32">+			config := allEnabledChainConfig()</span>
<span class="term-fg32">+			cel2Time := uint64(1000)</span>
<span class="term-fg32">+			config.Cel2Time = &amp;cel2Time</span>
<span class="term-fg32">+			s := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber), blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.CeloDynamicFeeTx{</span>
<span class="term-fg32">+				ChainID:             config.ChainID,</span>
<span class="term-fg32">+				Nonce:               nonce,</span>
<span class="term-fg32">+				Gas:                 gasLimit,</span>
<span class="term-fg32">+				GasFeeCap:           feeCap,</span>
<span class="term-fg32">+				GasTipCap:           tipCap,</span>
<span class="term-fg32">+				FeeCurrency:         &amp;feeCurrency,</span>
<span class="term-fg32">+				GatewayFee:          gatewayFee,</span>
<span class="term-fg32">+				GatewayFeeRecipient: &amp;gatewayFeeRecipient,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;CeloDynamicFeeTxV2&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+				ChainID:     config.ChainID,</span>
<span class="term-fg32">+				Nonce:       nonce,</span>
<span class="term-fg32">+				Gas:         gasLimit,</span>
<span class="term-fg32">+				GasFeeCap:   feeCap,</span>
<span class="term-fg32">+				GasTipCap:   tipCap,</span>
<span class="term-fg32">+				FeeCurrency: &amp;feeCurrency,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, nil)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	t.Run(&quot;PostCel2MinedDynamicTxs&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+		receipt := &amp;types.Receipt{}</span>
<span class="term-fg32">+		receipt.EffectiveGasPrice = big.NewInt(1234)</span>
<span class="term-fg32">+		effectiveGasPrice := func(t *testing.T, tx *types.Transaction, rpcTx *RPCTransaction) {</span>
<span class="term-fg32">+			assert.Equal(t, (*hexutil.Big)(receipt.EffectiveGasPrice), rpcTx.GasPrice)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		overrides := map[string]func(*testing.T, *types.Transaction, *RPCTransaction){&quot;gasPrice&quot;: effectiveGasPrice}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		config := allEnabledChainConfig()</span>
<span class="term-fg32">+		s := types.MakeSigner(config, new(big.Int).SetUint64(blockNumber), blockTime)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+		t.Run(&quot;CeloDynamicFeeTxV2&quot;, func(t *testing.T) {</span>
<span class="term-fg32">+			&#47;&#47; For a pre gingerbread mined dynamic fee tx we expect the gas price to be unset.</span>
<span class="term-fg32">+			tx := types.NewTx(&amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+				ChainID:     config.ChainID,</span>
<span class="term-fg32">+				Nonce:       nonce,</span>
<span class="term-fg32">+				Gas:         gasLimit,</span>
<span class="term-fg32">+				GasFeeCap:   feeCap,</span>
<span class="term-fg32">+				GasTipCap:   tipCap,</span>
<span class="term-fg32">+				FeeCurrency: &amp;feeCurrency,</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+				To:    &amp;to,</span>
<span class="term-fg32">+				Value: value,</span>
<span class="term-fg32">+				Data:  []byte{},</span>
<span class="term-fg32">+			})</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			signed, err := types.SignTx(tx, s, key)</span>
<span class="term-fg32">+			require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+			rpcTx := newRPCTransaction(signed, blockhash, blockNumber, blockTime, transactionIndex, baseFee, config, receipt)</span>
<span class="term-fg32">+			checkTxFields(t, signed, rpcTx, s, blockhash, blockNumber, transactionIndex, overrides)</span>
<span class="term-fg32">+		})</span>
<span class="term-fg32">+	})</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func allEnabledChainConfig() *params.ChainConfig {</span>
<span class="term-fg32">+	zeroTime := uint64(0)</span>
<span class="term-fg32">+	return &amp;params.ChainConfig{</span>
<span class="term-fg32">+		ChainID:             big.NewInt(44787),</span>
<span class="term-fg32">+		HomesteadBlock:      big.NewInt(0),</span>
<span class="term-fg32">+		EIP150Block:         big.NewInt(0),</span>
<span class="term-fg32">+		EIP155Block:         big.NewInt(0),</span>
<span class="term-fg32">+		EIP158Block:         big.NewInt(0),</span>
<span class="term-fg32">+		ByzantiumBlock:      big.NewInt(0),</span>
<span class="term-fg32">+		ConstantinopleBlock: big.NewInt(0),</span>
<span class="term-fg32">+		PetersburgBlock:     big.NewInt(0),</span>
<span class="term-fg32">+		IstanbulBlock:       big.NewInt(0),</span>
<span class="term-fg32">+		MuirGlacierBlock:    big.NewInt(0),</span>
<span class="term-fg32">+		BerlinBlock:         big.NewInt(0),</span>
<span class="term-fg32">+		LondonBlock:         big.NewInt(0),</span>
<span class="term-fg32">+		ArrowGlacierBlock:   big.NewInt(0),</span>
<span class="term-fg32">+		GrayGlacierBlock:    big.NewInt(0),</span>
<span class="term-fg32">+		ShanghaiTime:        &amp;zeroTime,</span>
<span class="term-fg32">+		CancunTime:          &amp;zeroTime,</span>
<span class="term-fg32">+		RegolithTime:        &amp;zeroTime,</span>
<span class="term-fg32">+		CanyonTime:          &amp;zeroTime,</span>
<span class="term-fg32">+		EcotoneTime:         &amp;zeroTime,</span>
<span class="term-fg32">+		FjordTime:           &amp;zeroTime,</span>
<span class="term-fg32">+		Cel2Time:            &amp;zeroTime,</span>
<span class="term-fg32">+		GingerbreadBlock:    big.NewInt(0),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; checkTxFields for the most part checks that the fields of the rpcTx match those of the provided tx, it allows for</span>
<span class="term-fg32">+&#47;&#47; overriding some checks by providing a map of fieldName -&gt; overrideFunc.</span>
<span class="term-fg32">+func checkTxFields(</span>
<span class="term-fg32">+	t *testing.T,</span>
<span class="term-fg32">+	tx *types.Transaction,</span>
<span class="term-fg32">+	rpcTx *RPCTransaction,</span>
<span class="term-fg32">+	signer types.Signer,</span>
<span class="term-fg32">+	blockhash common.Hash,</span>
<span class="term-fg32">+	blockNumber uint64,</span>
<span class="term-fg32">+	transactionIndex uint64,</span>
<span class="term-fg32">+	overrides map[string]func(*testing.T, *types.Transaction, *RPCTransaction),</span>
<span class="term-fg32">+) {</span>
<span class="term-fg32">+	&#47;&#47; Added fields (not part of the transaction type)</span>
<span class="term-fg32">+	&#47;&#47;</span>
<span class="term-fg32">+	&#47;&#47; If blockhash is empty it signifies a pending tx and for pending txs the block hash, block number and tx index are</span>
<span class="term-fg32">+	&#47;&#47; not set on the rpcTx. on the result.</span>
<span class="term-fg32">+	if blockhash == (common.Hash{}) {</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.BlockHash)</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.BlockNumber)</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.TransactionIndex)</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		assert.Equal(t, &amp;blockhash, rpcTx.BlockHash)</span>
<span class="term-fg32">+		assert.Equal(t, (*hexutil.Big)(big.NewInt(int64(blockNumber))), rpcTx.BlockNumber)</span>
<span class="term-fg32">+		assert.Equal(t, hexutil.Uint64(transactionIndex), *rpcTx.TransactionIndex)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	from, err := types.Sender(signer, tx)</span>
<span class="term-fg32">+	require.NoError(t, err)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	assert.Equal(t, from, rpcTx.From)</span>
<span class="term-fg32">+	assert.Equal(t, hexutil.Uint64(tx.Gas()), rpcTx.Gas)</span>
<span class="term-fg32">+	assert.Equal(t, tx.To(), rpcTx.To)</span>
<span class="term-fg32">+	override, ok := overrides[&quot;gasPrice&quot;]</span>
<span class="term-fg32">+	if ok {</span>
<span class="term-fg32">+		override(t, tx, rpcTx)</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		assert.Equal(t, (*hexutil.Big)(tx.GasPrice()), rpcTx.GasPrice)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	switch tx.Type() {</span>
<span class="term-fg32">+	case types.DynamicFeeTxType, types.CeloDynamicFeeTxType, types.CeloDynamicFeeTxV2Type, types.CeloDenominatedTxType:</span>
<span class="term-fg32">+		assert.Equal(t, (*hexutil.Big)(tx.GasFeeCap()), rpcTx.GasFeeCap)</span>
<span class="term-fg32">+		assert.Equal(t, (*hexutil.Big)(tx.GasTipCap()), rpcTx.GasTipCap)</span>
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.GasFeeCap)</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.GasTipCap)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	assert.Equal(t, (*hexutil.Big)(tx.BlobGasFeeCap()), rpcTx.MaxFeePerBlobGas)</span>
<span class="term-fg32">+	assert.Equal(t, tx.Hash(), rpcTx.Hash)</span>
<span class="term-fg32">+	assert.Equal(t, (hexutil.Bytes)(tx.Data()), rpcTx.Input)</span>
<span class="term-fg32">+	assert.Equal(t, hexutil.Uint64(tx.Nonce()), rpcTx.Nonce)</span>
<span class="term-fg32">+	assert.Equal(t, tx.To(), rpcTx.To)</span>
<span class="term-fg32">+	assert.Equal(t, (*hexutil.Big)(tx.Value()), rpcTx.Value)</span>
<span class="term-fg32">+	assert.Equal(t, hexutil.Uint64(tx.Type()), rpcTx.Type)</span>
<span class="term-fg32">+	switch tx.Type() {</span>
<span class="term-fg32">+	case types.AccessListTxType, types.DynamicFeeTxType, types.CeloDynamicFeeTxType, types.CeloDynamicFeeTxV2Type, types.CeloDenominatedTxType, types.BlobTxType:</span>
<span class="term-fg32">+		assert.Equal(t, tx.AccessList(), *rpcTx.Accesses)</span>
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.Accesses)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	assert.Equal(t, (*hexutil.Big)(tx.ChainId()), rpcTx.ChainID)</span>
<span class="term-fg32">+	assert.Equal(t, tx.BlobHashes(), rpcTx.BlobVersionedHashes)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	v, r, s := tx.RawSignatureValues()</span>
<span class="term-fg32">+	assert.Equal(t, (*hexutil.Big)(v), rpcTx.V)</span>
<span class="term-fg32">+	assert.Equal(t, (*hexutil.Big)(r), rpcTx.R)</span>
<span class="term-fg32">+	assert.Equal(t, (*hexutil.Big)(s), rpcTx.S)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	switch tx.Type() {</span>
<span class="term-fg32">+	case types.AccessListTxType, types.DynamicFeeTxType, types.CeloDynamicFeeTxType, types.CeloDynamicFeeTxV2Type, types.CeloDenominatedTxType, types.BlobTxType:</span>
<span class="term-fg32">+		yparity := (hexutil.Uint64)(v.Sign())</span>
<span class="term-fg32">+		assert.Equal(t, &amp;yparity, rpcTx.YParity)</span>
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.YParity)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; optimism fields</span>
<span class="term-fg32">+	switch tx.Type() {</span>
<span class="term-fg32">+	case types.DepositTxType:</span>
<span class="term-fg32">+		assert.Equal(t, tx.SourceHash(), rpcTx.SourceHash)</span>
<span class="term-fg32">+		assert.Equal(t, tx.Mint(), rpcTx.Mint)</span>
<span class="term-fg32">+		assert.Equal(t, tx.IsSystemTx(), rpcTx.IsSystemTx)</span>
<span class="term-fg32">+	default:</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.SourceHash)</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.Mint)</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.IsSystemTx)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	assert.Nil(t, rpcTx.DepositReceiptVersion)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; celo fields</span>
<span class="term-fg32">+	assert.Equal(t, tx.FeeCurrency(), rpcTx.FeeCurrency)</span>
<span class="term-fg32">+	assert.Equal(t, (*hexutil.Big)(tx.MaxFeeInFeeCurrency()), rpcTx.MaxFeeInFeeCurrency)</span>
<span class="term-fg32">+	if tx.Type() == types.LegacyTxType &amp;&amp; tx.IsCeloLegacy() {</span>
<span class="term-fg32">+		assert.Equal(t, false, *rpcTx.EthCompatible)</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		assert.Nil(t, rpcTx.EthCompatible)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	assert.Equal(t, (*hexutil.Big)(tx.GatewayFee()), rpcTx.GatewayFee)</span>
<span class="term-fg32">+	assert.Equal(t, tx.GatewayFeeRecipient(), rpcTx.GatewayFeeRecipient)</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-3ca347633351a4c12acf6b72" role="button"
                       aria-expanded="false" aria-controls="id-3ca347633351a4c12acf6b72">
                        <code>internal/ethapi/celo_block_receipt.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/celo_block_receipt.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+60</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-3ca347633351a4c12acf6b72"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;celo_block_receipt.go CELO&#47;internal&#47;ethapi&#47;celo_block_receipt.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..e89b3a684a9f46082248e3bdfe458cfdc2242d58</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;celo_block_receipt.go</span>
<span class="term-fg36">@@ -0,0 +1,60 @@</span>
<span class="term-fg32">+package ethapi</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;context&quot;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;core&#47;types&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; GetBlockReceipt returns &quot;system calls&quot; receipt for the block with the given block hash.</span>
<span class="term-fg32">+func (s *BlockChainAPI) GetBlockReceipt(ctx context.Context, hash common.Hash) (map[string]interface{}, error) {</span>
<span class="term-fg32">+	block, err := s.b.BlockByHash(ctx, hash)</span>
<span class="term-fg32">+	if block == nil || err != nil {</span>
<span class="term-fg32">+		&#47;&#47; If no header with that hash is found, err gives &quot;header for hash not found&quot;.</span>
<span class="term-fg32">+		&#47;&#47; But we return nil with no error, to match the behavior of eth_getBlockByHash and eth_getTransactionReceipt in these cases.</span>
<span class="term-fg32">+		return nil, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	index := block.Transactions().Len()</span>
<span class="term-fg32">+	blockNumber := block.NumberU64()</span>
<span class="term-fg32">+	receipts, err := s.b.GetReceipts(ctx, block.Hash())</span>
<span class="term-fg32">+	&#47;&#47; GetReceipts() doesn&#39;t return an error if things go wrong, so we also check len(receipts)</span>
<span class="term-fg32">+	if err != nil || len(receipts) &lt; index {</span>
<span class="term-fg32">+		return nil, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+	var receipt *types.Receipt</span>
<span class="term-fg32">+	if len(receipts) == index {</span>
<span class="term-fg32">+		&#47;&#47; The block didn&#39;t have any logs from system calls and no receipt was created.</span>
<span class="term-fg32">+		&#47;&#47; So we create an empty receipt to return, similarly to how system receipts are created.</span>
<span class="term-fg32">+		receipt = types.NewReceipt(nil, false, 0)</span>
<span class="term-fg32">+		receipt.Bloom = types.CreateBloom(types.Receipts{receipt})</span>
<span class="term-fg32">+	} else {</span>
<span class="term-fg32">+		receipt = receipts[index]</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return marshalBlockReceipt(receipt, hash, blockNumber, index), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; marshalBlockReceipt marshals a Celo block receipt into a JSON object. See https:&#47;&#47;docs.celo.org&#47;developer&#47;migrate&#47;from-ethereum#core-contract-calls</span>
<span class="term-fg32">+func marshalBlockReceipt(receipt *types.Receipt, blockHash common.Hash, blockNumber uint64, index int) map[string]interface{} {</span>
<span class="term-fg32">+	fields := map[string]interface{}{</span>
<span class="term-fg32">+		&quot;blockHash&quot;:         blockHash,</span>
<span class="term-fg32">+		&quot;blockNumber&quot;:       hexutil.Uint64(blockNumber),</span>
<span class="term-fg32">+		&quot;transactionHash&quot;:   blockHash,</span>
<span class="term-fg32">+		&quot;transactionIndex&quot;:  hexutil.Uint64(index),</span>
<span class="term-fg32">+		&quot;from&quot;:              common.Address{},</span>
<span class="term-fg32">+		&quot;to&quot;:                nil,</span>
<span class="term-fg32">+		&quot;gasUsed&quot;:           hexutil.Uint64(0),</span>
<span class="term-fg32">+		&quot;cumulativeGasUsed&quot;: hexutil.Uint64(0),</span>
<span class="term-fg32">+		&quot;contractAddress&quot;:   nil,</span>
<span class="term-fg32">+		&quot;logs&quot;:              receipt.Logs,</span>
<span class="term-fg32">+		&quot;logsBloom&quot;:         receipt.Bloom,</span>
<span class="term-fg32">+		&quot;type&quot;:              hexutil.Uint(0),</span>
<span class="term-fg32">+		&quot;status&quot;:            hexutil.Uint(types.ReceiptStatusSuccessful),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if receipt.Logs == nil {</span>
<span class="term-fg32">+		fields[&quot;logs&quot;] = []*types.Log{}</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return fields</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-22751ab2ca33e00eaf0d478a" role="button"
                       aria-expanded="false" aria-controls="id-22751ab2ca33e00eaf0d478a">
                        <code>internal/ethapi/testdata/eth_getBlockByNumber-tag-latest.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/testdata/eth_getBlockByNumber-tag-latest.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/testdata/eth_getBlockByNumber-tag-latest.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-22751ab2ca33e00eaf0d478a"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-latest.json CELO&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-latest.json</span>
<span class="term-fg1">index 6e914e37d0d3904a2da97f87baacbf6968b4d5d5..46d3034f28e2d633f2933d4e6afae3ecd0a4768f 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-latest.json</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-latest.json</span>
<span class="term-fg36">@@ -22,4 +22,4 @@</span>     &quot;0x3ee4094ca1e0b07a66dd616a057e081e53144ca7e9685a126fd4dda9ca042644&quot;
   ],
   &quot;transactionsRoot&quot;: &quot;0xb0893d21a4a44dc26a962a6e91abae66df87fb61ac9c60e936aee89c76331445&quot;,
   &quot;uncles&quot;: []
<span class="term-fg31">-}</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-19e47a58aef919ad8401caa3" role="button"
                       aria-expanded="false" aria-controls="id-19e47a58aef919ad8401caa3">
                        <code>internal/ethapi/testdata/eth_getBlockByNumber-tag-pending-fullTx.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/testdata/eth_getBlockByNumber-tag-pending-fullTx.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/testdata/eth_getBlockByNumber-tag-pending-fullTx.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+3</span></div>
                            <div class="text-start"><span class="text-danger">-2</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-19e47a58aef919ad8401caa3"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending-fullTx.json CELO&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending-fullTx.json</span>
<span class="term-fg1">index 7087932286ea7facdae1e56caf15e618b5307e71..f4b569893814aff595a31259c5ede86860e03b62 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending-fullTx.json</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending-fullTx.json</span>
<span class="term-fg36">@@ -1,7 +1,7 @@</span>
 {
   &quot;difficulty&quot;: &quot;0x0&quot;,
   &quot;extraData&quot;: &quot;0x&quot;,
<span class="term-fg31">-  &quot;gasLimit&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+  &quot;gasLimit&quot;: &quot;0xa&quot;,</span>
   &quot;gasUsed&quot;: &quot;0x0&quot;,
   &quot;hash&quot;: null,
   &quot;logsBloom&quot;: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
<span class="term-fg36">@@ -18,7 +18,7 @@</span>   &quot;timestamp&quot;: &quot;0x2a&quot;,
   &quot;totalDifficulty&quot;: null,
   &quot;transactions&quot;: [
     {
<span class="term-fg31">-      &quot;blockHash&quot;: &quot;0x6cebd9f966ea686f44b981685e3f0eacea28591a7a86d7fbbe521a86e9f81165&quot;,</span>
<span class="term-fg32">+      &quot;blockHash&quot;: &quot;0x0a6761c1616a9ef71352fa9b7169f0ca379397c73516f32f9cc5f414663b3412&quot;,</span>
       &quot;blockNumber&quot;: &quot;0xb&quot;,
       &quot;from&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,
       &quot;gas&quot;: &quot;0x457&quot;,
<span class="term-fg36">@@ -47,4 +47,4 @@</span>       &quot;amount&quot;: &quot;0xa&quot;
     }
   ],
   &quot;withdrawalsRoot&quot;: &quot;0x73d756269cdfc22e7e17a3548e36f42f750ca06d7e3cd98d1b6d0eb5add9dc84&quot;
<span class="term-fg31">-}</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-846643d1e88c50e2b45dbcd2" role="button"
                       aria-expanded="false" aria-controls="id-846643d1e88c50e2b45dbcd2">
                        <code>internal/ethapi/testdata/eth_getBlockByNumber-tag-pending.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/testdata/eth_getBlockByNumber-tag-pending.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/testdata/eth_getBlockByNumber-tag-pending.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-846643d1e88c50e2b45dbcd2"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending.json CELO&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending.json</span>
<span class="term-fg1">index c0e2b07bb8aa78eba79fd1896a451092dc8f47ad..688c8e8ff6f6ec3fee9bbb602194dec85f1c6c10 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending.json</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending.json</span>
<span class="term-fg36">@@ -1,7 +1,7 @@</span>
 {
   &quot;difficulty&quot;: &quot;0x0&quot;,
   &quot;extraData&quot;: &quot;0x&quot;,
<span class="term-fg31">-  &quot;gasLimit&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+  &quot;gasLimit&quot;: &quot;0xa&quot;,</span>
   &quot;gasUsed&quot;: &quot;0x0&quot;,
   &quot;hash&quot;: null,
   &quot;logsBloom&quot;: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
<span class="term-fg36">@@ -30,4 +30,4 @@</span>       &quot;amount&quot;: &quot;0xa&quot;
     }
   ],
   &quot;withdrawalsRoot&quot;: &quot;0x73d756269cdfc22e7e17a3548e36f42f750ca06d7e3cd98d1b6d0eb5add9dc84&quot;
<span class="term-fg31">-}</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-9bffa1ee15edbbaa28e9c3a2" role="button"
                       aria-expanded="false" aria-controls="id-9bffa1ee15edbbaa28e9c3a2">
                        <code>internal/ethapi/testdata/eth_getHeaderByNumber-tag-pending.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/testdata/eth_getHeaderByNumber-tag-pending.json" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/testdata/eth_getHeaderByNumber-tag-pending.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-9bffa1ee15edbbaa28e9c3a2"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;testdata&#47;eth_getHeaderByNumber-tag-pending.json CELO&#47;internal&#47;ethapi&#47;testdata&#47;eth_getHeaderByNumber-tag-pending.json</span>
<span class="term-fg1">index da177f2189282f081feea19c570f81cfff3254d7..35d27ef88b60e6ccbef62b599bd7c8e27ed9cfcd 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;testdata&#47;eth_getHeaderByNumber-tag-pending.json</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;testdata&#47;eth_getHeaderByNumber-tag-pending.json</span>
<span class="term-fg36">@@ -1,7 +1,7 @@</span>
 {
   &quot;difficulty&quot;: &quot;0x0&quot;,
   &quot;extraData&quot;: &quot;0x&quot;,
<span class="term-fg31">-  &quot;gasLimit&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+  &quot;gasLimit&quot;: &quot;0xa&quot;,</span>
   &quot;gasUsed&quot;: &quot;0x0&quot;,
   &quot;hash&quot;: null,
   &quot;logsBloom&quot;: &quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,
<span class="term-fg36">@@ -17,4 +17,4 @@</span>   &quot;timestamp&quot;: &quot;0x2a&quot;,
   &quot;totalDifficulty&quot;: null,
   &quot;transactionsRoot&quot;: &quot;0x98d9f6dd0aa479c0fb448f2627e9f1964aca699fccab8f6e95861547a4699e37&quot;,
   &quot;withdrawalsRoot&quot;: &quot;0x73d756269cdfc22e7e17a3548e36f42f750ca06d7e3cd98d1b6d0eb5add9dc84&quot;
<span class="term-fg31">-}</span>
<span class="term-fg31">\ No newline at end of file</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-71f483ea7f0594876ea5f6c4" role="button"
                       aria-expanded="false" aria-controls="id-71f483ea7f0594876ea5f6c4">
                        <code>internal/ethapi/transaction_args.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/transaction_args.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/transaction_args.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+122</span></div>
                            <div class="text-start"><span class="text-danger">-20</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-71f483ea7f0594876ea5f6c4"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;transaction_args.go CELO&#47;internal&#47;ethapi&#47;transaction_args.go</span>
<span class="term-fg1">index bae1c68641594887b4a800c0f7bfd6af58326ecf..5026761ee36c9161bd51ece98b1eb599f683131d 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;transaction_args.go</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;transaction_args.go</span>
<span class="term-fg36">@@ -25,6 +25,7 @@</span> 	&quot;fmt&quot;
 	&quot;math&#47;big&quot;
&nbsp;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;exchange&quot;</span>
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;hexutil&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&#47;math&quot;
 	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;consensus&#47;misc&#47;eip4844&quot;
<span class="term-fg36">@@ -74,6 +75,10 @@</span> 	Proofs      []kzg4844.Proof      `json:&quot;proofs&quot;`
&nbsp;
 	&#47;&#47; This configures whether blobs are allowed to be passed.
 	blobSidecarAllowed bool
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo specific:</span>
<span class="term-fg32">+	FeeCurrency         *common.Address `json:&quot;feeCurrency,omitempty&quot;`         &#47;&#47; CIP-64, CIP-66</span>
<span class="term-fg32">+	MaxFeeInFeeCurrency *hexutil.Big    `json:&quot;maxFeeInFeeCurrency,omitempty&quot;` &#47;&#47; CIP-66</span>
 }
&nbsp;
 &#47;&#47; from retrieves the transaction sender address.
<span class="term-fg36">@@ -96,7 +101,7 @@</span> 	return nil
 }
&nbsp;
 &#47;&#47; setDefaults fills in default values for unspecified tx fields.
<span class="term-fg31">-func (args *TransactionArgs) setDefaults(ctx context.Context, b Backend, skipGasEstimation bool) error {</span>
<span class="term-fg32">+func (args *TransactionArgs) setDefaults(ctx context.Context, b CeloBackend, skipGasEstimation bool) error {</span>
 	if err := args.setBlobTxSidecar(ctx, b); err != nil {
 		return err
 	}
<span class="term-fg36">@@ -158,6 +163,9 @@</span> 				Data:                 (*hexutil.Bytes)(&amp;data),
 				AccessList:           args.AccessList,
 				BlobFeeCap:           args.BlobFeeCap,
 				BlobHashes:           args.BlobHashes,
<span class="term-fg32">+</span>
<span class="term-fg32">+				FeeCurrency:         args.FeeCurrency,</span>
<span class="term-fg32">+				MaxFeeInFeeCurrency: args.MaxFeeInFeeCurrency,</span>
 			}
 			latestBlockNr := rpc.BlockNumberOrHashWithNumber(rpc.LatestBlockNumber)
 			estimated, err := DoEstimateGas(ctx, b, callArgs, latestBlockNr, nil, b.RPCGasCap())
<span class="term-fg36">@@ -183,7 +191,7 @@</span> 	return nil
 }
&nbsp;
 &#47;&#47; setFeeDefaults fills in default fee values for unspecified tx fields.
<span class="term-fg31">-func (args *TransactionArgs) setFeeDefaults(ctx context.Context, b Backend) error {</span>
<span class="term-fg32">+func (args *TransactionArgs) setFeeDefaults(ctx context.Context, b CeloBackend) error {</span>
 	head := b.CurrentHeader()
 	&#47;&#47; Sanity check the EIP-4844 fee parameters.
 	if args.BlobFeeCap != nil &amp;&amp; args.BlobFeeCap.ToInt().Sign() == 0 {
<span class="term-fg36">@@ -201,6 +209,10 @@</span> 	&#47;&#47; This allows users who are not yet synced past London to get defaults for
 	&#47;&#47; other tx values. See https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum&#47;pull&#47;23274
 	&#47;&#47; for more information.
 	eip1559ParamsSet := args.MaxFeePerGas != nil &amp;&amp; args.MaxPriorityFeePerGas != nil
<span class="term-fg32">+</span>
<span class="term-fg32">+	if args.MaxFeeInFeeCurrency != nil &amp;&amp; args.FeeCurrency == nil {</span>
<span class="term-fg32">+		return errors.New(&quot;feeCurrency must be set when maxFeeInFeeCurrency is given&quot;)</span>
<span class="term-fg32">+	}</span>
 	&#47;&#47; Sanity check the EIP-1559 fee parameters if present.
 	if args.GasPrice == nil &amp;&amp; eip1559ParamsSet {
 		if args.MaxFeePerGas.ToInt().Sign() == 0 {
<span class="term-fg36">@@ -243,7 +255,7 @@</span> 	return nil
 }
&nbsp;
 &#47;&#47; setCancunFeeDefaults fills in reasonable default fee values for unspecified fields.
<span class="term-fg31">-func (args *TransactionArgs) setCancunFeeDefaults(ctx context.Context, head *types.Header, b Backend) error {</span>
<span class="term-fg32">+func (args *TransactionArgs) setCancunFeeDefaults(ctx context.Context, head *types.Header, b CeloBackend) error {</span>
 	&#47;&#47; Set maxFeePerBlobGas if it is missing.
 	if args.BlobHashes != nil &amp;&amp; args.BlobFeeCap == nil {
 		var excessBlobGas uint64
<span class="term-fg36">@@ -252,6 +264,20 @@</span> 			excessBlobGas = *head.ExcessBlobGas
 		}
 		&#47;&#47; ExcessBlobGas must be set for a Cancun block.
 		blobBaseFee := eip4844.CalcBlobFee(excessBlobGas)
<span class="term-fg32">+		if args.IsFeeCurrencyDenominated() {</span>
<span class="term-fg32">+			&#47;&#47; wether the blob-fee will be used like that in Cel2 or not,</span>
<span class="term-fg32">+			&#47;&#47; at least this keeps it consistent with the rest of the gas-fees</span>
<span class="term-fg32">+			var err error</span>
<span class="term-fg32">+			blobBaseFee, err = b.ConvertToCurrency(</span>
<span class="term-fg32">+				ctx,</span>
<span class="term-fg32">+				rpc.BlockNumberOrHashWithHash(head.Hash(), false),</span>
<span class="term-fg32">+				blobBaseFee,</span>
<span class="term-fg32">+				args.FeeCurrency,</span>
<span class="term-fg32">+			)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return fmt.Errorf(&quot;can&#39;t convert blob-fee to fee-currency: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
 		&#47;&#47; Set the max fee to be 2 times larger than the previous block&#39;s blob base fee.
 		&#47;&#47; The additional slack allows the tx to not become invalidated if the base
 		&#47;&#47; fee is rising.
<span class="term-fg36">@@ -262,13 +288,24 @@</span> 	return nil
 }
&nbsp;
 &#47;&#47; setLondonFeeDefaults fills in reasonable default fee values for unspecified fields.
<span class="term-fg31">-func (args *TransactionArgs) setLondonFeeDefaults(ctx context.Context, head *types.Header, b Backend) error {</span>
<span class="term-fg32">+func (args *TransactionArgs) setLondonFeeDefaults(ctx context.Context, head *types.Header, b CeloBackend) error {</span>
 	&#47;&#47; Set maxPriorityFeePerGas if it is missing.
 	if args.MaxPriorityFeePerGas == nil {
 		tip, err := b.SuggestGasTipCap(ctx)
 		if err != nil {
 			return err
 		}
<span class="term-fg32">+		if args.IsFeeCurrencyDenominated() {</span>
<span class="term-fg32">+			tip, err = b.ConvertToCurrency(</span>
<span class="term-fg32">+				ctx,</span>
<span class="term-fg32">+				rpc.BlockNumberOrHashWithHash(head.Hash(), false),</span>
<span class="term-fg32">+				tip,</span>
<span class="term-fg32">+				args.FeeCurrency,</span>
<span class="term-fg32">+			)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return fmt.Errorf(&quot;can&#39;t convert suggested gasTipCap to fee-currency: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
 		args.MaxPriorityFeePerGas = (*hexutil.Big)(tip)
 	}
 	&#47;&#47; Set maxFeePerGas if it is missing.
<span class="term-fg36">@@ -276,9 +313,22 @@</span> 	if args.MaxFeePerGas == nil {
 		&#47;&#47; Set the max fee to be 2 times larger than the previous block&#39;s base fee.
 		&#47;&#47; The additional slack allows the tx to not become invalidated if the base
 		&#47;&#47; fee is rising.
<span class="term-fg32">+		baseFee := head.BaseFee</span>
<span class="term-fg32">+		if args.IsFeeCurrencyDenominated() {</span>
<span class="term-fg32">+			var err error</span>
<span class="term-fg32">+			baseFee, err = b.ConvertToCurrency(</span>
<span class="term-fg32">+				ctx,</span>
<span class="term-fg32">+				rpc.BlockNumberOrHashWithHash(head.Hash(), false),</span>
<span class="term-fg32">+				baseFee,</span>
<span class="term-fg32">+				args.FeeCurrency,</span>
<span class="term-fg32">+			)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				return fmt.Errorf(&quot;can&#39;t convert base-fee to fee-currency: %w&quot;, err)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		}</span>
 		val := new(big.Int).Add(
 			args.MaxPriorityFeePerGas.ToInt(),
<span class="term-fg31">-			new(big.Int).Mul(head.BaseFee, big.NewInt(2)),</span>
<span class="term-fg32">+			new(big.Int).Mul(baseFee, big.NewInt(2)),</span>
 		)
 		args.MaxFeePerGas = (*hexutil.Big)(val)
 	}
<span class="term-fg36">@@ -367,7 +417,7 @@</span>
 &#47;&#47; ToMessage converts the transaction arguments to the Message type used by the
 &#47;&#47; core evm. This method is used in calls and traces that do not require a real
 &#47;&#47; live transaction.
<span class="term-fg31">-func (args *TransactionArgs) ToMessage(globalGasCap uint64, baseFee *big.Int) (*core.Message, error) {</span>
<span class="term-fg32">+func (args *TransactionArgs) ToMessage(globalGasCap uint64, baseFee *big.Int, exchangeRates common.ExchangeRates) (*core.Message, error) {</span>
 	&#47;&#47; Reject invalid combinations of pre- and post-1559 fee styles
 	if args.GasPrice != nil &amp;&amp; (args.MaxFeePerGas != nil || args.MaxPriorityFeePerGas != nil) {
 		return nil, errors.New(&quot;both gasPrice and (maxFeePerGas or maxPriorityFeePerGas) specified&quot;)
<span class="term-fg36">@@ -388,10 +438,11 @@</span> 		log.Warn(&quot;Caller gas above allowance, capping&quot;, &quot;requested&quot;, gas, &quot;cap&quot;, globalGasCap)
 		gas = globalGasCap
 	}
 	var (
<span class="term-fg31">-		gasPrice   *big.Int</span>
<span class="term-fg31">-		gasFeeCap  *big.Int</span>
<span class="term-fg31">-		gasTipCap  *big.Int</span>
<span class="term-fg31">-		blobFeeCap *big.Int</span>
<span class="term-fg32">+		gasPrice            *big.Int</span>
<span class="term-fg32">+		gasFeeCap           *big.Int</span>
<span class="term-fg32">+		gasTipCap           *big.Int</span>
<span class="term-fg32">+		blobFeeCap          *big.Int</span>
<span class="term-fg32">+		maxFeeInFeeCurrency *big.Int</span>
 	)
 	if baseFee == nil {
 		&#47;&#47; If there&#39;s no basefee, then it must be a non-1559 execution
<span class="term-fg36">@@ -419,6 +470,13 @@</span> 			}
 			&#47;&#47; Backfill the legacy gasPrice for EVM execution, unless we&#39;re all zeroes
 			gasPrice = new(big.Int)
 			if gasFeeCap.BitLen() &gt; 0 || gasTipCap.BitLen() &gt; 0 {
<span class="term-fg32">+				if args.IsFeeCurrencyDenominated() {</span>
<span class="term-fg32">+					var err error</span>
<span class="term-fg32">+					baseFee, err = exchange.ConvertCeloToCurrency(exchangeRates, args.FeeCurrency, baseFee)</span>
<span class="term-fg32">+					if err != nil {</span>
<span class="term-fg32">+						return nil, fmt.Errorf(&quot;can&#39;t convert base-fee to fee-currency: %w&quot;, err)</span>
<span class="term-fg32">+					}</span>
<span class="term-fg32">+				}</span>
 				gasPrice = math.BigMin(new(big.Int).Add(gasTipCap, baseFee), gasFeeCap)
 			}
 		}
<span class="term-fg36">@@ -437,6 +495,9 @@</span> 	var accessList types.AccessList
 	if args.AccessList != nil {
 		accessList = *args.AccessList
 	}
<span class="term-fg32">+	if args.MaxFeeInFeeCurrency != nil {</span>
<span class="term-fg32">+		maxFeeInFeeCurrency = args.MaxFeeInFeeCurrency.ToInt()</span>
<span class="term-fg32">+	}</span>
 	msg := &amp;core.Message{
 		From:              addr,
 		To:                args.To,
<span class="term-fg36">@@ -450,6 +511,9 @@</span> 		AccessList:        accessList,
 		BlobGasFeeCap:     blobFeeCap,
 		BlobHashes:        args.BlobHashes,
 		SkipAccountChecks: true,
<span class="term-fg32">+		&#47;&#47; Celo specific:</span>
<span class="term-fg32">+		FeeCurrency:         args.FeeCurrency,</span>
<span class="term-fg32">+		MaxFeeInFeeCurrency: maxFeeInFeeCurrency,</span>
 	}
 	return msg, nil
 }
<span class="term-fg36">@@ -490,16 +554,47 @@</span> 		al := types.AccessList{}
 		if args.AccessList != nil {
 			al = *args.AccessList
 		}
<span class="term-fg31">-		data = &amp;types.DynamicFeeTx{</span>
<span class="term-fg31">-			To:         args.To,</span>
<span class="term-fg31">-			ChainID:    (*big.Int)(args.ChainID),</span>
<span class="term-fg31">-			Nonce:      uint64(*args.Nonce),</span>
<span class="term-fg31">-			Gas:        uint64(*args.Gas),</span>
<span class="term-fg31">-			GasFeeCap:  (*big.Int)(args.MaxFeePerGas),</span>
<span class="term-fg31">-			GasTipCap:  (*big.Int)(args.MaxPriorityFeePerGas),</span>
<span class="term-fg31">-			Value:      (*big.Int)(args.Value),</span>
<span class="term-fg31">-			Data:       args.data(),</span>
<span class="term-fg31">-			AccessList: al,</span>
<span class="term-fg32">+		if args.FeeCurrency != nil {</span>
<span class="term-fg32">+			if args.IsFeeCurrencyDenominated() {</span>
<span class="term-fg32">+				data = &amp;types.CeloDynamicFeeTxV2{</span>
<span class="term-fg32">+					To:          args.To,</span>
<span class="term-fg32">+					ChainID:     (*big.Int)(args.ChainID),</span>
<span class="term-fg32">+					Nonce:       uint64(*args.Nonce),</span>
<span class="term-fg32">+					Gas:         uint64(*args.Gas),</span>
<span class="term-fg32">+					GasFeeCap:   (*big.Int)(args.MaxFeePerGas),</span>
<span class="term-fg32">+					GasTipCap:   (*big.Int)(args.MaxPriorityFeePerGas),</span>
<span class="term-fg32">+					Value:       (*big.Int)(args.Value),</span>
<span class="term-fg32">+					Data:        args.data(),</span>
<span class="term-fg32">+					AccessList:  al,</span>
<span class="term-fg32">+					FeeCurrency: args.FeeCurrency,</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			} else {</span>
<span class="term-fg32">+				data = &amp;types.CeloDenominatedTx{</span>
<span class="term-fg32">+					To:                  args.To,</span>
<span class="term-fg32">+					ChainID:             (*big.Int)(args.ChainID),</span>
<span class="term-fg32">+					Nonce:               uint64(*args.Nonce),</span>
<span class="term-fg32">+					Gas:                 uint64(*args.Gas),</span>
<span class="term-fg32">+					GasFeeCap:           (*big.Int)(args.MaxFeePerGas),</span>
<span class="term-fg32">+					GasTipCap:           (*big.Int)(args.MaxPriorityFeePerGas),</span>
<span class="term-fg32">+					Value:               (*big.Int)(args.Value),</span>
<span class="term-fg32">+					Data:                args.data(),</span>
<span class="term-fg32">+					AccessList:          al,</span>
<span class="term-fg32">+					FeeCurrency:         args.FeeCurrency,</span>
<span class="term-fg32">+					MaxFeeInFeeCurrency: (*big.Int)(args.MaxFeeInFeeCurrency),</span>
<span class="term-fg32">+				}</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		} else {</span>
<span class="term-fg32">+			data = &amp;types.DynamicFeeTx{</span>
<span class="term-fg32">+				To:         args.To,</span>
<span class="term-fg32">+				ChainID:    (*big.Int)(args.ChainID),</span>
<span class="term-fg32">+				Nonce:      uint64(*args.Nonce),</span>
<span class="term-fg32">+				Gas:        uint64(*args.Gas),</span>
<span class="term-fg32">+				GasFeeCap:  (*big.Int)(args.MaxFeePerGas),</span>
<span class="term-fg32">+				GasTipCap:  (*big.Int)(args.MaxPriorityFeePerGas),</span>
<span class="term-fg32">+				Value:      (*big.Int)(args.Value),</span>
<span class="term-fg32">+				Data:       args.data(),</span>
<span class="term-fg32">+				AccessList: al,</span>
<span class="term-fg32">+			}</span>
 		}
&nbsp;
 	case args.AccessList != nil:
<span class="term-fg36">@@ -531,3 +626,10 @@</span> &#47;&#47; IsEIP4844 returns an indicator if the args contains EIP4844 fields.
 func (args *TransactionArgs) IsEIP4844() bool {
 	return args.BlobHashes != nil || args.BlobFeeCap != nil
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; IsFeeCurrencyDenominated returns whether the gas-price related</span>
<span class="term-fg32">+&#47;&#47; fields are denominated in a given fee currency or in the native token.</span>
<span class="term-fg32">+&#47;&#47; This effectively is only true for CIP-64 transactions.</span>
<span class="term-fg32">+func (args *TransactionArgs) IsFeeCurrencyDenominated() bool {</span>
<span class="term-fg32">+	return args.FeeCurrency != nil &amp;&amp; args.MaxFeeInFeeCurrency == nil</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5ba61fef84f9bcc5453edcfb" role="button"
                       aria-expanded="false" aria-controls="id-5ba61fef84f9bcc5453edcfb">
                        <code>internal/ethapi/transaction_args_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/internal/ethapi/transaction_args_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/internal/ethapi/transaction_args_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+74</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5ba61fef84f9bcc5453edcfb"><span class="term-fg1">diff --git op-geth&#47;internal&#47;ethapi&#47;transaction_args_test.go CELO&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg1">index f98683baca5290c91bb1ad1c1405f0e688c006c5..1672f07059924a893834a35943bc95dc25f5883b 100644</span>
<span class="term-fg1">--- op-geth&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg1">+++ CELO&#47;internal&#47;ethapi&#47;transaction_args_test.go</span>
<span class="term-fg36">@@ -51,11 +51,14 @@</span> 		err  error
 	}
&nbsp;
 	var (
<span class="term-fg31">-		b        = newBackendMock()</span>
<span class="term-fg31">-		zero     = (*hexutil.Big)(big.NewInt(0))</span>
<span class="term-fg31">-		fortytwo = (*hexutil.Big)(big.NewInt(42))</span>
<span class="term-fg31">-		maxFee   = (*hexutil.Big)(new(big.Int).Add(new(big.Int).Mul(b.current.BaseFee, big.NewInt(2)), fortytwo.ToInt()))</span>
<span class="term-fg31">-		al       = &amp;types.AccessList{types.AccessTuple{Address: common.Address{0xaa}, StorageKeys: []common.Hash{{0x01}}}}</span>
<span class="term-fg32">+		b            = newCeloBackendMock()</span>
<span class="term-fg32">+		zero         = (*hexutil.Big)(big.NewInt(0))</span>
<span class="term-fg32">+		fortytwo     = (*hexutil.Big)(big.NewInt(42))</span>
<span class="term-fg32">+		maxFee       = (*hexutil.Big)(new(big.Int).Add(new(big.Int).Mul(b.current.BaseFee, big.NewInt(2)), fortytwo.ToInt()))</span>
<span class="term-fg32">+		al           = &amp;types.AccessList{types.AccessTuple{Address: common.Address{0xaa}, StorageKeys: []common.Hash{{0x01}}}}</span>
<span class="term-fg32">+		feeCurrency  = common.BigToAddress(big.NewInt(42))</span>
<span class="term-fg32">+		eightyfour   = (*hexutil.Big)(big.NewInt(84))</span>
<span class="term-fg32">+		doubleMaxFee = (*hexutil.Big)(new(big.Int).Mul(maxFee.ToInt(), big.NewInt(2)))</span>
 	)
&nbsp;
 	tests := []test{
<span class="term-fg36">@@ -228,6 +231,37 @@</span> 			&amp;TransactionArgs{BlobHashes: []common.Hash{}, MaxFeePerGas: maxFee, MaxPriorityFeePerGas: fortytwo},
 			&amp;TransactionArgs{BlobHashes: []common.Hash{}, BlobFeeCap: (*hexutil.Big)(big.NewInt(4)), MaxFeePerGas: maxFee, MaxPriorityFeePerGas: fortytwo},
 			nil,
 		},
<span class="term-fg32">+		&#47;&#47; CIP-64</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			&quot;Fee-currency denominated tx, set maxPriorityFeePerGas in converted valued&quot;,</span>
<span class="term-fg32">+			&quot;cancun&quot;,</span>
<span class="term-fg32">+			&amp;TransactionArgs{MaxFeePerGas: doubleMaxFee, FeeCurrency: &amp;feeCurrency},</span>
<span class="term-fg32">+			&#47;&#47; maxPriorityFeePerGas is double in feeCurrency</span>
<span class="term-fg32">+			&amp;TransactionArgs{MaxFeePerGas: doubleMaxFee, MaxPriorityFeePerGas: eightyfour, FeeCurrency: &amp;feeCurrency},</span>
<span class="term-fg32">+			nil,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			&quot;Fee-currency denominated tx, set maxFeePerGas in converted valued&quot;,</span>
<span class="term-fg32">+			&quot;cancun&quot;,</span>
<span class="term-fg32">+			&amp;TransactionArgs{MaxPriorityFeePerGas: eightyfour, FeeCurrency: &amp;feeCurrency},</span>
<span class="term-fg32">+			&amp;TransactionArgs{MaxFeePerGas: doubleMaxFee, MaxPriorityFeePerGas: eightyfour, FeeCurrency: &amp;feeCurrency},</span>
<span class="term-fg32">+			nil,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		&#47;&#47; CIP-66</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			&quot;CIP-66 transaction, maxPriorityFeePerGas gets set in non-converted value&quot;,</span>
<span class="term-fg32">+			&quot;cancun&quot;,</span>
<span class="term-fg32">+			&amp;TransactionArgs{MaxFeePerGas: maxFee, MaxFeeInFeeCurrency: fortytwo, FeeCurrency: &amp;feeCurrency},</span>
<span class="term-fg32">+			&amp;TransactionArgs{MaxFeePerGas: maxFee, MaxPriorityFeePerGas: fortytwo, MaxFeeInFeeCurrency: fortytwo, FeeCurrency: &amp;feeCurrency},</span>
<span class="term-fg32">+			nil,</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			&quot;set maxFeeInFeeCurrency without feeCurrency&quot;,</span>
<span class="term-fg32">+			&quot;cancun&quot;,</span>
<span class="term-fg32">+			&amp;TransactionArgs{MaxFeePerGas: maxFee, MaxPriorityFeePerGas: fortytwo, MaxFeeInFeeCurrency: fortytwo},</span>
<span class="term-fg32">+			nil,</span>
<span class="term-fg32">+			errors.New(&quot;feeCurrency must be set when maxFeeInFeeCurrency is given&quot;),</span>
<span class="term-fg32">+		},</span>
 	}
&nbsp;
 	ctx := context.Background()
<span class="term-fg36">@@ -252,6 +286,41 @@</span> 		if !reflect.DeepEqual(got, test.want) {
 			t.Fatalf(&quot;test %d (%s): did not fill defaults as expected: (got: %v, want: %v)&quot;, i, test.name, got, test.want)
 		}
 	}
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+type celoBackendMock struct {</span>
<span class="term-fg32">+	*backendMock</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func newCeloBackendMock() *celoBackendMock {</span>
<span class="term-fg32">+	return &amp;celoBackendMock{</span>
<span class="term-fg32">+		backendMock: newBackendMock(),</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoBackendMock) GetFeeBalance(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, account common.Address, feeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	&#47;&#47; Celo specific backend features are currently not tested</span>
<span class="term-fg32">+	return nil, errCeloNotImplemented</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoBackendMock) GetExchangeRates(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash) (common.ExchangeRates, error) {</span>
<span class="term-fg32">+	var er common.ExchangeRates</span>
<span class="term-fg32">+	&#47;&#47; This Celo specific backend features are currently not tested</span>
<span class="term-fg32">+	return er, errCeloNotImplemented</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoBackendMock) ConvertToCurrency(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, value *big.Int, fromFeeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	if fromFeeCurrency == nil {</span>
<span class="term-fg32">+		return value, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return new(big.Int).Mul(value, big.NewInt(2)), nil</span>
<span class="term-fg32">+}</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+func (c *celoBackendMock) ConvertToCelo(ctx context.Context, blockNumOrHash rpc.BlockNumberOrHash, value *big.Int, toFeeCurrency *common.Address) (*big.Int, error) {</span>
<span class="term-fg32">+	if toFeeCurrency == nil {</span>
<span class="term-fg32">+		return value, nil</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return new(big.Int).Div(value, big.NewInt(2)), nil</span>
 }
&nbsp;
 type backendMock struct {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-b14be08259fadc6916426f56" role="button"
                       aria-expanded="false" aria-controls="id-b14be08259fadc6916426f56">
                        <code>metrics/influxdb/influxdb_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/metrics/influxdb/influxdb_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/metrics/influxdb/influxdb_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+9</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-b14be08259fadc6916426f56"><span class="term-fg1">diff --git op-geth&#47;metrics&#47;influxdb&#47;influxdb_test.go CELO&#47;metrics&#47;influxdb&#47;influxdb_test.go</span>
<span class="term-fg1">index c6f2eeac62771186603424165133a5dc884a8f8d..5879af7cf6a7bbf628a22a4ef08899e99ffc20d6 100644</span>
<span class="term-fg1">--- op-geth&#47;metrics&#47;influxdb&#47;influxdb_test.go</span>
<span class="term-fg1">+++ CELO&#47;metrics&#47;influxdb&#47;influxdb_test.go</span>
<span class="term-fg36">@@ -23,6 +23,7 @@</span> 	&quot;net&#47;http&quot;
 	&quot;net&#47;http&#47;httptest&quot;
 	&quot;net&#47;url&quot;
 	&quot;os&quot;
<span class="term-fg32">+	&quot;runtime&quot;</span>
 	&quot;strings&quot;
 	&quot;testing&quot;
&nbsp;
<span class="term-fg36">@@ -37,6 +38,10 @@</span> 	os.Exit(m.Run())
 }
&nbsp;
 func TestExampleV1(t *testing.T) {
<span class="term-fg32">+	if runtime.GOARCH == &quot;arm64&quot; {</span>
<span class="term-fg32">+		t.Skip(&quot;test skipped on ARM64 due to floating point precision differences&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	r := internal.ExampleMetrics()
 	var have, want string
 	ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {
<span class="term-fg36">@@ -69,6 +74,10 @@</span> 	}
 }
&nbsp;
 func TestExampleV2(t *testing.T) {
<span class="term-fg32">+	if runtime.GOARCH == &quot;arm64&quot; {</span>
<span class="term-fg32">+		t.Skip(&quot;test skipped on ARM64 due to floating point precision differences&quot;)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+</span>
 	r := internal.ExampleMetrics()
 	var have, want string
 	ts := httptest.NewServer(http.HandlerFunc(func(w http.ResponseWriter, r *http.Request) {</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-7331a67971056992fea2f978" role="button"
                       aria-expanded="false" aria-controls="id-7331a67971056992fea2f978">
                        <code>miner/celo_defaults.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/miner/celo_defaults.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+29</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-7331a67971056992fea2f978"><span class="term-fg1">diff --git op-geth&#47;miner&#47;celo_defaults.go CELO&#47;miner&#47;celo_defaults.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..be843d1bc991fcbf6fa80bf4b291617e110d0716</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;miner&#47;celo_defaults.go</span>
<span class="term-fg36">@@ -0,0 +1,29 @@</span>
<span class="term-fg32">+package miner</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+import (</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;common&quot;</span>
<span class="term-fg32">+	&quot;github.com&#47;ethereum&#47;go-ethereum&#47;params&quot;</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; cStables addresses on mainnet</span>
<span class="term-fg32">+var (</span>
<span class="term-fg32">+	cUSD_TOKEN  = common.HexToAddress(&quot;0x765DE816845861e75A25fCA122bb6898B8B1282a&quot;)</span>
<span class="term-fg32">+	cEUR_TOKEN  = common.HexToAddress(&quot;0xD8763CBa276a3738E6DE85b4b3bF5FDed6D6cA73&quot;)</span>
<span class="term-fg32">+	cREAL_TOKEN = common.HexToAddress(&quot;0xe8537a3d056DA446677B9E9d6c5dB704EaAb4787&quot;)</span>
<span class="term-fg32">+	USDC_TOKEN  = common.HexToAddress(&quot;0xcebA9300f2b948710d2653dD7B07f33A8B32118C&quot;)</span>
<span class="term-fg32">+	USDT_TOKEN  = common.HexToAddress(&quot;0x48065fbBE25f71C9282ddf5e1cD6D6A887483D5e&quot;)</span>
<span class="term-fg32">+)</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; default limits default fraction</span>
<span class="term-fg32">+const DefaultFeeCurrencyLimit = 0.5</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; default limits configuration</span>
<span class="term-fg32">+var DefaultFeeCurrencyLimits = map[uint64]map[common.Address]float64{</span>
<span class="term-fg32">+	params.CeloMainnetChainID: {</span>
<span class="term-fg32">+		cUSD_TOKEN:  0.9,</span>
<span class="term-fg32">+		USDT_TOKEN:  0.9,</span>
<span class="term-fg32">+		USDC_TOKEN:  0.9,</span>
<span class="term-fg32">+		cEUR_TOKEN:  0.5,</span>
<span class="term-fg32">+		cREAL_TOKEN: 0.5,</span>
<span class="term-fg32">+	},</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-812ed8ad047e7de15ed42979" role="button"
                       aria-expanded="false" aria-controls="id-812ed8ad047e7de15ed42979">
                        <code>miner/miner.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/miner/miner.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/miner/miner.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+6</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-812ed8ad047e7de15ed42979"><span class="term-fg1">diff --git op-geth&#47;miner&#47;miner.go CELO&#47;miner&#47;miner.go</span>
<span class="term-fg1">index 85b3d8d13d58582f442ca17798122c83b5946aca..2b9c1a416cc3c47e147a0035fbc3c5f7afac5169 100644</span>
<span class="term-fg1">--- op-geth&#47;miner&#47;miner.go</span>
<span class="term-fg1">+++ CELO&#47;miner&#47;miner.go</span>
<span class="term-fg36">@@ -62,6 +62,10 @@</span> 	NewPayloadTimeout time.Duration &#47;&#47; The maximum time allowance for creating a new payload
&nbsp;
 	RollupComputePendingBlock bool   &#47;&#47; Compute the pending block from tx-pool, instead of copying the latest-block
 	EffectiveGasCeil          uint64 &#47;&#47; if non-zero, a gas ceiling to apply independent of the header&#39;s gaslimit value
<span class="term-fg32">+</span>
<span class="term-fg32">+	&#47;&#47; Celo:</span>
<span class="term-fg32">+	FeeCurrencyDefault float64                    &#47;&#47; Default fraction of block gas limit</span>
<span class="term-fg32">+	FeeCurrencyLimits  map[common.Address]float64 &#47;&#47; Fee currency-to-limit fraction mapping</span>
 }
&nbsp;
 &#47;&#47; DefaultConfig contains default settings for miner.
<span class="term-fg36">@@ -75,6 +79,8 @@</span> 	&#47;&#47; for payload generation. It should be enough for Geth to
 	&#47;&#47; run 3 rounds.
 	Recommit:          2 * time.Second,
 	NewPayloadTimeout: 2 * time.Second,
<span class="term-fg32">+</span>
<span class="term-fg32">+	FeeCurrencyDefault: DefaultFeeCurrencyLimit,</span>
 }
&nbsp;
 &#47;&#47; Miner creates blocks and searches for proof-of-work values.</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-ae7ba4b7c81a87d17126766d" role="button"
                       aria-expanded="false" aria-controls="id-ae7ba4b7c81a87d17126766d">
                        <code>miner/worker.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/miner/worker.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/miner/worker.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+60</span></div>
                            <div class="text-start"><span class="text-danger">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-ae7ba4b7c81a87d17126766d"><span class="term-fg1">diff --git op-geth&#47;miner&#47;worker.go CELO&#47;miner&#47;worker.go</span>
<span class="term-fg1">index a69e5644105f19ff1f2a59ee11fd0da493c27181..71210f016b92edb17c242e598c2e635fcd3c27c3 100644</span>
<span class="term-fg1">--- op-geth&#47;miner&#47;worker.go</span>
<span class="term-fg1">+++ CELO&#47;miner&#47;worker.go</span>
<span class="term-fg36">@@ -87,11 +87,13 @@</span>
 &#47;&#47; environment is the worker&#39;s current environment and holds all
 &#47;&#47; information of the sealing block generation.
 type environment struct {
<span class="term-fg31">-	signer   types.Signer</span>
<span class="term-fg31">-	state    *state.StateDB &#47;&#47; apply state changes here</span>
<span class="term-fg31">-	tcount   int            &#47;&#47; tx count in cycle</span>
<span class="term-fg31">-	gasPool  *core.GasPool  &#47;&#47; available gas used to pack transactions</span>
<span class="term-fg31">-	coinbase common.Address</span>
<span class="term-fg32">+	signer               types.Signer</span>
<span class="term-fg32">+	state                *state.StateDB     &#47;&#47; apply state changes here</span>
<span class="term-fg32">+	tcount               int                &#47;&#47; tx count in cycle</span>
<span class="term-fg32">+	gasPool              *core.GasPool      &#47;&#47; available gas used to pack transactions</span>
<span class="term-fg32">+	multiGasPool         *core.MultiGasPool &#47;&#47; available per-fee-currency gas used to pack transactions</span>
<span class="term-fg32">+	feeCurrencyAllowlist []common.Address</span>
<span class="term-fg32">+	coinbase             common.Address</span>
&nbsp;
 	header   *types.Header
 	txs      []*types.Transaction
<span class="term-fg36">@@ -113,6 +115,9 @@</span> 	}
 	if env.gasPool != nil {
 		gasPool := *env.gasPool
 		cpy.gasPool = &amp;gasPool
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	if env.multiGasPool != nil {</span>
<span class="term-fg32">+		cpy.multiGasPool = env.multiGasPool.Copy()</span>
 	}
 	cpy.txs = make([]*types.Transaction, len(env.txs))
 	copy(cpy.txs, env.txs)
<span class="term-fg36">@@ -851,6 +856,14 @@</span> 	gasLimit := env.header.GasLimit
 	if env.gasPool == nil {
 		env.gasPool = new(core.GasPool).AddGas(gasLimit)
 	}
<span class="term-fg32">+	if env.multiGasPool == nil {</span>
<span class="term-fg32">+		env.multiGasPool = core.NewMultiGasPool(</span>
<span class="term-fg32">+			env.header.GasLimit,</span>
<span class="term-fg32">+			env.feeCurrencyAllowlist,</span>
<span class="term-fg32">+			w.config.FeeCurrencyDefault,</span>
<span class="term-fg32">+			w.config.FeeCurrencyLimits,</span>
<span class="term-fg32">+		)</span>
<span class="term-fg32">+	}</span>
 	var coalescedLogs []*types.Log
&nbsp;
 	for {
<span class="term-fg36">@@ -906,6 +919,15 @@</span> 			log.Trace(&quot;Not enough blob gas left for transaction&quot;, &quot;hash&quot;, ltx.Hash, &quot;left&quot;, left, &quot;needed&quot;, ltx.BlobGas)
 			txs.Pop()
 			continue
 		}
<span class="term-fg32">+		if left := env.multiGasPool.PoolFor(ltx.FeeCurrency).Gas(); left &lt; ltx.Gas {</span>
<span class="term-fg32">+			log.Trace(</span>
<span class="term-fg32">+				&quot;Not enough specific fee-currency gas left for transaction&quot;,</span>
<span class="term-fg32">+				&quot;currency&quot;, ltx.FeeCurrency, &quot;hash&quot;, ltx.Hash,</span>
<span class="term-fg32">+				&quot;left&quot;, left, &quot;needed&quot;, ltx.Gas,</span>
<span class="term-fg32">+			)</span>
<span class="term-fg32">+			txs.Pop()</span>
<span class="term-fg32">+			continue</span>
<span class="term-fg32">+		}</span>
 		&#47;&#47; Transaction seems to fit, pull it up from the pool
 		tx := ltx.Resolve()
 		if tx == nil {
<span class="term-fg36">@@ -927,7 +949,9 @@</span> 		}
 		&#47;&#47; Start executing the transaction
 		env.state.SetTxContext(tx.Hash(), env.tcount)
&nbsp;
<span class="term-fg32">+		availableGas := env.gasPool.Gas()</span>
 		logs, err := w.commitTransaction(env, tx)
<span class="term-fg32">+		gasUsed := availableGas - env.gasPool.Gas()</span>
 		switch {
 		case errors.Is(err, core.ErrNonceTooLow):
 			&#47;&#47; New head notification data race between the transaction pool and miner, shift
<span class="term-fg36">@@ -935,6 +959,23 @@</span> 			log.Trace(&quot;Skipping transaction with low nonce&quot;, &quot;hash&quot;, ltx.Hash, &quot;sender&quot;, from, &quot;nonce&quot;, tx.Nonce())
 			txs.Shift()
&nbsp;
 		case errors.Is(err, nil):
<span class="term-fg32">+			err := env.multiGasPool.PoolFor(tx.FeeCurrency()).SubGas(gasUsed)</span>
<span class="term-fg32">+			if err != nil {</span>
<span class="term-fg32">+				&#47;&#47; Should never happen as we check it above</span>
<span class="term-fg32">+				log.Warn(</span>
<span class="term-fg32">+					&quot;Unexpectedly reached limit for fee currency, but tx will not be skipped&quot;,</span>
<span class="term-fg32">+					&quot;hash&quot;, tx.Hash(), &quot;gas&quot;, env.multiGasPool.PoolFor(tx.FeeCurrency()).Gas(),</span>
<span class="term-fg32">+					&quot;tx gas used&quot;, gasUsed,</span>
<span class="term-fg32">+				)</span>
<span class="term-fg32">+				&#47;&#47; If we reach this codepath, we want to still include the transaction,</span>
<span class="term-fg32">+				&#47;&#47; since the &quot;global&quot; gasPool in the commitTransaction accepted it and we</span>
<span class="term-fg32">+				&#47;&#47; would have to roll the transaction back now, introducing unnecessary</span>
<span class="term-fg32">+				&#47;&#47; complexity.</span>
<span class="term-fg32">+				&#47;&#47; Since we shouldn&#39;t reach this point anyways and the</span>
<span class="term-fg32">+				&#47;&#47; block gas limit per fee currency is enforced voluntarily and not</span>
<span class="term-fg32">+				&#47;&#47; included in the consensus this is fine.</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+</span>
 			&#47;&#47; Everything ok, collect the logs and shift in the next transaction from the same account
 			coalescedLogs = append(coalescedLogs, logs...)
 			env.tcount++
<span class="term-fg36">@@ -1095,8 +1136,9 @@</span> 	if err != nil {
 		log.Error(&quot;Failed to create sealing context&quot;, &quot;err&quot;, err)
 		return nil, err
 	}
<span class="term-fg32">+	context := core.NewEVMBlockContext(header, w.chain, nil, w.chainConfig, env.state)</span>
<span class="term-fg32">+	env.feeCurrencyAllowlist = common.CurrencyAllowlist(context.FeeCurrencyContext.ExchangeRates)</span>
 	if header.ParentBeaconRoot != nil {
<span class="term-fg31">-		context := core.NewEVMBlockContext(header, w.chain, nil, w.chainConfig, env.state)</span>
 		vmenv := vm.NewEVM(context, vm.TxContext{}, env.state, w.chainConfig, vm.Config{})
 		core.ProcessBeaconBlockRoot(*header.ParentBeaconRoot, vmenv, env.state)
 	}
<span class="term-fg36">@@ -1175,6 +1217,14 @@</span> 			gasLimit = work.header.GasLimit
 		}
 		work.gasPool = new(core.GasPool).AddGas(gasLimit)
 	}
<span class="term-fg32">+	if work.multiGasPool == nil {</span>
<span class="term-fg32">+		work.multiGasPool = core.NewMultiGasPool(</span>
<span class="term-fg32">+			work.header.GasLimit,</span>
<span class="term-fg32">+			work.feeCurrencyAllowlist,</span>
<span class="term-fg32">+			w.config.FeeCurrencyDefault,</span>
<span class="term-fg32">+			w.config.FeeCurrencyLimits,</span>
<span class="term-fg32">+		)</span>
<span class="term-fg32">+	}</span>
&nbsp;
 	misc.EnsureCreate2Deployer(w.chainConfig, work.header.Time, work.state)
&nbsp;
<span class="term-fg36">@@ -1185,6 +1235,10 @@</span> 		_, err := w.commitTransaction(work, tx)
 		if err != nil {
 			return &amp;newPayloadResult{err: fmt.Errorf(&quot;failed to force-include tx: %s type: %d sender: %s nonce: %d, err: %w&quot;, tx.Hash(), tx.Type(), from, tx.Nonce(), err)}
 		}
<span class="term-fg32">+		&#47;&#47; the non-fee currency pool in the multipool is not used, but for consistency</span>
<span class="term-fg32">+		&#47;&#47; subtract the gas. Don&#39;t check the error either, this has been checked already</span>
<span class="term-fg32">+		&#47;&#47; with the work.gasPool.</span>
<span class="term-fg32">+		work.multiGasPool.PoolFor(nil).SubGas(tx.Gas())</span>
 		work.tcount++
 	}
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-54f06d54bb5e6f41b0958144" role="button"
                       aria-expanded="false" aria-controls="id-54f06d54bb5e6f41b0958144">
                        <code>params/celo.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/params/celo.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+5</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-54f06d54bb5e6f41b0958144"><span class="term-fg1">diff --git op-geth&#47;params&#47;celo.go CELO&#47;params&#47;celo.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a6b053bd06f8f5718569c6f0f550640921409dff</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;params&#47;celo.go</span>
<span class="term-fg36">@@ -0,0 +1,5 @@</span>
<span class="term-fg32">+package params</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+const (</span>
<span class="term-fg32">+	DefaultGasLimit uint64 = 20000000 &#47;&#47; Gas limit of the blocks before BlockchainParams contract is loaded.</span>
<span class="term-fg32">+)</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-698ab968c9e48efbf1472982" role="button"
                       aria-expanded="false" aria-controls="id-698ab968c9e48efbf1472982">
                        <code>params/config_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/params/config_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/params/config_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+60</span></div>
                            <div class="text-start"><span class="text-danger">-5</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-698ab968c9e48efbf1472982"><span class="term-fg1">diff --git op-geth&#47;params&#47;config_test.go CELO&#47;params&#47;config_test.go</span>
<span class="term-fg1">index fc76c604a8163f77f8da9522f40a00d315de64a7..712f203d16fa2895b2ef89343c6cb592a6a367b8 100644</span>
<span class="term-fg1">--- op-geth&#47;params&#47;config_test.go</span>
<span class="term-fg1">+++ CELO&#47;params&#47;config_test.go</span>
<span class="term-fg36">@@ -17,6 +17,7 @@</span>
 package params
&nbsp;
 import (
<span class="term-fg32">+	&quot;fmt&quot;</span>
 	&quot;math&#47;big&quot;
 	&quot;reflect&quot;
 	&quot;testing&quot;
<span class="term-fg36">@@ -31,6 +32,8 @@</span> 		stored, new   *ChainConfig
 		headBlock     uint64
 		headTimestamp uint64
 		wantErr       *ConfigCompatError
<span class="term-fg32">+</span>
<span class="term-fg32">+		genesisTimestamp *uint64</span>
 	}
 	tests := []test{
 		{stored: AllEthashProtocolChanges, new: AllEthashProtocolChanges, headBlock: 0, headTimestamp: 0, wantErr: nil},
<span class="term-fg36">@@ -109,13 +112,46 @@</span> 				NewTime:      newUint64(20),
 				RewindToTime: 9,
 			},
 		},
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			stored:           &amp;ChainConfig{CanyonTime: newUint64(10)},</span>
<span class="term-fg32">+			new:              &amp;ChainConfig{CanyonTime: newUint64(20)},</span>
<span class="term-fg32">+			headTimestamp:    25,</span>
<span class="term-fg32">+			genesisTimestamp: newUint64(2),</span>
<span class="term-fg32">+			wantErr: &amp;ConfigCompatError{</span>
<span class="term-fg32">+				What:         &quot;Canyon fork timestamp&quot;,</span>
<span class="term-fg32">+				StoredTime:   newUint64(10),</span>
<span class="term-fg32">+				NewTime:      newUint64(20),</span>
<span class="term-fg32">+				RewindToTime: 9,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			stored:           &amp;ChainConfig{CanyonTime: newUint64(10)},</span>
<span class="term-fg32">+			new:              &amp;ChainConfig{CanyonTime: newUint64(20)},</span>
<span class="term-fg32">+			headTimestamp:    25,</span>
<span class="term-fg32">+			genesisTimestamp: nil,</span>
<span class="term-fg32">+			wantErr: &amp;ConfigCompatError{</span>
<span class="term-fg32">+				What:         &quot;Canyon fork timestamp&quot;,</span>
<span class="term-fg32">+				StoredTime:   newUint64(10),</span>
<span class="term-fg32">+				NewTime:      newUint64(20),</span>
<span class="term-fg32">+				RewindToTime: 9,</span>
<span class="term-fg32">+			},</span>
<span class="term-fg32">+		},</span>
<span class="term-fg32">+		{</span>
<span class="term-fg32">+			stored:           &amp;ChainConfig{CanyonTime: newUint64(10)},</span>
<span class="term-fg32">+			new:              &amp;ChainConfig{CanyonTime: newUint64(20)},</span>
<span class="term-fg32">+			headTimestamp:    25,</span>
<span class="term-fg32">+			genesisTimestamp: newUint64(24),</span>
<span class="term-fg32">+			wantErr:          nil,</span>
<span class="term-fg32">+		},</span>
 	}
&nbsp;
<span class="term-fg31">-	for _, test := range tests {</span>
<span class="term-fg31">-		err := test.stored.CheckCompatible(test.new, test.headBlock, test.headTimestamp)</span>
<span class="term-fg31">-		if !reflect.DeepEqual(err, test.wantErr) {</span>
<span class="term-fg31">-			t.Errorf(&quot;error mismatch:\nstored: %v\nnew: %v\nheadBlock: %v\nheadTimestamp: %v\nerr: %v\nwant: %v&quot;, test.stored, test.new, test.headBlock, test.headTimestamp, err, test.wantErr)</span>
<span class="term-fg31">-		}</span>
<span class="term-fg32">+	for i, test := range tests {</span>
<span class="term-fg32">+		t.Run(fmt.Sprintf(&quot;case %d&quot;, i), func(t *testing.T) {</span>
<span class="term-fg32">+			err := test.stored.CheckCompatible(test.new, test.headBlock, test.headTimestamp, test.genesisTimestamp)</span>
<span class="term-fg32">+			if !reflect.DeepEqual(err, test.wantErr) {</span>
<span class="term-fg32">+				t.Errorf(&quot;error mismatch:\nstored: %v\nnew: %v\nheadBlock: %v\nheadTimestamp: %v\nerr: %v\nwant: %v&quot;, test.stored, test.new, test.headBlock, test.headTimestamp, err, test.wantErr)</span>
<span class="term-fg32">+			}</span>
<span class="term-fg32">+		})</span>
 	}
 }
&nbsp;
<span class="term-fg36">@@ -157,3 +193,22 @@</span> 	if r := c.Rules(big.NewInt(0), true, stamp); !r.IsOptimismRegolith {
 		t.Errorf(&quot;expected %v to be regolith&quot;, stamp)
 	}
 }
<span class="term-fg32">+</span>
<span class="term-fg32">+func TestConfigRulesCel2(t *testing.T) {</span>
<span class="term-fg32">+	c := &amp;ChainConfig{</span>
<span class="term-fg32">+		Cel2Time: newUint64(500),</span>
<span class="term-fg32">+		Optimism: &amp;OptimismConfig{},</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	var stamp uint64</span>
<span class="term-fg32">+	if r := c.Rules(big.NewInt(0), true, stamp); r.IsCel2 {</span>
<span class="term-fg32">+		t.Errorf(&quot;expected %v to not be Cel2&quot;, stamp)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	stamp = 500</span>
<span class="term-fg32">+	if r := c.Rules(big.NewInt(0), true, stamp); !r.IsCel2 {</span>
<span class="term-fg32">+		t.Errorf(&quot;expected %v to be Cel2&quot;, stamp)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	stamp = math.MaxInt64</span>
<span class="term-fg32">+	if r := c.Rules(big.NewInt(0), true, stamp); !r.IsCel2 {</span>
<span class="term-fg32">+		t.Errorf(&quot;expected %v to be Cel2&quot;, stamp)</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-344298ded849dd1e3ed73cbf" role="button"
                       aria-expanded="false" aria-controls="id-344298ded849dd1e3ed73cbf">
                        <code>params/superchain.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/params/superchain.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/params/superchain.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-344298ded849dd1e3ed73cbf"><span class="term-fg1">diff --git op-geth&#47;params&#47;superchain.go CELO&#47;params&#47;superchain.go</span>
<span class="term-fg1">index bcce62832f9e25c8820fe65b06435b517d1e2bcb..bf592ae822130f98980949f83560defe2bda66f5 100644</span>
<span class="term-fg1">--- op-geth&#47;params&#47;superchain.go</span>
<span class="term-fg1">+++ CELO&#47;params&#47;superchain.go</span>
<span class="term-fg36">@@ -76,7 +76,7 @@</span> 		Clique:                        nil,
 		Optimism: &amp;OptimismConfig{
 			EIP1559Elasticity:        6,
 			EIP1559Denominator:       50,
<span class="term-fg31">-			EIP1559DenominatorCanyon: 250,</span>
<span class="term-fg32">+			EIP1559DenominatorCanyon: newUint64(250),</span>
 		},
 	}
</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-cd0e121c859aef35fc801bfd" role="button"
                       aria-expanded="false" aria-controls="id-cd0e121c859aef35fc801bfd">
                        <code>rlp/celo_raw.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/rlp/celo_raw.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+16</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cd0e121c859aef35fc801bfd"><span class="term-fg1">diff --git op-geth&#47;rlp&#47;celo_raw.go CELO&#47;rlp&#47;celo_raw.go</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..de024d3f5de6f9c179f02de335382f6aae83699d</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;rlp&#47;celo_raw.go</span>
<span class="term-fg36">@@ -0,0 +1,16 @@</span>
<span class="term-fg32">+package rlp</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+&#47;&#47; ReadNext reads the next RLP item from the given buffer and returns the remaining buffer,</span>
<span class="term-fg32">+&#47;&#47; the kind of the item, the size of the tag, the size of the content, and any error encountered.</span>
<span class="term-fg32">+func ReadNext(buf []byte) (remaining []byte, kind Kind, tagsize, contentsize uint64, err error) {</span>
<span class="term-fg32">+	remaining = buf</span>
<span class="term-fg32">+	kind, tagsize, contentsize, err = readKind(remaining)</span>
<span class="term-fg32">+	if err != nil {</span>
<span class="term-fg32">+		return nil, 0, 0, 0, err</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	remaining = remaining[tagsize:]</span>
<span class="term-fg32">+	if kind != List {</span>
<span class="term-fg32">+		remaining = remaining[contentsize:]</span>
<span class="term-fg32">+	}</span>
<span class="term-fg32">+	return</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-8acbecd168ac5805ab37af15" role="button"
                       aria-expanded="false" aria-controls="id-8acbecd168ac5805ab37af15">
                        <code>rpc/subscription_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/rpc/subscription_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/rpc/subscription_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+2</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-8acbecd168ac5805ab37af15"><span class="term-fg1">diff --git op-geth&#47;rpc&#47;subscription_test.go CELO&#47;rpc&#47;subscription_test.go</span>
<span class="term-fg1">index 3a131c8e6bd2a6e46fc2043530eb01d1d36af9cc..f96ed423e4f7e412ee4d28e755a72a412f2be883 100644</span>
<span class="term-fg1">--- op-geth&#47;rpc&#47;subscription_test.go</span>
<span class="term-fg1">+++ CELO&#47;rpc&#47;subscription_test.go</span>
<span class="term-fg36">@@ -270,10 +270,11 @@</span> 	}
 	msg := &amp;types.Header{
 		ParentHash: common.HexToHash(&quot;0x01&quot;),
 		Number:     big.NewInt(100),
<span class="term-fg32">+		GasLimit:   10,</span>
 	}
 	notifier.Notify(id, msg)
 	have := strings.TrimSpace(out.String())
<span class="term-fg31">-	want := `{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;_subscription&quot;,&quot;params&quot;:{&quot;subscription&quot;:&quot;test&quot;,&quot;result&quot;:{&quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;,&quot;sha3Uncles&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;miner&quot;:&quot;0x0000000000000000000000000000000000000000&quot;,&quot;stateRoot&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;transactionsRoot&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;receiptsRoot&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;logsBloom&quot;:&quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;difficulty&quot;:null,&quot;number&quot;:&quot;0x64&quot;,&quot;gasLimit&quot;:&quot;0x0&quot;,&quot;gasUsed&quot;:&quot;0x0&quot;,&quot;timestamp&quot;:&quot;0x0&quot;,&quot;extraData&quot;:&quot;0x&quot;,&quot;mixHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;nonce&quot;:&quot;0x0000000000000000&quot;,&quot;baseFeePerGas&quot;:null,&quot;withdrawalsRoot&quot;:null,&quot;blobGasUsed&quot;:null,&quot;excessBlobGas&quot;:null,&quot;parentBeaconBlockRoot&quot;:null,&quot;hash&quot;:&quot;0xe5fb877dde471b45b9742bb4bb4b3d74a761e2fb7cb849a3d2b687eed90fb604&quot;}}}`</span>
<span class="term-fg32">+	want := `{&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;_subscription&quot;,&quot;params&quot;:{&quot;subscription&quot;:&quot;test&quot;,&quot;result&quot;:{&quot;parentHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;,&quot;sha3Uncles&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;miner&quot;:&quot;0x0000000000000000000000000000000000000000&quot;,&quot;stateRoot&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;transactionsRoot&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;receiptsRoot&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;logsBloom&quot;:&quot;0x00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;difficulty&quot;:null,&quot;number&quot;:&quot;0x64&quot;,&quot;gasLimit&quot;:&quot;0xa&quot;,&quot;gasUsed&quot;:&quot;0x0&quot;,&quot;timestamp&quot;:&quot;0x0&quot;,&quot;extraData&quot;:&quot;0x&quot;,&quot;mixHash&quot;:&quot;0x0000000000000000000000000000000000000000000000000000000000000000&quot;,&quot;nonce&quot;:&quot;0x0000000000000000&quot;,&quot;baseFeePerGas&quot;:null,&quot;withdrawalsRoot&quot;:null,&quot;blobGasUsed&quot;:null,&quot;excessBlobGas&quot;:null,&quot;parentBeaconBlockRoot&quot;:null,&quot;hash&quot;:&quot;0x98d8242410614702f0263d5f204c421912343ccad5a9ceee8989fda3ec21a1db&quot;}}}`</span>
 	if have != want {
 		t.Errorf(&quot;have:\n%v\nwant:\n%v\n&quot;, have, want)
 	}</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-5c5fd143610aae495e4825ad" role="button"
                       aria-expanded="false" aria-controls="id-5c5fd143610aae495e4825ad">
                        <code>tests/block_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/tests/block_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/tests/block_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-5c5fd143610aae495e4825ad"><span class="term-fg1">diff --git op-geth&#47;tests&#47;block_test.go CELO&#47;tests&#47;block_test.go</span>
<span class="term-fg1">index fb355085fd8c106df6f957c7c066fafd93d2a82b..5bea3e289f6de7e4b95c4a97db7edcef6e0ed4be 100644</span>
<span class="term-fg1">--- op-geth&#47;tests&#47;block_test.go</span>
<span class="term-fg1">+++ CELO&#47;tests&#47;block_test.go</span>
<span class="term-fg36">@@ -18,6 +18,7 @@</span> package tests
&nbsp;
 import (
 	&quot;math&#47;rand&quot;
<span class="term-fg32">+	&quot;regexp&quot;</span>
 	&quot;runtime&quot;
 	&quot;testing&quot;
&nbsp;
<span class="term-fg36">@@ -69,6 +70,13 @@</span> 	}
 	bt := new(testMatcher)
&nbsp;
 	bt.walk(t, executionSpecBlockchainTestDir, func(t *testing.T, name string, test *BlockTest) {
<span class="term-fg32">+		matches, err := regexp.MatchString(&quot;blockchain_test-create2?-over_limit_(ones|zeros)&quot;, name)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			t.Errorf(&quot;Bad regexp: %s&quot;, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if matches {</span>
<span class="term-fg32">+			t.Skipf(&quot;Celo has increased the MaxCodeSize, which makes some tests invalid&quot;)</span>
<span class="term-fg32">+		}</span>
 		execBlockTest(t, bt, test)
 	})
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-bee9df0a5305761e5d2881d6" role="button"
                       aria-expanded="false" aria-controls="id-bee9df0a5305761e5d2881d6">
                        <code>tests/state_test.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/tests/state_test.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/tests/state_test.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+8</span></div>
                            <div class="text-start"><span class="text-danger">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-bee9df0a5305761e5d2881d6"><span class="term-fg1">diff --git op-geth&#47;tests&#47;state_test.go CELO&#47;tests&#47;state_test.go</span>
<span class="term-fg1">index 5562942627c6b32294a2291ab6d8404f08ce97ff..d9ff2c16fd8a53ff9e32f3100fbb1d3713e46134 100644</span>
<span class="term-fg1">--- op-geth&#47;tests&#47;state_test.go</span>
<span class="term-fg1">+++ CELO&#47;tests&#47;state_test.go</span>
<span class="term-fg36">@@ -25,6 +25,7 @@</span> 	&quot;math&#47;rand&quot;
 	&quot;os&quot;
 	&quot;path&#47;filepath&quot;
 	&quot;reflect&quot;
<span class="term-fg32">+	&quot;regexp&quot;</span>
 	&quot;runtime&quot;
 	&quot;strings&quot;
 	&quot;testing&quot;
<span class="term-fg36">@@ -94,6 +95,13 @@</span> 	}
 	st := new(testMatcher)
&nbsp;
 	st.walk(t, executionSpecStateTestDir, func(t *testing.T, name string, test *StateTest) {
<span class="term-fg32">+		matches, err := regexp.MatchString(&quot;state_test-(create2?-)?over_limit_(ones|zeros)&quot;, name)</span>
<span class="term-fg32">+		if err != nil {</span>
<span class="term-fg32">+			t.Errorf(&quot;Bad regexp: %s&quot;, err)</span>
<span class="term-fg32">+		}</span>
<span class="term-fg32">+		if matches {</span>
<span class="term-fg32">+			t.Skipf(&quot;Celo has increased the MaxCodeSize, which makes some tests invalid&quot;)</span>
<span class="term-fg32">+		}</span>
 		execStateTest(t, st, test)
 	})
 }</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-decoration-none" data-bs-toggle="collapse" href="#id-e0cd61dd312b517a1939a16d" role="button"
                       aria-expanded="false" aria-controls="id-e0cd61dd312b517a1939a16d">
                        <code>tests/transaction_test_util.go</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/tests/transaction_test_util.go" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/tests/transaction_test_util.go" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-success">+1</span></div>
                            <div class="text-start"><span class="text-danger">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e0cd61dd312b517a1939a16d"><span class="term-fg1">diff --git op-geth&#47;tests&#47;transaction_test_util.go CELO&#47;tests&#47;transaction_test_util.go</span>
<span class="term-fg1">index 391aa57584cfa5708234d2ff5fe4f8d7875afe34..956be1fc25b1fc606a0e68eb64a20e0f06f028d7 100644</span>
<span class="term-fg1">--- op-geth&#47;tests&#47;transaction_test_util.go</span>
<span class="term-fg1">+++ CELO&#47;tests&#47;transaction_test_util.go</span>
<span class="term-fg36">@@ -55,7 +55,7 @@</span> 		if err != nil {
 			return nil, nil, err
 		}
 		&#47;&#47; Intrinsic gas
<span class="term-fg31">-		requiredGas, err := core.IntrinsicGas(tx.Data(), tx.AccessList(), tx.To() == nil, isHomestead, isIstanbul, false)</span>
<span class="term-fg32">+		requiredGas, err := core.IntrinsicGas(tx.Data(), tx.AccessList(), tx.To() == nil, isHomestead, isIstanbul, false, nil, common.IntrinsicGasCosts{})</span>
 		if err != nil {
 			return nil, nil, err
 		}</div>
    </div>

            
            
        </div>
        <div>
            
        </div>
    </div>
</div>

            
        </div>
    </div>
</div>

                
                    <div class="ps-1 py-2 my-1"><div class="row border-bottom border-1"data-bs-toggle="collapse" data-bs-target="#id-0201ba291d6b6be368c05c1b"role="button" aria-expanded="false" aria-controls="id-0201ba291d6b6be368c05c1b">
        
            <div class="col-12 col-md-12 col-lg-6 col-xl-6 text-start"><h4>Ignored changes</h4></div>
        

        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2">
            <div class="row line-stat">
                
                
            </div>
        </div>
        <div class="col-6 col-md-3 col-xl-2 ms-auto mt-2 ">
            <div class="row line-stat">
                
                
                    <div class="text-end"><span class="text-add-ignored">+364</span></div>
                    <div class="text-start"><span class="text-delete-ignored">-545</span></div>
                
            </div>
        </div>
    </div>

    <div class="row forkdef-content collapse  border-1 ps-3 my-3" id="id-0201ba291d6b6be368c05c1b">
        <div></div>
        <div>
            
            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-e68873fceeee7ee9057aa96f" role="button"
                       aria-expanded="false" aria-controls="id-e68873fceeee7ee9057aa96f">
                        <code>.circleci/check-releases.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/.circleci/check-releases.sh" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <span class="text-muted">(deleted)</span>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+0</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-21</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e68873fceeee7ee9057aa96f"><span class="term-fg1">diff --git op-geth&#47;.circleci&#47;check-releases.sh CELO&#47;.circleci&#47;check-releases.sh</span>
<span class="term-fg1">deleted file mode 100755</span>
<span class="term-fg1">index f3595e1320377bea4b17c13326d87342083071c0..0000000000000000000000000000000000000000</span>
<span class="term-fg1">--- op-geth&#47;.circleci&#47;check-releases.sh</span>
<span class="term-fg1">+++ &#47;dev&#47;null</span>
<span class="term-fg36">@@ -1,21 +0,0 @@</span>
<span class="term-fg31">-#!&#47;bin&#47;bash</span>
<span class="term-fg31">-set -euo pipefail</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-LATEST_RELEASE=$(curl -s --fail -L \</span>
<span class="term-fg31">-  -H &quot;Accept: application&#47;vnd.github+json&quot; \</span>
<span class="term-fg31">-  -H &quot;X-GitHub-Api-Version: 2022-11-28&quot; \</span>
<span class="term-fg31">-  https:&#47;&#47;api.github.com&#47;repos&#47;ethereum&#47;go-ethereum&#47;releases \</span>
<span class="term-fg31">-  | jq -r &#39;(.[] | select(.draft==false) | select(.prerelease==false)).tag_name&#39; | head -n 1)</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-echo &quot;Detected latest go-ethereum release as ${LATEST_RELEASE}&quot;</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-git remote add upstream https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum</span>
<span class="term-fg31">-git fetch upstream &gt; &#47;dev&#47;null</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-if git branch --contains &quot;${LATEST_RELEASE}&quot; 2&gt;&amp;1 | grep -e &#39;^[ *]*optimism$&#39; &gt; &#47;dev&#47;null</span>
<span class="term-fg31">-then</span>
<span class="term-fg31">-  echo &quot;Up to date with latest release.  Great job! 🎉&quot;</span>
<span class="term-fg31">-else</span>
<span class="term-fg31">-  echo &quot;Release has not been merged&quot;</span>
<span class="term-fg31">-  exit 1</span>
<span class="term-fg31">-fi</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-e3067bd7dea4dcf843cc6df8" role="button"
                       aria-expanded="false" aria-controls="id-e3067bd7dea4dcf843cc6df8">
                        <code>.circleci/ci-docker-tag-op-geth-release.sh</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/.circleci/ci-docker-tag-op-geth-release.sh" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <span class="text-muted">(deleted)</span>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+0</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-38</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e3067bd7dea4dcf843cc6df8"><span class="term-fg1">diff --git op-geth&#47;.circleci&#47;ci-docker-tag-op-geth-release.sh CELO&#47;.circleci&#47;ci-docker-tag-op-geth-release.sh</span>
<span class="term-fg1">deleted file mode 100755</span>
<span class="term-fg1">index 7b66e789a4d7e50699f2d22ff037117c0d7a3a35..0000000000000000000000000000000000000000</span>
<span class="term-fg1">--- op-geth&#47;.circleci&#47;ci-docker-tag-op-geth-release.sh</span>
<span class="term-fg1">+++ &#47;dev&#47;null</span>
<span class="term-fg36">@@ -1,38 +0,0 @@</span>
<span class="term-fg31">-#!&#47;usr&#47;bin&#47;env bash</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-set -euo pipefail</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-DOCKER_REPO=$1</span>
<span class="term-fg31">-GIT_TAG=$2</span>
<span class="term-fg31">-GIT_SHA=$3</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-IMAGE_NAME=&quot;op-geth&quot;</span>
<span class="term-fg31">-IMAGE_TAG=$GIT_TAG</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-SOURCE_IMAGE_TAG=&quot;$DOCKER_REPO&#47;$IMAGE_NAME:$GIT_SHA&quot;</span>
<span class="term-fg31">-TARGET_IMAGE_TAG=&quot;$DOCKER_REPO&#47;$IMAGE_NAME:$IMAGE_TAG&quot;</span>
<span class="term-fg31">-TARGET_IMAGE_TAG_LATEST=&quot;$DOCKER_REPO&#47;$IMAGE_NAME:latest&quot;</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-echo &quot;Checking if docker images exist for &#39;$IMAGE_NAME&#39;&quot;</span>
<span class="term-fg31">-echo &quot;&quot;</span>
<span class="term-fg31">-tags=$(gcloud container images list-tags &quot;$DOCKER_REPO&#47;$IMAGE_NAME&quot; --limit 1 --format json)</span>
<span class="term-fg31">-if [ &quot;$tags&quot; = &quot;[]&quot; ]; then</span>
<span class="term-fg31">-  echo &quot;No existing docker images were found for &#39;$IMAGE_NAME&#39;. The code tagged with &#39;$GIT_TAG&#39; may not have an associated dockerfile or docker build job.&quot;</span>
<span class="term-fg31">-  echo &quot;If this service has a dockerfile, add a docker-publish job for it in the circleci config.&quot;</span>
<span class="term-fg31">-  echo &quot;&quot;</span>
<span class="term-fg31">-  echo &quot;Exiting&quot;</span>
<span class="term-fg31">-  exit 0</span>
<span class="term-fg31">-fi</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-echo &quot;Tagging $SOURCE_IMAGE_TAG with &#39;$IMAGE_TAG&#39;&quot;</span>
<span class="term-fg31">-gcloud container images add-tag -q &quot;$SOURCE_IMAGE_TAG&quot; &quot;$TARGET_IMAGE_TAG&quot;</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-# Do not tag with latest if the release is a release candidate.</span>
<span class="term-fg31">-if [[ &quot;$IMAGE_TAG&quot; == *&quot;rc&quot;* ]]; then</span>
<span class="term-fg31">-  echo &quot;Not tagging with &#39;latest&#39; because the release is a release candidate.&quot;</span>
<span class="term-fg31">-  exit 0</span>
<span class="term-fg31">-fi</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-echo &quot;Tagging $SOURCE_IMAGE_TAG with &#39;latest&#39;&quot;</span>
<span class="term-fg31">-gcloud container images add-tag -q &quot;$SOURCE_IMAGE_TAG&quot; &quot;$TARGET_IMAGE_TAG_LATEST&quot;</span>
<span class="term-fg31">-</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-e167af420b75de4001609a27" role="button"
                       aria-expanded="false" aria-controls="id-e167af420b75de4001609a27">
                        <code>.circleci/config.yml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/.circleci/config.yml" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <span class="text-muted">(deleted)</span>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+0</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-230</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e167af420b75de4001609a27"><span class="term-fg1">diff --git op-geth&#47;.circleci&#47;config.yml CELO&#47;.circleci&#47;config.yml</span>
<span class="term-fg1">deleted file mode 100644</span>
<span class="term-fg1">index ad9793ad9873c294d4c128d575406fc0710ee20c..0000000000000000000000000000000000000000</span>
<span class="term-fg1">--- op-geth&#47;.circleci&#47;config.yml</span>
<span class="term-fg1">+++ &#47;dev&#47;null</span>
<span class="term-fg36">@@ -1,230 +0,0 @@</span>
<span class="term-fg31">-version: 2.1</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-orbs:</span>
<span class="term-fg31">-  gcp-cli: circleci&#47;gcp-cli@3.0.1</span>
<span class="term-fg31">-  slack: circleci&#47;slack@4.10.1</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-commands:</span>
<span class="term-fg31">-  gcp-oidc-authenticate:</span>
<span class="term-fg31">-    description: &quot;Authenticate with GCP using a CircleCI OIDC token.&quot;</span>
<span class="term-fg31">-    parameters:</span>
<span class="term-fg31">-      project_id:</span>
<span class="term-fg31">-        type: env_var_name</span>
<span class="term-fg31">-        default: GCP_PROJECT_ID</span>
<span class="term-fg31">-      workload_identity_pool_id:</span>
<span class="term-fg31">-        type: env_var_name</span>
<span class="term-fg31">-        default: GCP_WIP_ID</span>
<span class="term-fg31">-      workload_identity_pool_provider_id:</span>
<span class="term-fg31">-        type: env_var_name</span>
<span class="term-fg31">-        default: GCP_WIP_PROVIDER_ID</span>
<span class="term-fg31">-      service_account_email:</span>
<span class="term-fg31">-        type: env_var_name</span>
<span class="term-fg31">-        default: GCP_SERVICE_ACCOUNT_EMAIL</span>
<span class="term-fg31">-      gcp_cred_config_file_path:</span>
<span class="term-fg31">-        type: string</span>
<span class="term-fg31">-        default: &#47;home&#47;circleci&#47;gcp_cred_config.json</span>
<span class="term-fg31">-      oidc_token_file_path:</span>
<span class="term-fg31">-        type: string</span>
<span class="term-fg31">-        default: &#47;home&#47;circleci&#47;oidc_token.json</span>
<span class="term-fg31">-    steps:</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          name: &quot;Create OIDC credential configuration&quot;</span>
<span class="term-fg31">-          command: |</span>
<span class="term-fg31">-            # Store OIDC token in temp file</span>
<span class="term-fg31">-            echo $CIRCLE_OIDC_TOKEN &gt; &lt;&lt; parameters.oidc_token_file_path &gt;&gt;</span>
<span class="term-fg31">-            # Create a credential configuration for the generated OIDC ID Token</span>
<span class="term-fg31">-            gcloud iam workload-identity-pools create-cred-config \</span>
<span class="term-fg31">-                &quot;projects&#47;${&lt;&lt; parameters.project_id &gt;&gt;}&#47;locations&#47;global&#47;workloadIdentityPools&#47;${&lt;&lt; parameters.workload_identity_pool_id &gt;&gt;}&#47;providers&#47;${&lt;&lt; parameters.workload_identity_pool_provider_id &gt;&gt;}&quot;\</span>
<span class="term-fg31">-                --output-file=&quot;&lt;&lt; parameters.gcp_cred_config_file_path &gt;&gt;&quot; \</span>
<span class="term-fg31">-                --service-account=&quot;${&lt;&lt; parameters.service_account_email &gt;&gt;}&quot; \</span>
<span class="term-fg31">-                --credential-source-file=&lt;&lt; parameters.oidc_token_file_path &gt;&gt;</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          name: &quot;Authenticate with GCP using OIDC&quot;</span>
<span class="term-fg31">-          command: |</span>
<span class="term-fg31">-            # Configure gcloud to leverage the generated credential configuration</span>
<span class="term-fg31">-            gcloud auth login --brief --cred-file &quot;&lt;&lt; parameters.gcp_cred_config_file_path &gt;&gt;&quot;</span>
<span class="term-fg31">-            # Configure ADC</span>
<span class="term-fg31">-            echo &quot;export GOOGLE_APPLICATION_CREDENTIALS=&#39;&lt;&lt; parameters.gcp_cred_config_file_path &gt;&gt;&#39;&quot; | tee -a &quot;$BASH_ENV&quot;</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-jobs:</span>
<span class="term-fg31">-  docker-release:</span>
<span class="term-fg31">-    environment:</span>
<span class="term-fg31">-      DOCKER_BUILDKIT: 1</span>
<span class="term-fg31">-    parameters:</span>
<span class="term-fg31">-      docker_name:</span>
<span class="term-fg31">-        description: Docker image name</span>
<span class="term-fg31">-        type: string</span>
<span class="term-fg31">-        default: &quot;op-geth&quot;</span>
<span class="term-fg31">-      docker_tags:</span>
<span class="term-fg31">-        description: Docker image tags as csv</span>
<span class="term-fg31">-        type: string</span>
<span class="term-fg31">-      registry:</span>
<span class="term-fg31">-        description: Docker registry</span>
<span class="term-fg31">-        type: string</span>
<span class="term-fg31">-        default: &quot;us-docker.pkg.dev&quot;</span>
<span class="term-fg31">-      repo:</span>
<span class="term-fg31">-        description: Docker repo</span>
<span class="term-fg31">-        type: string</span>
<span class="term-fg31">-        default: &quot;oplabs-tools-artifacts&#47;images&quot;</span>
<span class="term-fg31">-      push_tags:</span>
<span class="term-fg31">-        description: Push release push tags</span>
<span class="term-fg31">-        type: boolean</span>
<span class="term-fg31">-        default: false</span>
<span class="term-fg31">-    machine:</span>
<span class="term-fg31">-      image: default</span>
<span class="term-fg31">-      resource_class: xlarge</span>
<span class="term-fg31">-    steps:</span>
<span class="term-fg31">-      - gcp-cli&#47;install</span>
<span class="term-fg31">-      - gcp-oidc-authenticate</span>
<span class="term-fg31">-      - checkout</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          name: Configure Docker</span>
<span class="term-fg31">-          command: |</span>
<span class="term-fg31">-            gcloud auth configure-docker &lt;&lt;parameters.registry&gt;&gt;</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          name: Build and push</span>
<span class="term-fg31">-          command: |</span>
<span class="term-fg31">-            RAW_TAGS=&quot;&lt;&lt;parameters.docker_tags&gt;&gt;&quot;</span>
<span class="term-fg31">-            if [ &quot;$CIRCLE_BRANCH&quot; = &quot;optimism&quot; ]; then</span>
<span class="term-fg31">-              RAW_TAGS=&quot;$RAW_TAGS,optimism&quot;</span>
<span class="term-fg31">-            fi</span>
<span class="term-fg31">-            IMAGE_BASE=&quot;&lt;&lt;parameters.registry&gt;&gt;&#47;&lt;&lt;parameters.repo&gt;&gt;&#47;&lt;&lt;parameters.docker_name&gt;&gt;&quot;</span>
<span class="term-fg31">-            DOCKER_TAGS=$(echo -ne &quot;$RAW_TAGS&quot; | sed &quot;s&#47;,&#47;\n&#47;g&quot; | sed &quot;s&#47;[^a-zA-Z0-9\n.]&#47;-&#47;g&quot; | sed -e &quot;s|^|-t ${IMAGE_BASE}:|&quot;)</span>
<span class="term-fg31">-            docker context create buildx-build</span>
<span class="term-fg31">-            docker buildx create --use buildx-build</span>
<span class="term-fg31">-            docker buildx build --push \</span>
<span class="term-fg31">-              $(echo -ne $DOCKER_TAGS | tr &#39;\n&#39; &#39; &#39;) \</span>
<span class="term-fg31">-              --platform=linux&#47;arm64,linux&#47;amd64 \</span>
<span class="term-fg31">-              --build-arg VERSION=$CIRCLE_TAG \</span>
<span class="term-fg31">-              --build-arg COMMIT=$CIRCLE_SHA \</span>
<span class="term-fg31">-              --build-arg BUILDNUM=$CIRCLE_BUILD_NUM \</span>
<span class="term-fg31">-              --progress plain \</span>
<span class="term-fg31">-              -f Dockerfile .</span>
<span class="term-fg31">-      - when:</span>
<span class="term-fg31">-          condition:</span>
<span class="term-fg31">-            equal: [ true, &lt;&lt;parameters.push_tags&gt;&gt; ]</span>
<span class="term-fg31">-          steps:</span>
<span class="term-fg31">-            - run:</span>
<span class="term-fg31">-                name: Tag</span>
<span class="term-fg31">-                command: |</span>
<span class="term-fg31">-                  .&#47;.circleci&#47;ci-docker-tag-op-geth-release.sh &lt;&lt;parameters.registry&gt;&gt;&#47;&lt;&lt;parameters.repo&gt;&gt; $CIRCLE_TAG $CIRCLE_SHA1</span>
<span class="term-fg31">-      - when:</span>
<span class="term-fg31">-          condition:</span>
<span class="term-fg31">-            equal: [optimism, &lt;&lt; pipeline.git.branch &gt;&gt;]</span>
<span class="term-fg31">-          steps:</span>
<span class="term-fg31">-            - gcp-oidc-authenticate:</span>
<span class="term-fg31">-                service_account_email: GCP_SERVICE_ATTESTOR_ACCOUNT_EMAIL</span>
<span class="term-fg31">-            - run:</span>
<span class="term-fg31">-                name: Sign</span>
<span class="term-fg31">-                command: |</span>
<span class="term-fg31">-                  git clone --branch v1.0.3 --depth 1 https:&#47;&#47;github.com&#47;ethereum-optimism&#47;binary_signer</span>
<span class="term-fg31">-                  cd binary_signer&#47;signer</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-                  IMAGE_PATH=&quot;&lt;&lt;parameters.registry&gt;&gt;&#47;&lt;&lt;parameters.repo&gt;&gt;&#47;&lt;&lt;parameters.docker_name&gt;&gt;:&lt;&lt;pipeline.git.revision&gt;&gt;&quot;</span>
<span class="term-fg31">-                  echo $IMAGE_PATH</span>
<span class="term-fg31">-                  pip3 install -r requirements.txt</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-                  python3 .&#47;sign_image.py --command=&quot;sign&quot;\</span>
<span class="term-fg31">-                      --attestor-project-name=&quot;$ATTESTOR_PROJECT_NAME&quot;\</span>
<span class="term-fg31">-                      --attestor-name=&quot;$ATTESTOR_NAME&quot;\</span>
<span class="term-fg31">-                      --image-path=&quot;$IMAGE_PATH&quot;\</span>
<span class="term-fg31">-                      --signer-logging-level=&quot;INFO&quot;\</span>
<span class="term-fg31">-                      --attestor-key-id=&quot;&#47;&#47;cloudkms.googleapis.com&#47;v1&#47;projects&#47;$ATTESTOR_PROJECT_NAME&#47;locations&#47;global&#47;keyRings&#47;$ATTESTOR_NAME-key-ring&#47;cryptoKeys&#47;$ATTESTOR_NAME-key&#47;cryptoKeyVersions&#47;1&quot;</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-  build-geth:</span>
<span class="term-fg31">-    docker:</span>
<span class="term-fg31">-      - image: cimg&#47;go:1.21</span>
<span class="term-fg31">-    resource_class: xlarge</span>
<span class="term-fg31">-    steps:</span>
<span class="term-fg31">-      - checkout</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          command: go run build&#47;ci.go install</span>
<span class="term-fg31">-  unit-test:</span>
<span class="term-fg31">-    resource_class: xlarge</span>
<span class="term-fg31">-    docker:</span>
<span class="term-fg31">-      - image: cimg&#47;go:1.21</span>
<span class="term-fg31">-    steps:</span>
<span class="term-fg31">-      - checkout</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          command: go run build&#47;ci.go test</span>
<span class="term-fg31">-  lint-geth:</span>
<span class="term-fg31">-    resource_class: medium</span>
<span class="term-fg31">-    docker:</span>
<span class="term-fg31">-      - image: cimg&#47;go:1.21</span>
<span class="term-fg31">-    steps:</span>
<span class="term-fg31">-      - checkout</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          command: go run build&#47;ci.go lint</span>
<span class="term-fg31">-  tidy-geth:</span>
<span class="term-fg31">-    resource_class: small</span>
<span class="term-fg31">-    docker:</span>
<span class="term-fg31">-      - image: cimg&#47;go:1.21</span>
<span class="term-fg31">-    steps:</span>
<span class="term-fg31">-      - checkout</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          command: go mod tidy &amp;&amp; git diff --exit-code</span>
<span class="term-fg31">-  check-releases:</span>
<span class="term-fg31">-    docker:</span>
<span class="term-fg31">-      - image: cimg&#47;go:1.21</span>
<span class="term-fg31">-    steps:</span>
<span class="term-fg31">-      - checkout</span>
<span class="term-fg31">-      - run:</span>
<span class="term-fg31">-          command: .circleci&#47;check-releases.sh</span>
<span class="term-fg31">-      - slack&#47;notify:</span>
<span class="term-fg31">-          channel: C03N11M0BBN</span>
<span class="term-fg31">-          branch_pattern: optimism</span>
<span class="term-fg31">-          event: fail</span>
<span class="term-fg31">-          template: basic_fail_1</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-workflows:</span>
<span class="term-fg31">-  main:</span>
<span class="term-fg31">-    jobs:</span>
<span class="term-fg31">-      - build-geth:</span>
<span class="term-fg31">-          name: Build geth</span>
<span class="term-fg31">-      - unit-test:</span>
<span class="term-fg31">-          name: Run unit tests for geth</span>
<span class="term-fg31">-      - lint-geth:</span>
<span class="term-fg31">-          name: Run linter over geth</span>
<span class="term-fg31">-      - tidy-geth:</span>
<span class="term-fg31">-          name: Check geth go.mod file has been tidied</span>
<span class="term-fg31">-      - docker-release:</span>
<span class="term-fg31">-          name: Push to Docker</span>
<span class="term-fg31">-          docker_tags: &lt;&lt;pipeline.git.revision&gt;&gt;</span>
<span class="term-fg31">-          context:</span>
<span class="term-fg31">-            - oplabs-gcr</span>
<span class="term-fg31">-  release:</span>
<span class="term-fg31">-    jobs:</span>
<span class="term-fg31">-      - hold:</span>
<span class="term-fg31">-          type: approval</span>
<span class="term-fg31">-          filters:</span>
<span class="term-fg31">-            tags:</span>
<span class="term-fg31">-              only: &#47;^v.*&#47;</span>
<span class="term-fg31">-            branches:</span>
<span class="term-fg31">-              ignore: &#47;.*&#47;</span>
<span class="term-fg31">-      - docker-release:</span>
<span class="term-fg31">-          name: Push to Docker (release)</span>
<span class="term-fg31">-          filters:</span>
<span class="term-fg31">-            tags:</span>
<span class="term-fg31">-              only: &#47;^v.*&#47;</span>
<span class="term-fg31">-            branches:</span>
<span class="term-fg31">-              ignore: &#47;.*&#47;</span>
<span class="term-fg31">-          docker_tags: &lt;&lt;pipeline.git.revision&gt;&gt;,&lt;&lt;pipeline.git.tag&gt;&gt;</span>
<span class="term-fg31">-          push_tags: true</span>
<span class="term-fg31">-          context:</span>
<span class="term-fg31">-            - oplabs-gcr-release</span>
<span class="term-fg31">-          requires:</span>
<span class="term-fg31">-            - hold</span>
<span class="term-fg31">-  scheduled:</span>
<span class="term-fg31">-    triggers:</span>
<span class="term-fg31">-      - schedule:</span>
<span class="term-fg31">-          # run daily</span>
<span class="term-fg31">-          cron: &quot;0 0 * * *&quot;</span>
<span class="term-fg31">-          filters:</span>
<span class="term-fg31">-            branches:</span>
<span class="term-fg31">-              only: [ &quot;optimism&quot; ]</span>
<span class="term-fg31">-    jobs:</span>
<span class="term-fg31">-      - check-releases:</span>
<span class="term-fg31">-          name: Check for new upstream releases</span>
<span class="term-fg31">-          context: slack</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-4b91e791de17d6cec9d1990d" role="button"
                       aria-expanded="false" aria-controls="id-4b91e791de17d6cec9d1990d">
                        <code>.github/renovate.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/.github/renovate.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+18</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-4b91e791de17d6cec9d1990d"><span class="term-fg1">diff --git op-geth&#47;.github&#47;renovate.json CELO&#47;.github&#47;renovate.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..f19d8969ae48ed1dd6445c14ff9bfebf1de9ca26</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;.github&#47;renovate.json</span>
<span class="term-fg36">@@ -0,0 +1,18 @@</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+  &quot;$schema&quot;: &quot;https:&#47;&#47;docs.renovatebot.com&#47;renovate-schema.json&quot;,</span>
<span class="term-fg32">+  &quot;extends&quot;: [</span>
<span class="term-fg32">+    &quot;local&gt;celo-org&#47;.github:renovate-config&quot;</span>
<span class="term-fg32">+  ],</span>
<span class="term-fg32">+  &quot;packageRules&quot;: [</span>
<span class="term-fg32">+    {</span>
<span class="term-fg32">+      &quot;enabled&quot;: false,</span>
<span class="term-fg32">+      &quot;groupName&quot;: &quot;everything&quot;,</span>
<span class="term-fg32">+      &quot;matchManagers&quot;: [&quot;gomod&quot;, &quot;dockerfile&quot;, &quot;docker-compose&quot;, &quot;npm&quot;, &quot;html&quot;, &quot;github-actions&quot;, &quot;pip_requirements&quot;],</span>
<span class="term-fg32">+      &quot;matchPackagePatterns&quot;: [&quot;*&quot;],</span>
<span class="term-fg32">+      &quot;separateMajorMinor&quot;: false</span>
<span class="term-fg32">+    }</span>
<span class="term-fg32">+  ],</span>
<span class="term-fg32">+  &quot;vulnerabilityAlerts&quot;: {</span>
<span class="term-fg32">+    &quot;enabled&quot;: true</span>
<span class="term-fg32">+  }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-52a016c915e5e66a29f9f81e" role="button"
                       aria-expanded="false" aria-controls="id-52a016c915e5e66a29f9f81e">
                        <code>.github/workflows/ci.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/.github/workflows/ci.yaml" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+56</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-52a016c915e5e66a29f9f81e"><span class="term-fg1">diff --git op-geth&#47;.github&#47;workflows&#47;ci.yaml CELO&#47;.github&#47;workflows&#47;ci.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..0241711c87328bedc7cdc28d323a9dab36a0ac52</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;.github&#47;workflows&#47;ci.yaml</span>
<span class="term-fg36">@@ -0,0 +1,56 @@</span>
<span class="term-fg32">+name: CI</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+on:</span>
<span class="term-fg32">+  push:</span>
<span class="term-fg32">+    branches:</span>
<span class="term-fg32">+      - master</span>
<span class="term-fg32">+      - celo*</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+  pull_request:</span>
<span class="term-fg32">+    branches:</span>
<span class="term-fg32">+      - master</span>
<span class="term-fg32">+      - celo*</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+  workflow_dispatch:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  Test:</span>
<span class="term-fg32">+    runs-on: [&quot;8-cpu&quot;,&quot;self-hosted&quot;,&quot;org&quot;]</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+        - uses: actions&#47;checkout@v4</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        - uses: actions&#47;setup-go@v5</span>
<span class="term-fg32">+          with:</span>
<span class="term-fg32">+            go-version: &#39;1.21&#39;</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        - name: Build</span>
<span class="term-fg32">+          run: make all</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        - name: Test</span>
<span class="term-fg32">+          run: make test</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        - uses: actions&#47;setup-node@v4</span>
<span class="term-fg32">+          with:</span>
<span class="term-fg32">+            node-version: 18</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        - name: Install Foundry</span>
<span class="term-fg32">+          uses: foundry-rs&#47;foundry-toolchain@v1</span>
<span class="term-fg32">+          with:</span>
<span class="term-fg32">+            version: nightly-f625d0fa7c51e65b4bf1e8f7931cd1c6e2e285e9</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        - name: Run e2e tests</span>
<span class="term-fg32">+          shell: bash</span>
<span class="term-fg32">+          run: e2e_test&#47;run_all_tests.sh</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+  Lint:</span>
<span class="term-fg32">+    runs-on: [&quot;8-cpu&quot;,&quot;self-hosted&quot;,&quot;org&quot;]</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+        - uses: actions&#47;checkout@v4</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        - uses: actions&#47;setup-go@v5</span>
<span class="term-fg32">+          with:</span>
<span class="term-fg32">+            go-version: &#39;1.21&#39;</span>
<span class="term-fg32">+            cache: false</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+        - name: Lint</span>
<span class="term-fg32">+          run: make lint</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-cd3fc57ed9a56f1c33a15ccf" role="button"
                       aria-expanded="false" aria-controls="id-cd3fc57ed9a56f1c33a15ccf">
                        <code>.github/workflows/docker-build-scan.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/.github/workflows/docker-build-scan.yaml" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+17</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cd3fc57ed9a56f1c33a15ccf"><span class="term-fg1">diff --git op-geth&#47;.github&#47;workflows&#47;docker-build-scan.yaml CELO&#47;.github&#47;workflows&#47;docker-build-scan.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..475a5cffb9038c72bd89a9b40eed5fe85a2e9e1d</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;.github&#47;workflows&#47;docker-build-scan.yaml</span>
<span class="term-fg36">@@ -0,0 +1,17 @@</span>
<span class="term-fg32">+name: Docker Build Push</span>
<span class="term-fg32">+on:</span>
<span class="term-fg32">+  push:</span>
<span class="term-fg32">+  workflow_dispatch:</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  build-scan-container:</span>
<span class="term-fg32">+    uses: celo-org&#47;reusable-workflows&#47;.github&#47;workflows&#47;container-cicd.yaml@main</span>
<span class="term-fg32">+    name: Build us-west1-docker.pkg.dev&#47;blockchaintestsglobaltestnet&#47;dev-images&#47;op-geth:${{ github.sha }}</span>
<span class="term-fg32">+    with:</span>
<span class="term-fg32">+      workload-id-provider: projects&#47;1094498259535&#47;locations&#47;global&#47;workloadIdentityPools&#47;gh-op-geth&#47;providers&#47;github-by-repos</span>
<span class="term-fg32">+      service-account: &#39;op-geth-dev@blockchaintestsglobaltestnet.iam.gserviceaccount.com&#39;</span>
<span class="term-fg32">+      artifact-registry: us-west1-docker.pkg.dev&#47;blockchaintestsglobaltestnet&#47;dev-images&#47;op-geth</span>
<span class="term-fg32">+      tags: ${{ github.sha }}</span>
<span class="term-fg32">+      context: .</span>
<span class="term-fg32">+      file: Dockerfile</span>
<span class="term-fg32">+      trivy: true</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-cbd5f401c6b69dd200e5b695" role="button"
                       aria-expanded="false" aria-controls="id-cbd5f401c6b69dd200e5b695">
                        <code>.github/workflows/pages.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/.github/workflows/pages.yaml" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/.github/workflows/pages.yaml" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-6</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-cbd5f401c6b69dd200e5b695"><span class="term-fg1">diff --git op-geth&#47;.github&#47;workflows&#47;pages.yaml CELO&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg1">index 3c45b5d3390e8fa379824c7001f308ad721a2f86..1002ebfee1314ed7a823bb99b9fe305bd642c8e8 100644</span>
<span class="term-fg1">--- op-geth&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg1">+++ CELO&#47;.github&#47;workflows&#47;pages.yaml</span>
<span class="term-fg36">@@ -4,16 +4,17 @@</span>   contents: write
 on:
   push:
     branches:
<span class="term-fg31">-      - optimism</span>
<span class="term-fg32">+      - celo[0-9]+</span>
<span class="term-fg32">+</span>
 jobs:
   deploy:
     concurrency: ci-${{ github.ref }}
     runs-on: ubuntu-latest
     steps:
       - name: Checkout
<span class="term-fg31">-        uses: actions&#47;checkout@v3</span>
<span class="term-fg32">+        uses: actions&#47;checkout@v4</span>
         with:
<span class="term-fg31">-          fetch-depth: 1000  # make sure to fetch the old commit we diff against</span>
<span class="term-fg32">+          fetch-depth: 0  # make sure to fetch the old commit we diff against</span>
&nbsp;
       - name: Build forkdiff
         uses: &quot;docker:&#47;&#47;protolambda&#47;forkdiff:0.1.0&quot;
<span class="term-fg36">@@ -25,9 +26,6 @@</span>         run: |
           mkdir -p tmp&#47;pages
           mv index.html tmp&#47;pages&#47;index.html
           touch tmp&#47;pages&#47;.nojekyll
<span class="term-fg31">-          if [ &quot;$GITHUB_REPOSITORY&quot; == &quot;ethereum-optimism&#47;op-geth&quot; ]; then</span>
<span class="term-fg31">-              echo &quot;op-geth.optimism.io&quot; &gt; tmp&#47;pages&#47;CNAME</span>
<span class="term-fg31">-          fi;</span>
&nbsp;
       - name: Deploy
         uses: JamesIves&#47;github-pages-deploy-action@v4</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-380d4c35abdbcf3e946de5a2" role="button"
                       aria-expanded="false" aria-controls="id-380d4c35abdbcf3e946de5a2">
                        <code>.github/workflows/pr.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/.github/workflows/pr.yaml" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+17</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-380d4c35abdbcf3e946de5a2"><span class="term-fg1">diff --git op-geth&#47;.github&#47;workflows&#47;pr.yaml CELO&#47;.github&#47;workflows&#47;pr.yaml</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6738c729a13fea04a5f53276653163355a5ecf92</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;.github&#47;workflows&#47;pr.yaml</span>
<span class="term-fg36">@@ -0,0 +1,17 @@</span>
<span class="term-fg32">+name: PR only</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+on:</span>
<span class="term-fg32">+  pull_request:</span>
<span class="term-fg32">+    branches:</span>
<span class="term-fg32">+      - master</span>
<span class="term-fg32">+      - celo*</span>
<span class="term-fg32">+</span>
<span class="term-fg32">+jobs:</span>
<span class="term-fg32">+  dependencies:</span>
<span class="term-fg32">+    concurrency: ci-${{ github.ref }}</span>
<span class="term-fg32">+    runs-on: ubuntu-latest</span>
<span class="term-fg32">+    steps:</span>
<span class="term-fg32">+      - name: &quot;Dependency Review&quot;</span>
<span class="term-fg32">+        uses: actions&#47;dependency-review-action@v4</span>
<span class="term-fg32">+        with:</span>
<span class="term-fg32">+          warn-only: true</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-275aebe859157246712976bd" role="button"
                       aria-expanded="false" aria-controls="id-275aebe859157246712976bd">
                        <code>eth/tracers/internal/tracetest/testdata/call_tracer/deposit.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/internal/tracetest/testdata/call_tracer/deposit.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+52</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-275aebe859157246712976bd"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;deposit.json CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;deposit.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..c4f335ac7d010486c005513d3a8efdeb5ef02d70</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;deposit.json</span>
<span class="term-fg36">@@ -0,0 +1,52 @@</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+  &quot;context&quot;: {</span>
<span class="term-fg32">+    &quot;difficulty&quot;: &quot;3699098917&quot;,</span>
<span class="term-fg32">+    &quot;gasLimit&quot;: &quot;5258985&quot;,</span>
<span class="term-fg32">+    &quot;miner&quot;: &quot;0xd049bfd667cb46aa3ef5df0da3e57db3be39e511&quot;,</span>
<span class="term-fg32">+    &quot;number&quot;: &quot;2294631&quot;,</span>
<span class="term-fg32">+    &quot;timestamp&quot;: &quot;1513675366&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  &quot;genesis&quot;: {</span>
<span class="term-fg32">+    &quot;alloc&quot;: {</span>
<span class="term-fg32">+      &quot;0xBc339E628E6fe32C39E84392D087567B2743Ea35&quot;: {</span>
<span class="term-fg32">+        &quot;balance&quot;: &quot;0x99999999999999999&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;config&quot;: {</span>
<span class="term-fg32">+      &quot;chainId&quot;: 3,</span>
<span class="term-fg32">+      &quot;daoForkSupport&quot;: true,</span>
<span class="term-fg32">+      &quot;eip150Hash&quot;: &quot;0x41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d&quot;,</span>
<span class="term-fg32">+      &quot;ethash&quot;: {},</span>
<span class="term-fg32">+      &quot;eip150Block&quot;: 0,</span>
<span class="term-fg32">+      &quot;eip155Block&quot;: 0,</span>
<span class="term-fg32">+      &quot;eip158Block&quot;: 0,</span>
<span class="term-fg32">+      &quot;byzantiumBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;constantinopleBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;petersburgBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;istanbulBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;berlinBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;londonBlock&quot;: 0</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;difficulty&quot;: &quot;3699098917&quot;,</span>
<span class="term-fg32">+    &quot;extraData&quot;: &quot;0x4554482e45544846414e532e4f52472d4641313738394444&quot;,</span>
<span class="term-fg32">+    &quot;gasLimit&quot;: &quot;5263953&quot;,</span>
<span class="term-fg32">+    &quot;hash&quot;: &quot;0x03a0f62a8106793dafcfae7b75fd2654322062d585a19cea568314d7205790dc&quot;,</span>
<span class="term-fg32">+    &quot;miner&quot;: &quot;0xbbf5029fd710d227630c8b7d338051b8e76d50b3&quot;,</span>
<span class="term-fg32">+    &quot;mixHash&quot;: &quot;0x15482cc64b7c00a947f5bf015dfc010db1a6a668c74df61974d6a7848c174408&quot;,</span>
<span class="term-fg32">+    &quot;nonce&quot;: &quot;0xd1bdb150f6fd170e&quot;,</span>
<span class="term-fg32">+    &quot;number&quot;: &quot;2294630&quot;,</span>
<span class="term-fg32">+    &quot;stateRoot&quot;: &quot;0x1ab1a534e84cc787cda1db21e0d5920ab06017948075b759166cfea7274657a1&quot;,</span>
<span class="term-fg32">+    &quot;timestamp&quot;: &quot;1513675347&quot;,</span>
<span class="term-fg32">+    &quot;totalDifficulty&quot;: &quot;7160543502214733&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  &quot;input&quot;: &quot;0x7ef85aa0b4f9f798a5fe956d1b79c3eff355febf9e1039a7440948845536982cb62aa03194bc339e628e6fe32c39e84392d087567b2743ea3594bc339e628e6fe32c39e84392d087567b2743ea3580871aa535d3d0c00083030d408000&quot;,</span>
<span class="term-fg32">+  &quot;result&quot;: {</span>
<span class="term-fg32">+    &quot;from&quot;:&quot;0xBc339E628E6fe32C39E84392D087567B2743Ea35&quot;,</span>
<span class="term-fg32">+    &quot;to&quot;: &quot;0xbc339e628e6fe32c39e84392d087567b2743ea35&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;:&quot;0x30d40&quot;,</span>
<span class="term-fg32">+    &quot;gasUsed&quot;:&quot;0x30d40&quot;,</span>
<span class="term-fg32">+    &quot;input&quot;:&quot;0x00&quot;,</span>
<span class="term-fg32">+    &quot;value&quot;: &quot;0x1aa535d3d0c000&quot;,</span>
<span class="term-fg32">+    &quot;type&quot;:&quot;CALL&quot;</span>
<span class="term-fg32">+  }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-dc7fbf98e20fc659573966ed" role="button"
                       aria-expanded="false" aria-controls="id-dc7fbf98e20fc659573966ed">
                        <code>eth/tracers/internal/tracetest/testdata/call_tracer/transfer_precompile.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/internal/tracetest/testdata/call_tracer/transfer_precompile.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+83</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-dc7fbf98e20fc659573966ed"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;transfer_precompile.json CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;transfer_precompile.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..6d073db7504279461ca80b8b6ca570edc3a03384</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer&#47;transfer_precompile.json</span>
<span class="term-fg36">@@ -0,0 +1,83 @@</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+  &quot;genesis&quot;: {</span>
<span class="term-fg32">+    &quot;baseFeePerGas&quot;: &quot;875000000&quot;,</span>
<span class="term-fg32">+    &quot;difficulty&quot;: &quot;0&quot;,</span>
<span class="term-fg32">+    &quot;extraData&quot;: &quot;0xd8820100846765746888676f312e32312e368664617277696e&quot;,</span>
<span class="term-fg32">+    &quot;gasLimit&quot;: &quot;11511229&quot;,</span>
<span class="term-fg32">+    &quot;hash&quot;: &quot;0x5d605116d6623291269abed0d1f35e1e3bb04dd44e2039007e3111ca0cef1624&quot;,</span>
<span class="term-fg32">+    &quot;miner&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,</span>
<span class="term-fg32">+    &quot;mixHash&quot;: &quot;0x5e9f72a9c84605a6ac33f5b5c603a7ce89c63be3f9b9de3072beb167f0062131&quot;,</span>
<span class="term-fg32">+    &quot;nonce&quot;: &quot;0x0000000000000000&quot;,</span>
<span class="term-fg32">+    &quot;number&quot;: &quot;1&quot;,</span>
<span class="term-fg32">+    &quot;stateRoot&quot;: &quot;0x72c0d1653648a020479291917e2fedce749162b54a6d33962481f58815d2537f&quot;,</span>
<span class="term-fg32">+    &quot;timestamp&quot;: &quot;1721214738&quot;,</span>
<span class="term-fg32">+    &quot;totalDifficulty&quot;: &quot;1&quot;,</span>
<span class="term-fg32">+    &quot;withdrawals&quot;: [],</span>
<span class="term-fg32">+    &quot;withdrawalsRoot&quot;: &quot;0x56e81f171bcc55a6ff8345e692c0f86e5b48e01b996cadc001622fb5e363b421&quot;,</span>
<span class="term-fg32">+    &quot;alloc&quot;: {</span>
<span class="term-fg32">+        &quot;0x0000000000000000000000000000000000000000&quot;: {</span>
<span class="term-fg32">+          &quot;balance&quot;: &quot;0x0&quot;</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        &quot;0x00000000000000000000000000000000000000fd&quot;: {</span>
<span class="term-fg32">+          &quot;balance&quot;: &quot;0x0&quot;</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        &quot;0x42cf1bbc38baaa3c4898ce8790e21ed2738c6a4a&quot;: {</span>
<span class="term-fg32">+          &quot;balance&quot;: &quot;0x56bc74344293a6d9c&quot;,</span>
<span class="term-fg32">+          &quot;nonce&quot;: &quot;1&quot;</span>
<span class="term-fg32">+        },</span>
<span class="term-fg32">+        &quot;0x471ece3750da237f93b8e339c536989b8978a438&quot;: {</span>
<span class="term-fg32">+          &quot;balance&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+          &quot;code&quot;: &quot;0x608060405234801561001057600080fd5b50600436106101fb5760003560e01c80637b1039991161011a578063a91ee0dc116100ad578063d4d83cfb1161007c578063d4d83cfb14610565578063db2b4d101461056d578063dd62ed3e14610593578063e1d6aceb146105c1578063f2fde38b14610646576101fb565b8063a91ee0dc146104f4578063b921e1631461051a578063c4d66de814610537578063c80ec5221461055d576101fb565b80639358928b116100e95780639358928b1461048c57806395d89b4114610494578063a457c2d71461049c578063a9059cbb146104c8576101fb565b80637b1039991461043b57806387f8ab261461045f5780638da5cb5b1461047c5780638f32d59b14610484576101fb565b8063395093511161019257806354255be01161016157806354255be0146103d757806370a0823114610405578063715018a61461042b57806376348f7114610433576101fb565b8063395093511461035a5780633a70a5ca1461038657806340c10f191461038e57806342966c68146103ba576101fb565b806318160ddd116101ce57806318160ddd146102e457806323b872dd146102fe578063265126bd14610334578063313ce5671461033c576101fb565b80630562b9f71461020057806306fdde031461021f578063095ea7b31461029c578063158ef93e146102dc575b600080fd5b61021d6004803603602081101561021657600080fd5b503561066c565b005b61022761070d565b6040805160208082528351818301528351919283929083019185019080838360005b83811015610261578181015183820152602001610249565b50505050905090810190601f16801561028e5780820380516001836020036101000a031916815260200191505b509250505060405180910390f35b6102c8600480360360408110156102b257600080fd5b506001600160a01b038135169060200135610739565b604080519115158252519081900360200190f35b6102c86107fe565b6102ec610807565b60408051918252519081900360200190f35b6102c86004803603606081101561031457600080fd5b506001600160a01b03813581169160208101359091169060400135610846565b6102ec610b17565b610344610b29565b6040805160ff9092168252519081900360200190f35b6102c86004803603604081101561037057600080fd5b506001600160a01b038135169060200135610b2e565b6102ec610c2a565b6102c8600480360360408110156103a457600080fd5b506001600160a01b038135169060200135610c8e565b6102c8600480360360208110156103d057600080fd5b5035610eb6565b6103df610ec4565b604080519485526020850193909352838301919091526060830152519081900360800190f35b6102ec6004803603602081101561041b57600080fd5b50356001600160a01b0316610ed1565b61021d610ede565b6102c8610f74565b610443610f88565b604080516001600160a01b039092168252519081900360200190f35b61021d6004803603602081101561047557600080fd5b5035610f97565b610443611033565b6102c8611047565b6102ec611070565b61022761109e565b6102c8600480360360408110156104b257600080fd5b506001600160a01b0381351690602001356110bc565b6102c8600480360360408110156104de57600080fd5b506001600160a01b0381351690602001356110f1565b61021d6004803603602081101561050a57600080fd5b50356001600160a01b0316611104565b61021d6004803603602081101561053057600080fd5b50356111f0565b61021d6004803603602081101561054d57600080fd5b50356001600160a01b0316611257565b6102ec6112d4565b6104436112da565b61021d6004803603602081101561058357600080fd5b50356001600160a01b03166112e9565b6102ec600480360360408110156105a957600080fd5b506001600160a01b03813581169160200135166113e3565b6102c8600480360360608110156105d757600080fd5b6001600160a01b038235169160208101359181019060608101604082013564010000000081111561060757600080fd5b82018360208201111561061957600080fd5b8035906020019184600183028401116401000000008311171561063b57600080fd5b50909250905061140e565b61021d6004803603602081101561065c57600080fd5b50356001600160a01b0316611486565b610674610f74565b6106af5760405162461bcd60e51b81526004018080602001828103825260238152602001806119e76023913960400191505060405180910390fd5b6016602160991b0133146106f45760405162461bcd60e51b81526004018080602001828103825260228152602001806119076022913960400191505060405180910390fd5b600454610707908263ffffffff6114d616565b60045550565b60408051808201909152601181527010d95b1bc81b985d1a5d9948185cdcd95d607a1b60208201525b90565b60006001600160a01b038316610796576040805162461bcd60e51b815260206004820152601a60248201527f63616e6e6f742073657420616c6c6f77616e636520666f722030000000000000604482015290519081900360640190fd5b3360008181526003602090815260408083206001600160a01b03881680855290835292819020869055805186815290519293927f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925929181900390910190a35060015b92915050565b60005460ff1681565b6000610811610f74565b1561083d57600454610836906b033b2e3c9fd0803ce80000009063ffffffff61153016565b9050610736565b50600254610736565b60006001600160a01b03831661088d5760405162461bcd60e51b815260040180806020018281038252602a815260200180611a0a602a913960400191505060405180910390fd5b61089684610ed1565b8211156108d45760405162461bcd60e51b81526004018080602001828103825260298152602001806119be6029913960400191505060405180910390fd5b6001600160a01b03841660009081526003602090815260408083203384529091529020548211156109365760405162461bcd60e51b8152600401808060200182810382526036815260200180611a346036913960400191505060405180910390fd5b600060fd815a9087878760405160200180846001600160a01b03166001600160a01b03168152602001836001600160a01b03166001600160a01b0316815260200182815260200193505050506040516020818303038152906040526040518082805190602001908083835b602083106109c05780518252601f1990920191602091820191016109a1565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381858888f193505050503d8060008114610a23576040519150601f19603f3d011682016040523d82523d6000602084013e610a28565b606091505b50508091505080610a77576040805162461bcd60e51b815260206004820152601460248201527310d15313c81d1c985b9cd9995c8819985a5b195960621b604482015290519081900360640190fd5b6001600160a01b0385166000908152600360209081526040808320338452909152902054610aab908463ffffffff61153016565b6001600160a01b03808716600081815260036020908152604080832033845282529182902094909455805187815290519288169391927fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef929181900390910190a3506001949350505050565b6000610b2461dead610ed1565b905090565b601290565b60006001600160a01b038316610b8b576040805162461bcd60e51b815260206004820152601a60248201527f63616e6e6f742073657420616c6c6f77616e636520666f722030000000000000604482015290519081900360640190fd5b3360009081526003602090815260408083206001600160a01b038716845290915281205490610bc0828563ffffffff6114d616565b3360008181526003602090815260408083206001600160a01b038b16808552908352928190208590558051858152905194955091937f8c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b9259281900390910190a3506001949350505050565b6000610c34610f74565b610c6f5760405162461bcd60e51b81526004018080602001828103825260238152602001806119e76023913960400191505060405180910390fd5b506005546001600160a01b0316316b033b2e3c9fd0803ce80000000390565b6000610c98611572565b3315610cde576040805162461bcd60e51b815260206004820152601060248201526f13db9b1e4815934818d85b8818d85b1b60821b604482015290519081900360640190fd5b81610ceb575060016107f8565b6001600160a01b038316610d305760405162461bcd60e51b81526004018080602001828103825260268152602001806119296026913960400191505060405180910390fd5b600254610d43908363ffffffff6114d616565b600255600060fd815a6040805160006020808301919091526001600160a01b038a168284015260608083018a905283518084039091018152608090920192839052815193949391929182918401908083835b60208310610db45780518252601f199092019160209182019101610d95565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381858888f193505050503d8060008114610e17576040519150601f19603f3d011682016040523d82523d6000602084013e610e1c565b606091505b50508091505080610e6b576040805162461bcd60e51b815260206004820152601460248201527310d15313c81d1c985b9cd9995c8819985a5b195960621b604482015290519081900360640190fd5b6040805184815290516001600160a01b038616916000917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360200190a35060019392505050565b60006107f861dead836115b8565b6001806003600090919293565b6001600160a01b03163190565b610ee6611047565b610f25576040805162461bcd60e51b8152602060048201819052602482015260008051602061199e833981519152604482015290519081900360640190fd5b600080546040516101009091046001600160a01b0316907f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e0908390a360008054610100600160a81b0319169055565b63ffffffff6018602160991b013b16151590565b6001546001600160a01b031681565b3315610fdd576040805162461bcd60e51b815260206004820152601060248201526f13db9b1e4815934818d85b8818d85b1b60821b604482015290519081900360640190fd5b610fe5610f74565b6110205760405162461bcd60e51b81526004018080602001828103825260238152602001806119e76023913960400191505060405180910390fd5b600454610707908263ffffffff61153016565b60005461010090046001600160a01b031690565b6000805461010090046001600160a01b031661106161176f565b6001600160a01b031614905090565b6000610b2461107f6000610ed1565b61109261108a610b17565b611092610807565b9063ffffffff61153016565b60408051808201909152600481526343454c4f60e01b602082015290565b3360009081526003602090815260408083206001600160a01b038616845290915281205481610bc0828563ffffffff61153016565b60006110fd8383611773565b9392505050565b61110c611047565b61114b576040805162461bcd60e51b8152602060048201819052602482015260008051602061199e833981519152604482015290519081900360640190fd5b6001600160a01b0381166111a6576040805162461bcd60e51b815260206004820181905260248201527f43616e6e6f7420726567697374657220746865206e756c6c2061646472657373604482015290519081900360640190fd5b600180546001600160a01b0319166001600160a01b0383169081179091556040517f27fe5f0c1c3b1ed427cc63d0f05759ffdecf9aec9e18d31ef366fc8a6cb5dc3b90600090a250565b6111f8611572565b331561123e576040805162461bcd60e51b815260206004820152601060248201526f13db9b1e4815934818d85b8818d85b1b60821b604482015290519081900360640190fd5b600254611251908263ffffffff6114d616565b60025550565b60005460ff16156112af576040805162461bcd60e51b815260206004820152601c60248201527f636f6e747261637420616c726561647920696e697469616c697a656400000000604482015290519081900360640190fd5b6000805460ff191660011781556002556112c8336117c4565b6112d181611104565b50565b60045481565b6005546001600160a01b031681565b6112f1611047565b611330576040805162461bcd60e51b8152602060048201819052602482015260008051602061199e833981519152604482015290519081900360640190fd5b6001600160a01b03811615158061135557506005546001600160a01b03828116911614155b611399576040805162461bcd60e51b815260206004820152601060248201526f24b73b30b634b21030b2323932b9b99760811b604482015290519081900360640190fd5b600580546001600160a01b0319166001600160a01b0383169081179091556040517f4b0e16c81bce2248d2d60ed469d2fe74152253bde95ba850f22ae056723980a690600090a250565b6001600160a01b03918216600090815260036020908152604080832093909416825291909152205490565b60008061141b8686611773565b90507fe5d4e30fb8364e57bc4d662a07d0cf36f4c34552004c4c3624620a2c1d1c03dc848460405180806020018281038252848482818152602001925080828437600083820152604051601f909101601f19169092018290039550909350505050a195945050505050565b61148e611047565b6114cd576040805162461bcd60e51b8152602060048201819052602482015260008051602061199e833981519152604482015290519081900360640190fd5b6112d1816117c4565b6000828201838110156110fd576040805162461bcd60e51b815260206004820152601b60248201527f536166654d6174683a206164646974696f6e206f766572666c6f770000000000604482015290519081900360640190fd5b60006110fd83836040518060400160405280601e81526020017f536166654d6174683a207375627472616374696f6e206f766572666c6f77000081525061186f565b61157a610f74565b156115b65760405162461bcd60e51b81526004018080602001828103825260298152602001806119756029913960400191505060405180910390fd5b565b60006115c333610ed1565b8211156116015760405162461bcd60e51b81526004018080602001828103825260298152602001806119be6029913960400191505060405180910390fd5b600060fd815a60408051336020808301919091526001600160a01b038a168284015260608083018a905283518084039091018152608090920192839052815193949391929182918401908083835b6020831061166e5780518252601f19909201916020918201910161164f565b6001836020036101000a038019825116818451168082178552505050505050905001915050600060405180830381858888f193505050503d80600081146116d1576040519150601f19603f3d011682016040523d82523d6000602084013e6116d6565b606091505b50508091505080611725576040805162461bcd60e51b815260206004820152601460248201527310d15313c81d1c985b9cd9995c8819985a5b195960621b604482015290519081900360640190fd5b6040805184815290516001600160a01b0386169133917fddf252ad1be2c89b69c2b068fc378daa952ba7f163c4a11628f55a4df523b3ef9181900360200190a35060019392505050565b3390565b60006001600160a01b0383166117ba5760405162461bcd60e51b815260040180806020018281038252602a815260200180611a0a602a913960400191505060405180910390fd5b6110fd83836115b8565b6001600160a01b0381166118095760405162461bcd60e51b815260040180806020018281038252602681526020018061194f6026913960400191505060405180910390fd5b600080546040516001600160a01b038085169361010090930416917f8be0079c531659141344cd1fd0a4f28419497f9722a3daafe3b4186f6b6457e091a3600080546001600160a01b0390921661010002610100600160a81b0319909216919091179055565b600081848411156118fe5760405162461bcd60e51b81526004018080602001828103825283818151815260200191508051906020019080838360005b838110156118c35781810151838201526020016118ab565b50505050905090810190601f1680156118f05780820380516001836020036101000a031916815260200191505b509250505060405180910390fd5b50505090039056fe4f6e6c79204c32546f4c314d6573736167655061737365722063616e2063616c6c2e6d696e7420617474656d7074656420746f2072657365727665642061646472657373203078304f776e61626c653a206e6577206f776e657220697320746865207a65726f206164647265737354686973206d6574686f64206973206e6f206c6f6e67657220737570706f7274656420696e204c322e4f776e61626c653a2063616c6c6572206973206e6f7420746865206f776e65727472616e736665722076616c75652065786365656465642062616c616e6365206f662073656e64657254686973206d6574686f64206973206e6f7420737570706f7274656420696e204c312e7472616e7366657220617474656d7074656420746f2072657365727665642061646472657373203078307472616e736665722076616c75652065786365656465642073656e646572277320616c6c6f77616e636520666f72207370656e646572a265627a7a72315820883737fc20fdb370fa6d2083191051192e78e14b9c9ed5974e58cd42d97124f264736f6c63430005110032&quot;</span>
<span class="term-fg32">+        }</span>
<span class="term-fg32">+      },</span>
<span class="term-fg32">+    &quot;config&quot;: {</span>
<span class="term-fg32">+        &quot;chainId&quot;: 1337,</span>
<span class="term-fg32">+        &quot;homesteadBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;eip150Block&quot;: 0,</span>
<span class="term-fg32">+        &quot;eip155Block&quot;: 0,</span>
<span class="term-fg32">+        &quot;eip158Block&quot;: 0,</span>
<span class="term-fg32">+        &quot;byzantiumBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;constantinopleBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;petersburgBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;istanbulBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;muirGlacierBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;berlinBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;londonBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;arrowGlacierBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;grayGlacierBlock&quot;: 0,</span>
<span class="term-fg32">+        &quot;shanghaiTime&quot;: 0,</span>
<span class="term-fg32">+        &quot;cel2Time&quot;: 0,</span>
<span class="term-fg32">+        &quot;terminalTotalDifficulty&quot;: 0,</span>
<span class="term-fg32">+        &quot;terminalTotalDifficultyPassed&quot;: true</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  &quot;context&quot;: {</span>
<span class="term-fg32">+    &quot;number&quot;: &quot;2&quot;,</span>
<span class="term-fg32">+    &quot;difficulty&quot;: &quot;0&quot;,</span>
<span class="term-fg32">+    &quot;timestamp&quot;: &quot;1721214739&quot;,</span>
<span class="term-fg32">+    &quot;gasLimit&quot;: &quot;11522469&quot;,</span>
<span class="term-fg32">+    &quot;miner&quot;: &quot;0x0000000000000000000000000000000000000000&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  &quot;input&quot;: &quot;0x02f8ad820539018084684ee18082857e94471ece3750da237f93b8e339c536989b8978a43880b844a9059cbb000000000000000000000000000000000000000000000000000000000000dead0000000000000000000000000000000000000000000000000000000000000064c080a08e63474fbf5acffb6848dca77cb51ab6341ee34e2a8dd3e13af9bb99363eb068a0439aee6906e998ba44680f29c309bd82621f7eae4591e9439ec2636b0ad933c6&quot;,</span>
<span class="term-fg32">+  &quot;result&quot;: {</span>
<span class="term-fg32">+    &quot;from&quot;: &quot;0x42cf1bbc38baaa3c4898ce8790e21ed2738c6a4a&quot;,</span>
<span class="term-fg32">+    &quot;gas&quot;: &quot;0x857e&quot;,</span>
<span class="term-fg32">+    &quot;gasUsed&quot;: &quot;0x83c9&quot;,</span>
<span class="term-fg32">+    &quot;to&quot;: &quot;0x471ece3750da237f93b8e339c536989b8978a438&quot;,</span>
<span class="term-fg32">+    &quot;input&quot;: &quot;0xa9059cbb000000000000000000000000000000000000000000000000000000000000dead0000000000000000000000000000000000000000000000000000000000000064&quot;,</span>
<span class="term-fg32">+    &quot;output&quot;: &quot;0x0000000000000000000000000000000000000000000000000000000000000001&quot;,</span>
<span class="term-fg32">+    &quot;calls&quot;: [</span>
<span class="term-fg32">+      {</span>
<span class="term-fg32">+        &quot;from&quot;: &quot;0x471ece3750da237f93b8e339c536989b8978a438&quot;,</span>
<span class="term-fg32">+        &quot;gas&quot;: &quot;0x2c16&quot;,</span>
<span class="term-fg32">+        &quot;gasUsed&quot;: &quot;0x2328&quot;,</span>
<span class="term-fg32">+        &quot;to&quot;: &quot;0x00000000000000000000000000000000000000fd&quot;,</span>
<span class="term-fg32">+        &quot;input&quot;: &quot;0x00000000000000000000000042cf1bbc38baaa3c4898ce8790e21ed2738c6a4a000000000000000000000000000000000000000000000000000000000000dead0000000000000000000000000000000000000000000000000000000000000064&quot;,</span>
<span class="term-fg32">+        &quot;value&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+        &quot;type&quot;: &quot;CALL&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    ],</span>
<span class="term-fg32">+    &quot;value&quot;: &quot;0x0&quot;,</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;CALL&quot;</span>
<span class="term-fg32">+  }</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-e13454da9ce6f63c98fced7d" role="button"
                       aria-expanded="false" aria-controls="id-e13454da9ce6f63c98fced7d">
                        <code>eth/tracers/internal/tracetest/testdata/call_tracer_flat/deposit.json</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <span class="text-muted">(new)</span>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/eth/tracers/internal/tracetest/testdata/call_tracer_flat/deposit.json" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+65</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-0</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-e13454da9ce6f63c98fced7d"><span class="term-fg1">diff --git op-geth&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;deposit.json CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;deposit.json</span>
<span class="term-fg1">new file mode 100644</span>
<span class="term-fg1">index 0000000000000000000000000000000000000000..a6439339d5526b1c6ddf8de213fa49dedcf48a2b</span>
<span class="term-fg1">--- &#47;dev&#47;null</span>
<span class="term-fg1">+++ CELO&#47;eth&#47;tracers&#47;internal&#47;tracetest&#47;testdata&#47;call_tracer_flat&#47;deposit.json</span>
<span class="term-fg36">@@ -0,0 +1,65 @@</span>
<span class="term-fg32">+{</span>
<span class="term-fg32">+  &quot;context&quot;: {</span>
<span class="term-fg32">+    &quot;difficulty&quot;: &quot;3699098917&quot;,</span>
<span class="term-fg32">+    &quot;gasLimit&quot;: &quot;5258985&quot;,</span>
<span class="term-fg32">+    &quot;miner&quot;: &quot;0xd049bfd667cb46aa3ef5df0da3e57db3be39e511&quot;,</span>
<span class="term-fg32">+    &quot;number&quot;: &quot;2294631&quot;,</span>
<span class="term-fg32">+    &quot;timestamp&quot;: &quot;1513675366&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  &quot;genesis&quot;: {</span>
<span class="term-fg32">+    &quot;alloc&quot;: {</span>
<span class="term-fg32">+      &quot;0xBc339E628E6fe32C39E84392D087567B2743Ea35&quot;: {</span>
<span class="term-fg32">+        &quot;balance&quot;: &quot;0x99999999999999999&quot;</span>
<span class="term-fg32">+      }</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;config&quot;: {</span>
<span class="term-fg32">+      &quot;daoForkSupport&quot;: true,</span>
<span class="term-fg32">+      &quot;chainId&quot;: 3,</span>
<span class="term-fg32">+      &quot;eip150Hash&quot;: &quot;0x41941023680923e0fe4d74a34bdac8141f2540e3ae90623718e47d66d1ca4a2d&quot;,</span>
<span class="term-fg32">+      &quot;ethash&quot;: {},</span>
<span class="term-fg32">+      &quot;eip150Block&quot;: 0,</span>
<span class="term-fg32">+      &quot;eip155Block&quot;: 0,</span>
<span class="term-fg32">+      &quot;eip158Block&quot;: 0,</span>
<span class="term-fg32">+      &quot;byzantiumBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;constantinopleBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;petersburgBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;istanbulBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;berlinBlock&quot;: 0,</span>
<span class="term-fg32">+      &quot;londonBlock&quot;: 0</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;difficulty&quot;: &quot;3699098917&quot;,</span>
<span class="term-fg32">+    &quot;extraData&quot;: &quot;0x4554482e45544846414e532e4f52472d4641313738394444&quot;,</span>
<span class="term-fg32">+    &quot;gasLimit&quot;: &quot;5263953&quot;,</span>
<span class="term-fg32">+    &quot;hash&quot;: &quot;0x03a0f62a8106793dafcfae7b75fd2654322062d585a19cea568314d7205790dc&quot;,</span>
<span class="term-fg32">+    &quot;miner&quot;: &quot;0xbbf5029fd710d227630c8b7d338051b8e76d50b3&quot;,</span>
<span class="term-fg32">+    &quot;mixHash&quot;: &quot;0x15482cc64b7c00a947f5bf015dfc010db1a6a668c74df61974d6a7848c174408&quot;,</span>
<span class="term-fg32">+    &quot;nonce&quot;: &quot;0xd1bdb150f6fd170e&quot;,</span>
<span class="term-fg32">+    &quot;number&quot;: &quot;2294630&quot;,</span>
<span class="term-fg32">+    &quot;stateRoot&quot;: &quot;0x1ab1a534e84cc787cda1db21e0d5920ab06017948075b759166cfea7274657a1&quot;,</span>
<span class="term-fg32">+    &quot;timestamp&quot;: &quot;1513675347&quot;,</span>
<span class="term-fg32">+    &quot;totalDifficulty&quot;: &quot;7160543502214733&quot;</span>
<span class="term-fg32">+  },</span>
<span class="term-fg32">+  &quot;input&quot;: &quot;0x7ef85aa0b4f9f798a5fe956d1b79c3eff355febf9e1039a7440948845536982cb62aa03194bc339e628e6fe32c39e84392d087567b2743ea3594bc339e628e6fe32c39e84392d087567b2743ea3580871aa535d3d0c00083030d408000&quot;,</span>
<span class="term-fg32">+  &quot;result&quot;: [{</span>
<span class="term-fg32">+    &quot;type&quot;: &quot;call&quot;,</span>
<span class="term-fg32">+    &quot;action&quot;: {</span>
<span class="term-fg32">+      &quot;author&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,</span>
<span class="term-fg32">+      &quot;refundAddress&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,</span>
<span class="term-fg32">+      &quot;from&quot;:&quot;0xBc339E628E6fe32C39E84392D087567B2743Ea35&quot;,</span>
<span class="term-fg32">+      &quot;to&quot;: &quot;0xbc339e628e6fe32c39e84392d087567b2743ea35&quot;,</span>
<span class="term-fg32">+      &quot;gas&quot;:&quot;0x30d40&quot;,</span>
<span class="term-fg32">+      &quot;gasUsed&quot;:&quot;0x30d40&quot;,</span>
<span class="term-fg32">+      &quot;input&quot;:&quot;0x00&quot;,</span>
<span class="term-fg32">+      &quot;value&quot;: &quot;0x1aa535d3d0c000&quot;,</span>
<span class="term-fg32">+      &quot;callType&quot;:&quot;call&quot;,</span>
<span class="term-fg32">+      &quot;address&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,</span>
<span class="term-fg32">+      &quot;balance&quot;: &quot;0x0&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;result&quot;: {</span>
<span class="term-fg32">+      &quot;address&quot;: &quot;0x0000000000000000000000000000000000000000&quot;,</span>
<span class="term-fg32">+      &quot;gasUsed&quot;: &quot;0x30d40&quot;,</span>
<span class="term-fg32">+      &quot;output&quot;: &quot;0x&quot;</span>
<span class="term-fg32">+    },</span>
<span class="term-fg32">+    &quot;traceAddress&quot;: []</span>
<span class="term-fg32">+  }]</span>
<span class="term-fg32">+}</span></div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-da925bf374be93199a584132" role="button"
                       aria-expanded="false" aria-controls="id-da925bf374be93199a584132">
                        <code>fork.yaml</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/fork.yaml" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/fork.yaml" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+47</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-245</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-da925bf374be93199a584132"><span class="term-fg1">diff --git op-geth&#47;fork.yaml CELO&#47;fork.yaml</span>
<span class="term-fg1">index 7244be0e7b6de286d9ed060619799e4c4cc692ce..a7045927d832c006a32202be89a709277c20cefe 100644</span>
<span class="term-fg1">--- op-geth&#47;fork.yaml</span>
<span class="term-fg1">+++ CELO&#47;fork.yaml</span>
<span class="term-fg36">@@ -1,268 +1,70 @@</span>
<span class="term-fg31">-title: &quot;op-geth - go-ethereum fork diff overview&quot;</span>
<span class="term-fg32">+# yamllint disable rule:line-length rule:document-start</span>
<span class="term-fg32">+title: &quot;CELO &lt;&gt; OP op-geth forkdiff&quot;</span>
 footer: |
<span class="term-fg31">-  Fork-diff overview of [`op-geth`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth), a fork of [`go-ethereum`](https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum).</span>
<span class="term-fg31">-  and execution-engine of the [OP-stack](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism).</span>
<span class="term-fg32">+  Fork-diff overview of changes made in [Celo&#39;s `op-geth`](https:&#47;&#47;github.com&#47;celo-org&#47;op-geth),</span>
<span class="term-fg32">+  a fork of [Optimism&#39;s `op-geth`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth).</span>
 base:
<span class="term-fg31">-  name: go-ethereum</span>
<span class="term-fg31">-  url: https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum</span>
<span class="term-fg31">-  hash: c5ba367eb6232e3eddd7d6226bfd374449c63164 # v1.13.15</span>
<span class="term-fg31">-fork:</span>
   name: op-geth
   url: https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth
<span class="term-fg31">-  ref: refs&#47;heads&#47;optimism</span>
<span class="term-fg32">+  hash: 7c2819836018bfe0ca07c4e4955754834ffad4e0</span>
<span class="term-fg32">+fork:</span>
<span class="term-fg32">+  name: CELO</span>
<span class="term-fg32">+  url: https:&#47;&#47;github.com&#47;celo-org&#47;op-geth</span>
<span class="term-fg32">+  ref: HEAD</span>
 def:
<span class="term-fg31">-  title: &quot;op-geth&quot;</span>
<span class="term-fg32">+  title: &quot;Celo&#39;s op-geth&quot;</span>
   description: |
<span class="term-fg31">-    This is an overview of the changes in [`op-geth`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth),</span>
<span class="term-fg31">-    a fork of [`go-ethereum`](https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum), part of the OP-stack.</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-    The OP-stack architecture is modular, following the Consensus&#47;Execution split of post-Merge Ethereum L1:</span>
<span class="term-fg31">-</span>
<span class="term-fg31">-      - [`op-node`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;tree&#47;develop&#47;op-node) implements most rollup-specific functionality as Consensus-Layer, similar to a L1 beacon-node. </span>
<span class="term-fg31">-      - [`op-geth`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth) implements the Execution-Layer, with **minimal changes** for a secure Ethereum-equivalent application environment.</span>
<span class="term-fg32">+    This is an overview of the changes in [Celo&#39;s `op-geth` implementation](https:&#47;&#47;github.com&#47;celo-org&#47;op-geth),</span>
<span class="term-fg32">+    a fork of [Optimism&#39;s `op-geth`](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;op-geth).</span>
&nbsp;
<span class="term-fg31">-    Related [op-stack specifications](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;tree&#47;develop&#47;specs):</span>
<span class="term-fg32">+    For differences between the base `op-geth` and `go-ethereum`, check out Optimism&#39;s</span>
<span class="term-fg32">+    [fork-diff overview of changes](https:&#47;&#47;op-geth.optimism.io&#47;).</span>
&nbsp;
<span class="term-fg31">-    - [L2 Execution Engine spec](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;blob&#47;develop&#47;specs&#47;exec-engine.md)</span>
<span class="term-fg31">-    - [Deposit Transaction spec](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;blob&#47;develop&#47;specs&#47;deposits.md)</span>
   sub:
<span class="term-fg31">-    - title: &quot;Core modifications&quot;</span>
<span class="term-fg32">+    - title: &quot;Celo-specific features&quot;</span>
       sub:
<span class="term-fg31">-        - title: &quot;State-transition modifications&quot;</span>
<span class="term-fg31">-          description: &quot;&quot;</span>
<span class="term-fg31">-          sub:</span>
<span class="term-fg31">-            - title: &quot;Deposit Transaction type&quot;</span>
<span class="term-fg31">-              description: |</span>
<span class="term-fg31">-                The Bedrock upgrade introduces a `Deposit` transaction-type (`0x7E`) to enable both users and the</span>
<span class="term-fg31">-                rollup system itself to change the L2 state based on L1 events and system rules as</span>
<span class="term-fg31">-                [specified](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;blob&#47;develop&#47;specs&#47;deposits.md).</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;deposit_tx.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;transaction_marshalling.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;transaction_signing.go&quot;</span>
<span class="term-fg31">-            - title: &quot;Transaction properties&quot;</span>
<span class="term-fg31">-              description: |</span>
<span class="term-fg31">-                The `Transaction` type now exposes the deposit-transaction and L1-cost properties required for the rollup.</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;transaction.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;tx_access_list.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;tx_dynamic_fee.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;tx_legacy.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;tx_blob.go&quot;</span>
<span class="term-fg31">-            - title: &quot;L1 cost computation&quot;</span>
<span class="term-fg31">-              description: |</span>
<span class="term-fg31">-                Transactions must pay an additional L1 cost based on the amount of rollup-data-gas they consume,</span>
<span class="term-fg31">-                estimated based on gas-price-oracle information and encoded tx size.&quot;</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;core&#47;vm&#47;evm.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;evm.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;types&#47;rollup_cost.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;state_processor.go&quot;</span>
<span class="term-fg31">-                - &quot;core&#47;state_prefetcher.go&quot;</span>
<span class="term-fg31">-            - title: Transaction processing</span>
<span class="term-fg31">-              description: |</span>
<span class="term-fg31">-                Deposit transactions have special processing rules: gas is pre-paid on L1,</span>
<span class="term-fg31">-                and deposits with EVM-failure are included with rolled back changes (except mint).</span>
<span class="term-fg31">-                For regular transactions, at the end of the transition, the 1559 burn and L1 cost are routed to vaults.</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;core&#47;state_transition.go&quot;</span>
<span class="term-fg31">-            - title: &quot;Core Error definitions&quot;</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;core&#47;error.go&quot;</span>
<span class="term-fg31">-            - title: &quot;Gaslimit&quot;</span>
<span class="term-fg31">-              description: |</span>
<span class="term-fg31">-                The gaslimit is free to be set by the Engine API caller, instead of enforcing adjustments of the</span>
<span class="term-fg31">-                gaslimit in increments of 1&#47;1024 of the previous gaslimit.</span>
<span class="term-fg31">-                The gaslimit is changed (and limited) through the `SystemConfig` contract.</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;consensus&#47;misc&#47;eip1559&#47;eip1559.go&quot;</span>
<span class="term-fg31">-            - title: &quot;Consensus tweaks&quot;</span>
<span class="term-fg31">-              description: |</span>
<span class="term-fg31">-                The Engine API is activated at the Merge transition, with a Total Terminal Difficulty (TTD).</span>
<span class="term-fg31">-                The rollup starts post-merge, and thus sets the TTD to 0.</span>
<span class="term-fg31">-                The TTD is always &quot;reached&quot; starting at the bedrock block.</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;consensus&#47;beacon&#47;consensus.go&quot;</span>
<span class="term-fg31">-            - title: &quot;Legacy OP-mainnet &#47; OP-goerli header-verification support&quot;</span>
<span class="term-fg31">-              description: |</span>
<span class="term-fg31">-                Pre-Bedrock OP-mainnet and OP-Goerli had differently formatted block-headers, loosely compatible with the geth types (since it was based on Clique).</span>
<span class="term-fg31">-                However, due to differences like the extra-data length (97+ bytes), these legacy block-headers need special verification.</span>
<span class="term-fg31">-                The pre-merge &quot;consensus&quot; fallback is set to this custom but basic verifier, to accept these headers when syncing a pre-bedrock part of the chain,</span>
<span class="term-fg31">-                independent of any clique code or configuration (which may be removed from geth at a later point).</span>
<span class="term-fg31">-                All the custom verifier has to do is accept the headers, as the headers are already verified by block-hash through the reverse-header-sync.</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;consensus&#47;beacon&#47;oplegacy.go&quot;</span>
<span class="term-fg31">-        - title: &quot;Engine API modifications&quot;</span>
<span class="term-fg31">-          description: |</span>
<span class="term-fg31">-            The Engine API is extended to insert transactions into the block and optionally exclude the tx-pool,</span>
<span class="term-fg31">-            to reproduce the exact block of the sequencer from just the inputs, as derived from L1 by the rollup-node.</span>
<span class="term-fg31">-            See [L2 execution engine specs](https:&#47;&#47;github.com&#47;ethereum-optimism&#47;optimism&#47;blob&#47;develop&#47;specs&#47;exec-engine.md).</span>
<span class="term-fg32">+        - title: &quot;Celo token duality&quot;</span>
<span class="term-fg32">+          description: &quot;The Celo token is both the native token and ERC-20 compatible.&quot;</span>
           globs:
<span class="term-fg31">-            - &quot;beacon&#47;engine&#47;types.go&quot;</span>
<span class="term-fg31">-            - &quot;beacon&#47;engine&#47;gen_blockparams.go&quot;</span>
<span class="term-fg31">-            - &quot;eth&#47;catalyst&#47;api.go&quot;</span>
<span class="term-fg31">-        - title: &quot;Block-building modifications&quot;</span>
<span class="term-fg31">-          description: |</span>
<span class="term-fg31">-            The block-building code (in the &quot;miner&quot; package because of Proof-Of-Work legacy of ethereum) implements the</span>
<span class="term-fg31">-            changes to support the transaction-inclusion, tx-pool toggle and gaslimit parameters of the Engine API.</span>
<span class="term-fg32">+            - &quot;core&#47;vm&#47;celo_contracts*.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;vm&#47;contracts*.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;vm&#47;evm.go&quot;</span>
<span class="term-fg32">+        - title: &quot;Celo fee currencies&quot;</span>
<span class="term-fg32">+          description: &quot;Fee currencies allow to pay transaction fees with ERC20 tokens.&quot;</span>
           globs:
<span class="term-fg31">-            - &quot;miner&#47;*&quot;</span>
<span class="term-fg31">-        - title: &quot;Tx-pool tx cost updates&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;evm.go&quot;</span>
<span class="term-fg32">+            - &quot;contracts&#47;fee_currencies.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;blockchain_celo_test.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;celo_evm.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;state_processor.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;state_transition.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;types&#47;celo_dynamic_fee_tx.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;types&#47;celo_transaction_signing.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;txpool&#47;*&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;txpool&#47;*&#47;*&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;types&#47;receipt*.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;types&#47;transaction*.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;types&#47;tx*.go&quot;</span>
<span class="term-fg32">+        - title: &quot;Celo contracts&quot;</span>
           description: |
<span class="term-fg31">-            Transaction queueing and inclusion needs to account for the L1 cost component.</span>
<span class="term-fg32">+            Contract bindings are necessary for token duality and gas currencies.</span>
<span class="term-fg32">+            The corresponding contracts are included to generate the bindings and test these features.</span>
           globs:
<span class="term-fg31">-            - &quot;core&#47;txpool&#47;**&#47;*&quot;</span>
<span class="term-fg31">-            - &quot;core&#47;txpool&#47;legacypool&#47;*&quot;</span>
<span class="term-fg31">-    - title: &quot;Chain Configuration&quot;</span>
<span class="term-fg31">-      sub:</span>
<span class="term-fg32">+            - &quot;contracts&#47;celo&#47;*&quot;</span>
<span class="term-fg32">+            - &quot;contracts&#47;celo&#47;*&#47;*&quot;</span>
<span class="term-fg32">+            - &quot;contracts&#47;config&#47;registry_ids.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;celo_backend.go&quot;</span>
<span class="term-fg32">+            - &quot;core&#47;celo_genesis.go&quot;</span>
         - title: &quot;Chain config&quot;
<span class="term-fg31">-          description: |</span>
<span class="term-fg31">-            The rollup functionality is enabled with the `optimism` field in the chain config.</span>
<span class="term-fg31">-            The EIP-1559 parameters are configurable to adjust for faster more frequent and smaller blocks.</span>
<span class="term-fg31">-            The parameters can be overriden for testing.</span>
<span class="term-fg32">+          description: &quot;&quot;</span>
           globs:
             - &quot;params&#47;config.go&quot;
             - &quot;params&#47;protocol_params.go&quot;
             - &quot;core&#47;genesis.go&quot;
<span class="term-fg31">-        - title: &quot;Chain config cleanup&quot;</span>
<span class="term-fg31">-          description: |</span>
<span class="term-fg31">-            The optimism Goerli testnet used clique-config data to make geth internals accept blocks.</span>
<span class="term-fg31">-            Post-bedrock the beacon-consensus (i.e. follow Engine API) is now used, and the clique config is removed.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;core&#47;rawdb&#47;accessors_metadata.go&quot;</span>
<span class="term-fg31">-        - title: Genesis loading</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;core&#47;gen_genesis.go&quot;</span>
<span class="term-fg31">-        - title: &quot;Superchain config&quot;</span>
<span class="term-fg31">-          description: Testing of the superchain configuration</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;core&#47;superchain.go&quot;</span>
<span class="term-fg31">-            - &quot;params&#47;superchain.go&quot;</span>
<span class="term-fg31">-    - title: &quot;Node modifications&quot;</span>
<span class="term-fg31">-      description: Changes to the node configuration and services.</span>
<span class="term-fg31">-      sub:</span>
<span class="term-fg31">-        - title: &quot;CLI&quot;</span>
<span class="term-fg31">-          sub:</span>
<span class="term-fg31">-            - title: &quot;Flags&quot;</span>
<span class="term-fg31">-              description: |</span>
<span class="term-fg31">-                Flag changes:</span>
<span class="term-fg31">-                  - Transactions can be forwarded to an RPC for sequencing.</span>
<span class="term-fg31">-                  - Historical calls can be forwarded to a legacy node.</span>
<span class="term-fg31">-                  - The tx pool propagation can be enabled&#47;disabled.</span>
<span class="term-fg31">-                  - The Optimism bedrock fork activation can be changed for testing.</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;cmd&#47;utils&#47;flags.go&quot;</span>
<span class="term-fg31">-                - &quot;cmd&#47;geth&#47;main.go&quot;</span>
<span class="term-fg31">-                - &quot;internal&#47;flags&#47;categories.go&quot;</span>
<span class="term-fg31">-                - &quot;cmd&#47;geth&#47;config.go&quot;</span>
<span class="term-fg31">-            - title: &quot;Versioning&quot;</span>
<span class="term-fg31">-              description: List the op-geth and upstream go-ethereum versions.</span>
<span class="term-fg31">-              globs:</span>
<span class="term-fg31">-                - &quot;cmd&#47;geth&#47;misccmd.go&quot;</span>
<span class="term-fg31">-                - &quot;params&#47;version.go&quot;</span>
<span class="term-fg31">-                - &quot;build&#47;ci.go&quot;</span>
<span class="term-fg31">-        - title: Node config</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;ethconfig&#47;config.go&quot;</span>
<span class="term-fg31">-        - title: Tx gossip disable option</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;handler.go&quot;</span>
<span class="term-fg31">-            - &quot;eth&#47;handler_eth.go&quot;</span>
<span class="term-fg31">-        - title: Warn on missing hardfork data</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;core&#47;blockchain.go&quot;</span>
<span class="term-fg31">-        - title: Optional Engine API extensions</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;catalyst&#47;superchain.go&quot;</span>
<span class="term-fg31">-        - title: Support legacy DBs when snap-syncing</span>
<span class="term-fg31">-          description: Snap-sync does not serve unprefixed code by default.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;core&#47;blockchain_reader.go&quot;</span>
<span class="term-fg31">-            - &quot;eth&#47;protocols&#47;snap&#47;handler.go&quot;</span>
<span class="term-fg31">-        - title: Historical data for Snap-sync</span>
<span class="term-fg31">-          description: Snap-sync has access to trusted Deposit Transaction Nonce Data.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;downloader&#47;downloader.go&quot;</span>
<span class="term-fg31">-            - &quot;eth&#47;downloader&#47;receiptreference.go&quot;</span>
<span class="term-fg31">-        - title: Discv5 node discovery</span>
<span class="term-fg31">-          description: Fix discv5 option to allow discv5 to be an active source for node-discovery.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;p2p&#47;server.go&quot;</span>
<span class="term-fg31">-        - title: Bootnodes</span>
<span class="term-fg31">-          description: Discovery bootnode addresses.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;params&#47;bootnodes.go&quot;</span>
<span class="term-fg31">-        - title: Generated TOML config update</span>
<span class="term-fg32">+        - title: &quot;E2E tests&quot;</span>
           globs:
<span class="term-fg31">-            - &quot;eth&#47;ethconfig&#47;gen_config.go&quot;</span>
<span class="term-fg31">-    - title: &quot;User API enhancements&quot;</span>
<span class="term-fg31">-      description: &quot;Encode the Deposit Tx properties, the L1 costs, and daisy-chain RPC-calls for pre-Bedrock historical data&quot;</span>
<span class="term-fg31">-      sub:</span>
<span class="term-fg31">-        - title: &quot;Receipts metadata&quot;</span>
<span class="term-fg31">-          description: |</span>
<span class="term-fg31">-            Pre-Bedrock L1-cost receipt data is loaded from the database if available, and post-Bedrock the L1-cost </span>
<span class="term-fg31">-            metadata is hydrated on-the-fly based on the L1 fee information in the corresponding block.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;core&#47;types&#47;receipt.go&quot;</span>
<span class="term-fg31">-            - &quot;core&#47;types&#47;gen_receipt_json.go&quot;</span>
<span class="term-fg31">-            - &quot;core&#47;rawdb&#47;accessors_chain.go&quot;</span>
<span class="term-fg31">-        - title: &quot;API Backend&quot;</span>
<span class="term-fg31">-          description: |</span>
<span class="term-fg31">-            Forward transactions to the sequencer if configured.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;api_backend.go&quot;</span>
<span class="term-fg31">-            - &quot;eth&#47;backend.go&quot;</span>
<span class="term-fg31">-            - &quot;internal&#47;ethapi&#47;backend.go&quot;</span>
<span class="term-fg31">-        - title: &quot;Apply L1 cost in API responses&quot;</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;state_accessor.go&quot;</span>
<span class="term-fg31">-        - title: API frontend</span>
<span class="term-fg31">-          description: Format deposit and L1-cost data in transaction responses. Add `debug_chainConfig` API.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;internal&#47;ethapi&#47;api.go&quot;</span>
<span class="term-fg31">-            - &quot;rpc&#47;errors.go&quot;</span>
<span class="term-fg31">-        - title: Tracer RPC daisy-chain</span>
<span class="term-fg31">-          description: Forward pre-bedrock tracing calls to legacy node.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;tracers&#47;api.go&quot;</span>
<span class="term-fg31">-        - title: &quot;Daisy Chain tests&quot;</span>
<span class="term-fg31">-          ignore:</span>
<span class="term-fg31">-            - &quot;internal&#47;ethapi&#47;transaction_args_test.go&quot;</span>
<span class="term-fg31">-            - &quot;ethclient&#47;ethclient_test.go&quot;</span>
<span class="term-fg31">-            - &quot;eth&#47;tracers&#47;api_test.go&quot;</span>
<span class="term-fg31">-        - title: Debug API</span>
<span class="term-fg31">-          description: Fix Debug API block marshaling to include deposits</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;api_debug.go&quot;</span>
<span class="term-fg31">-        - title: Eth gasprice suggestions</span>
<span class="term-fg31">-          description: gasprice suggestion adjustments to accommodate faster L2 blocks and lower fees.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;eth&#47;gasprice&#47;gasprice.go&quot;</span>
<span class="term-fg31">-            - &quot;eth&#47;gasprice&#47;optimism-gasprice.go&quot;</span>
<span class="term-fg31">-        - title: API testvector fix</span>
<span class="term-fg31">-          description: |</span>
<span class="term-fg31">-            Upstream test of broken behavior; in Optimism, a zero signature is valid (pre-bedrock for deposit-txs),</span>
<span class="term-fg31">-            and the chain ID formula on signature data must not be used, or an underflow happens.</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;internal&#47;ethapi&#47;testdata&#47;eth_getBlockByNumber-tag-pending-fullTx.json&quot;</span>
<span class="term-fg31">-    - title: &quot;Geth extras&quot;</span>
<span class="term-fg31">-      description: Extend the tools available in geth to improve external testing and tooling.</span>
<span class="term-fg31">-      sub:</span>
<span class="term-fg31">-        - title: Simulated Backend</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;accounts&#47;abi&#47;bind&#47;backends&#47;simulated.go&quot;</span>
<span class="term-fg31">-            - &quot;ethclient&#47;simulated&#47;backend.go&quot;</span>
<span class="term-fg31">-    - title: &quot;Hardware wallet support&quot;</span>
<span class="term-fg31">-      description: Extend Ledger wallet support for newer devices on Macos</span>
<span class="term-fg31">-      sub:</span>
<span class="term-fg31">-        - title: Fix Ledger discoverability</span>
<span class="term-fg31">-          # upstream PR: https:&#47;&#47;github.com&#47;ethereum&#47;go-ethereum&#47;pull&#47;28863&#47;</span>
<span class="term-fg31">-          globs:</span>
<span class="term-fg31">-            - &quot;accounts&#47;usbwallet&#47;hub.go&quot;</span>
<span class="term-fg31">-    - title: &quot;Testing&quot;</span>
<span class="term-fg31">-      description: Additional or modified tests, not already captured by the above diff</span>
<span class="term-fg31">-      ignore:</span>
<span class="term-fg31">-        - &quot;**&#47;*_test.go&quot;</span>
<span class="term-fg32">+            - &quot;e2e_test&#47;*&quot;</span>
<span class="term-fg32">+            - &quot;e2e_test&#47;*&#47;*&quot;</span>
&nbsp;
 # ignored globally, does not count towards line count
 ignore:</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-2ed9660bd1f065d9968d6bfd" role="button"
                       aria-expanded="false" aria-controls="id-2ed9660bd1f065d9968d6bfd">
                        <code>go.mod</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/go.mod" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/go.mod" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+1</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-1</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-2ed9660bd1f065d9968d6bfd"><span class="term-fg1">diff --git op-geth&#47;go.mod CELO&#47;go.mod</span>
<span class="term-fg1">index 706b6dd393a274c7af07f5a814b358a81bf11ce2..9023cfcc0bd136a0e8f67944c9b9b1577e6a0342 100644</span>
<span class="term-fg1">--- op-geth&#47;go.mod</span>
<span class="term-fg1">+++ CELO&#47;go.mod</span>
<span class="term-fg36">@@ -22,7 +22,7 @@</span> 	github.com&#47;crate-crypto&#47;go-kzg-4844 v0.7.0
 	github.com&#47;davecgh&#47;go-spew v1.1.1
 	github.com&#47;deckarep&#47;golang-set&#47;v2 v2.1.0
 	github.com&#47;dop251&#47;goja v0.0.0-20230806174421-c933cf95e127
<span class="term-fg31">-	github.com&#47;ethereum-optimism&#47;superchain-registry&#47;superchain v0.0.0-20240603085035-9c8f6081266e</span>
<span class="term-fg32">+	github.com&#47;ethereum-optimism&#47;superchain-registry&#47;superchain v0.0.0-20240614103325-d8902381f5d8</span>
 	github.com&#47;ethereum&#47;c-kzg-4844 v0.4.0
 	github.com&#47;fatih&#47;color v1.13.0
 	github.com&#47;ferranbt&#47;fastssz v0.1.2</div>
    </div>

            
                <div class="border-bottom"><div class="row">
            <div class="col-12 col-md-4 text-start pe-2">
                
                    <a class="text-muted" data-bs-toggle="collapse" href="#id-505c4c7b4c6b5e207e481da2" role="button"
                       aria-expanded="false" aria-controls="id-505c4c7b4c6b5e207e481da2">
                        <code>go.sum</code>
                    </a>
                
            </div>

            <div class="col-12 col-sm-8 col-md-4 text-start px-2">
                <div class="row">
                    <div class="col-6">
                        
                            <a href="https://github.com/ethereum-optimism/op-geth/blob/7c2819836018bfe0ca07c4e4955754834ffad4e0/go.sum" target="_blank">op-geth <i class="bi bi-github"></i></a>
                        
                    </div>

                    <div class="col-6">
                        
                            <a href="https://github.com/celo-org/op-geth/blob/877ff8fa00a9c359412c0492f3cf834ab0dfb85d/go.sum" target="_blank">CELO <i class="bi bi-github"></i></a>
                        
                    </div>
                </div>
            </div>

            <div class="col-12 col-sm-4 ms-auto ps-2">
                
                    <div class="row line-stat">
                        
                            <div class="text-end"><span class="text-add-ignored">+4</span></div>
                            <div class="text-start"><span class="text-delete-ignored">-4</span></div>
                        
                    </div>
                
            </div>
        </div>
        <div class="collapse patch-content term-container" id="id-505c4c7b4c6b5e207e481da2"><span class="term-fg1">diff --git op-geth&#47;go.sum CELO&#47;go.sum</span>
<span class="term-fg1">index 2fd2c4d30d5ca0faa469395c5be70a0a8952e375..1a7af45565cf39e38341b7513d793287c1681bb7 100644</span>
<span class="term-fg1">--- op-geth&#47;go.sum</span>
<span class="term-fg1">+++ CELO&#47;go.sum</span>
<span class="term-fg36">@@ -45,8 +45,8 @@</span> github.com&#47;Azure&#47;azure-sdk-for-go&#47;sdk&#47;storage&#47;azblob v1.2.0&#47;go.mod h1:+6KLcKIVgxoBDMqMO&#47;Nvy7bZ9a0nbU3I1DtFQK3YvB4=
 github.com&#47;AzureAD&#47;microsoft-authentication-library-for-go v1.0.0 h1:OBhqkivkhkMqLPymWEppkm7vgPQY2XsHoEkaMQ0AdZY=
 github.com&#47;AzureAD&#47;microsoft-authentication-library-for-go v1.0.0&#47;go.mod h1:kgDmCTgBzIEPFElEF+FK0SdjAor06dRq2Go927dnQ6o=
 github.com&#47;BurntSushi&#47;toml v0.3.1&#47;go.mod h1:xHWCNGjB5oqiDr8zfno3MHue2Ht5sIBksp03qcyfWMU=
<span class="term-fg31">-github.com&#47;BurntSushi&#47;toml v1.3.2 h1:o7IhLm0Msx3BaB+n3Ag7L8EVlByGnpq14C4YWiu&#47;gL8=</span>
<span class="term-fg31">-github.com&#47;BurntSushi&#47;toml v1.3.2&#47;go.mod h1:CxXYINrC8qIiEnFrOxCa7Jy5BFHlXnUU2pbicEuybxQ=</span>
<span class="term-fg32">+github.com&#47;BurntSushi&#47;toml v1.4.0 h1:kuoIxZQy2WRRk1pttg9asf+WVv6tWQuBNVmK8+nqPr0=</span>
<span class="term-fg32">+github.com&#47;BurntSushi&#47;toml v1.4.0&#47;go.mod h1:ukJfTF&#47;6rtPPRCnwkur4qwRxa8vTRFBF0uk2lLoLwho=</span>
 github.com&#47;BurntSushi&#47;xgb v0.0.0-20160522181843-27f122750802&#47;go.mod h1:IVnqGOEym&#47;WlBOVXweHU+Q+&#47;VP0lqqI8lqeDx9IjBqo=
 github.com&#47;CloudyKit&#47;fastprinter v0.0.0-20170127035650-74b38d55f37a&#47;go.mod h1:EFZQ978U7x8IRnstaskI3IysnWY5Ao3QgZUKOXlsAdw=
 github.com&#47;CloudyKit&#47;jet v2.1.3-0.20180809161101-62edd43e4f88+incompatible&#47;go.mod h1:HPYO+50pSWkPoj9Q&#47;eq0aRGByCL6ScRlUmiEX5Zgm+w=
<span class="term-fg36">@@ -188,8 +188,8 @@</span> github.com&#47;envoyproxy&#47;go-control-plane v0.9.1-0.20191026205805-5f8ba28d4473&#47;go.mod h1:YTl&#47;9mNaCwkRvm6d1a2C3ymFceY&#47;DCBVvsKhRF0iEA4=
 github.com&#47;envoyproxy&#47;go-control-plane v0.9.4&#47;go.mod h1:6rpuAdCZL397s3pYoYcLgu1mIlRU8Am5FuJP05cCM98=
 github.com&#47;envoyproxy&#47;protoc-gen-validate v0.1.0&#47;go.mod h1:iSmxcyjqTsJpI2R4NaDN7+kN2VEUnK&#47;pcBlmesArF7c=
 github.com&#47;etcd-io&#47;bbolt v1.3.3&#47;go.mod h1:ZF2nL25h33cCyBtcyWeZ2&#47;I3HQOfTP+0PIEvHjkjCrw=
<span class="term-fg31">-github.com&#47;ethereum-optimism&#47;superchain-registry&#47;superchain v0.0.0-20240603085035-9c8f6081266e h1:PJWaF&#47;45dMhO7xdzSwuZmwIIBwnqnPr84oFNmmnpGNs=</span>
<span class="term-fg31">-github.com&#47;ethereum-optimism&#47;superchain-registry&#47;superchain v0.0.0-20240603085035-9c8f6081266e&#47;go.mod h1:7xh2awFQqsiZxFrHKTgEd+InVfDRrkKVUIuK8SAFHp0=</span>
<span class="term-fg32">+github.com&#47;ethereum-optimism&#47;superchain-registry&#47;superchain v0.0.0-20240614103325-d8902381f5d8 h1:CTeE8ZsqRwwV0z8NVazSyXgRx4aAPwtCucN&#47;IkfYqdU=</span>
<span class="term-fg32">+github.com&#47;ethereum-optimism&#47;superchain-registry&#47;superchain v0.0.0-20240614103325-d8902381f5d8&#47;go.mod h1:&#47;S7Chw9Xo8Nx6Ranq2OMyeyG+9mFvgBYvLZk4JyTw&#47;k=</span>
 github.com&#47;ethereum&#47;c-kzg-4844 v0.4.0 h1:3MS1s4JtA868KpJxroZoepdV0ZKBp3u&#47;O5HcZ7R3nlY=
 github.com&#47;ethereum&#47;c-kzg-4844 v0.4.0&#47;go.mod h1:VewdlzQmpT5QSrVhbBuGoCdFJkpaJlO1aQputP83wc0=
 github.com&#47;fasthttp-contrib&#47;websocket v0.0.0-20160511215533-1f3b11f56072&#47;go.mod h1:duJ4Jxv5lDcvg4QuQr0oowTf7dz4&#47;CR8NtyCooz9HL8=</div>
    </div>

            
        </div>
        <div>
            
        </div>
    </div>
</div>

                
            </div>
        </main>
    </div>

    <footer class="col-xl-10 col-xxl-8 mx-auto px-3 pt-5 my-5 text-muted border-top">
        <p>Fork-diff overview of changes made in <a href="https://github.com/celo-org/op-geth">Celo&rsquo;s <code>op-geth</code></a>,
a fork of <a href="https://github.com/ethereum-optimism/op-geth">Optimism&rsquo;s <code>op-geth</code></a>.</p>

    </footer>

    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js" integrity="sha384-mQ93GR66B00ZXjt0YO5KlohRA5SY2XofN4zfuZxLkoj1gXtW8ANNCe9d5Y3eG5eD" crossorigin="anonymous"></script>
    <script type="text/javascript">
        const storedTheme = localStorage.getItem('theme')

        // Get the preferred theme from the user's OS
        const getPreferredTheme = () => {
            if (storedTheme) {
                return storedTheme
            }

            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light'
        }

        // Set the bootstrap theme
        const setTheme = function (theme) {
            document.documentElement.setAttribute('data-bs-theme', theme)
            if (theme === 'dark') {
                document.getElementById('dark-mode-toggle').setAttribute('checked', true)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-high-fill', 'bi-brightness-low')
            } else {
                document.getElementById('dark-mode-toggle').setAttribute('checked', false)
                document.getElementById('dark-mode-icon').classList.replace('bi-brightness-low', 'bi-brightness-high-fill')
            }
        }

        // Returns true if the current theme is dark
        const isDark = () => {
            return document.documentElement.getAttribute('data-bs-theme') === 'dark'
        }

        // Toggles dark mode
        const toggleDarkMode = () => {
            const newTheme = isDark() ? 'light' : 'dark'
            setTheme(newTheme)
            localStorage.setItem('theme', newTheme)
        }

        // Set the preferred theme on page load
        window.onload = () => {
            // Set preferred theme
            setTheme(getPreferredTheme());
            // Initialize tooltips
            const tooltipTriggerList = document.querySelectorAll('[data-bs-toggle="tooltip"]')
            const tooltipList = [...tooltipTriggerList].map(tooltipTriggerEl => new bootstrap.Tooltip(tooltipTriggerEl))
        }

        // Toggle dark mode when the toggle button is clicked
        addEventListener("click", (event) => {
            if (event.target.id === 'dark-mode-toggle') {
                toggleDarkMode();
                // De-focus the toggle
                document.activeElement.blur()
            }
        });
    </script>
</body>
</html>
