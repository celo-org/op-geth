# yamllint disable rule:line-length rule:document-start
title: "CELO <> OP op-geth forkdiff"
footer: |
  Fork-diff overview of changes made in [Celo's `op-geth`](https://github.com/celo-org/op-geth),
  a fork of [Optimism's `op-geth`](https://github.com/ethereum-optimism/op-geth).
base:
  name: op-geth
  url: https://github.com/ethereum-optimism/op-geth
  hash: 0f5b9dcfd2ac66f6fd8faae526b1549721f5f392
fork:
  name: CELO
  url: https://github.com/celo-org/op-geth
  ref: HEAD
def:
  title: "Celo's op-geth"
  description: |
    This is an overview of the changes in [Celo's `op-geth` implementation](https://github.com/celo-org/op-geth),
    a fork of [Optimism's `op-geth`](https://github.com/ethereum-optimism/op-geth).

    For differences between the base `op-geth` and `go-ethereum`, check out Optimism's
    [fork-diff overview of changes](https://op-geth.optimism.io/).

  sub:
    - title: "Celo-specific features"
      sub:
        - title: "Celo token duality"
          description: "The Celo token is both the native token and ERC-20 compatible."
          globs:
            - "core/vm/celo_contracts*.go"
            - "core/vm/contracts*.go"
            - "core/vm/evm.go"
        - title: "Celo fee currencies"
          description: "Fee currencies allow to pay transaction fees with ERC20 tokens."
          globs:
            - "core/evm.go"
            - "contracts/fee_currencies.go"
            - "core/blockchain_celo_test.go"
            - "core/celo_evm.go"
            - "core/state_processor.go"
            - "core/state_transition.go"
            - "core/types/celo_dynamic_fee_tx.go"
            - "core/types/celo_transaction_signing.go"
            - "core/txpool/*"
            - "core/txpool/*/*"
            - "core/types/receipt*.go"
            - "core/types/transaction*.go"
            - "core/types/tx*.go"
        - title: "Celo contracts"
          description: |
            Contract bindings are necessary for token duality and gas currencies.
            The corresponding contracts are included to generate the bindings and test these features.
          globs:
<<<<<<< HEAD
            - "core/txpool/**/*"
            - "core/txpool/legacypool/*"
        - title: "RIP-7212"
          description: ""
          globs:
            - "core/vm/contracts.go"
            - "core/vm/interpreter.go"
            - "crypto/secp256r1/publickey.go"
            - "crypto/secp256r1/verifier.go"
    - title: "Chain Configuration"
      sub:
||||||| parent of c9334d8f3 (Add forkdiff comparison to op-geth (#7))
            - "core/txpool/**/*"
            - "core/txpool/legacypool/*"
    - title: "Chain Configuration"
      sub:
=======
            - "contracts/celo/*"
            - "contracts/celo/*/*"
            - "contracts/config/registry_ids.go"
            - "core/celo_backend.go"
            - "core/celo_genesis.go"
>>>>>>> c9334d8f3 (Add forkdiff comparison to op-geth (#7))
        - title: "Chain config"
          description: ""
          globs:
            - "params/config.go"
            - "params/protocol_params.go"
            - "core/genesis.go"
        - title: "E2E tests"
          globs:
<<<<<<< HEAD
            - "core/rawdb/accessors_metadata.go"
        - title: Genesis loading
          globs:
            - "core/gen_genesis.go"
        - title: "Superchain config"
          description: Testing of the superchain configuration
          globs:
            - "core/superchain.go"
            - "params/superchain.go"
    - title: "Node modifications"
      description: Changes to the node configuration and services.
      sub:
        - title: "CLI"
          sub:
            - title: "Flags"
              description: |
                Flag changes:
                  - Transactions can be forwarded to an RPC for sequencing.
                  - Historical calls can be forwarded to a legacy node.
                  - The tx pool propagation can be enabled/disabled.
                  - The Optimism bedrock fork activation can be changed for testing.
              globs:
                - "cmd/utils/flags.go"
                - "cmd/geth/main.go"
                - "internal/flags/categories.go"
                - "cmd/geth/config.go"
            - title: "Versioning"
              description: List the op-geth and upstream go-ethereum versions.
              globs:
                - "cmd/geth/misccmd.go"
                - "params/version.go"
                - "build/ci.go"
        - title: Node config
          globs:
            - "eth/ethconfig/config.go"
        - title: Tx gossip disable option
          globs:
            - "eth/handler.go"
            - "eth/handler_eth.go"
        - title: Warn on missing hardfork data
          globs:
            - "core/blockchain.go"
        - title: Optional Engine API extensions
          globs:
            - "eth/catalyst/superchain.go"
        - title: Support legacy DBs when snap-syncing
          description: Snap-sync does not serve unprefixed code by default.
          globs:
            - "core/blockchain_reader.go"
            - "eth/protocols/snap/handler.go"
        - title: Historical data for Snap-sync
          description: Snap-sync has access to trusted Deposit Transaction Nonce Data.
          globs:
            - "eth/downloader/downloader.go"
            - "eth/downloader/receiptreference.go"
        - title: Discv5 node discovery
          description: Fix discv5 option to allow discv5 to be an active source for node-discovery.
          globs:
            - "p2p/server.go"
        - title: Bootnodes
          description: Discovery bootnode addresses.
          globs:
            - "params/bootnodes.go"
        - title: Generated TOML config update
          globs:
            - "eth/ethconfig/gen_config.go"
    - title: "User API enhancements"
      description: "Encode the Deposit Tx properties, the L1 costs, and daisy-chain RPC-calls for pre-Bedrock historical data"
      sub:
        - title: "Receipts metadata"
          description: |
            Pre-Bedrock L1-cost receipt data is loaded from the database if available, and post-Bedrock the L1-cost
            metadata is hydrated on-the-fly based on the L1 fee information in the corresponding block.
          globs:
            - "core/types/receipt.go"
            - "core/types/gen_receipt_json.go"
            - "core/rawdb/accessors_chain.go"
        - title: "API Backend"
          description: |
            Forward transactions to the sequencer if configured.
          globs:
            - "eth/api_backend.go"
            - "eth/backend.go"
            - "internal/ethapi/backend.go"
        - title: "Apply L1 cost in API responses"
          globs:
            - "eth/state_accessor.go"
        - title: API frontend
          description: Format deposit and L1-cost data in transaction responses. Add `debug_chainConfig` API.
          globs:
            - "internal/ethapi/api.go"
            - "rpc/errors.go"
        - title: Tracer RPC daisy-chain
          description: Forward pre-bedrock tracing calls to legacy node.
          globs:
            - "eth/tracers/api.go"
        - title: "Daisy Chain tests"
          ignore:
            - "internal/ethapi/transaction_args_test.go"
            - "ethclient/ethclient_test.go"
            - "eth/tracers/api_test.go"
        - title: Debug API
          description: Fix Debug API block marshaling to include deposits
          globs:
            - "eth/api_debug.go"
        - title: Eth gasprice suggestions
          description: gasprice suggestion adjustments to accommodate faster L2 blocks and lower fees.
          globs:
            - "eth/gasprice/gasprice.go"
            - "eth/gasprice/optimism-gasprice.go"
        - title: API testvector fix
          description: |
            Upstream test of broken behavior; in Optimism, a zero signature is valid (pre-bedrock for deposit-txs),
            and the chain ID formula on signature data must not be used, or an underflow happens.
          globs:
            - "internal/ethapi/testdata/eth_getBlockByNumber-tag-pending-fullTx.json"
    - title: "Geth extras"
      description: Extend the tools available in geth to improve external testing and tooling.
      sub:
        - title: Simulated Backend
          globs:
            - "accounts/abi/bind/backends/simulated.go"
            - "ethclient/simulated/backend.go"
        - title: Live tracer update
          description: |
            Track L1-deposited native currency that is coming into the L2 supply.
            The balance delta is considered to be a "withdrawal" from L1,
            similar to a withdrawal of the Beacon-chain into the Ethereum L1 execution chain.
          globs:
            - "eth/tracers/live/supply.go"
    - title: "Hardware wallet support"
      description: Extend Ledger wallet support for newer devices on Macos
      sub:
        - title: Fix Ledger discoverability
          # upstream PR: https://github.com/ethereum/go-ethereum/pull/28863/
          globs:
            - "accounts/usbwallet/hub.go"
    - title: "Testing"
      description: Additional or modified tests, not already captured by the above diff
      ignore:
        - "**/*_test.go"
||||||| parent of c9334d8f3 (Add forkdiff comparison to op-geth (#7))
            - "core/rawdb/accessors_metadata.go"
        - title: Genesis loading
          globs:
            - "core/gen_genesis.go"
        - title: "Superchain config"
          description: Testing of the superchain configuration
          globs:
            - "core/superchain.go"
            - "params/superchain.go"
    - title: "Node modifications"
      description: Changes to the node configuration and services.
      sub:
        - title: "CLI"
          sub:
            - title: "Flags"
              description: |
                Flag changes:
                  - Transactions can be forwarded to an RPC for sequencing.
                  - Historical calls can be forwarded to a legacy node.
                  - The tx pool propagation can be enabled/disabled.
                  - The Optimism bedrock fork activation can be changed for testing.
              globs:
                - "cmd/utils/flags.go"
                - "cmd/geth/main.go"
                - "internal/flags/categories.go"
                - "cmd/geth/config.go"
            - title: "Versioning"
              description: List the op-geth and upstream go-ethereum versions.
              globs:
                - "cmd/geth/misccmd.go"
                - "params/version.go"
                - "build/ci.go"
        - title: Node config
          globs:
            - "eth/ethconfig/config.go"
        - title: Tx gossip disable option
          globs:
            - "eth/handler.go"
            - "eth/handler_eth.go"
        - title: Warn on missing hardfork data
          globs:
            - "core/blockchain.go"
        - title: Optional Engine API extensions
          globs:
            - "eth/catalyst/superchain.go"
        - title: Support legacy DBs when snap-syncing
          description: Snap-sync does not serve unprefixed code by default.
          globs:
            - "core/blockchain_reader.go"
            - "eth/protocols/snap/handler.go"
        - title: Historical data for Snap-sync
          description: Snap-sync has access to trusted Deposit Transaction Nonce Data.
          globs:
            - "eth/downloader/downloader.go"
            - "eth/downloader/receiptreference.go"
        - title: Discv5 node discovery
          description: Fix discv5 option to allow discv5 to be an active source for node-discovery.
          globs:
            - "p2p/server.go"
        - title: Bootnodes
          description: Discovery bootnode addresses.
          globs:
            - "params/bootnodes.go"
        - title: Generated TOML config update
          globs:
            - "eth/ethconfig/gen_config.go"
    - title: "User API enhancements"
      description: "Encode the Deposit Tx properties, the L1 costs, and daisy-chain RPC-calls for pre-Bedrock historical data"
      sub:
        - title: "Receipts metadata"
          description: |
            Pre-Bedrock L1-cost receipt data is loaded from the database if available, and post-Bedrock the L1-cost
            metadata is hydrated on-the-fly based on the L1 fee information in the corresponding block.
          globs:
            - "core/types/receipt.go"
            - "core/types/gen_receipt_json.go"
            - "core/rawdb/accessors_chain.go"
        - title: "API Backend"
          description: |
            Forward transactions to the sequencer if configured.
          globs:
            - "eth/api_backend.go"
            - "eth/backend.go"
            - "internal/ethapi/backend.go"
        - title: "Apply L1 cost in API responses"
          globs:
            - "eth/state_accessor.go"
        - title: API frontend
          description: Format deposit and L1-cost data in transaction responses. Add `debug_chainConfig` API.
          globs:
            - "internal/ethapi/api.go"
            - "rpc/errors.go"
        - title: Tracer RPC daisy-chain
          description: Forward pre-bedrock tracing calls to legacy node.
          globs:
            - "eth/tracers/api.go"
        - title: "Daisy Chain tests"
          ignore:
            - "internal/ethapi/transaction_args_test.go"
            - "ethclient/ethclient_test.go"
            - "eth/tracers/api_test.go"
        - title: Debug API
          description: Fix Debug API block marshaling to include deposits
          globs:
            - "eth/api_debug.go"
        - title: Eth gasprice suggestions
          description: gasprice suggestion adjustments to accommodate faster L2 blocks and lower fees.
          globs:
            - "eth/gasprice/gasprice.go"
            - "eth/gasprice/optimism-gasprice.go"
        - title: API testvector fix
          description: |
            Upstream test of broken behavior; in Optimism, a zero signature is valid (pre-bedrock for deposit-txs),
            and the chain ID formula on signature data must not be used, or an underflow happens.
          globs:
            - "internal/ethapi/testdata/eth_getBlockByNumber-tag-pending-fullTx.json"
    - title: "Geth extras"
      description: Extend the tools available in geth to improve external testing and tooling.
      sub:
        - title: Simulated Backend
          globs:
            - "accounts/abi/bind/backends/simulated.go"
            - "ethclient/simulated/backend.go"
    - title: "Hardware wallet support"
      description: Extend Ledger wallet support for newer devices on Macos
      sub:
        - title: Fix Ledger discoverability
          # upstream PR: https://github.com/ethereum/go-ethereum/pull/28863/
          globs:
            - "accounts/usbwallet/hub.go"
    - title: "Testing"
      description: Additional or modified tests, not already captured by the above diff
      ignore:
        - "**/*_test.go"
=======
            - "e2e_test/*"
            - "e2e_test/*/*"
>>>>>>> c9334d8f3 (Add forkdiff comparison to op-geth (#7))

# ignored globally, does not count towards line count
ignore:
  - ".circleci/*"
  - "*.sum"
  - "go.mod"
  - "fork.yaml"
  - "Makefile"
  - ".golangci.yml"
  - ".github/**"
  - "**/*.gob" # data asset, not code
  - "core/vm/testdata/precompiles/p256Verify.json" # data asset, not code
  - "eth/tracers/internal/tracetest/testdata/**/*.json"
